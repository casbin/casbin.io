"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[6650],{3905:(e,a,n)=>{n.d(a,{Zo:()=>u,kt:()=>p});var i=n(7294);function l(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function r(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,i)}return n}function t(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?r(Object(n),!0).forEach((function(a){l(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function k(e,a){if(null==e)return{};var n,i,l=function(e,a){if(null==e)return{};var n,i,l={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],a.indexOf(n)>=0||(l[n]=e[n]);return l}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=i.createContext({}),o=function(e){var a=i.useContext(s),n=a;return e&&(n="function"==typeof e?e(a):t(t({},a),e)),n},u=function(e){var a=o(e.components);return i.createElement(s.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return i.createElement(i.Fragment,{},a)}},m=i.forwardRef((function(e,a){var n=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,u=k(e,["components","mdxType","originalType","parentName"]),m=o(n),p=l,b=m["".concat(s,".").concat(p)]||m[p]||d[p]||r;return n?i.createElement(b,t(t({ref:a},u),{},{components:n})):i.createElement(b,t({ref:a},u))}));function p(e,a){var n=arguments,l=a&&a.mdxType;if("string"==typeof e||l){var r=n.length,t=new Array(r);t[0]=m;var k={};for(var s in a)hasOwnProperty.call(a,s)&&(k[s]=a[s]);k.originalType=e,k.mdxType="string"==typeof e?e:l,t[1]=k;for(var o=2;o<r;o++)t[o]=n[o];return i.createElement.apply(null,t)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7503:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>s,contentTitle:()=>t,default:()=>d,frontMatter:()=>r,metadata:()=>k,toc:()=>o});var i=n(7462),l=(n(7294),n(3905));const r={id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Kubernetes (K8s) RBAC & ABAC Yetkilendirme Ara Yaz\u0131l\u0131m\u0131, Casbin Tabanl\u0131",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},t=void 0,k={unversionedId:"k8s-gatekeeper",id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Kubernetes (K8s) RBAC & ABAC Yetkilendirme Ara Yaz\u0131l\u0131m\u0131, Casbin Tabanl\u0131",source:"@site/i18n/tr/docusaurus-plugin-content-docs/current/K8sGateKeeper.mdx",sourceDirName:".",slug:"/k8s-gatekeeper",permalink:"/tr/docs/k8s-gatekeeper",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sGateKeeper.mdx",tags:[],version:"current",frontMatter:{id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Kubernetes (K8s) RBAC & ABAC Yetkilendirme Ara Yaz\u0131l\u0131m\u0131, Casbin Tabanl\u0131",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},sidebar:"docs",previous:{title:"Authorization of Kubernetes",permalink:"/tr/docs/k8s"},next:{title:"Authorization of Service Mesh through Envoy",permalink:"/tr/docs/envoy"}},s={},o=[{value:"1. Casbin K8s-Gatekeeper i\xe7in Genel Bak\u0131\u015f &amp; Belgeler",id:"1-casbin-k8s-gatekeeper-i\xe7in-genel-bak\u0131\u015f--belgeler",level:2},{value:"0.1 Basit Bir \xd6rnek",id:"01-basit-bir-\xf6rnek",level:3},{value:"1.1 Casbin K8s-Gatekeeper Nas\u0131l \xc7al\u0131\u015f\u0131r?",id:"11-casbin-k8s-gatekeeper-nas\u0131l-\xe7al\u0131\u015f\u0131r",level:3},{value:"1.2 Nas\u0131l \xc7al\u0131\u015ft\u0131\u011f\u0131n\u0131 G\xf6steren Bir \xd6rnek",id:"12-nas\u0131l-\xe7al\u0131\u015ft\u0131\u011f\u0131n\u0131-g\xf6steren-bir-\xf6rnek",level:3},{value:"2 K8s-gatekeeper&#39;\u0131 Y\xfckle",id:"2-k8s-gatekeeper\u0131-y\xfckle",level:2},{value:"2.1.1 Ad\u0131m 1: G\xf6r\xfcnt\xfcy\xfc Olu\u015ftur",id:"211-ad\u0131m-1-g\xf6r\xfcnt\xfcy\xfc-olu\u015ftur",level:3},{value:"\u0130\xe7 webhook y\xf6ntemi i\xe7in, webhook kendisi Kubernetes i\xe7inde bir hizmet olarak uygulanacakt\u0131r.",id:"i\u0307\xe7-webhook-y\xf6ntemi-i\xe7in-webhook-kendisi-kubernetes-i\xe7inde-bir-hizmet-olarak-uygulanacakt\u0131r",level:4},{value:"2.1.2 Ad\u0131m 2: K8s-gatekeeper i\xe7in hizmetler ve da\u011f\u0131t\u0131mlar\u0131 ayarlay\u0131n",id:"212-ad\u0131m-2-k8s-gatekeeper-i\xe7in-hizmetler-ve-da\u011f\u0131t\u0131mlar\u0131-ayarlay\u0131n",level:4},{value:"2.1.3 Ad\u0131m 3: K8s-gatekeeper i\xe7in CRD Kaynaklar\u0131n\u0131 Y\xfckleyin",id:"213-ad\u0131m-3-k8s-gatekeeper-i\xe7in-crd-kaynaklar\u0131n\u0131-y\xfckleyin",level:4},{value:"2.2 D\u0131\u015f webhook",id:"22-d\u0131\u015f-webhook",level:3},{value:"2.3.1 Ad\u0131m 1: G\xf6r\xfcnt\xfcy\xfc olu\u015fturma",id:"231-ad\u0131m-1-g\xf6r\xfcnt\xfcy\xfc-olu\u015fturma",level:3},{value:"2.3.1 Ad\u0131m 1: G\xf6r\xfcnt\xfcy\xfc olu\u015fturun",id:"231-ad\u0131m-1-g\xf6r\xfcnt\xfcy\xfc-olu\u015fturun",level:4},{value:"2.3.2 Helm kurulumu",id:"232-helm-kurulumu",level:4},{value:"3. K8s-gatekeeper&#39;i deneyin",id:"3-k8s-gatekeeperi-deneyin",level:2},{value:"3.1 Casbin Model ve Politika Olu\u015fturma",id:"31-casbin-model-ve-politika-olu\u015fturma",level:3},{value:"3.1.1 Casbin Model ve Politikay\u0131 kubectl ile Olu\u015fturma/G\xfcncelleme",id:"311-casbin-model-ve-politikay\u0131-kubectl-ile-olu\u015fturmag\xfcncelleme",level:4},{value:"3.1.2 Casbin Model ve Politikas\u0131n\u0131 sa\u011flad\u0131\u011f\u0131m\u0131z go-client \xfczerinden Olu\u015fturma/G\xfcncelleme",id:"312-casbin-model-ve-politikas\u0131n\u0131-sa\u011flad\u0131\u011f\u0131m\u0131z-go-client-\xfczerinden-olu\u015fturmag\xfcncelleme",level:4},{value:"3.1.2 K8s-gatekeeper&#39;\u0131n \xc7al\u0131\u015f\u0131p \xc7al\u0131\u015fmad\u0131\u011f\u0131n\u0131 Deneyin",id:"312-k8s-gatekeeper\u0131n-\xe7al\u0131\u015f\u0131p-\xe7al\u0131\u015fmad\u0131\u011f\u0131n\u0131-deneyin",level:3},{value:"4. K8s-gatekeeper ile Model ve Politika Nas\u0131l Yaz\u0131l\u0131r",id:"4-k8s-gatekeeper-ile-model-ve-politika-nas\u0131l-yaz\u0131l\u0131r",level:2},{value:"4.1 Modelin \u0130stek Tan\u0131m\u0131",id:"41-modelin-i\u0307stek-tan\u0131m\u0131",level:3},{value:"4.2 Modelin E\u015fle\u015ftiricileri",id:"42-modelin-e\u015fle\u015ftiricileri",level:3},{value:"4.2.1 Uzant\u0131 Fonksiyonlar\u0131",id:"421-uzant\u0131-fonksiyonlar\u0131",level:3},{value:"4.2.1.1 eri\u015fim",id:"4211-eri\u015fim",level:4},{value:"4.2.1.2 accessWithWildcard",id:"4212-accesswithwildcard",level:4},{value:"4.2.1.3 De\u011fi\u015fken Uzunluklu Arg\xfcmanlar\u0131 Destekleyen Fonksiyonlar",id:"4213-de\u011fi\u015fken-uzunluklu-arg\xfcmanlar\u0131-destekleyen-fonksiyonlar",level:3},{value:"4.2.1.2 T\xfcr D\xf6n\xfc\u015ft\xfcrme Fonksiyonlar\u0131",id:"4212-t\xfcr-d\xf6n\xfc\u015ft\xfcrme-fonksiyonlar\u0131",level:4},{value:"5. Geli\u015fmi\u015f Ayarlar",id:"5-geli\u015fmi\u015f-ayarlar",level:2},{value:"5.1 Sertifikalar Hakk\u0131nda",id:"51-sertifikalar-hakk\u0131nda",level:3},{value:"5.1.1 Kendinden imzal\u0131 sertifikalar",id:"511-kendinden-imzal\u0131-sertifikalar",level:4},{value:"5.1.2 Yasal sertifikalar",id:"512-yasal-sertifikalar",level:4}],u={toc:o};function d(e){let{components:a,...n}=e;return(0,l.kt)("wrapper",(0,i.Z)({},u,n,{components:a,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"1-casbin-k8s-gatekeeper-i\xe7in-genel-bak\u0131\u015f--belgeler"},"1. Casbin K8s-Gatekeeper i\xe7in Genel Bak\u0131\u015f & Belgeler"),(0,l.kt)("p",null,"Casbin K8s-GateKeeper, Casbin'i Eri\u015fim Kontrol Arac\u0131 Olarak Entegre Eden Bir Kubernetes Kabul Webhook'udur. Casbin K8s-GateKeeper'\u0131 kullanarak, K8s kaynaklar\u0131 \xfczerindeki herhangi bir i\u015flemi yetkilendirmek veya engellemek i\xe7in esnek kurallar olu\u015fturabilirsiniz, HERHANG\u0130 B\u0130R KOD YAZMADAN, sadece Casbin modellerinin ve politikalar\u0131n\u0131n birka\xe7 sat\u0131rl\u0131k bildirimsel yap\u0131land\u0131rmalar\u0131 ile, bu da Casbin ACL (Eri\u015fim Kontrol Listesi) dilinin bir par\xe7as\u0131d\u0131r."),(0,l.kt)("p",null,"Casbin K8s-GateKeeper, Casbin toplulu\u011fu taraf\u0131ndan geli\u015ftirilmekte ve s\xfcrd\xfcr\xfclmektedir. Bu projenin deposu \u015fu adreste mevcuttur: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-gatekeeper"},"https://github.com/casbin/k8s-gatekeeper")),(0,l.kt)("h3",{id:"01-basit-bir-\xf6rnek"},"0.1 Basit Bir \xd6rnek"),(0,l.kt)("p",null,'\xd6rne\u011fin, herhangi bir kod yazman\u0131za gerek yok, ancak bu i\u015flevi ger\xe7ekle\u015ftirmek i\xe7in a\u015fa\u011f\u0131daki yap\u0131land\u0131rma sat\u0131rlar\u0131n\u0131 kullan\u0131n: "Baz\u0131 belirli etiketlere sahip g\xf6r\xfcnt\xfclerin herhangi bir da\u011f\u0131t\u0131mda kullan\u0131lmas\u0131n\u0131 yasaklamak":'),(0,l.kt)("p",null,"Model:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\ncontain(split(accessWithWildcard(${OBJECT}.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,l.kt)("p",null,"And Policy:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csv"},'p, "1.14.1",deny\n')),(0,l.kt)("p",null,"Bunlar, s\u0131radan Casbin ACL dilindedir. E\u011fer bunlarla ilgili b\xf6l\xfcmleri zaten okuduysan\u0131z, anlamak \xe7ok kolay olacakt\u0131r."),(0,l.kt)("p",null,"Casbin K8s-GateKeeper a\u015fa\u011f\u0131daki avantajlara sahiptir:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Kullan\u0131m\u0131 kolayd\u0131r. ACL'nin birka\xe7 sat\u0131r\u0131n\u0131 yazmak, bir\xe7ok kod yazmaktan \xe7ok daha iyidir."),(0,l.kt)("li",{parentName:"ul"},"Yap\u0131land\u0131rmalar\u0131n s\u0131cak g\xfcncellemelerine izin verir. Yap\u0131land\u0131rmalar\u0131 de\u011fi\u015ftirmek i\xe7in t\xfcm eklentiyi kapatman\u0131za gerek yoktur."),(0,l.kt)("li",{parentName:"ul"},"Esnek bir yap\u0131dad\u0131r. Herhangi bir K8s kayna\u011f\u0131 \xfczerinde keyfi kurallar olu\u015fturulabilir, bunlar ",(0,l.kt)("inlineCode",{parentName:"li"},"kubectl gatekeeper")," ile ke\u015ffedilebilir."),(0,l.kt)("li",{parentName:"ul"},"K8s kabul webhook'unun uygulanmas\u0131n\u0131 basitle\u015ftirir, ki bu \xe7ok karma\u015f\u0131kt\u0131r. K8s kabul webhook'unun ne oldu\u011funu veya onun i\xe7in kod yazmay\u0131 bilmenize gerek yoktur. Tek yapman\u0131z gereken, k\u0131s\u0131tlamalar koymak istedi\u011finiz kayna\u011f\u0131 bilmek ve ard\u0131ndan Casbin ACL yazmakt\u0131r. Herkes K8s'nin karma\u015f\u0131k oldu\u011funu biliyor, ancak Casbin K8s-Gatekeeper kullanarak zaman\u0131n\u0131z\u0131 koruyabilirsiniz."),(0,l.kt)("li",{parentName:"ul"},"Casbin toplulu\u011fu taraf\u0131ndan bak\u0131m\u0131 yap\u0131lmaktad\u0131r. E\u011fer bu eklentiyle ilgili herhangi bir \u015fey kafan\u0131z\u0131 kar\u0131\u015ft\u0131r\u0131yorsa veya bunu deneyimlerken herhangi bir sorunla kar\u015f\u0131la\u015f\u0131rsan\u0131z, l\xfctfen bizimle ileti\u015fime ge\xe7mekten \xe7ekinmeyin.")),(0,l.kt)("h3",{id:"11-casbin-k8s-gatekeeper-nas\u0131l-\xe7al\u0131\u015f\u0131r"},"1.1 Casbin K8s-Gatekeeper Nas\u0131l \xc7al\u0131\u015f\u0131r?"),(0,l.kt)("p",null,"K8s-Gatekeeper, K8s i\xe7in bir kabul webhook'u olup, y\xf6neticinin istemedi\u011fi herhangi bir K8s i\u015flemi \xf6nlemeye yard\u0131mc\u0131 olmak i\xe7in ",(0,l.kt)("a",{parentName:"p",href:"/docs/overview"},"Casbin")," kullanarak kullan\u0131c\u0131 tan\u0131ml\u0131 rastgele eri\u015fim kontrol kurallar\u0131n\u0131 uygular."),(0,l.kt)("p",null,"Casbin, g\xfc\xe7l\xfc ve verimli a\xe7\u0131k kaynakl\u0131 bir eri\u015fim kontrol k\xfct\xfcphanesidir. \xc7e\u015fitli eri\u015fim kontrol modellerine dayal\u0131 yetkilendirmeyi uygulamak i\xe7in destek sa\u011flar. Casbin hakk\u0131nda daha fazla ayr\u0131nt\u0131 i\xe7in, ",(0,l.kt)("a",{parentName:"p",href:"/docs/overview"},"Genel Bak\u0131\u015f")," b\xf6l\xfcm\xfcne bak\u0131n."),(0,l.kt)("p",null,"K8s'deki kabul webhook'lar\u0131, 'kabul taleplerini' alan ve bunlarla bir \u015feyler yapan HTTP geri \xe7a\u011fr\u0131lar\u0131d\u0131r. \xd6zellikle, K8s-Gatekeeper \xf6zel bir t\xfcr kabul webhook'udur: 'ValidatingAdmissionWebhook', bu kabul talebinin kabul edilip edilmeyece\u011fine karar verebilir. Kabul talepleriyle ilgili olarak, bunlar K8s'nin belirli kaynaklar\u0131 \xfczerinde bir i\u015flemi (\xf6rne\u011fin, bir da\u011f\u0131t\u0131m\u0131n olu\u015fturulmas\u0131/silinmesi) tan\u0131mlayan HTTP istekleridir. Kabul webhook'lar\u0131 hakk\u0131nda daha fazla bilgi i\xe7in, ",(0,l.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks"},"K8s resmi belgelerine")," bak\u0131n."),(0,l.kt)("h3",{id:"12-nas\u0131l-\xe7al\u0131\u015ft\u0131\u011f\u0131n\u0131-g\xf6steren-bir-\xf6rnek"},"1.2 Nas\u0131l \xc7al\u0131\u015ft\u0131\u011f\u0131n\u0131 G\xf6steren Bir \xd6rnek"),(0,l.kt)("p",null,"\xd6rne\u011fin, birisi nginx \xe7al\u0131\u015ft\u0131ran bir pod i\xe7eren bir da\u011f\u0131t\u0131m olu\u015fturmak istedi\u011finde (kubectl veya K8s istemcileri kullanarak), K8s bir kabul talebi olu\u015fturacakt\u0131r, bu (YAML format\u0131na \xe7evrildi\u011finde) \u015f\xf6yle bir \u015fey olabilir:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.14.1\n        ports:\n        - containerPort: 80\n")),(0,l.kt)("p",null,"Bu talep, resimde g\xf6sterilen t\xfcm ara yaz\u0131l\u0131mlar\u0131n i\u015fleminden ge\xe7ecektir, K8s-Gatekeeper da dahil. K8s-Gatekeeper, K8s'in etcd'sinde saklanan t\xfcm Casbin zorlay\u0131c\u0131lar\u0131n\u0131 tespit edebilir, bu zorlay\u0131c\u0131lar kullan\u0131c\u0131 taraf\u0131ndan (",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," veya sa\u011flad\u0131\u011f\u0131m\u0131z Go istemcisi arac\u0131l\u0131\u011f\u0131yla) olu\u015fturulur ve s\xfcrd\xfcr\xfcl\xfcr. Her zorlay\u0131c\u0131, bir Casbin modeli ve bir Casbin politikas\u0131 i\xe7erir. Kabul talebi, her zorlay\u0131c\u0131 taraf\u0131ndan s\u0131rayla i\u015flenecek ve sadece t\xfcm zorlay\u0131c\u0131lar\u0131 ge\xe7en bir talebin bu K8s-Gatekeeper taraf\u0131ndan kabul edilmesi m\xfcmk\xfcn olacakt\u0131r."),(0,l.kt)("p",null,"(E\u011fer Casbin zorlay\u0131c\u0131s\u0131, model veya politikas\u0131 ne oldu\u011funu anlam\u0131yorsan\u0131z, bu belgeye bak\u0131n: ",(0,l.kt)("a",{parentName:"p",href:"/docs/get-started"},"Ba\u015flarken"),")."),(0,l.kt)("p",null,"\xd6rne\u011fin, baz\u0131 nedenlerden dolay\u0131, y\xf6netici 'nginx:1.14.1' g\xf6r\xfcnt\xfcs\xfcn\xfcn g\xf6r\xfcnmesini yasaklamak ve 'nginx:1.3.1' g\xf6r\xfcnt\xfcs\xfcn\xfcn g\xf6r\xfcnmesine izin vermek istiyor. A\u015fa\u011f\u0131daki kural\u0131 ve politikay\u0131 i\xe7eren bir zorlay\u0131c\u0131 olu\u015fturulabilir (Bir zorlay\u0131c\u0131n\u0131n nas\u0131l olu\u015fturulaca\u011f\u0131n\u0131, bu modellerin ve politikalar\u0131n ne oldu\u011funu ve bunlar\u0131n nas\u0131l yaz\u0131laca\u011f\u0131n\u0131 sonraki b\xf6l\xfcmlerde a\xe7\u0131klayaca\u011f\u0131z)."),(0,l.kt)("p",null,"Model:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n\n')),(0,l.kt)("p",null,"Policy:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csv"},'p, "nginx:1.13.1",allow\np, "nginx:1.14.1",deny\n')),(0,l.kt)("p",null,"Yukar\u0131daki model ve politika i\xe7eren bir zorlay\u0131c\u0131 olu\u015fturarak, \xf6nceki kabul talebi bu zorlay\u0131c\u0131 taraf\u0131ndan reddedilecektir, yani K8s bu da\u011f\u0131t\u0131m\u0131 olu\u015fturmayacakt\u0131r."),(0,l.kt)("h2",{id:"2-k8s-gatekeeper\u0131-y\xfckle"},"2 K8s-gatekeeper'\u0131 Y\xfckle"),(0,l.kt)("p",null,"K8s-gatekeeper'\u0131 y\xfcklemek i\xe7in \xfc\xe7 y\xf6ntem mevcuttur: D\u0131\u015f webhook, \u0130\xe7 webhook ve Helm."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"Not: Bu y\xf6ntemler yaln\u0131zca kullan\u0131c\u0131lar\u0131n K8s-gatekeeper'\u0131 denemeleri i\xe7in tasarlanm\u0131\u015ft\u0131r ve g\xfcvenli de\u011fildir. E\u011fer \xfcretim ortam\u0131nda kullanmak istiyorsan\u0131z, l\xfctfen y\xfcklemeden \xf6nce ",(0,l.kt)("a",{parentName:"p",href:"#5-advanced-settings"},"B\xf6l\xfcm 5. Geli\u015fmi\u015f Ayarlar")," b\xf6l\xfcm\xfcn\xfc okudu\u011funuzdan ve gerekli de\u011fi\u015fiklikleri yapt\u0131\u011f\u0131n\u0131zdan emin olun. 2.1 \u0130\xe7 Webhook")),(0,l.kt)("h3",{id:"211-ad\u0131m-1-g\xf6r\xfcnt\xfcy\xfc-olu\u015ftur"},"2.1.1 Ad\u0131m 1: G\xf6r\xfcnt\xfcy\xfc Olu\u015ftur"),(0,l.kt)("h4",{id:"i\u0307\xe7-webhook-y\xf6ntemi-i\xe7in-webhook-kendisi-kubernetes-i\xe7inde-bir-hizmet-olarak-uygulanacakt\u0131r"},"\u0130\xe7 webhook y\xf6ntemi i\xe7in, webhook kendisi Kubernetes i\xe7inde bir hizmet olarak uygulanacakt\u0131r."),(0,l.kt)("p",null,"\u0130\xe7 webhook y\xf6ntemi i\xe7in, webhook kendisi Kubernetes i\xe7inde bir servis olarak uygulanacak. Gerekli hizmet ve da\u011f\u0131t\u0131m\u0131 olu\u015fturmak i\xe7in bir K8s-gatekeeper g\xf6r\xfcnt\xfcs\xfc olu\u015fturman\u0131z gerekiyor. Kendi g\xf6r\xfcnt\xfcn\xfcz\xfc olu\u015fturmak i\xe7in a\u015fa\u011f\u0131daki komutu \xe7al\u0131\u015ft\u0131rabilirsiniz:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"docker build --target webhook -t k8s-gatekeeper .\n")),(0,l.kt)("p",null,"Bu komut, 'k8s-gatekeeper:latest' ad\u0131nda yerel bir g\xf6r\xfcnt\xfc olu\u015fturacakt\u0131r."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"Not: E\u011fer minikube kullan\u0131yorsan\u0131z, 'docker build' komutunu \xe7al\u0131\u015ft\u0131rmadan \xf6nce ",(0,l.kt)("inlineCode",{parentName:"p"},"eval $(minikube -p minikube docker-env)")," komutunu \xe7al\u0131\u015ft\u0131r\u0131n.")),(0,l.kt)("h4",{id:"212-ad\u0131m-2-k8s-gatekeeper-i\xe7in-hizmetler-ve-da\u011f\u0131t\u0131mlar\u0131-ayarlay\u0131n"},"2.1.2 Ad\u0131m 2: K8s-gatekeeper i\xe7in hizmetler ve da\u011f\u0131t\u0131mlar\u0131 ayarlay\u0131n"),(0,l.kt)("p",null,"A\u015fa\u011f\u0131daki komutlar\u0131 \xe7al\u0131\u015ft\u0131r\u0131n:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/rbac.yaml\nkubectl apply -f config/webhook_deployment.yaml \nkubectl apply -f config/webhook_internal.yaml \n")),(0,l.kt)("p",null,"Bu, K8s-gatekeeper'\u0131 \xe7al\u0131\u015ft\u0131rmaya ba\u015flayacak ve bunu ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl get pods")," komutunu \xe7al\u0131\u015ft\u0131rarak onaylayabilirsiniz."),(0,l.kt)("h4",{id:"213-ad\u0131m-3-k8s-gatekeeper-i\xe7in-crd-kaynaklar\u0131n\u0131-y\xfckleyin"},"2.1.3 Ad\u0131m 3: K8s-gatekeeper i\xe7in CRD Kaynaklar\u0131n\u0131 Y\xfckleyin"),(0,l.kt)("p",null,"A\u015fa\u011f\u0131daki komutlar\u0131 \xe7al\u0131\u015ft\u0131r\u0131n:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\n")),(0,l.kt)("h3",{id:"22-d\u0131\u015f-webhook"},"2.2 D\u0131\u015f webhook"),(0,l.kt)("p",null,"Harici webhook y\xf6ntemi i\xe7in, K8s-gatekeeper Kubernetes d\u0131\u015f\u0131nda \xe7al\u0131\u015facak ve Kubernetes, K8s-gatekeeper'a normal bir web sitesine eri\u015fir gibi eri\u015fecektir. Kubernetes, admission webhook'un HTTPS olmas\u0131 zorunlulu\u011funu ta\u015f\u0131maktad\u0131r. K8s-gatekeeper'\u0131 denemek amac\u0131yla, bir dizi sertifika ve \xf6zel anahtar sa\u011flad\u0131k (bu g\xfcvenli de\u011fildir). Kendi sertifikan\u0131z\u0131 kullanmay\u0131 tercih ederseniz, sertifika ve \xf6zel anahtar\u0131 ayarlama talimatlar\u0131 i\xe7in ",(0,l.kt)("a",{parentName:"p",href:"#5-advanced-settings"},"B\xf6l\xfcm 5. Geli\u015fmi\u015f Ayarlar")," b\xf6l\xfcm\xfcne bak\u0131n. Sa\u011flad\u0131\u011f\u0131m\u0131z sertifika 'webhook.domain.local' i\xe7in d\xfczenlenmi\u015ftir."),(0,l.kt)("p",null,"Bu nedenle, ana bilgisayar\u0131 (\xf6r. /etc/hosts) de\u011fi\u015ftirin ve 'webhook.domain.local'\u0131 K8s-gatekeeper'\u0131n \xe7al\u0131\u015ft\u0131\u011f\u0131 IP adresine y\xf6nlendirin. Ard\u0131ndan a\u015fa\u011f\u0131daki komutu \xe7al\u0131\u015ft\u0131r\u0131n:"),(0,l.kt)("p",null,"2.3 Helm arac\u0131l\u0131\u011f\u0131yla K8s-gatekeeper'\u0131 y\xfckleme"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"go mod tidy\ngo mod vendor\ngo run cmd/webhook/main.go\nkubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\nkubectl apply -f config/webhook_external.yaml \n")),(0,l.kt)("h3",{id:"231-ad\u0131m-1-g\xf6r\xfcnt\xfcy\xfc-olu\u015fturma"},"2.3.1 Ad\u0131m 1: G\xf6r\xfcnt\xfcy\xfc olu\u015fturma"),(0,l.kt)("h4",{id:"231-ad\u0131m-1-g\xf6r\xfcnt\xfcy\xfc-olu\u015fturun"},"2.3.1 Ad\u0131m 1: G\xf6r\xfcnt\xfcy\xfc olu\u015fturun"),(0,l.kt)("p",null,"L\xfctfen ",(0,l.kt)("a",{parentName:"p",href:"#211-step-1-build-the-image"},"B\xf6l\xfcm 2.1.1")," b\xf6l\xfcm\xfcne bak\u0131n."),(0,l.kt)("h4",{id:"232-helm-kurulumu"},"2.3.2 Helm kurulumu"),(0,l.kt)("p",null,"Komutu \xe7al\u0131\u015ft\u0131r\u0131n: ",(0,l.kt)("inlineCode",{parentName:"p"},"helm install k8sgatekeeper ./k8sgatekeeper"),"."),(0,l.kt)("h2",{id:"3-k8s-gatekeeperi-deneyin"},"3. K8s-gatekeeper'i deneyin"),(0,l.kt)("h3",{id:"31-casbin-model-ve-politika-olu\u015fturma"},"3.1 Casbin Model ve Politika Olu\u015fturma"),(0,l.kt)("p",null,"Bir model ve politika olu\u015fturmak i\xe7in iki y\xf6nteminiz var: kubectl arac\u0131l\u0131\u011f\u0131yla veya sa\u011flad\u0131\u011f\u0131m\u0131z go-client arac\u0131l\u0131\u011f\u0131yla."),(0,l.kt)("h4",{id:"311-casbin-model-ve-politikay\u0131-kubectl-ile-olu\u015fturmag\xfcncelleme"},"3.1.1 Casbin Model ve Politikay\u0131 kubectl ile Olu\u015fturma/G\xfcncelleme"),(0,l.kt)("p",null,"K8s-gatekeeper'de, Casbin modeli 'CasbinModel' ad\u0131nda bir CRD kayna\u011f\u0131nda saklan\u0131r. Tan\u0131m\u0131 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinmodels.yaml")," dosyas\u0131nda bulunmaktad\u0131r."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml")," i\xe7inde \xf6rnekler bulunmaktad\u0131r. A\u015fa\u011f\u0131daki alanlara dikkat edin:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"metadata.name: modelin ad\u0131. Bu ad, bu modele ili\u015fkin CasbinPolicy nesnesinin ad\u0131yla ayn\u0131 olmal\u0131d\u0131r, b\xf6ylece K8s-gatekeeper onlar\u0131 e\u015fle\u015ftirebilir ve bir uygulay\u0131c\u0131 olu\u015fturabilir."),(0,l.kt)("li",{parentName:"ul"},'spec.enable: bu alan "false" olarak ayarlan\u0131rsa, bu model (ve bu modele ili\u015fkin CasbinPolicy nesnesi) g\xf6z ard\u0131 edilecektir.'),(0,l.kt)("li",{parentName:"ul"},"spec.modelText: bir Casbin modelinin model metnini i\xe7eren bir dizedir.")),(0,l.kt)("p",null,"Casbin Politikas\u0131, tan\u0131m\u0131 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinpolicies.yaml")," dosyas\u0131nda bulunan 'CasbinPolicy' adl\u0131 ba\u015fka bir CRD kayna\u011f\u0131nda saklan\u0131r."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/policy.yaml")," i\xe7inde \xf6rnekler bulunmaktad\u0131r. A\u015fa\u011f\u0131daki alanlara dikkat edin:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"metadata.name: politika ad\u0131. Bu isim, bu politikayla ili\u015fkili olan CasbinModel nesnesinin ad\u0131yla ayn\u0131 olmal\u0131d\u0131r, b\xf6ylece K8s-gatekeeper onlar\u0131 e\u015fle\u015ftirebilir ve bir uygulay\u0131c\u0131 olu\u015fturabilir."),(0,l.kt)("li",{parentName:"ul"},"spec.policyItem: Bir Casbin modelinin politikal\u0131 metnini i\xe7eren bir dizedir.")),(0,l.kt)("p",null,"Kendi CasbinModel ve CasbinPolicy dosyalar\u0131n\u0131z\u0131 olu\u015fturduktan sonra, onlar\u0131 uygulamak i\xe7in a\u015fa\u011f\u0131daki komutu kullan\u0131n:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f <filename>\n")),(0,l.kt)("p",null,"Bir CasbinModel ve CasbinPolicy \xe7ifti olu\u015fturulduktan sonra, K8s-gatekeeper bunu 5 saniye i\xe7inde tespit edebilir."),(0,l.kt)("h4",{id:"312-casbin-model-ve-politikas\u0131n\u0131-sa\u011flad\u0131\u011f\u0131m\u0131z-go-client-\xfczerinden-olu\u015fturmag\xfcncelleme"},"3.1.2 Casbin Model ve Politikas\u0131n\u0131 sa\u011flad\u0131\u011f\u0131m\u0131z go-client \xfczerinden Olu\u015fturma/G\xfcncelleme"),(0,l.kt)("p",null,"\u015eirketiniz i\xe7in otomatik bir bulut platformu olu\u015ftururken oldu\u011fu gibi, K8s k\xfcmesinin bir d\xfc\u011f\xfcm\xfcnde do\u011frudan komutlar\u0131 \xe7al\u0131\u015ft\u0131rmak i\xe7in kabu\u011fu kullanman\u0131n uygun olmayabilece\u011fi durumlar olabilece\u011fini anl\u0131yoruz. Bu nedenle, CasbinModel ve CasbinPolicy'yi olu\u015fturmak ve s\xfcrd\xfcrmek i\xe7in bir go-client geli\u015ftirdik."),(0,l.kt)("p",null,"go-client k\xfct\xfcphanesi ",(0,l.kt)("inlineCode",{parentName:"p"},"pkg/client")," dizininde bulunmaktad\u0131r."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"client.go")," dosyas\u0131nda, bir istemci olu\u015fturmak i\xe7in bir fonksiyon sa\u011fl\u0131yoruz."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"func NewK8sGateKeeperClient(externalClient bool) (*K8sGateKeeperClient, error) \n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"externalClient")," parametresi, K8s-gatekeeper'\u0131n K8s k\xfcmesi i\xe7inde \xe7al\u0131\u015f\u0131p \xe7al\u0131\u015fmad\u0131\u011f\u0131n\u0131 belirler."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"model.go")," dosyas\u0131nda, CasbinModel'i olu\u015fturmak, silmek ve de\u011fi\u015ftirmek i\xe7in \xe7e\u015fitli fonksiyonlar sunuyoruz. Bu aray\xfczlerin nas\u0131l kullan\u0131laca\u011f\u0131n\u0131 ",(0,l.kt)("inlineCode",{parentName:"p"},"model_test.go")," dosyas\u0131nda \xf6\u011frenebilirsiniz."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"policy.go")," dosyas\u0131nda, CasbiPolicy'i olu\u015fturmak, silmek ve de\u011fi\u015ftirmek i\xe7in \xe7e\u015fitli fonksiyonlar sunuyoruz. Bu aray\xfczlerin nas\u0131l kullan\u0131laca\u011f\u0131n\u0131 ",(0,l.kt)("inlineCode",{parentName:"p"},"policy_test.go")," dosyas\u0131nda \xf6\u011frenebilirsiniz."),(0,l.kt)("h3",{id:"312-k8s-gatekeeper\u0131n-\xe7al\u0131\u015f\u0131p-\xe7al\u0131\u015fmad\u0131\u011f\u0131n\u0131-deneyin"},"3.1.2 K8s-gatekeeper'\u0131n \xc7al\u0131\u015f\u0131p \xc7al\u0131\u015fmad\u0131\u011f\u0131n\u0131 Deneyin"),(0,l.kt)("p",null,"Varsayal\u0131m ki ",(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo")," i\xe7inde tam olarak model ve politikay\u0131 olu\u015fturdunuz. \u015eimdi, a\u015fa\u011f\u0131daki komutu deneyin:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f example/allowed_repo/testcase/reject_1.yaml\n")),(0,l.kt)("p",null,"K8s'nin bu iste\u011fi reddedece\u011fini ve bu iste\u011fin reddedilme nedeni olarak webhook'u belirtece\u011fini g\xf6receksiniz. Ancak, ",(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/testcase/approve_2.yaml")," uygulamay\u0131 denerseniz, kabul edilecektir."),(0,l.kt)("h2",{id:"4-k8s-gatekeeper-ile-model-ve-politika-nas\u0131l-yaz\u0131l\u0131r"},"4. K8s-gatekeeper ile Model ve Politika Nas\u0131l Yaz\u0131l\u0131r"),(0,l.kt)("p",null,"\xd6ncelikle, Casbin Modelleri ve Politikalar\u0131n\u0131n temel grameriyle ilgili bilginiz oldu\u011fundan emin olun. E\u011fer de\u011filseniz, l\xfctfen \xf6nce ",(0,l.kt)("a",{parentName:"p",href:"/docs/get-started"},"Ba\u015flarken")," b\xf6l\xfcm\xfcn\xfc okuyun. Bu b\xf6l\xfcmde, Casbin Modelleri ve Politikalar\u0131n\u0131n ne oldu\u011funu zaten anlad\u0131\u011f\u0131n\u0131z\u0131 varsay\u0131yoruz."),(0,l.kt)("h3",{id:"41-modelin-i\u0307stek-tan\u0131m\u0131"},"4.1 Modelin \u0130stek Tan\u0131m\u0131"),(0,l.kt)("p",null,"K8s-gatekeeper bir iste\u011fi yetkilendirirken, girdi her zaman bir nesnedir: Kabul \u0130ste\u011finin Go nesnesi. Bu, zorlay\u0131c\u0131n\u0131n her zaman \u015fu \u015fekilde kullan\u0131laca\u011f\u0131 anlam\u0131na gelir:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"ok, err := enforcer.Enforce(admission)\n")),(0,l.kt)("p",null,"burada ",(0,l.kt)("inlineCode",{parentName:"p"},"admission"),", K8s'nin resmi go api'si ",(0,l.kt)("inlineCode",{parentName:"p"},'"k8s.io/api/admission/v1"')," taraf\u0131ndan tan\u0131mlanan bir ",(0,l.kt)("inlineCode",{parentName:"p"},"AdmissionReview")," nesnesidir. Bu yap\u0131n\u0131n tan\u0131m\u0131n\u0131 bu depoda bulabilirsiniz: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"},"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"),". Daha fazla bilgi i\xe7in, ",(0,l.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"},"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response")," adresine de ba\u015fvurabilirsiniz."),(0,l.kt)("p",null,"Bu nedenle, K8s-gatekeeper taraf\u0131ndan kullan\u0131lan herhangi bir model i\xe7in ",(0,l.kt)("inlineCode",{parentName:"p"},"request_definition")," tan\u0131m\u0131 her zaman \u015fu \u015fekilde olmal\u0131d\u0131r:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},"    [request_definition]\n    r =  obj\n")),(0,l.kt)("p",null,"'obj' ad\u0131 zorunlu de\u011fildir, ad\u0131n ",(0,l.kt)("inlineCode",{parentName:"p"},"[matchers]")," b\xf6l\xfcm\xfcnde kullan\u0131lan adla tutarl\u0131 olmas\u0131 yeterlidir."),(0,l.kt)("h3",{id:"42-modelin-e\u015fle\u015ftiricileri"},"4.2 Modelin E\u015fle\u015ftiricileri"),(0,l.kt)("p",null,"Kurallar\u0131n\u0131z\u0131 yazmak i\xe7in Casbin'in ABAC \xf6zelli\u011fini kullanmal\u0131s\u0131n\u0131z. Ancak, Casbin'de entegre edilmi\u015f ifade de\u011ferlendirici, haritalardaki veya dizilerdeki (dilimlerdeki) indekslemeyi veya dizilerin geni\u015flemesini desteklememektedir. Bu nedenle, K8s-gatekeeper bu \xf6zellikleri uygulamak i\xe7in \xe7e\u015fitli 'Casbin fonksiyonlar\u0131'n\u0131 uzant\u0131lar olarak sa\u011flar. E\u011fer h\xe2l\xe2 bu uzant\u0131larla talebinizi kar\u015f\u0131layamad\u0131\u011f\u0131n\u0131z\u0131 d\xfc\u015f\xfcn\xfcyorsan\u0131z, bir konu ba\u015flatmaya da \xe7ekinmeyin, ya da bir \xe7ekme iste\u011fi olu\u015fturun."),(0,l.kt)("p",null,"Casbin fonksiyonlar\u0131na a\u015fina de\u011filseniz, daha fazla bilgi i\xe7in ",(0,l.kt)("a",{parentName:"p",href:"/docs/function"},"Function")," sayfas\u0131na ba\u015fvurabilirsiniz."),(0,l.kt)("p",null,"\u0130\u015fte uzant\u0131 fonksiyonlar\u0131:"),(0,l.kt)("h3",{id:"421-uzant\u0131-fonksiyonlar\u0131"},"4.2.1 Uzant\u0131 Fonksiyonlar\u0131"),(0,l.kt)("h4",{id:"4211-eri\u015fim"},"4.2.1.1 eri\u015fim"),(0,l.kt)("p",null,"Eri\u015fim, Casbin'in haritalarda veya dizilerde indekslemeyi desteklemedi\u011fi sorunu \xe7\xf6zmek i\xe7in kullan\u0131l\u0131r. ",(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml")," \xf6rne\u011fi, bu fonksiyonun kullan\u0131m\u0131n\u0131 g\xf6sterir:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n')),(0,l.kt)("p",null,"Bu e\u015fle\u015ftiricide, ",(0,l.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image")')," ifadesi, ",(0,l.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Image")," ile e\u015fde\u011ferdir, burada ",(0,l.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers")," bir dilimdir."),(0,l.kt)("p",null,"Eri\u015fim ayr\u0131ca parametreleri olmayan ve tek bir de\u011fer d\xf6nd\xfcren basit fonksiyonlar\u0131 \xe7a\u011f\u0131rabilir. ",(0,l.kt)("inlineCode",{parentName:"p"},"example/container_resource_limit/model.yaml")," \xf6rne\u011fi bunu g\xf6sterir:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\n  m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")) >= parseFloat(p.cpu) && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","memory","Value")) >= parseFloat(p.memory)\n')),(0,l.kt)("p",null,"Bu e\u015fle\u015ftiricide, ",(0,l.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")')," ifadesi, ",(0,l.kt)("inlineCode",{parentName:"p"},'r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits["cpu"].Value()')," ile e\u015fde\u011ferdir, burada ",(0,l.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits")," bir haritad\u0131r ve ",(0,l.kt)("inlineCode",{parentName:"p"},"Value()")," parametresi olmayan ve tek bir de\u011fer d\xf6nd\xfcren basit bir fonksiyondur."),(0,l.kt)("h4",{id:"4212-accesswithwildcard"},"4.2.1.2 accessWithWildcard"),(0,l.kt)("p",null,'Bazen \u015f\xf6yle bir talepte bulunabilirsiniz: bir dizideki t\xfcm \xf6\u011felerin "aaa" \xf6neki olmal\u0131. Ancak, Casbin ',(0,l.kt)("inlineCode",{parentName:"p"},"for")," d\xf6ng\xfclerini desteklememektedir. ",(0,l.kt)("inlineCode",{parentName:"p"},"accessWithWildcard"),' ve "map/slice geni\u015fletme" \xf6zelli\u011fi ile, b\xf6yle bir talebi kolayca uygulayabilirsiniz.'),(0,l.kt)("p",null,"\xd6rne\u011fin, ",(0,l.kt)("inlineCode",{parentName:"p"},"a.b.c")," dizisi ",(0,l.kt)("inlineCode",{parentName:"p"},"[aaa, bbb, ccc, ddd, eee]")," olsun, o zaman ",(0,l.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a, "b", "c", "*")')," sonucu bir dilim ",(0,l.kt)("inlineCode",{parentName:"p"},"[aaa, bbb, ccc, ddd, eee]")," olacakt\u0131r. Joker karakter ",(0,l.kt)("inlineCode",{parentName:"p"},"*")," kullanarak, dilim geni\u015fletilir."),(0,l.kt)("p",null,"Benzer \u015fekilde, joker karakter birden fazla kez kullan\u0131labilir. \xd6rne\u011fin, ",(0,l.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a, "b", "c", "*", "*")')," sonucu ",(0,l.kt)("inlineCode",{parentName:"p"},"[a.b.c[0][0], a.b.c[0][1], ..., a.b.c[1][0], a.b.c[1][1], ...]")," olacakt\u0131r."),(0,l.kt)("h3",{id:"4213-de\u011fi\u015fken-uzunluklu-arg\xfcmanlar\u0131-destekleyen-fonksiyonlar"},"4.2.1.3 De\u011fi\u015fken Uzunluklu Arg\xfcmanlar\u0131 Destekleyen Fonksiyonlar"),(0,l.kt)("p",null,"Casbin'in ifade de\u011ferlendirici i\xe7inde, bir parametre bir dizi oldu\u011funda, otomatik olarak de\u011fi\u015fken uzunluklu bir arg\xfcman olarak geni\u015fletilir. Bu \xf6zelli\u011fi kullanarak dizi/dilim/map geni\u015fletmeyi desteklemek i\xe7in, ayr\u0131ca bir dizi/dilim parametresi kabul eden birka\xe7 fonksiyon entegre ettik:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"contain(): birden fazla parametre kabul eder ve son parametre hari\xe7 herhangi bir parametrenin son parametreye e\u015fit olup olmad\u0131\u011f\u0131n\u0131 d\xf6nd\xfcr\xfcr."),(0,l.kt)("li",{parentName:"ul"},"split(a, b, c..., sep, index): ",(0,l.kt)("inlineCode",{parentName:"li"},"[splits(a, sep)[index], splits(b, sep)[index], splits(a, sep)[index], ...]")," i\xe7eren bir dilim d\xf6nd\xfcr\xfcr."),(0,l.kt)("li",{parentName:"ul"},"len(): de\u011fi\u015fken uzunluklu arg\xfcman\u0131n uzunlu\u011funu d\xf6nd\xfcr\xfcr."),(0,l.kt)("li",{parentName:"ul"},"matchRegex(a,b,c...,regex): verilen t\xfcm parametrelerin (",(0,l.kt)("inlineCode",{parentName:"li"},"a"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"b"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"c"),", ...) verilen regex ile e\u015fle\u015fip e\u015fle\u015fmedi\u011fini d\xf6nd\xfcr\xfcr.")),(0,l.kt)("p",null,"\u0130\u015fte ",(0,l.kt)("inlineCode",{parentName:"p"},"example/disallowed_tag/model.yaml")," i\xe7inde bir \xf6rnek:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'    [matchers]\n    m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n    contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image")')," ",(0,l.kt)("inlineCode",{parentName:"p"},'["a:b", "c:d", "e:f", "g:h"]')," d\xf6nd\xfcrd\xfc\u011f\xfc varsay\u0131larak, \xe7\xfcnk\xfc splits de\u011fi\u015fken uzunluklu arg\xfcmanlar\u0131 destekler ve her \xf6\u011fede splits i\u015flemi ger\xe7ekle\u015ftirir, indeks 1'deki \xf6\u011fe se\xe7ilir ve d\xf6nd\xfcr\xfcl\xfcr. Bu nedenle, ",(0,l.kt)("inlineCode",{parentName:"p"},'split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1)')," ",(0,l.kt)("inlineCode",{parentName:"p"},'["b","d","f","h"]')," d\xf6nd\xfcr\xfcr. Ve ",(0,l.kt)("inlineCode",{parentName:"p"},'contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)')," ",(0,l.kt)("inlineCode",{parentName:"p"},"p.obj"),"'nin ",(0,l.kt)("inlineCode",{parentName:"p"},'["b","d","f","h"]')," i\xe7inde bulunup bulunmad\u0131\u011f\u0131n\u0131 d\xf6nd\xfcr\xfcr."),(0,l.kt)("h4",{id:"4212-t\xfcr-d\xf6n\xfc\u015ft\xfcrme-fonksiyonlar\u0131"},"4.2.1.2 T\xfcr D\xf6n\xfc\u015ft\xfcrme Fonksiyonlar\u0131"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"ParseFloat(): Bir tamsay\u0131y\u0131 float'a \xe7evirir (bu, kar\u015f\u0131la\u015ft\u0131rmada kullan\u0131lan herhangi bir say\u0131n\u0131n float'a d\xf6n\xfc\u015ft\xfcr\xfclmesi gerekti\u011fi i\xe7in gereklidir)."),(0,l.kt)("li",{parentName:"ul"},"ToString(): Bir nesneyi string'e d\xf6n\xfc\u015ft\xfcr\xfcr. Bu nesnenin temel bir string t\xfcr\xfc olmal\u0131d\u0131r (\xf6rne\u011fin, ",(0,l.kt)("inlineCode",{parentName:"li"},"type XXX string")," ifadesi oldu\u011funda ",(0,l.kt)("inlineCode",{parentName:"li"},"XXX")," t\xfcr\xfcnde bir nesne)."),(0,l.kt)("li",{parentName:"ul"},"IsNil(): Parametrenin nil olup olmad\u0131\u011f\u0131n\u0131 d\xf6nd\xfcr\xfcr.")),(0,l.kt)("h2",{id:"5-geli\u015fmi\u015f-ayarlar"},"5. Geli\u015fmi\u015f Ayarlar"),(0,l.kt)("h3",{id:"51-sertifikalar-hakk\u0131nda"},"5.1 Sertifikalar Hakk\u0131nda"),(0,l.kt)("p",null,"Kubernetes (k8s) i\xe7inde, bir webhook'un HTTPS kullanmas\u0131 zorunludur. Bunu ger\xe7ekle\u015ftirmek i\xe7in iki yakla\u015f\u0131m vard\u0131r:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Kendinden imzal\u0131 sertifikalar kullan\u0131n (bu depodaki \xf6rnekler bu y\xf6ntemi kullanmaktad\u0131r)"),(0,l.kt)("li",{parentName:"ul"},"Normal bir sertifika kullan\u0131n")),(0,l.kt)("h4",{id:"511-kendinden-imzal\u0131-sertifikalar"},"5.1.1 Kendinden imzal\u0131 sertifikalar"),(0,l.kt)("p",null,"Kendinden imzal\u0131 bir sertifika kullanmak, sertifikay\u0131 d\xfczenleyen Sertifika Yetkilisi'nin (CA) iyi bilinen CA'lardan biri olmad\u0131\u011f\u0131 anlam\u0131na gelir. Bu nedenle, k8s'ye bu CA'y\u0131 bildirmeniz gerekir."),(0,l.kt)("p",null,"\u015eu anda, bu depodaki \xf6rnek, \xf6zel anahtar\u0131 ve sertifikas\u0131 s\u0131ras\u0131yla ",(0,l.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.crt")," ve ",(0,l.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.key")," i\xe7inde saklanan kendi yap\u0131m\u0131 bir CA kullanmaktad\u0131r. Webhook i\xe7in sertifika ",(0,l.kt)("inlineCode",{parentName:"p"},"config/certificate/server.crt"),' \u015feklindedir ve bu, kendi yap\u0131m\u0131 CA taraf\u0131ndan d\xfczenlenmi\u015ftir. Bu sertifikan\u0131n alanlar\u0131 "webhook.domain.local" (harici webhook i\xe7in) ve "casbin-webhook-svc.default.svc" (dahili webhook i\xe7in) \u015feklindedir.'),(0,l.kt)("p",null,"CA hakk\u0131ndaki bilgiler, webhook yap\u0131land\u0131rma dosyalar\u0131 arac\u0131l\u0131\u011f\u0131yla k8s'ye iletilir. Hem ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," hem de ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),' dosyalar\u0131nda "CABundle" ad\u0131nda bir alan bulunmaktad\u0131r ve bu alan, CA\'n\u0131n sertifikas\u0131n\u0131n base64 ile kodlanm\u0131\u015f dizesini i\xe7erir.'),(0,l.kt)("p",null,"E\u011fer sertifika/alan\u0131 de\u011fi\u015ftirmeniz gerekiyorsa (\xf6rne\u011fin, bu webhook'u k8s'nin ba\u015fka bir namespace'ine yerle\u015ftirmek istiyorsan\u0131z ve dahili webhook kullan\u0131yorsan\u0131z veya alan\u0131 de\u011fi\u015ftirmek istiyorsan\u0131z ve harici webhook kullan\u0131yorsan\u0131z), a\u015fa\u011f\u0131daki prosed\xfcrler takip edilmelidir:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Yeni bir CA olu\u015fturun:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Sahte CA i\xe7in \xf6zel anahtar olu\u015fturun:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out ca.key 2048\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\xd6zel anahtar\u0131n \u015fifre korumas\u0131n\u0131 kald\u0131r\u0131n:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl rsa -in ca.key -out ca.key\n"))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Webhook sunucusu i\xe7in bir \xf6zel anahtar olu\u015fturun:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out server.key 2048\nopenssl rsa -in server.key -out server.key\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Kendinden olu\u015fturulan CA'y\u0131 kullanarak webhook i\xe7in sertifikay\u0131 imzalay\u0131n:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Sisteminizin openssl yap\u0131land\u0131rma dosyas\u0131n\u0131 ge\xe7ici kullan\u0131m i\xe7in kopyalay\u0131n. Yap\u0131land\u0131rma dosyas\u0131n\u0131n konumunu ",(0,l.kt)("inlineCode",{parentName:"p"},"openssl version -a")," komutunu \xe7al\u0131\u015ft\u0131rarak \xf6\u011frenebilirsiniz, genellikle ",(0,l.kt)("inlineCode",{parentName:"p"},"openssl.cnf")," olarak adland\u0131r\u0131l\u0131r.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Yap\u0131land\u0131rma dosyas\u0131nda:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"[req]")," paragraf\u0131n\u0131 bulun ve \u015fu sat\u0131r\u0131 ekleyin: ",(0,l.kt)("inlineCode",{parentName:"p"},"req_extensions = v3_req"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"[v3_req]")," paragraf\u0131n\u0131 bulun ve \u015fu sat\u0131r\u0131 ekleyin: ",(0,l.kt)("inlineCode",{parentName:"p"},"subjectAltName = @alt_names"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Dosyan\u0131n sonuna a\u015fa\u011f\u0131daki sat\u0131rlar\u0131 ekleyin:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-ini"},"[alt_names]\nDNS.2=<The domain you want>\n")),(0,l.kt)("p",{parentName:"li"},"Not: E\u011fer hizmet ad\u0131n\u0131 de\u011fi\u015ftirmeye karar verirseniz, 'casbin-webhook-svc.default.svc' yerine kendi hizmetinizin ger\xe7ek hizmet ad\u0131n\u0131 kullan\u0131n.")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"De\u011fi\u015ftirilmi\u015f yap\u0131land\u0131rma dosyas\u0131n\u0131 kullanarak bir sertifika iste\u011fi dosyas\u0131 olu\u015fturun:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl req -new -nodes -keyout server.key -out server.csr -config openssl.cnf\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Kendiniz yap\u0131lan CA'y\u0131 kullanarak iste\u011fe yan\u0131t verin ve sertifikay\u0131 imzalay\u0131n:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl x509 -req -days 3650 -in server.csr -out server.crt -CA ca.crt -CAkey ca.key -CAcreateserial -extensions v3_req -extensions SAN -extfile openssl.cnf\n"))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"'CABundle' alan\u0131n\u0131 de\u011fi\u015ftirin: Bu alan\u0131 yeni sertifika ile g\xfcncelleyin.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Helm kullan\u0131yorsan\u0131z, benzer de\u011fi\u015fikliklerin helm grafiklerine de uygulanmas\u0131 gerekir."))),(0,l.kt)("h4",{id:"512-yasal-sertifikalar"},"5.1.2 Yasal sertifikalar"),(0,l.kt)("p",null,"Yasal sertifikalar kullan\u0131yorsan\u0131z, t\xfcm bu prosed\xfcrleri uygulaman\u0131za gerek yoktur. ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," ve ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),' dosyalar\u0131ndaki "CABundle" alan\u0131n\u0131 kald\u0131r\u0131n ve bu dosyalardaki alan\u0131 sahip oldu\u011funuz alanla de\u011fi\u015ftirin.'))}d.isMDXComponent=!0}}]);