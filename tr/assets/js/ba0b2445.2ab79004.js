"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[7877],{5131:(e,i,n)=>{n.d(i,{A:()=>a});const a=n.p+"assets/images/model-1c0c2441dd19f8b957744635985283eb.png"},8056:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var a=n(9992),l=n(4848),r=n(8453);const t={title:"APISIX'te Casbin kullanarak yetkilendirme",author:"Rushikesh Tote",authorTitle:"Casbin \xdcyesi",authorURL:"http://github.com/rushitote",authorImageURL:"https://avatars.githubusercontent.com/rushitote"},s=void 0,o={authorsImageUrls:[void 0]},d=[{value:"Giri\u015f",id:"giri\u015f",level:2},{value:"Model Olu\u015fturma",id:"model-olu\u015fturma",level:2},{value:"Politika olu\u015fturma",id:"politika-olu\u015fturma",level:2},{value:"Eklentiyi rotada etkinle\u015ftirme",id:"eklentiyi-rotada-etkinle\u015ftirme",level:2},{value:"Eklentiyi global bir model/politika kullanarak etkinle\u015ftirme",id:"eklentiyi-global-bir-modelpolitika-kullanarak-etkinle\u015ftirme",level:2},{value:"Kullan\u0131m Senaryolar\u0131",id:"kullan\u0131m-senaryolar\u0131",level:2}];function c(e){const i={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.h2,{id:"giri\u015f",children:"Giri\u015f"}),"\n",(0,l.jsxs)(i.p,{children:[(0,l.jsx)(i.a,{href:"https://apisix.apache.org/",children:"APISIX"}),", Nginx ve etcd \xfczerine kurulu y\xfcksek performansl\u0131 ve \xf6l\xe7eklenebilir bir bulut yerel API a\u011f ge\xe7ididir. Apache Yaz\u0131l\u0131m Vakf\u0131 taraf\u0131ndan y\xfcr\xfct\xfclen a\xe7\u0131k kaynakl\u0131 bir projedir. APISIX'in bu kadar iyi olmas\u0131n\u0131n yan\u0131 s\u0131ra, kimlik do\u011frulama, izleme, y\xf6nlendirme gibi \xf6zellikleri uygulamak i\xe7in kullan\u0131labilecek bir\xe7ok harika yerle\u015fik eklenti deste\u011fi bulunmaktad\u0131r. APISIX'teki eklentilerin yeniden ba\u015flatmalar olmadan s\u0131cak y\xfcklenebilmesi, onu \xe7ok dinamik k\u0131lmaktad\u0131r."]}),"\n",(0,l.jsxs)(i.p,{children:["Ancak APISIX kullan\u0131rken, uygulaman\u0131zda karma\u015f\u0131k yetkilendirme mant\u0131\u011f\u0131 eklemek isteyebilece\u011finiz senaryolar olabilir. \u0130\u015fte burada authz-casbin size yard\u0131mc\u0131 olabilir, authz-casbin, \xe7e\u015fitli eri\u015fim kontrol modellerine dayal\u0131 g\xfc\xe7l\xfc yetkilendirme sa\u011flayan ",(0,l.jsx)(i.a,{href:"https://github.com/casbin/lua-casbin/",children:"Lua Casbin"})," tabanl\u0131 bir APISIX eklentisidir. ",(0,l.jsx)(i.a,{href:"/",children:"Casbin"}),", ACL, RBAC, ABAC gibi eri\u015fim kontrol modellerini destekleyen bir yetkilendirme k\xfct\xfcphanesidir. Ba\u015flang\u0131\xe7ta Go dilinde yaz\u0131lm\u0131\u015f olan Casbin, bir\xe7ok dilde port edilmi\u015ftir ve Lua Casbin, Casbin'in Lua uygulamas\u0131d\u0131r. authz-casbin'in geli\u015ftirilmesi, APISIX deposunda yetkilendirme i\xe7in yeni bir eklenti \xf6nerdi\u011fimizde (",(0,l.jsx)(i.a,{href:"https://github.com/apache/apisix/issues/4674",children:"#4674"}),") \xe7ekirdek \xfcyelerin de onay vermesiyle ba\u015flad\u0131. Ve yararl\u0131 incelemeler sonucu baz\u0131 \xf6nemli de\u011fi\u015fiklikler ve iyile\u015ftirmeler yap\u0131ld\u0131ktan sonra, PR (",(0,l.jsx)(i.a,{href:"https://github.com/apache/apisix/pull/4710",children:"#4710"}),") nihayet birle\u015ftirildi."]}),"\n",(0,l.jsx)(i.p,{children:"Bu blogda, authz-casbin eklentisini kullanarak APISIX'te Rol Tabanl\u0131 Eri\u015fim Kontrol\xfc (RBAC) temelli bir yetkilendirme modelinin nas\u0131l uygulanabilece\u011fini g\xf6sterece\u011fiz."}),"\n",(0,l.jsxs)(i.p,{children:[(0,l.jsx)(i.strong,{children:"NOT"}),": Casbin sadece yetkilendirme yapaca\u011f\u0131 i\xe7in kullan\u0131c\u0131n\u0131n kimlik do\u011frulamas\u0131 i\xe7in ba\u015fka bir eklenti veya \xf6zel bir i\u015f ak\u0131\u015f\u0131 kullanman\u0131z gerekecektir."]}),"\n",(0,l.jsx)(i.h2,{id:"model-olu\u015fturma",children:"Model Olu\u015fturma"}),"\n",(0,l.jsxs)(i.p,{children:["Eklenti, herhangi bir iste\u011fi yetkilendirmek i\xe7in \xfc\xe7 parametre kullan\u0131r - konu, nesne ve eylem. Burada, konu, kullan\u0131c\u0131 ad\u0131 ba\u015fl\u0131\u011f\u0131n\u0131n de\u011feridir ve ",(0,l.jsx)(i.code,{children:"[username: alice]"})," gibi bir \u015fey olabilir. Ard\u0131ndan, nesne eri\u015filmekte olan URL yolu ve eylem kullan\u0131lan istek y\xf6ntemidir."]}),"\n",(0,l.jsxs)(i.p,{children:["Diyelim ki ",(0,l.jsx)(i.code,{children:"/"}),", ",(0,l.jsx)(i.code,{children:"/res1"})," ve ",(0,l.jsx)(i.code,{children:"/res2"})," yollar\u0131nda \xfc\xe7 kaynakla bir model olu\u015fturmak istiyoruz. Ve \u015f\xf6yle bir model istiyoruz:"]}),"\n",(0,l.jsx)(i.p,{children:(0,l.jsx)(i.img,{alt:"resim",src:n(5131).A+"",width:"4520",height:"1720"})}),"\n",(0,l.jsxs)(i.p,{children:["Bu, \xf6rne\u011fin ",(0,l.jsx)(i.code,{children:"jack"})," gibi t\xfcm kullan\u0131c\u0131lar\u0131n (",(0,l.jsx)(i.code,{children:"*"}),") anasayfas\u0131na (",(0,l.jsx)(i.code,{children:"/"}),") eri\u015febilece\u011fi anlam\u0131na gelir. Ve ",(0,l.jsx)(i.code,{children:"alice"})," ve ",(0,l.jsx)(i.code,{children:"bob"})," gibi ",(0,l.jsx)(i.code,{children:"admin"})," izinlerine sahip kullan\u0131c\u0131lar t\xfcm sayfalara ve kaynaklara (\xf6rne\u011fin ",(0,l.jsx)(i.code,{children:"res1"})," ve ",(0,l.jsx)(i.code,{children:"res2"}),") eri\u015febilir. Ayr\u0131ca, admin izni olmayan kullan\u0131c\u0131lar\u0131n sadece ",(0,l.jsx)(i.code,{children:"GET"})," istek y\xf6ntemini kullanmas\u0131n\u0131 k\u0131s\u0131tlayal\u0131m. Bu senaryo i\xe7in modeli \u015fu \u015fekilde tan\u0131mlayabiliriz:"]}),"\n",(0,l.jsx)(i.pre,{children:(0,l.jsx)(i.code,{className:"language-ini",children:"[request_definition]\nr = sub, obj, act\n\n[policy_definition]\np = sub, obj, act\n\n[role_definition]\ng = _, _\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) && keyMatch(r.obj, p.obj) && keyMatch(r.act, p.act)\n"})}),"\n",(0,l.jsx)(i.h2,{id:"politika-olu\u015fturma",children:"Politika olu\u015fturma"}),"\n",(0,l.jsx)(i.p,{children:"Yukar\u0131daki senaryodan, politika \u015fu \u015fekilde olacakt\u0131r:"}),"\n",(0,l.jsx)(i.pre,{children:(0,l.jsx)(i.code,{className:"language-csv",children:"p, *, /, GET\np, admin, *, *\ng, alice, admin\ng, bob, admin\n"})}),"\n",(0,l.jsx)(i.p,{children:"Modelden gelen e\u015fle\u015ftirici \u015fu anlama gelir:"}),"\n",(0,l.jsxs)(i.ol,{children:["\n",(0,l.jsxs)(i.li,{children:[(0,l.jsx)(i.code,{children:"(g(r.sub, p.sub) || keyMatch(r.sub, p.sub))"}),": \u0130ste\u011fin konusu, politikan\u0131n konusu olarak bir rol\xfc ta\u015f\u0131yor ya da iste\u011fin konusu, ",(0,l.jsx)(i.code,{children:"keyMatch"})," i\xe7inde politikan\u0131n konusuyla e\u015fle\u015fiyor. ",(0,l.jsx)(i.code,{children:"keyMatch"}),", Lua Casbin'de yerle\u015fik bir fonksiyondur, fonksiyonun a\xe7\u0131klamas\u0131na ve daha faydal\u0131 olabilecek di\u011fer fonksiyonlara ",(0,l.jsx)(i.a,{href:"https://github.com/casbin/lua-casbin/blob/master/src/util/BuiltInFunctions.lua",children:"buradan"})," g\xf6z atabilirsiniz."]}),"\n",(0,l.jsxs)(i.li,{children:[(0,l.jsx)(i.code,{children:"keyMatch(r.obj, p.obj)"}),": \u0130ste\u011fin nesnesi, politikan\u0131n nesnesiyle e\u015fle\u015fiyor (burada URL yolu)."]}),"\n",(0,l.jsxs)(i.li,{children:[(0,l.jsx)(i.code,{children:"keyMatch(r.act, p.act)"}),": \u0130ste\u011fin eylemi, politikan\u0131n eylemiyle e\u015fle\u015fiyor (burada HTTP istek metodu)."]}),"\n"]}),"\n",(0,l.jsx)(i.h2,{id:"eklentiyi-rotada-etkinle\u015ftirme",children:"Eklentiyi rotada etkinle\u015ftirme"}),"\n",(0,l.jsx)(i.p,{children:"Modeli ve politikay\u0131 olu\u015fturduktan sonra, APISIX Admin API'sini kullanarak bunu bir rotada etkinle\u015ftirebilirsiniz. Model ve politika dosyas\u0131 yollar\u0131n\u0131 kullanarak etkinle\u015ftirmek i\xe7in:"}),"\n",(0,l.jsx)(i.pre,{children:(0,l.jsx)(i.code,{className:"language-sh",children:'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "plugins": {\n        "authz-casbin": {\n            "model_path": "/path/to/model.conf",\n            "policy_path": "/path/to/policy.csv",\n            "username": "username"\n        }\n    },\n    "upstream": {\n        "nodes": {\n            "127.0.0.1:1980": 1\n        },\n        "type": "roundrobin"\n    },\n    "uri": "/*"\n}\'\n'})}),"\n",(0,l.jsxs)(i.p,{children:["Burada, kullan\u0131c\u0131 ad\u0131 alan\u0131, konuyu iletece\u011finiz ba\u015fl\u0131k ad\u0131d\u0131r. \xd6rne\u011fin, kullan\u0131c\u0131 ad\u0131 ba\u015fl\u0131\u011f\u0131n\u0131 ",(0,l.jsx)(i.code,{children:"user: alice"})," olarak iletecekseniz, ",(0,l.jsx)(i.code,{children:'"username": "user"'})," kullan\u0131rs\u0131n\u0131z."]}),"\n",(0,l.jsxs)(i.p,{children:["Dosyalar yerine model/politika metni kullanmak i\xe7in, ",(0,l.jsx)(i.code,{children:"model"})," ve ",(0,l.jsx)(i.code,{children:"policy"})," alanlar\u0131n\u0131 kullanabilirsiniz:"]}),"\n",(0,l.jsx)(i.pre,{children:(0,l.jsx)(i.code,{className:"language-sh",children:'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "plugins": {\n        "authz-casbin": {\n            "model": "[request_definition]\n            r = sub, obj, act\n\n            [policy_definition]\n            p = sub, obj, act\n\n            [role_definition]\n            g = _, _\n\n            [policy_effect]\n            e = some(where (p.eft == allow))\n\n            [matchers]\n            m = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) && keyMatch(r.obj, p.obj) && keyMatch(r.act, p.act)",\n\n            "policy": "p, *, /, GET\n            p, admin, *, *\n            g, alice, admin\n            g, bob, admin",\n\n            "username": "username"\n        }\n    },\n    "upstream": {\n        "nodes": {\n            "127.0.0.1:1980": 1\n        },\n        "type": "roundrobin"\n    },\n    "uri": "/*"\n}\'\n'})}),"\n",(0,l.jsx)(i.h2,{id:"eklentiyi-global-bir-modelpolitika-kullanarak-etkinle\u015ftirme",children:"Eklentiyi global bir model/politika kullanarak etkinle\u015ftirme"}),"\n",(0,l.jsxs)(i.p,{children:["Birden fazla rotada tek bir model ve politika yap\u0131land\u0131rmas\u0131 kullanmak isteyebilece\u011finiz durumlar olabilir. Bunu, \xf6ncelikle model ve politika yap\u0131land\u0131rmas\u0131n\u0131 eklentinin meta verilerine eklemek i\xe7in bir ",(0,l.jsx)(i.code,{children:"PUT"})," iste\u011fi g\xf6ndererek yapabilirsiniz:"]}),"\n",(0,l.jsx)(i.pre,{children:(0,l.jsx)(i.code,{className:"language-sh",children:'curl http://127.0.0.1:9080/apisix/admin/plugin_metadata/authz-casbin -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -i -X PUT -d \'\n{\n"model": "[request_definition]\nr = sub, obj, act\n\n[policy_definition]\np = sub, obj, act\n\n[role_definition]\ng = _, _\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) && keyMatch(r.obj, p.obj) && keyMatch(r.act, p.act)",\n\n"policy": "p, *, /, GET\np, admin, *, *\ng, alice, admin\ng, bob, admin"\n}\'\n'})}),"\n",(0,l.jsx)(i.p,{children:"Ve sonra ayn\u0131 yap\u0131land\u0131rmay\u0131 baz\u0131 rotalarda etkinle\u015ftirmek i\xe7in, Admin API'sini kullanarak bir istek g\xf6nderin:"}),"\n",(0,l.jsx)(i.pre,{children:(0,l.jsx)(i.code,{className:"language-sh",children:'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "plugins": {\n        "authz-casbin": {\n            "username": "username"\n        }\n    },\n    "upstream": {\n        "nodes": {\n            "127.0.0.1:1980": 1\n        },\n        "type": "roundrobin"\n    },\n    "uri": "/route1/*"\n}\'\n'})}),"\n",(0,l.jsx)(i.p,{children:"Bu, eklenti meta veri yap\u0131land\u0131rmas\u0131n\u0131 rotaya ekleyecektir. Eklenti meta veri yap\u0131land\u0131rmas\u0131n\u0131, g\xfcncellenmi\u015f model ve politika yap\u0131land\u0131rmas\u0131 ile iste\u011fi yeniden g\xf6ndererek kolayca g\xfcncelleyebilirsiniz, eklenti otomatik olarak eklenti meta verisini kullanan t\xfcm rotalar\u0131 g\xfcncelleyecektir."}),"\n",(0,l.jsx)(i.h2,{id:"kullan\u0131m-senaryolar\u0131",children:"Kullan\u0131m Senaryolar\u0131"}),"\n",(0,l.jsxs)(i.ul,{children:["\n",(0,l.jsx)(i.li,{children:"Bu eklentinin birincil kullan\u0131m senaryosu, API'lerinizde yetkilendirmeyi uygulamak olacakt\u0131r. Bu eklentiyi, yetkilendirme modeliniz ve politika yap\u0131land\u0131rman\u0131zla kullanmakta oldu\u011funuz herhangi bir API rotas\u0131na kolayca ekleyebilirsiniz."}),"\n",(0,l.jsx)(i.li,{children:"T\xfcm API'leriniz i\xe7in tek bir yetkilendirme modeline sahip olmak istiyorsan\u0131z, global model/politika y\xf6ntemini kullanabilirsiniz. Bu, politika g\xfcncellemesini t\xfcm rotalar i\xe7in kolayla\u015ft\u0131r\u0131r, \xe7\xfcnk\xfc sadece etcd'deki meta verileri g\xfcncellemeniz yeterlidir."}),"\n",(0,l.jsx)(i.li,{children:"E\u011fer her farkl\u0131 rotaya farkl\u0131 bir model kullanmak istiyorsan\u0131z, rota y\xf6ntemini kullanabilirsiniz. Bu, farkl\u0131 API rotalar\u0131n\u0131n farkl\u0131 kullan\u0131c\u0131 izinlerine sahip oldu\u011funda yard\u0131mc\u0131 olur. Ayr\u0131ca, daha b\xfcy\xfck politikalarla u\u011fra\u015f\u0131rken bunu kullanabilirsiniz, \xe7\xfcnk\xfc bu, yetkilendirmeyi birden \xe7ok rota filtrelendi\u011finde daha h\u0131zl\u0131 yapacakt\u0131r."}),"\n"]})]})}function u(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,l.jsx)(i,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>t,x:()=>s});var a=n(6540);const l={},r=a.createContext(l);function t(e){const i=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),a.createElement(r.Provider,{value:i},e.children)}},9992:e=>{e.exports=JSON.parse('{"permalink":"/tr/blog/2021/08/19/apisix-casbin-authorization","editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/i18n/tr/docusaurus-plugin-content-blog/2021-08-19-apisix-casbin-authorization.md","source":"@site/i18n/tr/docusaurus-plugin-content-blog/2021-08-19-apisix-casbin-authorization.md","title":"APISIX\'te Casbin kullanarak yetkilendirme","description":"Giri\u015f","date":"2021-08-19T00:00:00.000Z","tags":[],"readingTime":4.45,"hasTruncateMarker":false,"authors":[{"name":"Rushikesh Tote","title":"Casbin \xdcyesi","url":"http://github.com/rushitote","imageURL":"https://avatars.githubusercontent.com/rushitote","key":null,"page":null}],"frontMatter":{"title":"APISIX\'te Casbin kullanarak yetkilendirme","author":"Rushikesh Tote","authorTitle":"Casbin \xdcyesi","authorURL":"http://github.com/rushitote","authorImageURL":"https://avatars.githubusercontent.com/rushitote"},"unlisted":false,"prevItem":{"title":"Understanding How Casbin Matching Works in Detail","permalink":"/tr/blog/2023/12/08/understanding-casbin-matching-in-detail"},"nextItem":{"title":"Yang Luo - Google A\xe7\u0131k Kaynak E\u015f \xd6d\xfcl\xfc Kazanan\u0131","permalink":"/tr/blog/2020/04/21/google-award"}}')}}]);