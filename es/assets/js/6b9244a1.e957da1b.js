"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[2212],{3905:(e,r,t)=>{t.d(r,{Zo:()=>p,kt:()=>u});var n=t(7294);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function l(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=n.createContext({}),d=function(e){var r=n.useContext(s),t=r;return e&&(t="function"==typeof e?e(r):i(i({},r),e)),t},p=function(e){var r=d(e.components);return n.createElement(s.Provider,{value:r},e.children)},g={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},c=n.forwardRef((function(e,r){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(t),u=a,m=c["".concat(s,".").concat(u)]||c[u]||g[u]||o;return t?n.createElement(m,i(i({ref:r},p),{},{components:t})):n.createElement(m,i({ref:r},p))}));function u(e,r){var t=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=c;var l={};for(var s in r)hasOwnProperty.call(r,s)&&(l[s]=r[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var d=2;d<o;d++)i[d]=t[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}c.displayName="MDXCreateElement"},3817:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var n=t(7462),a=(t(7294),t(3905));const o={id:"log-error",title:"Log & Error Handling",description:"Registro y manejo de errores en Casbin",keywords:["log","error","error handling"],authors:["hsluoyz"]},i=void 0,l={unversionedId:"log-error",id:"log-error",title:"Log & Error Handling",description:"Registro y manejo de errores en Casbin",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/LogError.mdx",sourceDirName:".",slug:"/log-error",permalink:"/es/docs/log-error",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/LogError.mdx",tags:[],version:"current",frontMatter:{id:"log-error",title:"Log & Error Handling",description:"Registro y manejo de errores en Casbin",keywords:["log","error","error handling"],authors:["hsluoyz"]},sidebar:"docs",previous:{title:"Casbin Service",permalink:"/es/docs/service"},next:{title:"Frontend Usage",permalink:"/es/docs/frontend"}},s={},d=[{value:"Registro",id:"registro",level:2},{value:"Usar diferentes registradores para diferentes ejecutores",id:"usar-diferentes-registradores-para-diferentes-ejecutores",level:3},{value:"Registradores admitidos",id:"registradores-admitidos",level:4},{value:"C\xf3mo escribir un registrador",id:"c\xf3mo-escribir-un-registrador",level:4},{value:"Manejo de errores",id:"manejo-de-errores",level:2},{value:"Habilitar y deshabilitar",id:"habilitar-y-deshabilitar",level:2}],p=e=>function(r){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",r)},g=p("Tabs"),c=p("TabItem"),u={toc:d};function m(e){let{components:r,...t}=e;return(0,a.kt)("wrapper",(0,n.Z)({},u,t,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"registro"},"Registro"),(0,a.kt)("p",null,"Casbin utiliza el ",(0,a.kt)("inlineCode",{parentName:"p"},"log")," incorporado para imprimir registros en la consola por defecto, como:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-log"},"2017/07/15 19:43:56 [Request: alice, data1, read ---\x3e true]\n")),(0,a.kt)("p",null,"El registro no est\xe1 habilitado por defecto. Puedes activarlo mediante ",(0,a.kt)("inlineCode",{parentName:"p"},"Enforcer.EnableLog()")," o el \xfaltimo par\xe1metro de ",(0,a.kt)("inlineCode",{parentName:"p"},"NewEnforcer()"),"."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Ya admitimos el registro del modelo, solicitud de aplicaci\xf3n, rol y pol\xedtica en Golang. Puedes definir tu propio registro para registrar Casbin.\nSi est\xe1s utilizando Python, pycasbin aprovecha el mecanismo de registro de Python por defecto. El paquete pycasbin hace una llamada a ",(0,a.kt)("inlineCode",{parentName:"p"},"logging.getLogger()")," para configurar el registrador. No se necesita ninguna configuraci\xf3n especial de registro aparte de inicializar el registrador en la aplicaci\xf3n principal. Si no se inicializa ning\xfan registro dentro de la aplicaci\xf3n principal, no ver\xe1s ning\xfan mensaje de registro de pycasbin. Al mismo tiempo, cuando habilitas el registro en pycasbin, utilizar\xe1 la ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/pycasbin/blob/c33cabfa0ac65cd09cf812a65e71794d64cb5132/casbin/util/log.py#L6C1-L6C1"},"configuraci\xf3n de registro por defecto"),". Para otras extensiones de pycasbin, puedes consultar la ",(0,a.kt)("a",{parentName:"p",href:"https://docs.djangoproject.com/en/4.2/topics/logging/"},"documentaci\xf3n de registro de Django")," si eres usuario de Django. Para otros usuarios de Python, debes consultar la ",(0,a.kt)("a",{parentName:"p",href:"https://docs.python.org/3/library/logging.config.html"},"documentaci\xf3n de registro de Python")," para configurar el registrador.")),(0,a.kt)("h3",{id:"usar-diferentes-registradores-para-diferentes-ejecutores"},"Usar diferentes registradores para diferentes ejecutores"),(0,a.kt)("p",null,"Cada ejecutor puede tener su propio registrador para registrar informaci\xf3n, y se puede cambiar en tiempo de ejecuci\xf3n."),(0,a.kt)("p",null,"Y puedes usar un registrador adecuado mediante el \xfaltimo par\xe1metro de ",(0,a.kt)("inlineCode",{parentName:"p"},"NewEnforcer()"),". Si est\xe1s utilizando esta forma de inicializar tu ejecutor, no necesitas usar el par\xe1metro habilitado porque la prioridad del campo habilitado en el registrador es m\xe1s alta."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"// Set a default logger as enforcer e1's logger.\n// This operation can also be seen as changing the logger of e1 at runtime.\ne1.SetLogger(&Log.DefaultLogger{})\n\n// Set another logger as enforcer e2's logger.\ne2.SetLogger(&YouOwnLogger)\n\n// Set your logger when initializing enforcer e3.\ne3, _ := casbin.NewEnforcer(\"examples/rbac_model.conf\", a, logger)\n")),(0,a.kt)("h4",{id:"registradores-admitidos"},"Registradores admitidos"),(0,a.kt)("p",null,"Proporcionamos algunos registradores para ayudarte a registrar informaci\xf3n."),(0,a.kt)(g,{groupId:"langs",mdxType:"Tabs"},(0,a.kt)(c,{value:"Go",label:"Go",default:!0,mdxType:"TabItem"},(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Registrador"),(0,a.kt)("th",{parentName:"tr",align:null},"Autor"),(0,a.kt)("th",{parentName:"tr",align:null},"Descripci\xf3n"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/log/default_logger.go"},"Registrador por defecto (incorporado)")),(0,a.kt)("td",{parentName:"tr",align:null},"Casbin"),(0,a.kt)("td",{parentName:"tr",align:null},"El registrador por defecto utilizando log de golang.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://github.com/casbin/zap-logger"},"Registrador Zap")),(0,a.kt)("td",{parentName:"tr",align:null},"Casbin"),(0,a.kt)("td",{parentName:"tr",align:null},"Utilizando ",(0,a.kt)("a",{parentName:"td",href:"https://github.com/uber-go/zap"},"zap"),", proporciona registro codificado en json y puedes personalizar m\xe1s con tu propio zap-logger."))))),(0,a.kt)(c,{value:"PHP",label:"PHP",mdxType:"TabItem"},(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Registrador"),(0,a.kt)("th",{parentName:"tr",align:null},"Autor"),(0,a.kt)("th",{parentName:"tr",align:null},"Descripci\xf3n"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://github.com/php-casbin/psr3-bridge"},"Registrador psr3-bridge")),(0,a.kt)("td",{parentName:"tr",align:null},"Casbin"),(0,a.kt)("td",{parentName:"tr",align:null},"Proporciona un puente compatible con ",(0,a.kt)("a",{parentName:"td",href:"https://www.php-fig.org/psr/psr-3/"},"PSR-3"),".")))))),(0,a.kt)("h4",{id:"c\xf3mo-escribir-un-registrador"},"C\xf3mo escribir un registrador"),(0,a.kt)("p",null,"Tu registrador debe implementar la interfaz ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casbin/blob/master/log/logger.go#L20"},"Logger"),"."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9todo"),(0,a.kt)("th",{parentName:"tr",align:null},"Tipo"),(0,a.kt)("th",{parentName:"tr",align:null},"Descripci\xf3n"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"EnableLog()"),(0,a.kt)("td",{parentName:"tr",align:null},"obligatorio"),(0,a.kt)("td",{parentName:"tr",align:null},"Controla si imprimir el mensaje.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"IsEnabled()"),(0,a.kt)("td",{parentName:"tr",align:null},"obligatorio"),(0,a.kt)("td",{parentName:"tr",align:null},"Muestra el estado habilitado del registrador actual.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"LogModel()"),(0,a.kt)("td",{parentName:"tr",align:null},"obligatorio"),(0,a.kt)("td",{parentName:"tr",align:null},"Registra informaci\xf3n relacionada con el modelo.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"LogEnforce()"),(0,a.kt)("td",{parentName:"tr",align:null},"obligatorio"),(0,a.kt)("td",{parentName:"tr",align:null},"Informaci\xf3n de registro relacionada con la aplicaci\xf3n.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"LogRole()"),(0,a.kt)("td",{parentName:"tr",align:null},"obligatorio"),(0,a.kt)("td",{parentName:"tr",align:null},"Informaci\xf3n de registro relacionada con el rol.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"LogPolicy()"),(0,a.kt)("td",{parentName:"tr",align:null},"obligatorio"),(0,a.kt)("td",{parentName:"tr",align:null},"Informaci\xf3n de registro relacionada con la pol\xedtica.")))),(0,a.kt)("p",null,"Puede pasar su ",(0,a.kt)("inlineCode",{parentName:"p"},"logger")," personalizado a ",(0,a.kt)("inlineCode",{parentName:"p"},"Enforcer.SetLogger()"),"."),(0,a.kt)("p",null,"Aqu\xed hay un ejemplo de c\xf3mo personalizar un logger para Golang:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n    "fmt"\n    "log"\n    "strings"\n)\n\n// DefaultLogger is the implementation for a Logger using golang log.\ntype DefaultLogger struct {\n    enabled bool\n}\n\nfunc (l *DefaultLogger) EnableLog(enable bool) {\n    l.enabled = enable\n}\n\nfunc (l *DefaultLogger) IsEnabled() bool {\n    return l.enabled\n}\n\nfunc (l *DefaultLogger) LogModel(model [][]string) {\n    if !l.enabled {\n        return\n    }\n    var str strings.Builder\n    str.WriteString("Model: ")\n    for _, v := range model {\n        str.WriteString(fmt.Sprintf("%v\\n", v))\n    }\n\n    log.Println(str.String())\n}\n\nfunc (l *DefaultLogger) LogEnforce(matcher string, request []interface{}, result bool, explains [][]string) {\n    if !l.enabled {\n        return\n    }\n\n    var reqStr strings.Builder\n    reqStr.WriteString("Request: ")\n    for i, rval := range request {\n        if i != len(request)-1 {\n            reqStr.WriteString(fmt.Sprintf("%v, ", rval))\n        } else {\n            reqStr.WriteString(fmt.Sprintf("%v", rval))\n        }\n    }\n    reqStr.WriteString(fmt.Sprintf(" ---\x3e %t\\n", result))\n\n    reqStr.WriteString("Hit Policy: ")\n    for i, pval := range explains {\n        if i != len(explains)-1 {\n            reqStr.WriteString(fmt.Sprintf("%v, ", pval))\n        } else {\n            reqStr.WriteString(fmt.Sprintf("%v \\n", pval))\n        }\n    }\n\n    log.Println(reqStr.String())\n}\n\nfunc (l *DefaultLogger) LogPolicy(policy map[string][][]string) {\n    if !l.enabled {\n        return\n    }\n\n    var str strings.Builder\n    str.WriteString("Policy: ")\n    for k, v := range policy {\n        str.WriteString(fmt.Sprintf("%s : %v\\n", k, v))\n    }\n\n    log.Println(str.String())\n}\n\nfunc (l *DefaultLogger) LogRole(roles []string) {\n    if !l.enabled {\n        return\n    }\n\n    log.Println("Roles: ", roles)\n}\n')),(0,a.kt)("h2",{id:"manejo-de-errores"},"Manejo de errores"),(0,a.kt)("p",null,"Pueden ocurrir errores o p\xe1nicos cuando usa Casbin por razones como:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Sintaxis inv\xe1lida en el archivo del modelo (.conf)."),(0,a.kt)("li",{parentName:"ol"},"Sintaxis inv\xe1lida en el archivo de pol\xedticas (.csv)."),(0,a.kt)("li",{parentName:"ol"},"Errores personalizados de adaptadores de almacenamiento, por ejemplo, MySQL no logra conectar."),(0,a.kt)("li",{parentName:"ol"},"Bug de Casbin.")),(0,a.kt)("p",null,"Hay cinco funciones principales que es posible que necesite conocer para errores o p\xe1nicos:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Funci\xf3n"),(0,a.kt)("th",{parentName:"tr",align:null},"Comportamiento en caso de error"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://godoc.org/github.com/casbin/casbin#NewEnforcer"},"NewEnforcer()")),(0,a.kt)("td",{parentName:"tr",align:null},"Devuelve un error")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://godoc.org/github.com/casbin/casbin#Enforcer.LoadModel"},"LoadModel()")),(0,a.kt)("td",{parentName:"tr",align:null},"Devuelve un error")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://godoc.org/github.com/casbin/casbin#Enforcer.LoadPolicy"},"LoadPolicy()")),(0,a.kt)("td",{parentName:"tr",align:null},"Devuelve un error")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://godoc.org/github.com/casbin/casbin#Enforcer.SavePolicy"},"SavePolicy()")),(0,a.kt)("td",{parentName:"tr",align:null},"Devuelve un error")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://godoc.org/github.com/casbin/casbin#Enforcer.Enforce"},"Enforce()")),(0,a.kt)("td",{parentName:"tr",align:null},"Devuelve un error")))),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"NewEnforcer()")," llama internamente a ",(0,a.kt)("inlineCode",{parentName:"p"},"LoadModel()")," y ",(0,a.kt)("inlineCode",{parentName:"p"},"LoadPolicy()"),". As\xed que no tiene que llamar a estos dos \xfaltimos al usar ",(0,a.kt)("inlineCode",{parentName:"p"},"NewEnforcer()"),".")),(0,a.kt)("h2",{id:"habilitar-y-deshabilitar"},"Habilitar y deshabilitar"),(0,a.kt)("p",null,"El enforcer se puede deshabilitar a trav\xe9s de la funci\xf3n ",(0,a.kt)("inlineCode",{parentName:"p"},"Enforcer.EnableEnforce()"),". Cuando est\xe1 deshabilitado, ",(0,a.kt)("inlineCode",{parentName:"p"},"Enforcer.Enforce()")," siempre devolver\xe1 ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),". Otras operaciones como agregar o eliminar pol\xedticas no se ven afectadas. Aqu\xed hay un ejemplo:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'e := casbin.NewEnforcer("examples/basic_model.conf", "examples/basic_policy.csv")\n\n// Will return false.\n// By default, the enforcer is enabled.\ne.Enforce("non-authorized-user", "data1", "read")\n\n// Disable the enforcer at runtime.\ne.EnableEnforce(false)\n\n// Will return true for any request.\ne.Enforce("non-authorized-user", "data1", "read")\n\n// Enable the enforcer again.\ne.EnableEnforce(true)\n\n// Will return false.\ne.Enforce("non-authorized-user", "data1", "read")\n')))}m.isMDXComponent=!0}}]);