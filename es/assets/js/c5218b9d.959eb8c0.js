"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[2209],{3905:(e,a,t)=>{t.d(a,{Zo:()=>u,kt:()=>m});var r=t(7294);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var l=r.createContext({}),c=function(e){var a=r.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},u=function(e){var a=c(e.components);return r.createElement(l.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},p=r.forwardRef((function(e,a){var t=e.components,n=e.mdxType,s=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(t),m=n,b=p["".concat(l,".").concat(m)]||p[m]||d[m]||s;return t?r.createElement(b,o(o({ref:a},u),{},{components:t})):r.createElement(b,o({ref:a},u))}));function m(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var s=t.length,o=new Array(s);o[0]=p;var i={};for(var l in a)hasOwnProperty.call(a,l)&&(i[l]=a[l]);i.originalType=e,i.mdxType="string"==typeof e?e:n,o[1]=i;for(var c=2;c<s;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},4548:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var r=t(7462),n=(t(7294),t(3905));const s={id:"k8s",title:"Authorization of Kubernetes",description:"Middleware de autorizaci\xf3n RBAC & ABAC de Kubernetes (k8s) basado en Casbin",keywords:["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],authors:["hsluoyz"]},o=void 0,i={unversionedId:"k8s",id:"k8s",title:"Authorization of Kubernetes",description:"Middleware de autorizaci\xf3n RBAC & ABAC de Kubernetes (k8s) basado en Casbin",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/K8sAuthz.mdx",sourceDirName:".",slug:"/k8s",permalink:"/es/docs/k8s",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sAuthz.mdx",tags:[],version:"current",frontMatter:{id:"k8s",title:"Authorization of Kubernetes",description:"Middleware de autorizaci\xf3n RBAC & ABAC de Kubernetes (k8s) basado en Casbin",keywords:["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],authors:["hsluoyz"]},sidebar:"docs",previous:{title:"Performance Optimization",permalink:"/es/docs/performance"},next:{title:"Admission Webhook for K8s",permalink:"/es/docs/k8s-gatekeeper"}},l={},c=[{value:"Requisitos",id:"requisitos",level:2},{value:"Uso",id:"uso",level:2}],u={toc:c};function d(e){let{components:a,...t}=e;return(0,n.kt)("wrapper",(0,r.Z)({},u,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz"},"K8s-authz")," es un middleware de autorizaci\xf3n de Kubernetes (k8s) basado en Casbin que utiliza RBAC (Control de Acceso Basado en Roles) y ABAC (Control de Acceso Basado en Atributos) para la aplicaci\xf3n de pol\xedticas. Este middleware se integra con el webhook de admisi\xf3n de validaci\xf3n de K8s para validar las pol\xedticas definidas por Casbin para cada solicitud hecha a los recursos de K8s. Los controladores de admisi\xf3n personalizados se registran en Kubernetes utilizando el ",(0,n.kt)("inlineCode",{parentName:"p"},"ValidatingAdmissionWebhook")," para realizar validaciones en los objetos de solicitud reenviados por el servidor API y proporcionar una respuesta que indica si la solicitud debe ser permitida o rechazada."),(0,n.kt)("p",null,"Para determinar cu\xe1ndo enviar solicitudes entrantes al controlador de admisi\xf3n, se ha implementado un webhook de validaci\xf3n. Este webhook reenv\xeda solicitudes para cualquier tipo de recurso o sub-recurso de K8s y realiza la verificaci\xf3n de pol\xedticas. Los usuarios solo est\xe1n autorizados a realizar operaciones en estos recursos si est\xe1n autorizados por el ejecutor de Casbin. El ",(0,n.kt)("a",{parentName:"p",href:"/docs/get-started#new-a-casbin-enforcer"},"ejecutor")," verifica los roles del usuario seg\xfan se definen en las pol\xedticas. El cl\xfaster de K8s es el objetivo de despliegue para este middleware."),(0,n.kt)("h2",{id:"requisitos"},"Requisitos"),(0,n.kt)("p",null,"Antes de continuar, aseg\xfarese de tener lo siguiente:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Un cl\xfaster de Kubernetes en funcionamiento. Puede configurar un cl\xfaster local usando Docker o configurar un ecosistema completo de Kubernetes en su servidor. Para instrucciones detalladas, consulte esta ",(0,n.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/"},"gu\xeda")," para configurar un cl\xfaster local de Kubernetes en Windows o esta ",(0,n.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/how-to-create-a-kubernetes-cluster-using-kubeadm-on-ubuntu-18-04"},"gu\xeda")," para configurar un cl\xfaster en Linux."),(0,n.kt)("li",{parentName:"ul"},"CLI de Kubectl. Las instrucciones para instalar Kubectl en Windows se pueden encontrar ",(0,n.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/"},"aqu\xed"),", y para Linux ",(0,n.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/"},"aqu\xed"),"."),(0,n.kt)("li",{parentName:"ul"},"OpenSSL")),(0,n.kt)("h2",{id:"uso"},"Uso"),(0,n.kt)("p",null,"Siga estos pasos para usar K8s-authz:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Genere certificados y claves para cada usuario utilizando OpenSSL. Ejecute el siguiente script:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./gen_cert.sh\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Construya la imagen de Docker desde el ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/Dockerfile"},"Dockerfile")," manualmente ejecutando el siguiente comando. Recuerde cambiar la versi\xf3n de construcci\xf3n en el comando y en el archivo de despliegue ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/718f58c46e3dbf79063b5b1c18348c2fee5de9e9/manifests/deployment.yaml#L18"},"file")," correspondientemente."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t casbin/k8s_authz:0.1 .\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Defina las pol\xedticas de Casbin en los archivos ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/config/model.conf"},"model.conf")," y ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/config/policy.csv"},"policy.csv"),". Para obtener m\xe1s informaci\xf3n sobre c\xf3mo funcionan estas pol\xedticas, consulte la ",(0,n.kt)("a",{parentName:"p",href:"/docs/how-it-works"},"documentaci\xf3n"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Antes de desplegar, puede modificar los puertos en el archivo ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/main.go"},"main.go"),", as\xed como en la configuraci\xf3n del webhook de validaci\xf3n ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/manifests/deployment.yaml"},"file"),", basado en sus requisitos espec\xedficos.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Despliegue el controlador de validaci\xf3n y el webhook en el cl\xfaster de Kubernetes ejecutando el siguiente comando:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f deployment.yaml\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Para un servidor de producci\xf3n, se recomienda crear un ",(0,n.kt)("inlineCode",{parentName:"p"},"secret")," de Kubernetes para asegurar los certificados:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create secret generic casbin -n default \\\n  --from-file=key.pem=certs/casbin-key.pem \\\n  --from-file=cert.pem=certs/casbin-crt.pem\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Despu\xe9s de completar los pasos anteriores, necesita actualizar el directorio de certificados en ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/main.go#L26"},"main.go")," y los ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/manifests/deployment.yaml#L22"},"manifests")," con el directorio del ",(0,n.kt)("inlineCode",{parentName:"p"},"secret")," creado."))),(0,n.kt)("p",null,"Ahora, el servidor deber\xeda estar en funcionamiento, listo para validar solicitudes hechas a los recursos de K8s y aplicar las pol\xedticas correspondientemente."))}d.isMDXComponent=!0}}]);