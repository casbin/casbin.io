"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[5059],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var s=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,s,n=function(e,t){if(null==e)return{};var r,s,n={},a=Object.keys(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var u=s.createContext({}),l=function(e){var t=s.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=l(e.components);return s.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},d=s.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,u=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=l(r),m=n,b=d["".concat(u,".").concat(m)]||d[m]||p[m]||a;return r?s.createElement(b,i(i({ref:t},c),{},{components:r})):s.createElement(b,i({ref:t},c))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,i=new Array(a);i[0]=d;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o.mdxType="string"==typeof e?e:n,i[1]=o;for(var l=2;l<a;l++)i[l]=r[l];return s.createElement.apply(null,i)}return s.createElement.apply(null,r)}d.displayName="MDXCreateElement"},9650:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var s=r(7462),n=(r(7294),r(3905));const a={id:"k8s",title:"Authorization of Kubernetes",description:"Kubernetes (k8s) RBAC & ABAC middleware d'autorisation bas\xe9 sur Casbin",keywords:["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],authors:["hsluoyz"]},i=void 0,o={unversionedId:"k8s",id:"k8s",title:"Authorization of Kubernetes",description:"Kubernetes (k8s) RBAC & ABAC middleware d'autorisation bas\xe9 sur Casbin",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/K8sAuthz.mdx",sourceDirName:".",slug:"/k8s",permalink:"/fr/docs/k8s",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sAuthz.mdx",tags:[],version:"current",frontMatter:{id:"k8s",title:"Authorization of Kubernetes",description:"Kubernetes (k8s) RBAC & ABAC middleware d'autorisation bas\xe9 sur Casbin",keywords:["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],authors:["hsluoyz"]},sidebar:"docs",previous:{title:"Performance Optimization",permalink:"/fr/docs/performance"},next:{title:"Admission Webhook for K8s",permalink:"/fr/docs/k8s-gatekeeper"}},u={},l=[{value:"Exigences",id:"exigences",level:2},{value:"Utilisation",id:"utilisation",level:2}],c={toc:l};function p(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,s.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz"},"K8s-authz")," est un middleware d'autorisation Kubernetes (k8s) bas\xe9 sur Casbin qui utilise RBAC (Contr\xf4le d'Acc\xe8s Bas\xe9 sur les R\xf4les) et ABAC (Contr\xf4le d'Acc\xe8s Bas\xe9 sur les Attributs) pour l'application des politiques. Ce middleware s'int\xe8gre avec le webhook d'admission de validation K8s pour valider les politiques d\xe9finies par Casbin pour chaque requ\xeate faite aux ressources K8s. Les contr\xf4leurs d'admission personnalis\xe9s sont enregistr\xe9s avec Kubernetes en utilisant le ",(0,n.kt)("inlineCode",{parentName:"p"},"ValidatingAdmissionWebhook")," pour effectuer des validations sur les objets de requ\xeate transmis par le serveur API et fournir une r\xe9ponse indiquant si la requ\xeate doit \xeatre autoris\xe9e ou rejet\xe9e."),(0,n.kt)("p",null,"Pour d\xe9terminer quand envoyer les requ\xeates entrantes au contr\xf4leur d'admission, un webhook de validation a \xe9t\xe9 mis en \u0153uvre. Ce webhook proxy les demandes pour tout type de ressource ou sous-ressource K8s et effectue la v\xe9rification des politiques. Les utilisateurs ne sont autoris\xe9s \xe0 effectuer des op\xe9rations sur ces ressources que s'ils sont autoris\xe9s par l'ex\xe9cuteur Casbin. L'",(0,n.kt)("a",{parentName:"p",href:"/docs/get-started#new-a-casbin-enforcer"},"ex\xe9cuteur")," v\xe9rifie les r\xf4les de l'utilisateur tels que d\xe9finis dans les politiques. Le cluster K8s est la cible de d\xe9ploiement pour ce middleware."),(0,n.kt)("h2",{id:"exigences"},"Exigences"),(0,n.kt)("p",null,"Avant de continuer, assurez-vous d'avoir ce qui suit :"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Un cluster Kubernetes en cours d'ex\xe9cution. Vous pouvez configurer un cluster local en utilisant Docker ou configurer un \xe9cosyst\xe8me Kubernetes complet sur votre serveur. Pour des instructions d\xe9taill\xe9es, reportez-vous \xe0 ce ",(0,n.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/"},"guide")," pour configurer un cluster Kubernetes local sur Windows ou ce ",(0,n.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/how-to-create-a-kubernetes-cluster-using-kubeadm-on-ubuntu-18-04"},"guide")," pour configurer un cluster sur Linux."),(0,n.kt)("li",{parentName:"ul"},"Kubectl CLI. Les instructions pour installer Kubectl sur Windows se trouvent ",(0,n.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/"},"ici"),", et pour Linux ",(0,n.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/"},"ici"),"."),(0,n.kt)("li",{parentName:"ul"},"OpenSSL")),(0,n.kt)("h2",{id:"utilisation"},"Utilisation"),(0,n.kt)("p",null,"Suivez ces \xe9tapes pour utiliser K8s-authz :"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"G\xe9n\xe9rez des certificats et des cl\xe9s pour chaque utilisateur en utilisant OpenSSL. Ex\xe9cutez le script ci-dessous :"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./gen_cert.sh\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Construisez l'image Docker \xe0 partir du ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/Dockerfile"},"Dockerfile")," manuellement en ex\xe9cutant la commande suivante. N'oubliez pas de changer la version de construction dans la commande et dans le ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/718f58c46e3dbf79063b5b1c18348c2fee5de9e9/manifests/deployment.yaml#L18"},"fichier")," de d\xe9ploiement en cons\xe9quence."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t casbin/k8s_authz:0.1 .\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"D\xe9finissez les politiques Casbin dans les fichiers ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/config/model.conf"},"model.conf")," et ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/config/policy.csv"},"policy.csv"),". Pour plus d'informations sur le fonctionnement de ces politiques, reportez-vous \xe0 la ",(0,n.kt)("a",{parentName:"p",href:"/docs/how-it-works"},"documentation"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Avant de d\xe9ployer, vous pouvez modifier les ports dans le fichier ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/main.go"},"main.go"),", ainsi que dans le fichier de configuration du webhook de validation ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/manifests/deployment.yaml"},"file"),", en fonction de vos besoins sp\xe9cifiques.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"D\xe9ployez le contr\xf4leur de validation et le webhook sur le cluster Kubernetes en ex\xe9cutant la commande suivante :"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f deployment.yaml\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Pour un serveur de production, il est recommand\xe9 de cr\xe9er un ",(0,n.kt)("inlineCode",{parentName:"p"},"secret")," Kubernetes pour s\xe9curiser les certificats :"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create secret generic casbin -n default \\\n  --from-file=key.pem=certs/casbin-key.pem \\\n  --from-file=cert.pem=certs/casbin-crt.pem\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Apr\xe8s avoir compl\xe9t\xe9 les \xe9tapes ci-dessus, vous devez mettre \xe0 jour le r\xe9pertoire des certificats dans ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/main.go#L26"},"main.go")," et les ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/manifests/deployment.yaml#L22"},"manifestes")," avec le r\xe9pertoire du ",(0,n.kt)("inlineCode",{parentName:"p"},"secret")," cr\xe9\xe9."))),(0,n.kt)("p",null,"Maintenant, le serveur devrait \xeatre op\xe9rationnel, pr\xeat \xe0 valider les requ\xeates faites aux ressources K8s et \xe0 appliquer les politiques en cons\xe9quence."))}p.isMDXComponent=!0}}]);