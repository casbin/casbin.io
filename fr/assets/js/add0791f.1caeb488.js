"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[5777],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return v}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=u(e,["components","mdxType","originalType","parentName"]),d=s(n),v=a,m=d["".concat(l,".").concat(v)]||d[v]||p[v]||i;return n?r.createElement(m,o(o({ref:t},c),{},{components:n})):r.createElement(m,o({ref:t},c))}));function v(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var u={};for(var l in t)hasOwnProperty.call(t,l)&&(u[l]=t[l]);u.originalType=e,u.mdxType="string"==typeof e?e:a,o[1]=u;for(var s=2;s<i;s++)o[s]=n[s];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5162:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(7294),a=n(6010),i="tabItem_Ymn6";function o(e){var t=e.children,n=e.hidden,o=e.className;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(i,o),hidden:n},t)}},5488:function(e,t,n){n.d(t,{Z:function(){return v}});var r=n(3117),a=n(7294),i=n(6010),o=n(2389),u=n(7392),l=n(7094),s=n(2466),c="tabList__CuJ",p="tabItem_LNqP";function d(e){var t,n,o=e.lazy,d=e.block,v=e.defaultValue,m=e.values,f=e.groupId,y=e.className,b=a.Children.map(e.children,(function(e){if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),h=null!=m?m:b.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),g=(0,u.l)(h,(function(e,t){return e.value===t.value}));if(g.length>0)throw new Error('Docusaurus error: Duplicate values "'+g.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var k=null===v?v:null!=(t=null!=v?v:null==(n=b.find((function(e){return e.props.default})))?void 0:n.props.value)?t:b[0].props.value;if(null!==k&&!h.some((function(e){return e.value===k})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+k+'" but none of its children has the corresponding value. Available values are: '+h.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var w=(0,l.U)(),E=w.tabGroupChoices,N=w.setTabGroupChoices,x=(0,a.useState)(k),O=x[0],C=x[1],T=[],q=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=f){var A=E[f];null!=A&&A!==O&&h.some((function(e){return e.value===A}))&&C(A)}var P=function(e){var t=e.currentTarget,n=T.indexOf(t),r=h[n].value;r!==O&&(q(t),C(r),null!=f&&N(f,String(r)))},I=function(e){var t,n=null;switch(e.key){case"ArrowRight":var r,a=T.indexOf(e.currentTarget)+1;n=null!=(r=T[a])?r:T[0];break;case"ArrowLeft":var i,o=T.indexOf(e.currentTarget)-1;n=null!=(i=T[o])?i:T[T.length-1]}null==(t=n)||t.focus()};return a.createElement("div",{className:(0,i.Z)("tabs-container",c)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":d},y)},h.map((function(e){var t=e.value,n=e.label,o=e.attributes;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:O===t?0:-1,"aria-selected":O===t,key:t,ref:function(e){return T.push(e)},onKeyDown:I,onFocus:P,onClick:P},o,{className:(0,i.Z)("tabs__item",p,null==o?void 0:o.className,{"tabs__item--active":O===t})}),null!=n?n:t)}))),o?(0,a.cloneElement)(b.filter((function(e){return e.props.value===O}))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},b.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==O})}))))}function v(e){var t=(0,o.Z)();return a.createElement(d,(0,r.Z)({key:String(t)},e))}},4220:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return v},frontMatter:function(){return u},metadata:function(){return s},toc:function(){return p}});var r=n(3117),a=n(102),i=(n(7294),n(3905)),o=(n(5488),n(5162),["components"]),u={id:"envoy",title:"Autorisation de maillage de service par l'envoy\xe9"},l=void 0,s={unversionedId:"envoy",id:"envoy",title:"Autorisation de maillage de service par l'envoy\xe9",description:"Envoy-authz est un middleware d'Envoy\xe9 qui effectue une autorisation externe RBAC & ABAC via casbin. Ce middleware utilise l'API d'autorisation externe Envoy\xe9 via un serveur gRPC. Ce proxy serait d\xe9ploy\xe9 sur n'importe quel type de mailles de service bas\xe9es sur l'envoi comme Istio.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/EnvoyAuthz.mdx",sourceDirName:".",slug:"/envoy",permalink:"/fr/docs/envoy",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/EnvoyAuthz.mdx",tags:[],version:"current",frontMatter:{id:"envoy",title:"Autorisation de maillage de service par l'envoy\xe9"},sidebar:"docs",previous:{title:"Autorisation de Kubernetes",permalink:"/fr/docs/k8s"},next:{title:"Portail Admin",permalink:"/fr/docs/admin-portal"}},c={},p=[{value:"Exigences",id:"exigences",level:2},{value:"Travail de Middleware",id:"travail-de-middleware",level:2},{value:"Usage",id:"usage",level:2},{value:"Int\xe9gration \xe0 Istio",id:"int\xe9gration-\xe0-istio",level:2}],d={toc:p};function v(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/casbin/envoy-authz"},"Envoy-authz")," est un middleware d'Envoy\xe9 qui effectue une autorisation externe RBAC & ABAC via casbin. Ce middleware utilise l'API d'autorisation externe ",(0,i.kt)("a",{parentName:"p",href:"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/security/ext_authz_filter.html"},"Envoy\xe9")," via un serveur gRPC. Ce proxy serait d\xe9ploy\xe9 sur n'importe quel type de mailles de service bas\xe9es sur l'envoi comme Istio."),(0,i.kt)("h2",{id:"exigences"},"Exigences"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Envoy\xe9 1.17+"),(0,i.kt)("li",{parentName:"ul"},"Istio ou tout type de maillage de service"),(0,i.kt)("li",{parentName:"ul"},"D\xe9pendances grpc")),(0,i.kt)("p",null,"Les d\xe9pendances sont g\xe9r\xe9es via ",(0,i.kt)("inlineCode",{parentName:"p"},"go.mod"),"."),(0,i.kt)("h2",{id:"travail-de-middleware"},"Travail de Middleware"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Un client ferait une requ\xeate http."),(0,i.kt)("li",{parentName:"ul"},"Envoy proxy enverrait cette requ\xeate au serveur grpc."),(0,i.kt)("li",{parentName:"ul"},"Le serveur grpc autoriserait alors la requ\xeate en se basant sur les r\xe8gles de casbin."),(0,i.kt)("li",{parentName:"ul"},"Si elle est autoris\xe9e, la demande sera envoy\xe9e par le biais ou autrement, elle sera refus\xe9e.")),(0,i.kt)("p",null,"Le serveur grpc est bas\xe9 sur le tampon de protocole de ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/envoyproxy/envoy/blob/master/api/envoy/service/auth/v2alpha/external_auth.proto"},"external_auth.proto")," d'Envoy."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"// Une interface g\xe9n\xe9rique pour effectuer la v\xe9rification d'autorisation sur les requ\xeates entrantes\n// \xe0 un service en r\xe9seau.\nservice Authorization {\n  // Effectue une v\xe9rification d'autorisation bas\xe9e sur les attributs associ\xe9s \xe0 la requ\xeate entrante\n  // et retourne le statut `OK` ou pas `OK`.\n  rpc Check(v2.CheckRequest) retourne (v2.CheckResponse);\n}\n")),(0,i.kt)("p",null,"\xc0 partir du profil ci-dessus, nous devons utiliser le service ",(0,i.kt)("inlineCode",{parentName:"p"},"Check()")," dans le serveur d'autorisation."),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"D\xe9finissez les politiques de Casbin sous les fichiers de configuration en suivant ce ",(0,i.kt)("a",{parentName:"li",href:"/docs/how-it-works"},"guide"),".")),(0,i.kt)("p",null,"Vous pouvez v\xe9rifier/tester vos politiques sur ",(0,i.kt)("a",{parentName:"p",href:"https://casbin.io/editor/"},"l'\xe9diteur de casbin-")," en ligne."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"D\xe9marrez le serveur d'autorisation en cours d'ex\xe9cution :-")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ go build .\n$ ./authz \n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Charger la configuration de l'envoy\xe9 :-")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$  envoy -c authz.yaml -l info\n")),(0,i.kt)("p",null,"Une fois que l'envoy\xe9 aura d\xe9marr\xe9, il commencera \xe0 intercepter les demandes d'autorisation."),(0,i.kt)("h2",{id:"int\xe9gration-\xe0-istio"},"Int\xe9gration \xe0 Istio"),(0,i.kt)("p",null,"Vous devez envoyer des en-t\xeates personnalis\xe9s, qui contiendraient des noms d'utilisateur dans les en-t\xeates JWT pour que ce middleware fonctionne. Vous pouvez consulter les docs officiels ",(0,i.kt)("a",{parentName:"p",href:"https://istio.io/v1.4/docs/tasks/policy-enforcement/control-headers/"},"Istio")," pour obtenir plus d'informations sur la modification des ",(0,i.kt)("inlineCode",{parentName:"p"},"en-t\xeates de requ\xeate"),"."))}v.isMDXComponent=!0}}]);