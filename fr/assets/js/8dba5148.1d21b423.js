"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[5059],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var n=r(7294);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r,n,s={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var u=n.createContext({}),l=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=l(e.components);return n.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,s=e.mdxType,a=e.originalType,u=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=l(r),m=s,b=d["".concat(u,".").concat(m)]||d[m]||p[m]||a;return r?n.createElement(b,i(i({ref:t},c),{},{components:r})):n.createElement(b,i({ref:t},c))}));function m(e,t){var r=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var a=r.length,i=new Array(a);i[0]=d;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o.mdxType="string"==typeof e?e:s,i[1]=o;for(var l=2;l<a;l++)i[l]=r[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},9650:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var n=r(7462),s=(r(7294),r(3905));const a={id:"k8s",title:"Autorisation de Kubernetes",description:"Kubernetes (k8s) RBAC & ABAC authorization middleware based on Casbin",keywords:["K8s-authz","Kubernetes","k8s"],authors:["hsluoyz"]},i=void 0,o={unversionedId:"k8s",id:"k8s",title:"Autorisation de Kubernetes",description:"Kubernetes (k8s) RBAC & ABAC authorization middleware based on Casbin",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/K8sAuthz.mdx",sourceDirName:".",slug:"/k8s",permalink:"/fr/docs/k8s",draft:!1,editUrl:"https://crowdin.com/project/casbin-website/fr",tags:[],version:"current",frontMatter:{id:"k8s",title:"Autorisation de Kubernetes",description:"Kubernetes (k8s) RBAC & ABAC authorization middleware based on Casbin",keywords:["K8s-authz","Kubernetes","k8s"],authors:["hsluoyz"]},sidebar:"docs",previous:{title:"Optimisation des performances",permalink:"/fr/docs/performance"},next:{title:"Admission Webhook For K8s",permalink:"/fr/docs/k8s-gatekeeper"}},u={},l=[{value:"Exigences",id:"exigences",level:2},{value:"Usage",id:"usage",level:2}],c={toc:l};function p(e){let{components:t,...r}=e;return(0,s.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz"},"K8s-authz")," est un middleware d'autorisation Kubernetes (k8s) RBAC & ABAC bas\xe9 sur Casbin. Ce middleware utilise le webhook de validation K8s pour v\xe9rifier les politiques d\xe9finies par casbin, pour chaque requ\xeate des ressources k8s. Ces contr\xf4leurs d'admission personnalis\xe9s effectuent une sorte de validation sur l'objet de requ\xeate qui a \xe9t\xe9 transf\xe9r\xe9 par le serveur api et bas\xe9 sur une logique, renvoie une r\xe9ponse au serveur api qui contient des informations sur l'autoriser ou rejeter la requ\xeate. Ces contr\xf4leurs sont enregistr\xe9s aupr\xe8s de Kubernetes en utilisant le ",(0,s.kt)("inlineCode",{parentName:"p"},"ValidatingAdmissionWebhook"),"."),(0,s.kt)("p",null,"Le serveur API K8s a besoin de savoir quand envoyer la requ\xeate entrante \xe0 notre contr\xf4leur d'entr\xe9e. Pour cette partie nous avons d\xe9fini un webhook de validation qui repr\xe9senterait les requ\xeates pour n'importe quel type de ressource/sous-ressource K8s et effectuerait une v\xe9rification de la politique dessus. L'utilisateur ne serait autoris\xe9 \xe0 effectuer les op\xe9rations sur ces ressources, que si le responsable de casbin l'autorise. Le ",(0,s.kt)("a",{parentName:"p",href:"/docs/get-started#new-a-casbin-enforcer"},"policier")," v\xe9rifie les r\xf4les de l'utilisateur d\xe9finis dans les politiques. Ce middleware serait d\xe9ploy\xe9 sur le cluster K8s."),(0,s.kt)("h2",{id:"exigences"},"Exigences"),(0,s.kt)("p",null,"Avant de continuer, assurez-vous d'avoir les \xe9l\xe9ments suivants-"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Un cluster k8s en cours d'ex\xe9cution. Vous pouvez soit ex\xe9cuter les clusters via Docker en l'activant sur Docker Desktop ou vous pouvez configurer l'\xe9cosytem K8s complet localement ou sur votre serveur. You can follow this detailed ",(0,s.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/"},"guide")," to setup the k8s cluster locally on Windows or this ",(0,s.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/how-to-create-a-kubernetes-cluster-using-kubeadm-on-ubuntu-18-04"},"guide")," if want to setup for Linux."),(0,s.kt)("li",{parentName:"ul"},"Kubectl CLI This is the ",(0,s.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/"},"guide")," to setup it on Windows and this ",(0,s.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/"},"guide")," for Linux."),(0,s.kt)("li",{parentName:"ul"},"OpenSSL")),(0,s.kt)("h2",{id:"usage"},"Usage"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"G\xe9n\xe9rer les certificats et cl\xe9s pour chaque utilisateur en utilisant openssl et en ex\xe9cutant le script suivant :-")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"./gen_cert.sh\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Construire l'image du docker \xe0 partir du ",(0,s.kt)("a",{parentName:"li",href:"https://github.com/casbin/k8s-authz/blob/master/Dockerfile"},"Dockerfile")," manuellement en ex\xe9cutant la commande suivante, puis changer la version de compilation ici et au fichier de d\xe9ploiement ",(0,s.kt)("a",{parentName:"li",href:"https://github.com/casbin/k8s-authz/blob/718f58c46e3dbf79063b5b1c18348c2fee5de9e9/manifests/deployment.yaml#L18"}),", selon les constructions.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t casbin/k8s_authz:0.1 .\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"D\xe9finissez les politiques casbin dans le ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/config/model.conf"},"model.conf")," et ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/config/policy.csv"},"policy.csv"),". Vous pouvez consulter les ",(0,s.kt)("a",{parentName:"p",href:"/docs/how-it-works"},"documents")," pour en savoir plus sur le fonctionnement de ces politiques.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Avant le d\xe9ploiement, vous pouvez modifier les ports dans ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/main.go"},"main.go")," et \xe9galement dans le fichier de configuration ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/manifests/deployment.yaml"},"de webhook de validation")," selon votre utilisation.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"D\xe9ployer le contr\xf4leur de validation et le webhook sur le cluster k8s en ex\xe9cutant :-"))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl applique -f deployment.yaml\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Pour un serveur de production, nous devons cr\xe9er un ",(0,s.kt)("inlineCode",{parentName:"li"},"secret")," k8s pour placer les certificats \xe0 des fins de s\xe9curit\xe9.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl cr\xe9e un casbin g\xe9n\xe9rique secret par d\xe9faut \\\n  --from-file=key.pem=certs/casbin-key.pem \\\n  --from-file=cert.pem=certs/casbin-crt.pem\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Une fois, cette partie est faite, nous devons changer le r\xe9pertoire des certificats dans ",(0,s.kt)("a",{parentName:"li",href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/main.go#L26"},"main. o")," puis dans ",(0,s.kt)("a",{parentName:"li",href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/manifests/deployment.yaml#L22"},"manifeste")," avec celui du ",(0,s.kt)("inlineCode",{parentName:"li"},"secret"),".")),(0,s.kt)("p",null,"Maintenant, le serveur devrait s'ex\xe9cuter et \xeatre pr\xeat \xe0 valider les requ\xeates pour les op\xe9rations sur les ressources k8s."))}p.isMDXComponent=!0}}]);