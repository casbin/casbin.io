"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[907],{3905:(a,e,n)=>{n.d(e,{Zo:()=>m,kt:()=>o});var i=n(7294);function t(a,e,n){return e in a?Object.defineProperty(a,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[e]=n,a}function l(a,e){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.push.apply(n,i)}return n}function r(a){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){t(a,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(n,e))}))}return a}function s(a,e){if(null==a)return{};var n,i,t=function(a,e){if(null==a)return{};var n,i,t={},l=Object.keys(a);for(i=0;i<l.length;i++)n=l[i],e.indexOf(n)>=0||(t[n]=a[n]);return t}(a,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(a);for(i=0;i<l.length;i++)n=l[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(a,n)&&(t[n]=a[n])}return t}var k=i.createContext({}),u=function(a){var e=i.useContext(k),n=e;return a&&(n="function"==typeof a?a(e):r(r({},e),a)),n},m=function(a){var e=u(a.components);return i.createElement(k.Provider,{value:e},a.children)},p={inlineCode:"code",wrapper:function(a){var e=a.children;return i.createElement(i.Fragment,{},e)}},d=i.forwardRef((function(a,e){var n=a.components,t=a.mdxType,l=a.originalType,k=a.parentName,m=s(a,["components","mdxType","originalType","parentName"]),d=u(n),o=t,g=d["".concat(k,".").concat(o)]||d[o]||p[o]||l;return n?i.createElement(g,r(r({ref:e},m),{},{components:n})):i.createElement(g,r({ref:e},m))}));function o(a,e){var n=arguments,t=e&&e.mdxType;if("string"==typeof a||t){var l=n.length,r=new Array(l);r[0]=d;var s={};for(var k in e)hasOwnProperty.call(e,k)&&(s[k]=e[k]);s.originalType=a,s.mdxType="string"==typeof a?a:t,r[1]=s;for(var u=2;u<l;u++)r[u]=n[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8321:(a,e,n)=>{n.r(e),n.d(e,{assets:()=>k,contentTitle:()=>r,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>u});var i=n(7462),t=(n(7294),n(3905));const l={id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Middleware Pengesahan RBAC & ABAC Kubernetes (K8s) berdasarkan Casbin",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},r=void 0,s={unversionedId:"k8s-gatekeeper",id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Middleware Pengesahan RBAC & ABAC Kubernetes (K8s) berdasarkan Casbin",source:"@site/i18n/ms/docusaurus-plugin-content-docs/current/K8sGateKeeper.mdx",sourceDirName:".",slug:"/k8s-gatekeeper",permalink:"/ms/docs/k8s-gatekeeper",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sGateKeeper.mdx",tags:[],version:"current",frontMatter:{id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Middleware Pengesahan RBAC & ABAC Kubernetes (K8s) berdasarkan Casbin",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},sidebar:"docs",previous:{title:"Authorization of Kubernetes",permalink:"/ms/docs/k8s"},next:{title:"Authorization of Service Mesh through Envoy",permalink:"/ms/docs/envoy"}},k={},u=[{value:"1. Gambaran Keseluruhan &amp; Dokumen untuk Casbin K8s-Gatekeeper",id:"1-gambaran-keseluruhan--dokumen-untuk-casbin-k8s-gatekeeper",level:2},{value:"0.1 Contoh Mudah",id:"01-contoh-mudah",level:3},{value:"1.1 Bagaimana Casbin K8s-Gatekeeper Berfungsi?",id:"11-bagaimana-casbin-k8s-gatekeeper-berfungsi",level:3},{value:"1.2 Contoh Menggambarkan Cara Kerjanya",id:"12-contoh-menggambarkan-cara-kerjanya",level:3},{value:"2 Pasang K8s-gatekeeper",id:"2-pasang-k8s-gatekeeper",level:2},{value:"2.1 Webhook dalaman",id:"21-webhook-dalaman",level:3},{value:"2.1.1 Langkah 1: Bina imej",id:"211-langkah-1-bina-imej",level:4},{value:"2.1.2 Langkah 2: Sediakan perkhidmatan dan peluncuran untuk K8s-gatekeeper",id:"212-langkah-2-sediakan-perkhidmatan-dan-peluncuran-untuk-k8s-gatekeeper",level:4},{value:"2.1.3 Langkah 3: Pasang Sumber CRD untuk K8s-gatekeeper",id:"213-langkah-3-pasang-sumber-crd-untuk-k8s-gatekeeper",level:4},{value:"2.2 Webhook Luaran",id:"22-webhook-luaran",level:3},{value:"2.3.1 Langkah 1: Bina imej",id:"231-langkah-1-bina-imej",level:3},{value:"2.3.1 Step 1: Build the image",id:"231-step-1-build-the-image",level:4},{value:"2.3.2 Pemasangan Helm",id:"232-pemasangan-helm",level:4},{value:"3. Cuba K8s-gatekeeper",id:"3-cuba-k8s-gatekeeper",level:2},{value:"3.1 Buat Model dan Polisi Casbin",id:"31-buat-model-dan-polisi-casbin",level:3},{value:"3.1.1 Buat/Kemaskini Model dan Polisi Casbin melalui kubectl",id:"311-buatkemaskini-model-dan-polisi-casbin-melalui-kubectl",level:4},{value:"3.1.2 Cipta/Kemas kini Model dan Dasar Casbin melalui go-client yang kami sediakan",id:"312-ciptakemas-kini-model-dan-dasar-casbin-melalui-go-client-yang-kami-sediakan",level:4},{value:"3.1.2 Cuba Samaada K8s-gatekeeper Berfungsi",id:"312-cuba-samaada-k8s-gatekeeper-berfungsi",level:3},{value:"4. Cara Menulis Model dan Polisi dengan K8s-gatekeeper",id:"4-cara-menulis-model-dan-polisi-dengan-k8s-gatekeeper",level:2},{value:"4.1 Takrifan Permintaan Model",id:"41-takrifan-permintaan-model",level:3},{value:"4.2 Matchers Model",id:"42-matchers-model",level:3},{value:"4.2.1 Fungsi Sambungan",id:"421-fungsi-sambungan",level:3},{value:"4.2.1.1 akses",id:"4211-akses",level:4},{value:"4.2.1.2 aksesDenganWildcard",id:"4212-aksesdenganwildcard",level:4},{value:"4.2.1.3 Fungsi Menyokong Argumen Panjang Berubah",id:"4213-fungsi-menyokong-argumen-panjang-berubah",level:3},{value:"4.2.1.2 Fungsi Penukaran Jenis",id:"4212-fungsi-penukaran-jenis",level:4},{value:"5. Tetapan Lanjutan",id:"5-tetapan-lanjutan",level:2},{value:"5.1 Mengenai Sijil",id:"51-mengenai-sijil",level:3},{value:"5.1.1 Sijil tandatangan sendiri",id:"511-sijil-tandatangan-sendiri",level:4},{value:"5.1.2 Sijil sah",id:"512-sijil-sah",level:4}],m={toc:u};function p(a){let{components:e,...n}=a;return(0,t.kt)("wrapper",(0,i.Z)({},m,n,{components:e,mdxType:"MDXLayout"}),(0,t.kt)("h2",{id:"1-gambaran-keseluruhan--dokumen-untuk-casbin-k8s-gatekeeper"},"1. Gambaran Keseluruhan & Dokumen untuk Casbin K8s-Gatekeeper"),(0,t.kt)("p",null,"Casbin K8s-GateKeeper ialah webhook kehadiran Kubernetes yang mengintegrasikan Casbin sebagai alat Kawalan Akses. Dengan menggunakan Casbin K8s-GateKeeper, anda boleh menubuhkan peraturan yang fleksibel untuk membenarkan atau menyekat sebarang operasi pada sumber K8s, TANPA menulis sebarang bahagian kod, tetapi hanya beberapa baris konfigurasi deklaratif model dan dasar Casbin, yang merupakan sebahagian daripada bahasa ACL (Senarai Kawalan Akses) Casbin."),(0,t.kt)("p",null,"Casbin K8s-GateKeeper dikembangkan dan diselenggarakan oleh komunitas Casbin. Repositori projek ini boleh didapati di sini: ",(0,t.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-gatekeeper"},"https://github.com/casbin/k8s-gatekeeper")),(0,t.kt)("h3",{id:"01-contoh-mudah"},"0.1 Contoh Mudah"),(0,t.kt)("p",null,'Sebagai contoh, anda tidak perlu menulis sebarang kod, tetapi gunakan baris konfigurasi berikut untuk mencapai fungsi ini: "Larang penggunaan imej dengan tag tertentu dalam sebarang penempatan":'),(0,t.kt)("p",null,"Model:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\ncontain(split(accessWithWildcard(${OBJECT}.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,t.kt)("p",null,"And Policy:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-csv"},'p, "1.14.1",deny\n')),(0,t.kt)("p",null,"Ini adalah dalam bahasa ACL Casbin biasa. Andaikan anda telah membaca bab mengenai mereka, ia akan menjadi sangat mudah untuk difahami."),(0,t.kt)("p",null,"Casbin K8s-GateKeeper mempunyai kelebihan berikut:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Mudah digunakan. Menulis beberapa baris ACL jauh lebih baik daripada menulis banyak kod."),(0,t.kt)("li",{parentName:"ul"},"Ia membolehkan kemas kini panas konfigurasi. Anda tidak perlu mematikan seluruh plugin untuk mengubah suai konfigurasi."),(0,t.kt)("li",{parentName:"ul"},"Ia adalah fleksibel. Peraturan sewenang-wenangnya boleh dibuat pada sumber K8s apa pun, yang boleh dieksplorasi dengan ",(0,t.kt)("inlineCode",{parentName:"li"},"kubectl gatekeeper"),"."),(0,t.kt)("li",{parentName:"ul"},"Ia memudahkan pelaksanaan webhook kehadiran K8s, yang sangat rumit. Anda tidak perlu tahu apa itu webhook kehadiran K8s atau bagaimana menulis kod untuk itu. Yang anda perlukan hanyalah mengetahui sumber yang ingin anda letakkan sekatan dan kemudian menulis ACL Casbin. Semua orang tahu bahawa K8s adalah kompleks, tetapi dengan menggunakan Casbin K8s-Gatekeeper, masa anda dapat diselamatkan."),(0,t.kt)("li",{parentName:"ul"},"Ia dikekalkan oleh komuniti Casbin. Jangan ragu untuk menghubungi kami jika ada sesuatu mengenai plugin ini yang membingungkan anda atau jika anda menghadapi sebarang masalah ketika mencuba ini.")),(0,t.kt)("h3",{id:"11-bagaimana-casbin-k8s-gatekeeper-berfungsi"},"1.1 Bagaimana Casbin K8s-Gatekeeper Berfungsi?"),(0,t.kt)("p",null,"K8s-Gatekeeper adalah webhook pengammit untuk K8s yang menggunakan ",(0,t.kt)("a",{parentName:"p",href:"/docs/overview"},"Casbin")," untuk menggunakan peraturan kawalan akses yang ditentukan pengguna secara sewenang-wenangnya untuk membantu mencegah sebarang operasi pada K8s yang tidak diingini oleh pentadbir."),(0,t.kt)("p",null,"Casbin adalah perpustakaan kawalan akses sumber terbuka yang berkuasa dan cekap. Ia menyediakan sokongan untuk menguatkuasakan kebenaran berdasarkan pelbagai model kawalan akses. Untuk maklumat lanjut mengenai Casbin, lihat ",(0,t.kt)("a",{parentName:"p",href:"/docs/overview"},"Gambaran Keseluruhan"),"."),(0,t.kt)("p",null,"Webhook pengammit dalam K8s adalah panggilan balik HTTP yang menerima 'permintaan pengammit' dan melakukan sesuatu dengannya. Khususnya, K8s-Gatekeeper adalah jenis webhook pengammit khas: 'ValidatingAdmissionWebhook', yang boleh membuat keputusan sama ada untuk menerima atau menolak permintaan pengammit ini atau tidak. Bagi permintaan pengammit, ia adalah permintaan HTTP yang menerangkan operasi pada sumber yang ditentukan K8s (contohnya, mencipta/menghapuskan penerapan). Untuk maklumat lanjut mengenai webhook pengammit, lihat ",(0,t.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks"},"dokumentasi rasmi K8s"),"."),(0,t.kt)("h3",{id:"12-contoh-menggambarkan-cara-kerjanya"},"1.2 Contoh Menggambarkan Cara Kerjanya"),(0,t.kt)("p",null,"Sebagai contoh, apabila seseorang ingin membuat penempatan yang mengandungi pod yang menjalankan nginx (menggunakan kubectl atau klien K8s), K8s akan menjana permintaan kehadiran, yang (jika diterjemahkan ke dalam format YAML) boleh menjadi seperti ini:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.14.1\n        ports:\n        - containerPort: 80\n")),(0,t.kt)("p",null,"Permintaan ini akan melalui proses semua perantaraan yang ditunjukkan dalam gambar, termasuk K8s-Gatekeeper kami. K8s-Gatekeeper boleh mengesan semua enforcer Casbin yang disimpan dalam etcd K8s, yang dicipta dan dikekalkan oleh pengguna (melalui ",(0,t.kt)("inlineCode",{parentName:"p"},"kubectl")," atau klien Go yang kami sediakan). Setiap enforcer mengandungi model Casbin dan polisi Casbin. Permintaan kehadiran akan diproses oleh setiap enforcer, satu demi satu, dan hanya dengan lulus semua enforcer, permintaan boleh diterima oleh K8s-Gatekeeper ini."),(0,t.kt)("p",null,"(Jika anda tidak memahami apa itu enforcer Casbin, model, atau polisi, lihat dokumen ini: ",(0,t.kt)("a",{parentName:"p",href:"/docs/get-started"},"Mulakan"),")."),(0,t.kt)("p",null,"Sebagai contoh, atas sebab tertentu, pentadbir ingin melarang kemunculan imej 'nginx:1.14.1' sambil membenarkan 'nginx:1.3.1'. Enforcer yang mengandungi peraturan dan polisi berikut boleh dicipta (Kami akan menerangkan cara membuat enforcer, apakah model dan polisi ini, dan bagaimana menulis mereka dalam bab-bab berikut)."),(0,t.kt)("p",null,"Model:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n\n')),(0,t.kt)("p",null,"Policy:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-csv"},'p, "nginx:1.13.1",allow\np, "nginx:1.14.1",deny\n')),(0,t.kt)("p",null,"Dengan mencipta penguatkuasa yang mengandungi model dan polisi di atas, permintaan pengakuan sebelumnya akan ditolak oleh penguatkuasa ini, yang bermaksud K8s tidak akan mencipta penempatan ini."),(0,t.kt)("h2",{id:"2-pasang-k8s-gatekeeper"},"2 Pasang K8s-gatekeeper"),(0,t.kt)("p",null,"Terdapat tiga kaedah yang tersedia untuk memasang K8s-gatekeeper: Webhook luaran, Webhook dalaman, dan Helm."),(0,t.kt)("admonition",{type:"note"},(0,t.kt)("p",{parentName:"admonition"},"Perhatian: Kaedah ini hanya bertujuan untuk pengguna mencuba K8s-gatekeeper dan tidak selamat. Jika anda ingin menggunakannya dalam persekitaran produktif, sila pastikan anda membaca ",(0,t.kt)("a",{parentName:"p",href:"#5-tetapan-lanjutan"},"Bab 5. Tetapan lanjutan")," dan buat sebarang pengubahsuaian yang diperlukan sebelum pemasangan.")),(0,t.kt)("h3",{id:"21-webhook-dalaman"},"2.1 Webhook dalaman"),(0,t.kt)("h4",{id:"211-langkah-1-bina-imej"},"2.1.1 Langkah 1: Bina imej"),(0,t.kt)("p",null,"Bagi kaedah webhook dalaman, webhook itu sendiri akan dilaksanakan sebagai perkhidmatan dalam Kubernetes. Untuk mencipta perkhidmatan dan peluncuran yang diperlukan, anda perlu membina imej K8s-gatekeeper. Anda boleh membina imej anda sendiri dengan menjalankan arahan berikut:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"docker build --target webhook -t k8s-gatekeeper .\n")),(0,t.kt)("p",null,"Arahan ini akan mencipta imej tempatan yang dipanggil 'k8s-gatekeeper:latest'."),(0,t.kt)("admonition",{type:"note"},(0,t.kt)("p",{parentName:"admonition"},"Perhatian: Jika anda menggunakan minikube, sila jalankan ",(0,t.kt)("inlineCode",{parentName:"p"},"eval $(minikube -p minikube docker-env)")," sebelum menjalankan 'docker build'.")),(0,t.kt)("h4",{id:"212-langkah-2-sediakan-perkhidmatan-dan-peluncuran-untuk-k8s-gatekeeper"},"2.1.2 Langkah 2: Sediakan perkhidmatan dan peluncuran untuk K8s-gatekeeper"),(0,t.kt)("p",null,"Jalankan arahan berikut:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/rbac.yaml\nkubectl apply -f config/webhook_deployment.yaml \nkubectl apply -f config/webhook_internal.yaml \n")),(0,t.kt)("p",null,"Ini akan memulakan K8s-gatekeeper, dan anda boleh mengesahkan ini dengan menjalankan ",(0,t.kt)("inlineCode",{parentName:"p"},"kubectl get pods"),"."),(0,t.kt)("h4",{id:"213-langkah-3-pasang-sumber-crd-untuk-k8s-gatekeeper"},"2.1.3 Langkah 3: Pasang Sumber CRD untuk K8s-gatekeeper"),(0,t.kt)("p",null,"Jalankan arahan berikut:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\n")),(0,t.kt)("h3",{id:"22-webhook-luaran"},"2.2 Webhook Luaran"),(0,t.kt)("p",null,"Untuk kaedah webhook luaran, K8s-gatekeeper akan berjalan di luar Kubernetes, dan Kubernetes akan mengakses K8s-gatekeeper seperti mengakses laman web biasa. Kubernetes mempunyai keperluan wajib bahawa webhook kehadiran mesti menggunakan HTTPS. Untuk tujuan mencuba K8s-gatekeeper, kami telah menyediakan satu set sijil dan kunci peribadi (walaupun ini tidak selamat). Jika anda lebih suka menggunakan sijil anda sendiri, sila rujuk kepada ",(0,t.kt)("a",{parentName:"p",href:"#5-advanced-settings"},"Bab 5. Tetapan lanjutan")," untuk arahan mengenai menyesuaikan sijil dan kunci peribadi. Sijil yang kami sediakan dikeluarkan untuk 'webhook.domain.local'."),(0,t.kt)("p",null,"Oleh itu, ubah hos (contohnya, /etc/hosts) dan titik 'webhook.domain.local' ke alamat IP di mana K8s-gatekeeper berjalan. Kemudian jalankan arahan berikut:"),(0,t.kt)("p",null,"2.3 Pasang K8s-gatekeeper melalui Helm"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"go mod tidy\ngo mod vendor\ngo run cmd/webhook/main.go\nkubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\nkubectl apply -f config/webhook_external.yaml \n")),(0,t.kt)("h3",{id:"231-langkah-1-bina-imej"},"2.3.1 Langkah 1: Bina imej"),(0,t.kt)("h4",{id:"231-step-1-build-the-image"},"2.3.1 Step 1: Build the image"),(0,t.kt)("p",null,"Sila rujuk kepada ",(0,t.kt)("a",{parentName:"p",href:"#211-step-1-build-the-image"},"Bab 2.1.1"),"."),(0,t.kt)("h4",{id:"232-pemasangan-helm"},"2.3.2 Pemasangan Helm"),(0,t.kt)("p",null,"Jalankan arahan ",(0,t.kt)("inlineCode",{parentName:"p"},"helm install k8sgatekeeper ./k8sgatekeeper"),"."),(0,t.kt)("h2",{id:"3-cuba-k8s-gatekeeper"},"3. Cuba K8s-gatekeeper"),(0,t.kt)("h3",{id:"31-buat-model-dan-polisi-casbin"},"3.1 Buat Model dan Polisi Casbin"),(0,t.kt)("p",null,"Anda mempunyai dua kaedah untuk membuat model dan polisi: melalui kubectl atau melalui go-client yang kami sediakan."),(0,t.kt)("h4",{id:"311-buatkemaskini-model-dan-polisi-casbin-melalui-kubectl"},"3.1.1 Buat/Kemaskini Model dan Polisi Casbin melalui kubectl"),(0,t.kt)("p",null,"Di K8s-gatekeeper, model Casbin disimpan dalam sumber CRD yang dipanggil 'CasbinModel'. Takrifannya terletak di ",(0,t.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinmodels.yaml"),"."),(0,t.kt)("p",null,"Terdapat contoh dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml"),". Perhatikan bidang berikut:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"metadata.name: nama model tersebut. Nama ini HARUS sama dengan nama objek CasbinPolicy yang berkaitan dengan model ini, agar K8s-gatekeeper dapat memasangkannya dan mencipta penguat."),(0,t.kt)("li",{parentName:"ul"},'spec.enable: jika bidang ini ditetapkan ke "false", model ini (serta objek CasbinPolicy yang berkaitan dengan model ini) akan diabaikan.'),(0,t.kt)("li",{parentName:"ul"},"spec.modelText: rentetan yang mengandungi teks model Casbin.")),(0,t.kt)("p",null,"Polisi Casbin disimpan dalam sumber CRD lain yang disebut 'CasbinPolicy', yang definisinya boleh didapati di ",(0,t.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinpolicies.yaml"),"."),(0,t.kt)("p",null,"Terdapat contoh dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/policy.yaml"),". Perhatikan bidang berikut:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"metadata.name: nama polisi tersebut. Nama ini MESTI sama dengan nama objek CasbinModel yang berkaitan dengan dasar ini, supaya K8s-gatekeeper dapat memasangkannya dan mencipta penguatkuasa."),(0,t.kt)("li",{parentName:"ul"},"spec.policyItem: rentetan yang mengandungi teks dasar model Casbin.")),(0,t.kt)("p",null,"Selepas mencipta fail CasbinModel dan CasbinPolicy anda sendiri, gunakan arahan berikut untuk menggunakannya:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f <filename>\n")),(0,t.kt)("p",null,"Setelah sepasang CasbinModel dan CasbinPolicy dicipta, K8s-gatekeeper akan dapat mengesannya dalam masa 5 saat."),(0,t.kt)("h4",{id:"312-ciptakemas-kini-model-dan-dasar-casbin-melalui-go-client-yang-kami-sediakan"},"3.1.2 Cipta/Kemas kini Model dan Dasar Casbin melalui go-client yang kami sediakan"),(0,t.kt)("p",null,"Kami faham bahawa mungkin terdapat situasi di mana tidak mudah menggunakan shell untuk melaksanakan arahan secara langsung pada nod kelompok K8s, seperti apabila anda membina platform awan automatik untuk korporasi anda. Oleh itu, kami telah membangunkan go-client untuk mencipta dan mengekalkan CasbinModel dan CasbinPolicy."),(0,t.kt)("p",null,"Perpustakaan go-client terletak di ",(0,t.kt)("inlineCode",{parentName:"p"},"pkg/client"),"."),(0,t.kt)("p",null,"Dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"client.go"),", kami menyediakan fungsi untuk mencipta klien."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-go"},"func NewK8sGateKeeperClient(externalClient bool) (*K8sGateKeeperClient, error) \n")),(0,t.kt)("p",null,"Parameter ",(0,t.kt)("inlineCode",{parentName:"p"},"externalClient")," menentukan sama ada K8s-gatekeeper sedang berjalan di dalam kelompok K8s atau tidak."),(0,t.kt)("p",null,"Dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"model.go"),", kami menyediakan pelbagai fungsi untuk membuat, menghapus, dan mengubah CasbinModel. Anda boleh mengetahui cara menggunakan antara muka ini dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"model_test.go"),"."),(0,t.kt)("p",null,"Dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"policy.go"),", kami menyediakan pelbagai fungsi untuk membuat, menghapus, dan mengubah CasbiPolicy. Anda boleh mengetahui cara menggunakan antara muka ini dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"policy_test.go"),"."),(0,t.kt)("h3",{id:"312-cuba-samaada-k8s-gatekeeper-berfungsi"},"3.1.2 Cuba Samaada K8s-gatekeeper Berfungsi"),(0,t.kt)("p",null,"Anggaplah anda telah mencipta model dan polisi yang tepat dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"example/allowed_repo"),". Sekarang, cuba arahan berikut:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f example/allowed_repo/testcase/reject_1.yaml\n")),(0,t.kt)("p",null,"Anda harus mendapati bahawa K8s akan menolak permintaan ini dan menyebut bahawa webhook adalah sebab mengapa permintaan ini ditolak. Namun, apabila anda cuba memohon ",(0,t.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/testcase/approve_2.yaml"),", ia akan diterima."),(0,t.kt)("h2",{id:"4-cara-menulis-model-dan-polisi-dengan-k8s-gatekeeper"},"4. Cara Menulis Model dan Polisi dengan K8s-gatekeeper"),(0,t.kt)("p",null,"Pertama sekali, pastikan anda sudah biasa dengan tatabahasa asas Model dan Polisi Casbin. Jika tidak, sila baca bahagian ",(0,t.kt)("a",{parentName:"p",href:"/docs/get-started"},"Mulakan")," terlebih dahulu. Dalam bab ini, kami menganggap bahawa anda sudah memahami apakah Model dan Polisi Casbin."),(0,t.kt)("h3",{id:"41-takrifan-permintaan-model"},"4.1 Takrifan Permintaan Model"),(0,t.kt)("p",null,"Apabila K8s-gatekeeper memberi kuasa kepada permintaan, inputnya selalu objek: objek Go Permintaan Kemasukan. Ini bermakna enforcer akan selalu digunakan seperti ini:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-go"},"ok, err := enforcer.Enforce(admission)\n")),(0,t.kt)("p",null,"di mana ",(0,t.kt)("inlineCode",{parentName:"p"},"admission")," adalah objek ",(0,t.kt)("inlineCode",{parentName:"p"},"AdmissionReview")," yang ditakrifkan oleh api go rasmi K8s ",(0,t.kt)("inlineCode",{parentName:"p"},'"k8s.io/api/admission/v1"'),". Anda boleh mencari takrifan struktur ini dalam repositori ini: ",(0,t.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"},"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"),". Untuk maklumat lanjut, anda juga boleh merujuk kepada ",(0,t.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"},"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"),"."),(0,t.kt)("p",null,"Oleh itu, bagi sebarang model yang digunakan oleh K8s-gatekeeper, definisi ",(0,t.kt)("inlineCode",{parentName:"p"},"request_definition")," harus selalu seperti ini:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},"    [request_definition]\n    r =  obj\n")),(0,t.kt)("p",null,"Nama 'obj' tidak wajib, selagi nama itu konsisten dengan nama yang digunakan dalam bahagian ",(0,t.kt)("inlineCode",{parentName:"p"},"[matchers]"),"."),(0,t.kt)("h3",{id:"42-matchers-model"},"4.2 Matchers Model"),(0,t.kt)("p",null,"Anda sepatutnya menggunakan ciri ABAC Casbin untuk menulis peraturan anda. Namun, penilai ungkapan yang terintegrasi dalam Casbin tidak menyokong pengindeksan dalam peta atau tatasusunan (slices), atau peluasan tatasusunan. Oleh itu, K8s-gatekeeper menyediakan pelbagai 'fungsi Casbin' sebagai sambungan untuk melaksanakan ciri-ciri ini. Jika anda masih mendapati bahawa permintaan anda tidak dapat dipenuhi oleh sambungan ini, jangan ragu untuk memulakan isu, atau membuat permintaan tarik."),(0,t.kt)("p",null,"Jika anda tidak biasa dengan fungsi Casbin, anda boleh merujuk kepada ",(0,t.kt)("a",{parentName:"p",href:"/docs/function"},"Function")," untuk maklumat lanjut."),(0,t.kt)("p",null,"Berikut adalah fungsi sambungan:"),(0,t.kt)("h3",{id:"421-fungsi-sambungan"},"4.2.1 Fungsi Sambungan"),(0,t.kt)("h4",{id:"4211-akses"},"4.2.1.1 akses"),(0,t.kt)("p",null,"Akses digunakan untuk menyelesaikan masalah bahawa Casbin tidak menyokong pengindeksan dalam peta atau tatasusunan. Contoh ",(0,t.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml")," menunjukkan penggunaan fungsi ini:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n')),(0,t.kt)("p",null,"Dalam pencocok ini, ",(0,t.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image")')," setara dengan ",(0,t.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Image"),", di mana ",(0,t.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers")," adalah sebuah irisan."),(0,t.kt)("p",null,"Akses juga boleh memanggil fungsi mudah yang tidak mempunyai parameter dan mengembalikan satu nilai. Contoh ",(0,t.kt)("inlineCode",{parentName:"p"},"example/container_resource_limit/model.yaml")," menunjukkan ini:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\n  m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")) >= parseFloat(p.cpu) && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","memory","Value")) >= parseFloat(p.memory)\n')),(0,t.kt)("p",null,"Dalam pencocok ini, ",(0,t.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")')," setara dengan ",(0,t.kt)("inlineCode",{parentName:"p"},'r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits["cpu"].Value()'),", di mana ",(0,t.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits")," adalah sebuah peta, dan ",(0,t.kt)("inlineCode",{parentName:"p"},"Value()")," adalah fungsi mudah yang tidak mempunyai parameter dan mengembalikan satu nilai."),(0,t.kt)("h4",{id:"4212-aksesdenganwildcard"},"4.2.1.2 aksesDenganWildcard"),(0,t.kt)("p",null,'Kadang kala, anda mungkin mempunyai permintaan seperti ini: semua elemen dalam tatasusunan mesti mempunyai awalan "aaa". Walau bagaimanapun, Casbin tidak menyokong gelung ',(0,t.kt)("inlineCode",{parentName:"p"},"for"),". Dengan ",(0,t.kt)("inlineCode",{parentName:"p"},"accessWithWildcard"),' dan ciri "pembesaran peta/jalur", anda boleh melaksanakan permintaan tersebut dengan mudah.'),(0,t.kt)("p",null,"Sebagai contoh, andaikan ",(0,t.kt)("inlineCode",{parentName:"p"},"a.b.c")," ialah tatasusunan ",(0,t.kt)("inlineCode",{parentName:"p"},"[aaa, bbb, ccc, ddd, eee]"),", maka hasil ",(0,t.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a, "b", "c", "*")')," akan menjadi jalur ",(0,t.kt)("inlineCode",{parentName:"p"},"[aaa, bbb, ccc, ddd, eee]"),". Dengan menggunakan wildcard ",(0,t.kt)("inlineCode",{parentName:"p"},"*"),", jalur itu diperluaskan."),(0,t.kt)("p",null,"Begitu juga, wildcard boleh digunakan lebih dari sekali. Sebagai contoh, hasil ",(0,t.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a, "b", "c", "*", "*")')," akan menjadi ",(0,t.kt)("inlineCode",{parentName:"p"},"[a.b.c[0][0], a.b.c[0][1], ..., a.b.c[1][0], a.b.c[1][1], ...]"),"."),(0,t.kt)("h3",{id:"4213-fungsi-menyokong-argumen-panjang-berubah"},"4.2.1.3 Fungsi Menyokong Argumen Panjang Berubah"),(0,t.kt)("p",null,"Dalam penilaian ungkapan Casbin, apabila parameter adalah tatasusunan, ia akan dibesarkan secara automatik sebagai argumen panjang berubah. Menggunakan ciri ini untuk menyokong pembesaran tatasusunan/jalur/peta, kami juga telah mengintegrasikan beberapa fungsi yang menerima tatasusunan/jalur sebagai parameter:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"contain(): menerima pelbagai parameter dan mengembalikan sama ada mana-mana parameter (kecuali parameter terakhir) sama dengan parameter terakhir."),(0,t.kt)("li",{parentName:"ul"},"split(a, b, c..., sep, index): mengembalikan jalur yang mengandungi ",(0,t.kt)("inlineCode",{parentName:"li"},"[splits(a, sep)[index], splits(b, sep)[index], splits(a, sep)[index], ...]"),"."),(0,t.kt)("li",{parentName:"ul"},"len(): mengembalikan panjang argumen berubah-ubah."),(0,t.kt)("li",{parentName:"ul"},"matchRegex(a,b,c...,regex): mengembalikan sama ada semua parameter yang diberikan (",(0,t.kt)("inlineCode",{parentName:"li"},"a"),", ",(0,t.kt)("inlineCode",{parentName:"li"},"b"),", ",(0,t.kt)("inlineCode",{parentName:"li"},"c"),", ...) sesuai dengan regex yang diberikan.")),(0,t.kt)("p",null,"Berikut adalah contoh dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"example/disallowed_tag/model.yaml"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},'    [matchers]\n    m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n    contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,t.kt)("p",null,"Dengan menganggap bahawa ",(0,t.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image")')," mengembalikan ",(0,t.kt)("inlineCode",{parentName:"p"},'["a:b", "c:d", "e:f", "g:h"]'),", kerana splits menyokong argumen berubah-ubah dan melakukan operasi splits pada setiap elemen, elemen pada indeks 1 akan dipilih dan dikembalikan. Oleh itu, ",(0,t.kt)("inlineCode",{parentName:"p"},'split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1)')," mengembalikan ",(0,t.kt)("inlineCode",{parentName:"p"},'["b","d","f","h"]'),". Dan ",(0,t.kt)("inlineCode",{parentName:"p"},'contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)')," mengembalikan sama ada ",(0,t.kt)("inlineCode",{parentName:"p"},"p.obj")," terkandung dalam ",(0,t.kt)("inlineCode",{parentName:"p"},'["b","d","f","h"]'),"."),(0,t.kt)("h4",{id:"4212-fungsi-penukaran-jenis"},"4.2.1.2 Fungsi Penukaran Jenis"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"ParseFloat(): Menukar integer kepada float (ini diperlukan kerana sebarang nombor yang digunakan dalam perbandingan mesti ditukar menjadi float)."),(0,t.kt)("li",{parentName:"ul"},"ToString(): Menukar objek kepada rentetan. Objek ini mesti mempunyai jenis asas rentetan (contohnya, objek jenis ",(0,t.kt)("inlineCode",{parentName:"li"},"XXX")," apabila terdapat kenyataan ",(0,t.kt)("inlineCode",{parentName:"li"},"type XXX string"),")."),(0,t.kt)("li",{parentName:"ul"},"IsNil(): Mengembalikan sama ada parameter tersebut adalah nil.")),(0,t.kt)("h2",{id:"5-tetapan-lanjutan"},"5. Tetapan Lanjutan"),(0,t.kt)("h3",{id:"51-mengenai-sijil"},"5.1 Mengenai Sijil"),(0,t.kt)("p",null,"Dalam Kubernetes (k8s), adalah wajib bahawa webhook harus menggunakan HTTPS. Terdapat dua pendekatan untuk mencapai ini:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Gunakan sijil tandatangan sendiri (contoh dalam repositori ini menggunakan kaedah ini)"),(0,t.kt)("li",{parentName:"ul"},"Gunakan sijil biasa")),(0,t.kt)("h4",{id:"511-sijil-tandatangan-sendiri"},"5.1.1 Sijil tandatangan sendiri"),(0,t.kt)("p",null,"Menggunakan sijil yang ditandatangani sendiri bermakna Pihak Berkuasa Sijil (CA) yang mengeluarkan sijil tersebut bukan salah satu daripada CA yang terkenal. Oleh itu, anda mesti memberitahu k8s mengenai CA ini."),(0,t.kt)("p",null,"Pada masa ini, contoh dalam repositori ini menggunakan CA buatan sendiri, yang mana kunci peribadi dan sijilnya disimpan dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.crt")," dan ",(0,t.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.key")," masing-masing. Sijil untuk webhook adalah ",(0,t.kt)("inlineCode",{parentName:"p"},"config/certificate/server.crt"),', yang dikeluarkan oleh CA buatan sendiri. Domain untuk sijil ini adalah "webhook.domain.local" (untuk webhook luaran) dan "casbin-webhook-svc.default.svc" (untuk webhook dalaman).'),(0,t.kt)("p",null,"Maklumat mengenai CA diberikan kepada k8s melalui fail konfigurasi webhook. Kedua-dua ",(0,t.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," dan ",(0,t.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),' mempunyai medan yang dipanggil "CABundle", yang mengandungi rentetan terenkod base64 bagi sijil CA.'),(0,t.kt)("p",null,"Sekiranya anda perlu menukar sijil/domain (contohnya, jika anda ingin meletakkan webhook ini ke dalam ruang nama lain k8s sambil menggunakan webhook dalaman, atau jika anda ingin menukar domain sambil menggunakan webhook luaran), prosedur berikut harus diikuti:"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Menjana CA baru:"),(0,t.kt)("ul",{parentName:"li"},(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Menjana kunci peribadi untuk CA palsu:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out ca.key 2048\n"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Buang perlindungan kata laluan daripada kunci peribadi:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"openssl rsa -in ca.key -out ca.key\n"))))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Hasilkan kunci peribadi untuk pelayan webhook:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out server.key 2048\nopenssl rsa -in server.key -out server.key\n"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Gunakan CA yang dihasilkan sendiri untuk menandatangani sijil untuk webhook:"),(0,t.kt)("ul",{parentName:"li"},(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Salin fail konfigurasi openssl sistem anda untuk kegunaan sementara. Anda boleh mengetahui lokasi fail konfigurasi dengan menjalankan ",(0,t.kt)("inlineCode",{parentName:"p"},"openssl version -a"),", biasanya dipanggil ",(0,t.kt)("inlineCode",{parentName:"p"},"openssl.cnf"),".")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Dalam fail konfigurasi:"),(0,t.kt)("ul",{parentName:"li"},(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Cari perenggan ",(0,t.kt)("inlineCode",{parentName:"p"},"[req]")," dan tambahkan baris berikut: ",(0,t.kt)("inlineCode",{parentName:"p"},"req_extensions = v3_req"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Cari perenggan ",(0,t.kt)("inlineCode",{parentName:"p"},"[v3_req]")," dan tambahkan baris berikut: ",(0,t.kt)("inlineCode",{parentName:"p"},"subjectAltName = @alt_names"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Tambahkan baris berikut ke dalam fail:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-ini"},"[alt_names]\nDNS.2=<The domain you want>\n")),(0,t.kt)("p",{parentName:"li"},"Perhatian: Ganti 'casbin-webhook-svc.default.svc' dengan nama perkhidmatan sebenar anda sendiri jika anda memutuskan untuk mengubah nama perkhidmatan.")))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Gunakan fail konfigurasi yang diubah suai untuk menghasilkan fail permintaan sijil:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"openssl req -new -nodes -keyout server.key -out server.csr -config openssl.cnf\n"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Gunakan CA buatan sendiri untuk menjawab permintaan dan menandatangani sijil:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"openssl x509 -req -days 3650 -in server.csr -out server.crt -CA ca.crt -CAkey ca.key -CAcreateserial -extensions v3_req -extensions SAN -extfile openssl.cnf\n"))))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Tukar field 'CABundle': Kemas kini field ini dengan sijil baru.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Jika anda menggunakan helm, perubahan yang serupa perlu dilakukan pada carta helm."))),(0,t.kt)("h4",{id:"512-sijil-sah"},"5.1.2 Sijil sah"),(0,t.kt)("p",null,'Jika anda menggunakan sijil sah, anda tidak perlu melalui semua prosedur ini. Buang field "CABundle" dalam ',(0,t.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," dan ",(0,t.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),", dan tukar domain dalam fail-fail ini kepada domain yang anda miliki."))}p.isMDXComponent=!0}}]);