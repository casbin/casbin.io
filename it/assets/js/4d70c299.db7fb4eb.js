"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[815],{591(e,n,t){t.d(n,{A:()=>a});const a=t.p+"assets/images/editor-tips-2c4bf3155a73f079c976e5ad118d5518.png"},4990(e,n,t){t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>l,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"rbac-with-pattern","title":"RBAC with Pattern","description":"RBAC with Pattern","source":"@site/docs/RBACWithPattern.mdx","sourceDirName":".","slug":"/rbac-with-pattern","permalink":"/it/docs/rbac-with-pattern","draft":false,"unlisted":false,"editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/docs/RBACWithPattern.mdx","tags":[],"version":"current","frontMatter":{"id":"rbac-with-pattern","title":"RBAC with Pattern","description":"RBAC with Pattern","keywords":["RBAC with pattern","pattern matching"],"authors":["hsluoyz"]},"sidebar":"docs","previous":{"title":"RBAC","permalink":"/it/docs/rbac"},"next":{"title":"RBAC with Domains","permalink":"/it/docs/rbac-with-domains"}}');var i=t(4848),c=t(8453);const o={id:"rbac-with-pattern",title:"RBAC with Pattern",description:"RBAC with Pattern",keywords:["RBAC with pattern","pattern matching"],authors:["hsluoyz"]},s=void 0,r={},d=[{value:"Quick Start",id:"quick-start",level:2},{value:"Use pattern matching in RBAC",id:"use-pattern-matching-in-rbac",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components},{TabItem:a,Tabs:o}=n;return a||u("TabItem",!0),o||u("Tabs",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Use pattern in ",(0,i.jsx)(n.code,{children:"g(_, _)"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'e, _ := NewEnforcer("./example.conf", "./example.csv")\ne.AddNamedMatchingFunc("g", "KeyMatch2", util.KeyMatch2)\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Use pattern with domain."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'e.AddNamedDomainMatchingFunc("g", "KeyMatch2", util.KeyMatch2)\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Use all patterns."}),"\n",(0,i.jsx)(n.p,{children:"Just combine the use of both APIs."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["As shown above, after you create the ",(0,i.jsx)(n.code,{children:"enforcer"})," instance, you need to activate pattern matching via the ",(0,i.jsx)(n.code,{children:"AddNamedMatchingFunc"})," and ",(0,i.jsx)(n.code,{children:"AddNamedDomainMatchingFunc"})," APIs, which determine how the pattern matches."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:['If you use the online editor, You can add a pattern matching function by clicking the "Add Role Matching" button in the lower left corner.\n',(0,i.jsx)(n.img,{alt:"editor-tips",src:t(591).A+"",width:"690",height:"480"})]})}),"\n",(0,i.jsx)(n.h2,{id:"use-pattern-matching-in-rbac",children:"Use pattern matching in RBAC"}),"\n",(0,i.jsxs)(n.p,{children:["Sometimes, you want certain subjects, objects, or domains/tenants with a specific pattern to be automatically granted a role. Pattern matching functions in RBAC can help you do that. A pattern matching function shares the same parameters and return value as the previous ",(0,i.jsx)(n.a,{href:"/docs/syntax-for-models#functions-in-matchers",children:"matcher function"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The pattern matching function supports each parameter of ",(0,i.jsx)(n.code,{children:"g"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["We know that normally RBAC is expressed as ",(0,i.jsx)(n.code,{children:"g(r.sub, p.sub)"})," in a matcher. Then we can use a policy like:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csv",children:"p, alice, book_group, read\ng, /book/1, book_group\ng, /book/2, book_group\n"})}),"\n",(0,i.jsxs)(n.p,{children:["So ",(0,i.jsx)(n.code,{children:"alice"})," can read all books including ",(0,i.jsx)(n.code,{children:"book 1"})," and ",(0,i.jsx)(n.code,{children:"book 2"}),". But there can be thousands of books, and it's very tedious to add each book to the book role (or group) with one ",(0,i.jsx)(n.code,{children:"g"})," policy rule."]}),"\n",(0,i.jsx)(n.p,{children:"But with pattern matching functions, you can write the policy with only one line:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csv",children:"g, /book/:id, book_group\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Casbin will automatically match ",(0,i.jsx)(n.code,{children:"/book/1"})," and ",(0,i.jsx)(n.code,{children:"/book/2"})," into the pattern ",(0,i.jsx)(n.code,{children:"/book/:id"})," for you. You only need to register the function with the enforcer like:"]}),"\n",(0,i.jsxs)(o,{groupId:"langs",children:[(0,i.jsx)(a,{value:"Go",label:"Go",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'e.AddNamedMatchingFunc("g", "KeyMatch2", util.KeyMatch2)\n'})})}),(0,i.jsx)(a,{value:"Node.js",label:"Node.js",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"await e.addNamedMatchingFunc('g', Util.keyMatch2Func);\n"})})})]}),"\n",(0,i.jsx)(n.p,{children:"When using a pattern matching function in domains/tenants, you need to register the function with the enforcer and model."}),"\n",(0,i.jsxs)(o,{groupId:"langs",children:[(0,i.jsx)(a,{value:"Go",label:"Go",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'e.AddNamedDomainMatchingFunc("g", "KeyMatch2", util.KeyMatch2)\n'})})}),(0,i.jsx)(a,{value:"Node.js",label:"Node.js",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"await e.addNamedDomainMatchingFunc('g', Util.keyMatch2Func);\n"})})})]}),"\n",(0,i.jsxs)(n.p,{children:["If you don't understand what ",(0,i.jsx)(n.code,{children:"g(r.sub, p.sub, r.dom)"})," means, please read ",(0,i.jsx)(n.a,{href:"/docs/rbac-with-domains",children:"rbac-with-domains"}),". In short, ",(0,i.jsx)(n.code,{children:"g(r.sub, p.sub, r.dom)"})," will check whether the user ",(0,i.jsx)(n.code,{children:"r.sub"})," has a role ",(0,i.jsx)(n.code,{children:"p.sub"})," in the domain ",(0,i.jsx)(n.code,{children:"r.dom"}),". So this is how the matcher works. You can see the full example ",(0,i.jsx)(n.a,{href:"https://github.com/casbin/casbin/blob/dbdb6cbe2e7a80863e4951f9ff36da07fef01b75/model_test.go#L278-L307",children:"here"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Apart from the pattern matching syntax above, we can also use pure domain pattern."}),"\n",(0,i.jsxs)(n.p,{children:["For example, if we want ",(0,i.jsx)(n.code,{children:"sub"})," to have access in different domains, ",(0,i.jsx)(n.code,{children:"domain1"})," and ",(0,i.jsx)(n.code,{children:"domain2"}),", we can use the pure domain pattern:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csv",children:"p, admin, domain1, data1, read\np, admin, domain1, data1, write\np, admin, domain2, data2, read\np, admin, domain2, data2, write\n\ng, alice, admin, *\ng, bob, admin, domain2\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In this example, we want ",(0,i.jsx)(n.code,{children:"alice"})," to read and write ",(0,i.jsx)(n.code,{children:"data"})," in domain1 and domain2. Pattern matching ",(0,i.jsx)(n.code,{children:"*"})," in ",(0,i.jsx)(n.code,{children:"g"})," makes ",(0,i.jsx)(n.code,{children:"alice"})," have access to two domains."]}),"\n",(0,i.jsxs)(n.p,{children:["By using pattern matching, especially in scenarios that are more complicated and have a lot of domains or objects to consider, we can implement the ",(0,i.jsx)(n.code,{children:"policy_definition"})," in a more elegant and effective way."]})]})}function l(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453(e,n,t){t.d(n,{R:()=>o,x:()=>s});var a=t(6540);const i={},c=a.createContext(i);function o(e){const n=a.useContext(c);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(c.Provider,{value:n},e.children)}}}]);