"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[1219],{3905:(e,t,i)=>{i.d(t,{Zo:()=>c,kt:()=>m});var a=i(7294);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function s(e,t){if(null==e)return{};var i,a,r=function(e,t){if(null==e)return{};var i,a,r={},n=Object.keys(e);for(a=0;a<n.length;a++)i=n[a],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)i=n[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var i=e.components,r=e.mdxType,n=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(i),m=r,b=d["".concat(l,".").concat(m)]||d[m]||p[m]||n;return i?a.createElement(b,o(o({ref:t},c),{},{components:i})):a.createElement(b,o({ref:t},c))}));function m(e,t){var i=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var n=i.length,o=new Array(n);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<n;u++)o[u]=i[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,i)}d.displayName="MDXCreateElement"},7883:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>n,metadata:()=>s,toc:()=>u});var a=i(7462),r=(i(7294),i(3905));const n={id:"k8s",title:"Authorization of Kubernetes",description:"Middleware di autorizzazione Kubernetes (k8s) RBAC & ABAC basato su Casbin",keywords:["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],authors:["hsluoyz"]},o=void 0,s={unversionedId:"k8s",id:"k8s",title:"Authorization of Kubernetes",description:"Middleware di autorizzazione Kubernetes (k8s) RBAC & ABAC basato su Casbin",source:"@site/i18n/it/docusaurus-plugin-content-docs/current/K8sAuthz.mdx",sourceDirName:".",slug:"/k8s",permalink:"/it/docs/k8s",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sAuthz.mdx",tags:[],version:"current",frontMatter:{id:"k8s",title:"Authorization of Kubernetes",description:"Middleware di autorizzazione Kubernetes (k8s) RBAC & ABAC basato su Casbin",keywords:["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],authors:["hsluoyz"]},sidebar:"docs",previous:{title:"Performance Optimization",permalink:"/it/docs/performance"},next:{title:"Admission Webhook for K8s",permalink:"/it/docs/k8s-gatekeeper"}},l={},u=[{value:"Requisiti",id:"requisiti",level:2},{value:"Utilizzo",id:"utilizzo",level:2}],c={toc:u};function p(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz"},"K8s-authz")," \xe8 un middleware di autorizzazione per Kubernetes (k8s) basato su Casbin che utilizza RBAC (Role-Based Access Control) e ABAC (Attribute-Based Access Control) per l'applicazione delle politiche. Questo middleware si integra con il webhook di ammissione di convalida di K8s per convalidare le politiche definite da Casbin per ogni richiesta effettuata ai risorse di K8s. I controller di ammissione personalizzati sono registrati con Kubernetes utilizzando il ",(0,r.kt)("inlineCode",{parentName:"p"},"ValidatingAdmissionWebhook")," per eseguire convalide sugli oggetti richiesta inoltrati dal server API e fornire una risposta che indica se la richiesta deve essere consentita o rifiutata."),(0,r.kt)("p",null,"Per determinare quando inviare le richieste in entrata al controller di ammissione, \xe8 stato implementato un webhook di convalida. Questo webhook inoltra le richieste per qualsiasi tipo di risorsa o sottorisorsa di K8s e esegue la verifica delle politiche. Gli utenti possono eseguire operazioni su queste risorse solo se sono autorizzati dall'enforcer di Casbin. L'",(0,r.kt)("a",{parentName:"p",href:"/docs/get-started#new-a-casbin-enforcer"},"enforcer")," verifica i ruoli dell'utente come definiti nelle politiche. Il cluster K8s \xe8 il target di distribuzione per questo middleware."),(0,r.kt)("h2",{id:"requisiti"},"Requisiti"),(0,r.kt)("p",null,"Prima di procedere, assicurati di avere quanto segue:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Un cluster Kubernetes in esecuzione. Puoi configurare un cluster locale utilizzando Docker o impostare un ecosistema Kubernetes completo sul tuo server. Per istruzioni dettagliate, consulta questa ",(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/"},"guida")," per configurare un cluster Kubernetes locale su Windows o questa ",(0,r.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/how-to-create-a-kubernetes-cluster-using-kubeadm-on-ubuntu-18-04"},"guida")," per configurare un cluster su Linux."),(0,r.kt)("li",{parentName:"ul"},"CLI Kubectl. Le istruzioni per l'installazione di Kubectl su Windows si trovano ",(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/"},"qui"),", e per Linux ",(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/"},"qui"),"."),(0,r.kt)("li",{parentName:"ul"},"OpenSSL")),(0,r.kt)("h2",{id:"utilizzo"},"Utilizzo"),(0,r.kt)("p",null,"Segui questi passaggi per utilizzare K8s-authz:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Genera certificati e chiavi per ogni utente utilizzando OpenSSL. Esegui lo script qui sotto:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./gen_cert.sh\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Costruisci l'immagine Docker dal ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/Dockerfile"},"Dockerfile")," manualmente eseguendo il seguente comando. Ricorda di cambiare la versione di build nel comando e nel ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/718f58c46e3dbf79063b5b1c18348c2fee5de9e9/manifests/deployment.yaml#L18"},"file")," di deployment di conseguenza."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t casbin/k8s_authz:0.1 .\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Definisci le politiche Casbin nei file ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/config/model.conf"},"model.conf")," e ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/config/policy.csv"},"policy.csv"),". Per ulteriori informazioni su come funzionano queste politiche, consulta la ",(0,r.kt)("a",{parentName:"p",href:"/docs/how-it-works"},"documentazione"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Prima di eseguire il deployment, puoi modificare le porte nel file ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/main.go"},"main.go"),", cos\xec come nel ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/manifests/deployment.yaml"},"file")," di configurazione del webhook di validazione, in base alle tue esigenze specifiche.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Esegui il deployment del controller di validazione e del webhook sul cluster Kubernetes eseguendo il seguente comando:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f deployment.yaml\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Per un server di produzione, \xe8 consigliato creare un ",(0,r.kt)("inlineCode",{parentName:"p"},"secret")," Kubernetes per proteggere i certificati:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create secret generic casbin -n default \\\n  --from-file=key.pem=certs/casbin-key.pem \\\n  --from-file=cert.pem=certs/casbin-crt.pem\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Dopo aver completato i passaggi precedenti, \xe8 necessario aggiornare la directory del certificato in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/main.go#L26"},"main.go")," e i ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/manifests/deployment.yaml#L22"},"manifesti")," con la directory del ",(0,r.kt)("inlineCode",{parentName:"p"},"secret")," creato."))),(0,r.kt)("p",null,"Ora, il server dovrebbe essere attivo e funzionante, pronto a convalidare le richieste effettuate alle risorse K8s e ad applicare le politiche di conseguenza."))}p.isMDXComponent=!0}}]);