"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[7936],{3905:(e,r,t)=>{t.d(r,{Zo:()=>d,kt:()=>m});var a=t(7294);function n(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){n(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function l(e,r){if(null==e)return{};var t,a,n=function(e,r){if(null==e)return{};var t,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],r.indexOf(t)>=0||(n[t]=e[t]);return n}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var s=a.createContext({}),p=function(e){var r=a.useContext(s),t=r;return e&&(t="function"==typeof e?e(r):i(i({},r),e)),t},d=function(e){var r=p(e.components);return a.createElement(s.Provider,{value:r},e.children)},g={inlineCode:"code",wrapper:function(e){var r=e.children;return a.createElement(a.Fragment,{},r)}},c=a.forwardRef((function(e,r){var t=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(t),m=n,u=c["".concat(s,".").concat(m)]||c[m]||g[m]||o;return t?a.createElement(u,i(i({ref:r},d),{},{components:t})):a.createElement(u,i({ref:r},d))}));function m(e,r){var t=arguments,n=r&&r.mdxType;if("string"==typeof e||n){var o=t.length,i=new Array(o);i[0]=c;var l={};for(var s in r)hasOwnProperty.call(r,s)&&(l[s]=r[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var p=2;p<o;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},5060:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=t(7462),n=(t(7294),t(3905));const o={id:"log-error",title:"Log & Error Handling",description:"Registro e tratamento de erros no Casbin",keywords:["log","error","error handling"],authors:["hsluoyz"]},i=void 0,l={unversionedId:"log-error",id:"log-error",title:"Log & Error Handling",description:"Registro e tratamento de erros no Casbin",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/LogError.mdx",sourceDirName:".",slug:"/log-error",permalink:"/pt/docs/log-error",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/LogError.mdx",tags:[],version:"current",frontMatter:{id:"log-error",title:"Log & Error Handling",description:"Registro e tratamento de erros no Casbin",keywords:["log","error","error handling"],authors:["hsluoyz"]},sidebar:"docs",previous:{title:"Casbin Service",permalink:"/pt/docs/service"},next:{title:"Frontend Usage",permalink:"/pt/docs/frontend"}},s={},p=[{value:"Registro",id:"registro",level:2},{value:"Use registradores diferentes para diferentes aplicadores",id:"use-registradores-diferentes-para-diferentes-aplicadores",level:3},{value:"Registradores suportados",id:"registradores-suportados",level:4},{value:"Como escrever um registrador",id:"como-escrever-um-registrador",level:4},{value:"Tratamento de erros",id:"tratamento-de-erros",level:2},{value:"Habilitar e desabilitar",id:"habilitar-e-desabilitar",level:2}],d=e=>function(r){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,n.kt)("div",r)},g=d("Tabs"),c=d("TabItem"),m={toc:p};function u(e){let{components:r,...t}=e;return(0,n.kt)("wrapper",(0,a.Z)({},m,t,{components:r,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"registro"},"Registro"),(0,n.kt)("p",null,"O Casbin usa o ",(0,n.kt)("inlineCode",{parentName:"p"},"log")," embutido para imprimir registros no console por padr\xe3o, como:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-log"},"2017/07/15 19:43:56 [Request: alice, data1, read ---\x3e true]\n")),(0,n.kt)("p",null,"O registro n\xe3o \xe9 ativado por padr\xe3o. Voc\xea pode ativ\xe1-lo por meio de ",(0,n.kt)("inlineCode",{parentName:"p"},"Enforcer.EnableLog()")," ou do \xfaltimo par\xe2metro de ",(0,n.kt)("inlineCode",{parentName:"p"},"NewEnforcer()"),"."),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"J\xe1 suportamos o registro do modelo, solicita\xe7\xe3o de execu\xe7\xe3o, papel e pol\xedtica em Golang. Voc\xea pode definir seu pr\xf3prio registro para registrar o Casbin.\nSe voc\xea est\xe1 usando Python, o pycasbin utiliza o mecanismo de registro padr\xe3o do Python. O pacote pycasbin faz uma chamada para ",(0,n.kt)("inlineCode",{parentName:"p"},"logging.getLogger()")," para definir o registrador. Nenhuma configura\xe7\xe3o especial de registro \xe9 necess\xe1ria, al\xe9m de inicializar o registrador na aplica\xe7\xe3o pai. Se nenhum registro for inicializado dentro da aplica\xe7\xe3o pai, voc\xea n\xe3o ver\xe1 nenhuma mensagem de registro do pycasbin. Ao mesmo tempo, quando voc\xea ativa o registro no pycasbin, ele usar\xe1 a ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/pycasbin/blob/c33cabfa0ac65cd09cf812a65e71794d64cb5132/casbin/util/log.py#L6C1-L6C1"},"configura\xe7\xe3o de registro padr\xe3o"),". Para outras extens\xf5es do pycasbin, voc\xea pode consultar a ",(0,n.kt)("a",{parentName:"p",href:"https://docs.djangoproject.com/en/4.2/topics/logging/"},"documenta\xe7\xe3o de registro do Django")," se for um usu\xe1rio do Django. Para outros usu\xe1rios de Python, voc\xea deve consultar a ",(0,n.kt)("a",{parentName:"p",href:"https://docs.python.org/3/library/logging.config.html"},"documenta\xe7\xe3o de registro do Python")," para configurar o registrador.")),(0,n.kt)("h3",{id:"use-registradores-diferentes-para-diferentes-aplicadores"},"Use registradores diferentes para diferentes aplicadores"),(0,n.kt)("p",null,"Cada aplicador pode ter seu pr\xf3prio registrador para registrar informa\xe7\xf5es, e ele pode ser alterado em tempo de execu\xe7\xe3o."),(0,n.kt)("p",null,"E voc\xea pode usar um registrador adequado por meio do \xfaltimo par\xe2metro de ",(0,n.kt)("inlineCode",{parentName:"p"},"NewEnforcer()"),". Se voc\xea est\xe1 usando essa maneira de inicializar seu aplicador, n\xe3o precisa usar o par\xe2metro habilitado porque a prioridade do campo habilitado no registrador \xe9 maior."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},"// Set a default logger as enforcer e1's logger.\n// This operation can also be seen as changing the logger of e1 at runtime.\ne1.SetLogger(&Log.DefaultLogger{})\n\n// Set another logger as enforcer e2's logger.\ne2.SetLogger(&YouOwnLogger)\n\n// Set your logger when initializing enforcer e3.\ne3, _ := casbin.NewEnforcer(\"examples/rbac_model.conf\", a, logger)\n")),(0,n.kt)("h4",{id:"registradores-suportados"},"Registradores suportados"),(0,n.kt)("p",null,"Fornecemos alguns registradores para ajud\xe1-lo a registrar informa\xe7\xf5es."),(0,n.kt)(g,{groupId:"langs",mdxType:"Tabs"},(0,n.kt)(c,{value:"Go",label:"Go",default:!0,mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Registrador"),(0,n.kt)("th",{parentName:"tr",align:null},"Autor"),(0,n.kt)("th",{parentName:"tr",align:null},"Descri\xe7\xe3o"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/log/default_logger.go"},"Registrador padr\xe3o (embutido)")),(0,n.kt)("td",{parentName:"tr",align:null},"Casbin"),(0,n.kt)("td",{parentName:"tr",align:null},"O registrador padr\xe3o usando log do golang.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://github.com/casbin/zap-logger"},"Registrador Zap")),(0,n.kt)("td",{parentName:"tr",align:null},"Casbin"),(0,n.kt)("td",{parentName:"tr",align:null},"Usando ",(0,n.kt)("a",{parentName:"td",href:"https://github.com/uber-go/zap"},"zap"),", fornece registro codificado em json e voc\xea pode personalizar mais com seu pr\xf3prio zap-logger."))))),(0,n.kt)(c,{value:"PHP",label:"PHP",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Registrador"),(0,n.kt)("th",{parentName:"tr",align:null},"Autor"),(0,n.kt)("th",{parentName:"tr",align:null},"Descri\xe7\xe3o"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://github.com/php-casbin/psr3-bridge"},"Registrador psr3-bridge")),(0,n.kt)("td",{parentName:"tr",align:null},"Casbin"),(0,n.kt)("td",{parentName:"tr",align:null},"Fornece uma ponte compat\xedvel com ",(0,n.kt)("a",{parentName:"td",href:"https://www.php-fig.org/psr/psr-3/"},"PSR-3"),".")))))),(0,n.kt)("h4",{id:"como-escrever-um-registrador"},"Como escrever um registrador"),(0,n.kt)("p",null,"Seu registrador deve implementar a interface ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casbin/casbin/blob/master/log/logger.go#L20"},"Logger"),"."),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"M\xe9todo"),(0,n.kt)("th",{parentName:"tr",align:null},"Tipo"),(0,n.kt)("th",{parentName:"tr",align:null},"Descri\xe7\xe3o"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"EnableLog()"),(0,n.kt)("td",{parentName:"tr",align:null},"obrigat\xf3rio"),(0,n.kt)("td",{parentName:"tr",align:null},"Controla se a mensagem ser\xe1 impressa.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"IsEnabled()"),(0,n.kt)("td",{parentName:"tr",align:null},"obrigat\xf3rio"),(0,n.kt)("td",{parentName:"tr",align:null},"Mostra o status habilitado do registrador atual.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"LogModel()"),(0,n.kt)("td",{parentName:"tr",align:null},"obrigat\xf3rio"),(0,n.kt)("td",{parentName:"tr",align:null},"Registra informa\xe7\xf5es relacionadas ao modelo.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"LogEnforce()"),(0,n.kt)("td",{parentName:"tr",align:null},"obrigat\xf3rio"),(0,n.kt)("td",{parentName:"tr",align:null},"Informa\xe7\xf5es de log relacionadas \xe0 aplica\xe7\xe3o.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"LogRole()"),(0,n.kt)("td",{parentName:"tr",align:null},"obrigat\xf3rio"),(0,n.kt)("td",{parentName:"tr",align:null},"Informa\xe7\xf5es de log relacionadas ao papel.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"LogPolicy()"),(0,n.kt)("td",{parentName:"tr",align:null},"obrigat\xf3rio"),(0,n.kt)("td",{parentName:"tr",align:null},"Informa\xe7\xf5es de log relacionadas \xe0 pol\xedtica.")))),(0,n.kt)("p",null,"Voc\xea pode passar seu ",(0,n.kt)("inlineCode",{parentName:"p"},"logger")," personalizado para ",(0,n.kt)("inlineCode",{parentName:"p"},"Enforcer.SetLogger()"),"."),(0,n.kt)("p",null,"Aqui est\xe1 um exemplo de como personalizar um logger para Golang:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'import (\n    "fmt"\n    "log"\n    "strings"\n)\n\n// DefaultLogger is the implementation for a Logger using golang log.\ntype DefaultLogger struct {\n    enabled bool\n}\n\nfunc (l *DefaultLogger) EnableLog(enable bool) {\n    l.enabled = enable\n}\n\nfunc (l *DefaultLogger) IsEnabled() bool {\n    return l.enabled\n}\n\nfunc (l *DefaultLogger) LogModel(model [][]string) {\n    if !l.enabled {\n        return\n    }\n    var str strings.Builder\n    str.WriteString("Model: ")\n    for _, v := range model {\n        str.WriteString(fmt.Sprintf("%v\\n", v))\n    }\n\n    log.Println(str.String())\n}\n\nfunc (l *DefaultLogger) LogEnforce(matcher string, request []interface{}, result bool, explains [][]string) {\n    if !l.enabled {\n        return\n    }\n\n    var reqStr strings.Builder\n    reqStr.WriteString("Request: ")\n    for i, rval := range request {\n        if i != len(request)-1 {\n            reqStr.WriteString(fmt.Sprintf("%v, ", rval))\n        } else {\n            reqStr.WriteString(fmt.Sprintf("%v", rval))\n        }\n    }\n    reqStr.WriteString(fmt.Sprintf(" ---\x3e %t\\n", result))\n\n    reqStr.WriteString("Hit Policy: ")\n    for i, pval := range explains {\n        if i != len(explains)-1 {\n            reqStr.WriteString(fmt.Sprintf("%v, ", pval))\n        } else {\n            reqStr.WriteString(fmt.Sprintf("%v \\n", pval))\n        }\n    }\n\n    log.Println(reqStr.String())\n}\n\nfunc (l *DefaultLogger) LogPolicy(policy map[string][][]string) {\n    if !l.enabled {\n        return\n    }\n\n    var str strings.Builder\n    str.WriteString("Policy: ")\n    for k, v := range policy {\n        str.WriteString(fmt.Sprintf("%s : %v\\n", k, v))\n    }\n\n    log.Println(str.String())\n}\n\nfunc (l *DefaultLogger) LogRole(roles []string) {\n    if !l.enabled {\n        return\n    }\n\n    log.Println("Roles: ", roles)\n}\n')),(0,n.kt)("h2",{id:"tratamento-de-erros"},"Tratamento de erros"),(0,n.kt)("p",null,"Erros ou panics podem ocorrer quando voc\xea usa o Casbin por motivos como:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Sintaxe inv\xe1lida no arquivo de modelo (.conf)."),(0,n.kt)("li",{parentName:"ol"},"Sintaxe inv\xe1lida no arquivo de pol\xedtica (.csv)."),(0,n.kt)("li",{parentName:"ol"},"Erros personalizados de adaptadores de armazenamento, por exemplo, falha ao conectar com o MySQL."),(0,n.kt)("li",{parentName:"ol"},"Bug do Casbin.")),(0,n.kt)("p",null,"H\xe1 cinco fun\xe7\xf5es principais das quais voc\xea pode precisar estar ciente para erros ou panics:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Fun\xe7\xe3o"),(0,n.kt)("th",{parentName:"tr",align:null},"Comportamento em caso de erro"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://godoc.org/github.com/casbin/casbin#NewEnforcer"},"NewEnforcer()")),(0,n.kt)("td",{parentName:"tr",align:null},"Retorna um erro")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://godoc.org/github.com/casbin/casbin#Enforcer.LoadModel"},"LoadModel()")),(0,n.kt)("td",{parentName:"tr",align:null},"Retorna um erro")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://godoc.org/github.com/casbin/casbin#Enforcer.LoadPolicy"},"LoadPolicy()")),(0,n.kt)("td",{parentName:"tr",align:null},"Retorna um erro")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://godoc.org/github.com/casbin/casbin#Enforcer.SavePolicy"},"SavePolicy()")),(0,n.kt)("td",{parentName:"tr",align:null},"Retorna um erro")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://godoc.org/github.com/casbin/casbin#Enforcer.Enforce"},"Enforce()")),(0,n.kt)("td",{parentName:"tr",align:null},"Retorna um erro")))),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},(0,n.kt)("inlineCode",{parentName:"p"},"NewEnforcer()")," chama ",(0,n.kt)("inlineCode",{parentName:"p"},"LoadModel()")," e ",(0,n.kt)("inlineCode",{parentName:"p"},"LoadPolicy()")," internamente. Ent\xe3o voc\xea n\xe3o precisa chamar os dois \xfaltimos ao usar ",(0,n.kt)("inlineCode",{parentName:"p"},"NewEnforcer()"),".")),(0,n.kt)("h2",{id:"habilitar-e-desabilitar"},"Habilitar e desabilitar"),(0,n.kt)("p",null,"O enforcer pode ser desabilitado atrav\xe9s da fun\xe7\xe3o ",(0,n.kt)("inlineCode",{parentName:"p"},"Enforcer.EnableEnforce()"),". Quando est\xe1 desabilitado, ",(0,n.kt)("inlineCode",{parentName:"p"},"Enforcer.Enforce()")," sempre retornar\xe1 ",(0,n.kt)("inlineCode",{parentName:"p"},"true"),". Outras opera\xe7\xf5es como adicionar ou remover pol\xedticas n\xe3o s\xe3o afetadas. Aqui est\xe1 um exemplo:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'e := casbin.NewEnforcer("examples/basic_model.conf", "examples/basic_policy.csv")\n\n// Will return false.\n// By default, the enforcer is enabled.\ne.Enforce("non-authorized-user", "data1", "read")\n\n// Disable the enforcer at runtime.\ne.EnableEnforce(false)\n\n// Will return true for any request.\ne.Enforce("non-authorized-user", "data1", "read")\n\n// Enable the enforcer again.\ne.EnableEnforce(true)\n\n// Will return false.\ne.Enforce("non-authorized-user", "data1", "read")\n')))}u.isMDXComponent=!0}}]);