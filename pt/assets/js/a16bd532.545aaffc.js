"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[4147],{6724:(e,s,o)=>{o.r(s),o.d(s,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>n,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"k8s","title":"Authorization of Kubernetes","description":"Kubernetes (k8s) RBAC & ABAC middleware de autoriza\xe7\xe3o baseado no Casbin","source":"@site/i18n/pt/docusaurus-plugin-content-docs/current/K8sAuthz.mdx","sourceDirName":".","slug":"/k8s","permalink":"/pt/docs/k8s","draft":false,"unlisted":false,"editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sAuthz.mdx","tags":[],"version":"current","frontMatter":{"id":"k8s","title":"Authorization of Kubernetes","description":"Kubernetes (k8s) RBAC & ABAC middleware de autoriza\xe7\xe3o baseado no Casbin","keywords":["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],"authors":["hsluoyz"]},"sidebar":"docs","previous":{"title":"Performance Optimization","permalink":"/pt/docs/performance"},"next":{"title":"Admission Webhook for K8s","permalink":"/pt/docs/k8s-gatekeeper"}}');var r=o(4848),i=o(8453);const n={id:"k8s",title:"Authorization of Kubernetes",description:"Kubernetes (k8s) RBAC & ABAC middleware de autoriza\xe7\xe3o baseado no Casbin",keywords:["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],authors:["hsluoyz"]},t=void 0,c={},d=[{value:"Requisitos",id:"requisitos",level:2},{value:"Uso",id:"uso",level:2}];function l(e){const s={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz",children:"K8s-authz"})," \xe9 um middleware de autoriza\xe7\xe3o do Kubernetes (k8s) baseado no Casbin que utiliza RBAC (Controle de Acesso Baseado em Fun\xe7\xf5es) e ABAC (Controle de Acesso Baseado em Atributos) para aplica\xe7\xe3o de pol\xedticas. Este middleware integra-se com o webhook de valida\xe7\xe3o de admiss\xe3o do K8s para validar as pol\xedticas definidas pelo Casbin para cada solicita\xe7\xe3o feita aos recursos do K8s. Controladores de admiss\xe3o personalizados s\xe3o registrados com o Kubernetes usando o ",(0,r.jsx)(s.code,{children:"ValidatingAdmissionWebhook"})," para realizar valida\xe7\xf5es em objetos de solicita\xe7\xe3o encaminhados pelo servidor de API e fornecer uma resposta indicando se a solicita\xe7\xe3o deve ser permitida ou rejeitada."]}),"\n",(0,r.jsxs)(s.p,{children:["Para determinar quando enviar solicita\xe7\xf5es de entrada para o controlador de admiss\xe3o, um webhook de valida\xe7\xe3o foi implementado. Este webhook encaminha solicita\xe7\xf5es para qualquer tipo de recurso ou sub-recurso do K8s e realiza a verifica\xe7\xe3o de pol\xedticas. Os usu\xe1rios s\xf3 t\xeam permiss\xe3o para realizar opera\xe7\xf5es nesses recursos se forem autorizados pelo executor do Casbin. O ",(0,r.jsx)(s.a,{href:"/docs/get-started#new-a-casbin-enforcer",children:"executor"})," verifica as fun\xe7\xf5es do usu\xe1rio conforme definido nas pol\xedticas. O cluster K8s \xe9 o alvo de implanta\xe7\xe3o para este middleware."]}),"\n",(0,r.jsx)(s.h2,{id:"requisitos",children:"Requisitos"}),"\n",(0,r.jsx)(s.p,{children:"Antes de prosseguir, certifique-se de que voc\xea tem o seguinte:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Um cluster Kubernetes em execu\xe7\xe3o. Voc\xea pode configurar um cluster local usando o Docker ou configurar um ecossistema Kubernetes completo no seu servidor. Para instru\xe7\xf5es detalhadas, consulte este ",(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/",children:"guia"})," para configurar um cluster Kubernetes local no Windows ou este ",(0,r.jsx)(s.a,{href:"https://www.digitalocean.com/community/tutorials/how-to-create-a-kubernetes-cluster-using-kubeadm-on-ubuntu-18-04",children:"guia"})," para configurar um cluster no Linux."]}),"\n",(0,r.jsxs)(s.li,{children:["Kubectl CLI. Instru\xe7\xf5es para instalar o Kubectl no Windows podem ser encontradas ",(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/",children:"aqui"}),", e para Linux ",(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/",children:"aqui"}),"."]}),"\n",(0,r.jsx)(s.li,{children:"OpenSSL"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"uso",children:"Uso"}),"\n",(0,r.jsx)(s.p,{children:"Siga estes passos para usar o K8s-authz:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Gere certificados e chaves para cada usu\xe1rio usando o OpenSSL. Execute o script abaixo:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"./gen_cert.sh\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Construa a imagem Docker a partir do ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/Dockerfile",children:"Dockerfile"})," manualmente executando o seguinte comando. Lembre-se de alterar a vers\xe3o de constru\xe7\xe3o no comando e no arquivo de implanta\xe7\xe3o ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/718f58c46e3dbf79063b5b1c18348c2fee5de9e9/manifests/deployment.yaml#L18",children:"file"})," de acordo."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker build -t casbin/k8s_authz:0.1 .\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Defina as pol\xedticas do Casbin nos arquivos ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/config/model.conf",children:"model.conf"})," e ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/config/policy.csv",children:"policy.csv"}),". Para mais informa\xe7\xf5es sobre como essas pol\xedticas funcionam, consulte a ",(0,r.jsx)(s.a,{href:"/docs/how-it-works",children:"documenta\xe7\xe3o"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Antes de implantar, voc\xea pode modificar as portas no arquivo ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/main.go",children:"main.go"}),", bem como na configura\xe7\xe3o do webhook de valida\xe7\xe3o ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/manifests/deployment.yaml",children:"file"}),", com base em suas necessidades espec\xedficas."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Implante o controlador de valida\xe7\xe3o e o webhook no cluster Kubernetes executando o seguinte comando:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f deployment.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Para um servidor de produ\xe7\xe3o, \xe9 recomendado criar um ",(0,r.jsx)(s.code,{children:"secret"})," do Kubernetes para proteger os certificados:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl create secret generic casbin -n default \\\n  --from-file=key.pem=certs/casbin-key.pem \\\n  --from-file=cert.pem=certs/casbin-crt.pem\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Ap\xf3s completar os passos acima, voc\xea precisa atualizar o diret\xf3rio do certificado no ",(0,r.jsx)(s.a,{href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/main.go#L26",children:"main.go"})," e nos ",(0,r.jsx)(s.a,{href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/manifests/deployment.yaml#L22",children:"manifestos"})," com o diret\xf3rio do ",(0,r.jsx)(s.code,{children:"secret"})," criado."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Agora, o servidor deve estar funcionando e pronto para validar solicita\xe7\xf5es feitas aos recursos do K8s e aplicar pol\xedticas de acordo."})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,s,o)=>{o.d(s,{R:()=>n,x:()=>t});var a=o(6540);const r={},i=a.createContext(r);function n(e){const s=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:n(e.components),a.createElement(i.Provider,{value:s},e.children)}}}]);