"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[2237],{8375(e,o,n){n.r(o),n.d(o,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"envoy","title":"Authorization of Service Mesh through Envoy","description":"Autoriza\xe7\xe3o de Service Mesh atrav\xe9s do Envoy","source":"@site/i18n/pt/docusaurus-plugin-content-docs/current/EnvoyAuthz.mdx","sourceDirName":".","slug":"/envoy","permalink":"/pt/docs/envoy","draft":false,"unlisted":false,"editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/docs/EnvoyAuthz.mdx","tags":[],"version":"current","frontMatter":{"id":"envoy","title":"Authorization of Service Mesh through Envoy","description":"Autoriza\xe7\xe3o de Service Mesh atrav\xe9s do Envoy","keywords":["Envoy","Envoy-authz","Istio"],"authors":["ashish493"]},"sidebar":"docs","previous":{"title":"Admission Webhook for K8s","permalink":"/pt/docs/k8s-gatekeeper"},"next":{"title":"Management","permalink":"/pt/docs/category/management"}}');var s=n(4848),r=n(8453);const a={id:"envoy",title:"Authorization of Service Mesh through Envoy",description:"Autoriza\xe7\xe3o de Service Mesh atrav\xe9s do Envoy",keywords:["Envoy","Envoy-authz","Istio"],authors:["ashish493"]},t=void 0,c={},d=[{value:"Requisitos",id:"requisitos",level:2},{value:"Funcionamento do Middleware",id:"funcionamento-do-middleware",level:2},{value:"Uso",id:"uso",level:2},{value:"Integrando com o Istio",id:"integrando-com-o-istio",level:2}];function l(e){const o={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o.p,{children:[(0,s.jsx)(o.a,{href:"https://github.com/casbin/envoy-authz",children:"Envoy-authz"})," \xe9 um middleware para o Envoy que realiza autoriza\xe7\xe3o externa RBAC & ABAC atrav\xe9s do casbin. Este middleware utiliza a ",(0,s.jsx)(o.a,{href:"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/security/ext_authz_filter.html",children:"API de autoriza\xe7\xe3o externa do Envoy"})," via um servidor gRPC. Este proxy pode ser implantado em qualquer tipo de service mesh baseado em Envoy, como o Istio."]}),"\n",(0,s.jsx)(o.h2,{id:"requisitos",children:"Requisitos"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"Envoy 1.17+"}),"\n",(0,s.jsx)(o.li,{children:"Istio ou qualquer outro tipo de service mesh"}),"\n",(0,s.jsx)(o.li,{children:"depend\xeancias grpc"}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["As depend\xeancias s\xe3o gerenciadas usando ",(0,s.jsx)(o.code,{children:"go.mod"}),"."]}),"\n",(0,s.jsx)(o.h2,{id:"funcionamento-do-middleware",children:"Funcionamento do Middleware"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"Um cliente faz uma solicita\xe7\xe3o HTTP."}),"\n",(0,s.jsx)(o.li,{children:"O proxy Envoy envia a solicita\xe7\xe3o para o servidor gRPC."}),"\n",(0,s.jsx)(o.li,{children:"O servidor gRPC autoriza a solicita\xe7\xe3o com base nas pol\xedticas do casbin."}),"\n",(0,s.jsx)(o.li,{children:"Se autorizado, a solicita\xe7\xe3o \xe9 encaminhada; caso contr\xe1rio, \xe9 negada."}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["O servidor gRPC \xe9 baseado no protocol buffer de ",(0,s.jsx)(o.a,{href:"https://github.com/envoyproxy/envoy/blob/master/api/envoy/service/auth/v2alpha/external_auth.proto",children:"external_auth.proto"})," no Envoy."]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-protobuf",children:"// A generic interface for performing authorization checks on incoming\n// requests to a networked service.\nservice Authorization {\n  // Performs an authorization check based on the attributes associated with the\n  // incoming request and returns a status of `OK` or not `OK`.\n  rpc Check(v2.CheckRequest) returns (v2.CheckResponse);\n}\n"})}),"\n",(0,s.jsxs)(o.p,{children:["Do arquivo proto acima, precisamos usar o servi\xe7o ",(0,s.jsx)(o.code,{children:"Check()"})," no servidor de autoriza\xe7\xe3o."]}),"\n",(0,s.jsx)(o.h2,{id:"uso",children:"Uso"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsxs)(o.li,{children:["Defina as pol\xedticas Casbin nos arquivos de configura\xe7\xe3o seguindo este ",(0,s.jsx)(o.a,{href:"/docs/how-it-works",children:"guia"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["Voc\xea pode verificar/testar suas pol\xedticas usando o ",(0,s.jsx)(o.a,{href:"/editor",children:"casbin-editor"})," online."]}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"Inicie o servidor de autentica\xe7\xe3o executando:"}),"\n"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"go build .\n./authz\n"})}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"Carregue a configura\xe7\xe3o do Envoy:"}),"\n"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"envoy -c authz.yaml -l info\n"})}),"\n",(0,s.jsx)(o.p,{children:"Uma vez que o Envoy \xe9 iniciado, ele interceptar\xe1 solicita\xe7\xf5es para o processo de autoriza\xe7\xe3o."}),"\n",(0,s.jsx)(o.h2,{id:"integrando-com-o-istio",children:"Integrando com o Istio"}),"\n",(0,s.jsxs)(o.p,{children:["Para fazer este middleware funcionar, voc\xea precisa enviar cabe\xe7alhos personalizados contendo nomes de usu\xe1rios no token JWT ou cabe\xe7alhos. Voc\xea pode consultar a ",(0,s.jsx)(o.a,{href:"https://istio.io/v1.4/docs/tasks/policy-enforcement/control-headers/",children:"documenta\xe7\xe3o oficial do Istio"})," para mais informa\xe7\xf5es sobre a modifica\xe7\xe3o de ",(0,s.jsx)(o.code,{children:"Request Headers"}),"."]})]})}function u(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453(e,o,n){n.d(o,{R:()=>a,x:()=>t});var i=n(6540);const s={},r=i.createContext(s);function a(e){const o=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:o},e.children)}}}]);