"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[3997],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>m});var n=t(7294);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,n,o=function(e,a){if(null==e)return{};var t,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var d=n.createContext({}),l=function(e){var a=n.useContext(d),t=a;return e&&(t="function"==typeof e?e(a):s(s({},a),e)),t},c=function(e){var a=l(e.components);return n.createElement(d.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,o=e.mdxType,r=e.originalType,d=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=l(t),m=o,b=u["".concat(d,".").concat(m)]||u[m]||p[m]||r;return t?n.createElement(b,s(s({ref:a},c),{},{components:t})):n.createElement(b,s({ref:a},c))}));function m(e,a){var t=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var r=t.length,s=new Array(r);s[0]=u;var i={};for(var d in a)hasOwnProperty.call(a,d)&&(i[d]=a[d]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var l=2;l<r;l++)s[l]=t[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},1058:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var n=t(7462),o=(t(7294),t(3905));const r={id:"frontend",title:"Frontend Usage",description:"Casbin.js \xe9 um addon do Casbin que facilita a gest\xe3o do controle de acesso na aplica\xe7\xe3o frontend",keywords:["Casbin.js","react-authz","rbac-react","vue-authz","angular-authz"],authors:["hsluoyz"]},s=void 0,i={unversionedId:"frontend",id:"frontend",title:"Frontend Usage",description:"Casbin.js \xe9 um addon do Casbin que facilita a gest\xe3o do controle de acesso na aplica\xe7\xe3o frontend",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/FrontendUsage.mdx",sourceDirName:".",slug:"/frontend",permalink:"/pt/docs/frontend",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/FrontendUsage.mdx",tags:[],version:"current",frontMatter:{id:"frontend",title:"Frontend Usage",description:"Casbin.js \xe9 um addon do Casbin que facilita a gest\xe3o do controle de acesso na aplica\xe7\xe3o frontend",keywords:["Casbin.js","react-authz","rbac-react","vue-authz","angular-authz"],authors:["hsluoyz"]},sidebar:"docs",previous:{title:"Log & Error Handling",permalink:"/pt/docs/log-error"},next:{title:"Editor",permalink:"/pt/docs/category/editor"}},d={},l=[{value:"Instala\xe7\xe3o",id:"instala\xe7\xe3o",level:2},{value:"Middlewares Frontend",id:"middlewares-frontend",level:2},{value:"In\xedcio R\xe1pido",id:"in\xedcio-r\xe1pido",level:2},{value:"Objeto de Permiss\xe3o",id:"objeto-de-permiss\xe3o",level:3},{value:"Uso Avan\xe7ado",id:"uso-avan\xe7ado",level:2},{value:"Lista de APIs",id:"lista-de-apis",level:2},{value:"<code>setPermission(permission: string)</code>",id:"setpermissionpermission-string",level:3},{value:"<code>setUser(user: string)</code>",id:"setuseruser-string",level:3},{value:"<code>can(action: string, object: string)</code>",id:"canaction-string-object-string",level:3},{value:"<code>cannot(action: string, object: string)</code>",id:"cannotaction-string-object-string",level:3},{value:"<code>canAll(action: string, objects: Array&lt;object&gt;)</code>",id:"canallaction-string-objects-arrayobject",level:3},{value:"<code>canAny(action: string, objects: Array&lt;object&gt;)</code>",id:"cananyaction-string-objects-arrayobject",level:3},{value:"Por que Casbin.js",id:"por-que-casbinjs",level:2}],c={toc:l};function p(e){let{components:a,...t}=e;return(0,o.kt)("wrapper",(0,n.Z)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/casbin/casbin.js"},"Casbin.js")," \xe9 um addon do Casbin que facilita a gest\xe3o do controle de acesso na aplica\xe7\xe3o frontend."),(0,o.kt)("h2",{id:"instala\xe7\xe3o"},"Instala\xe7\xe3o"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm install casbin.js\nnpm install casbin\n")),(0,o.kt)("p",null,"ou"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add casbin.js\n")),(0,o.kt)("h2",{id:"middlewares-frontend"},"Middlewares Frontend"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Middleware"),(0,o.kt)("th",{parentName:"tr",align:null},"Tipo"),(0,o.kt)("th",{parentName:"tr",align:null},"Autor"),(0,o.kt)("th",{parentName:"tr",align:null},"Descri\xe7\xe3o"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://github.com/casbin-js/react-authz"},"react-authz")),(0,o.kt)("td",{parentName:"tr",align:null},"React"),(0,o.kt)("td",{parentName:"tr",align:null},"Casbin"),(0,o.kt)("td",{parentName:"tr",align:null},"Wrapper do React para Casbin.js")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://github.com/daobeng/rbac-react"},"rbac-react")),(0,o.kt)("td",{parentName:"tr",align:null},"React"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://github.com/daobeng"},"@daobeng")),(0,o.kt)("td",{parentName:"tr",align:null},"Controle de Acesso Baseado em Fun\xe7\xf5es no React usando HOCs, CASL e Casbin.js")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://github.com/casbin-js/vue-authz"},"vue-authz")),(0,o.kt)("td",{parentName:"tr",align:null},"Vue"),(0,o.kt)("td",{parentName:"tr",align:null},"Casbin"),(0,o.kt)("td",{parentName:"tr",align:null},"Wrapper do Vue para Casbin.js")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://github.com/casbin-js/angular-authz"},"angular-authz")),(0,o.kt)("td",{parentName:"tr",align:null},"Angular"),(0,o.kt)("td",{parentName:"tr",align:null},"Casbin"),(0,o.kt)("td",{parentName:"tr",align:null},"Wrapper do Angular para Casbin.js")))),(0,o.kt)("h2",{id:"in\xedcio-r\xe1pido"},"In\xedcio R\xe1pido"),(0,o.kt)("p",null,"Voc\xea pode usar o modo ",(0,o.kt)("inlineCode",{parentName:"p"},"manual")," na sua aplica\xe7\xe3o frontend e definir as permiss\xf5es quando desejar."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const casbinjs = require("casbin.js");\n// Set the user\'s permission:\n// He/She can read `data1` and `data2` objects and can write `data1` object\nconst permission = {\n    "read": ["data1", "data2"],\n    "write": ["data1"]\n}\n\n// Run casbin.js in manual mode, which requires you to set the permission manually.\nconst authorizer = new casbinjs.Authorizer("manual");\n')),(0,o.kt)("p",null,"Agora temos um autorizador, ",(0,o.kt)("inlineCode",{parentName:"p"},"authorizer"),". Podemos obter regras de permiss\xe3o dele usando as APIs ",(0,o.kt)("inlineCode",{parentName:"p"},"authorizer.can()")," e ",(0,o.kt)("inlineCode",{parentName:"p"},"authorizer.cannot()"),". Os valores de retorno dessas 2 APIs s\xe3o Promessas JavaScript (",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises"},"detalhes aqui"),"), ent\xe3o devemos usar o m\xe9todo ",(0,o.kt)("inlineCode",{parentName:"p"},"then()")," do valor de retorno assim:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'result = authorizer.can("write", "data1");\nresult.then((success, failed) => {\n    if (success) {\n        console.log("you can write data1");\n    } else {\n        console.log("you cannot write data1");\n    }\n});\n// output: you can write data1\n')),(0,o.kt)("p",null,"A API ",(0,o.kt)("inlineCode",{parentName:"p"},"cannot()")," \xe9 usada da mesma maneira:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'result = authorizer.cannot("read", "data2");\nresult.then((success, failed) => {\n    if (success) {\n        console.log("you cannot read data2");\n    } else {\n        console.log("you can read data2");\n    }\n});\n// output: you can read data2\n')),(0,o.kt)("p",null,"No c\xf3digo acima, a vari\xe1vel ",(0,o.kt)("inlineCode",{parentName:"p"},"success")," nos par\xe2metros significa que a solicita\xe7\xe3o obteve o resultado sem lan\xe7ar um erro e n\xe3o significa que a regra de permiss\xe3o \xe9 ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),". A vari\xe1vel ",(0,o.kt)("inlineCode",{parentName:"p"},"failed")," tamb\xe9m n\xe3o est\xe1 relacionada \xe0s regras de permiss\xe3o. Ela s\xf3 faz sentido quando algo d\xe1 errado no processo da solicita\xe7\xe3o."),(0,o.kt)("p",null,"Voc\xea pode se referir ao nosso ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/casbin-js/examples"},"exemplo React")," para ver um uso pr\xe1tico do Casbin.js."),(0,o.kt)("h3",{id:"objeto-de-permiss\xe3o"},"Objeto de Permiss\xe3o"),(0,o.kt)("p",null,"Casbin.js aceitar\xe1 um objeto JSON para manipular a permiss\xe3o correspondente de um visitante. Por exemplo:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "read": ["data1", "data2"],\n    "write": ["data1"]\n}\n')),(0,o.kt)("p",null,"O objeto de permiss\xe3o acima mostra que o visitante pode ",(0,o.kt)("inlineCode",{parentName:"p"},"read")," os objetos ",(0,o.kt)("inlineCode",{parentName:"p"},"data1")," e ",(0,o.kt)("inlineCode",{parentName:"p"},"data2"),", enquanto eles s\xf3 podem ",(0,o.kt)("inlineCode",{parentName:"p"},"write")," nos objetos ",(0,o.kt)("inlineCode",{parentName:"p"},"data1"),"."),(0,o.kt)("h2",{id:"uso-avan\xe7ado"},"Uso Avan\xe7ado"),(0,o.kt)("p",null,"Casbin.js oferece uma solu\xe7\xe3o perfeita para integrar a gest\xe3o de controle de acesso do frontend com o servi\xe7o Casbin do backend."),(0,o.kt)("p",null,"Use o modo ",(0,o.kt)("inlineCode",{parentName:"p"},"auto")," e especifique seu endpoint ao inicializar o ",(0,o.kt)("inlineCode",{parentName:"p"},"Authorizer")," do Casbin.js, ele sincronizar\xe1 automaticamente a permiss\xe3o e manipular\xe1 o status do frontend."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const casbinjs = require('casbin.js');\n\n// Set your backend Casbin service URL\nconst authorizer = new casbinjs.Authorizer(\n    'auto', // mode\n    {endpoint: 'http://your_endpoint/api/casbin'}\n);\n\n// Set your visitor.\n// Casbin.js will automatically sync the permission with your backend Casbin service.\nauthorizer.setUser(\"Tom\");\n\n// Evaluate the permission\nresult = authorizer.can(\"read\", \"data1\");\nresult.then((success, failed) => {\n    if (success) {\n        // Some frontend procedure ...\n    }\n});\n")),(0,o.kt)("p",null,"Correspondentemente, voc\xea precisa expor uma interface (por exemplo, uma RestAPI) para gerar o objeto de permiss\xe3o e pass\xe1-lo para o frontend. No seu controlador de API, chame ",(0,o.kt)("inlineCode",{parentName:"p"},"CasbinJsGetUserPermission")," para construir o objeto de permiss\xe3o. Aqui est\xe1 um exemplo em Beego:"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Seu servidor de endpoint deve retornar algo como"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "other":"other",\n    "data": "What you get from `CasbinJsGetPermissionForUser`"\n}\n'))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},'// Router\nbeego.Router("api/casbin", &controllers.APIController{}, "GET:GetFrontendPermission")\n\n// Controller\nfunc (c *APIController) GetFrontendPermission() {\n    // Get the visitor from the GET parameters. (The key is "casbin_subject")\n    visitor := c.Input().Get("casbin_subject")\n    // `e` is an initialized instance of Casbin Enforcer\n    c.Data["perm"] = casbin.CasbinJsGetPermissionForUser(e, visitor)\n    // Pass the data to the frontend.\n    c.ServeJSON()\n}\n')),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Atualmente, a API ",(0,o.kt)("inlineCode",{parentName:"p"},"CasbinJsGetPermissionForUser")," s\xf3 \xe9 suportada no Go Casbin e Node-Casbin. Se voc\xea quiser que esta API seja suportada em outros idiomas, por favor ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/casbin/casbin.js/issues"},"crie uma issue")," ou deixe um coment\xe1rio abaixo.")),(0,o.kt)("h2",{id:"lista-de-apis"},"Lista de APIs"),(0,o.kt)("h3",{id:"setpermissionpermission-string"},(0,o.kt)("inlineCode",{parentName:"h3"},"setPermission(permission: string)")),(0,o.kt)("p",null,"Defina o objeto de permiss\xe3o. Sempre usado em modo ",(0,o.kt)("inlineCode",{parentName:"p"},"manual"),"."),(0,o.kt)("h3",{id:"setuseruser-string"},(0,o.kt)("inlineCode",{parentName:"h3"},"setUser(user: string)")),(0,o.kt)("p",null,"Defina a identidade do visitante e atualize a permiss\xe3o. Sempre usado em modo ",(0,o.kt)("inlineCode",{parentName:"p"},"auto"),"."),(0,o.kt)("h3",{id:"canaction-string-object-string"},(0,o.kt)("inlineCode",{parentName:"h3"},"can(action: string, object: string)")),(0,o.kt)("p",null,"Verifique se o usu\xe1rio pode realizar ",(0,o.kt)("inlineCode",{parentName:"p"},"action")," em ",(0,o.kt)("inlineCode",{parentName:"p"},"object"),"."),(0,o.kt)("h3",{id:"cannotaction-string-object-string"},(0,o.kt)("inlineCode",{parentName:"h3"},"cannot(action: string, object: string)")),(0,o.kt)("p",null,"Verifique se o usu\xe1rio ",(0,o.kt)("strong",{parentName:"p"},"n\xe3o pode")," realizar ",(0,o.kt)("inlineCode",{parentName:"p"},"action")," em ",(0,o.kt)("inlineCode",{parentName:"p"},"object"),"."),(0,o.kt)("h3",{id:"canallaction-string-objects-arrayobject"},(0,o.kt)("inlineCode",{parentName:"h3"},"canAll(action: string, objects: Array<object>)")),(0,o.kt)("p",null,"Verifique se o usu\xe1rio pode realizar ",(0,o.kt)("inlineCode",{parentName:"p"},"action")," em ",(0,o.kt)("strong",{parentName:"p"},"todos")," os objetos em ",(0,o.kt)("inlineCode",{parentName:"p"},"objects"),"."),(0,o.kt)("h3",{id:"cananyaction-string-objects-arrayobject"},(0,o.kt)("inlineCode",{parentName:"h3"},"canAny(action: string, objects: Array<object>)")),(0,o.kt)("p",null,"Verifique se o usu\xe1rio pode realizar ",(0,o.kt)("inlineCode",{parentName:"p"},"action")," em ",(0,o.kt)("strong",{parentName:"p"},"qualquer um")," dos ",(0,o.kt)("inlineCode",{parentName:"p"},"objects"),"."),(0,o.kt)("h2",{id:"por-que-casbinjs"},"Por que Casbin.js"),(0,o.kt)("p",null,"As pessoas podem se perguntar sobre a diferen\xe7a entre Node-Casbin e Casbin.js. Em uma palavra, Node-Casbin \xe9 o n\xfacleo do Casbin implementado no ambiente NodeJS, e normalmente \xe9 usado como um kit de ferramentas de gerenciamento de controle de acesso nas extremidades do servidor. Casbin.js \xe9 uma biblioteca frontend que ajuda voc\xea a usar o Casbin para autorizar seus usu\xe1rios de p\xe1ginas web no lado do cliente."),(0,o.kt)("p",null,"Normalmente, n\xe3o \xe9 adequado construir diretamente um servi\xe7o Casbin e realizar as tarefas de autoriza\xe7\xe3o/execu\xe7\xe3o em um aplicativo de frontend da web devido aos seguintes problemas:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Quando algu\xe9m liga o cliente, o executor ser\xe1 inicializado, e ele puxar\xe1 todas as pol\xedticas das camadas persistentes do backend. Uma alta concorr\xeancia poderia trazer grande press\xe3o sobre os bancos de dados e custar muito em termos de largura de banda de rede."),(0,o.kt)("li",{parentName:"ol"},"Carregar todas as pol\xedticas para o lado do cliente poderia trazer riscos de seguran\xe7a."),(0,o.kt)("li",{parentName:"ol"},"\xc9 dif\xedcil separar o cliente e o servidor, bem como facilitar o desenvolvimento \xe1gil.")),(0,o.kt)("p",null,"Precisamos de uma ferramenta que facilite o processo de usar o Casbin na frontend. Na verdade, o n\xfacleo do Casbin.js \xe9 a manipula\xe7\xe3o da permiss\xe3o do usu\xe1rio atual no lado do cliente. Como voc\xea mencionou, o Casbin.js faz uma busca de um endpoint especificado. Este procedimento sincronizar\xe1 a permiss\xe3o do usu\xe1rio com o servi\xe7o Casbin do backend. Depois de ter os dados de permiss\xe3o, os desenvolvedores podem usar as interfaces do Casbin.js para gerenciar o comportamento do usu\xe1rio no lado do frontend."),(0,o.kt)("p",null,"Casbin.js evita os dois problemas mencionados acima: o servi\xe7o Casbin n\xe3o ser\xe1 mais acionado repetidamente, e o tamanho das mensagens passadas entre o cliente e o servidor \xe9 reduzido. Tamb\xe9m evitamos armazenar todas as pol\xedticas no frontend. O usu\xe1rio s\xf3 pode acessar sua pr\xf3pria permiss\xe3o, mas n\xe3o tem conhecimento sobre o modelo de controle de acesso e as permiss\xf5es de outros usu\xe1rios. Al\xe9m disso, o Casbin.js tamb\xe9m pode desacoplar eficientemente o cliente e o servidor na gest\xe3o de autoriza\xe7\xe3o."))}p.isMDXComponent=!0}}]);