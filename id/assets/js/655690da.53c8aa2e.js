"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[625],{3905:(a,e,n)=>{n.d(e,{Zo:()=>m,kt:()=>o});var i=n(7294);function t(a,e,n){return e in a?Object.defineProperty(a,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[e]=n,a}function r(a,e){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.push.apply(n,i)}return n}function l(a){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){t(a,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(n,e))}))}return a}function k(a,e){if(null==a)return{};var n,i,t=function(a,e){if(null==a)return{};var n,i,t={},r=Object.keys(a);for(i=0;i<r.length;i++)n=r[i],e.indexOf(n)>=0||(t[n]=a[n]);return t}(a,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);for(i=0;i<r.length;i++)n=r[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(a,n)&&(t[n]=a[n])}return t}var s=i.createContext({}),u=function(a){var e=i.useContext(s),n=e;return a&&(n="function"==typeof a?a(e):l(l({},e),a)),n},m=function(a){var e=u(a.components);return i.createElement(s.Provider,{value:e},a.children)},p={inlineCode:"code",wrapper:function(a){var e=a.children;return i.createElement(i.Fragment,{},e)}},d=i.forwardRef((function(a,e){var n=a.components,t=a.mdxType,r=a.originalType,s=a.parentName,m=k(a,["components","mdxType","originalType","parentName"]),d=u(n),o=t,g=d["".concat(s,".").concat(o)]||d[o]||p[o]||r;return n?i.createElement(g,l(l({ref:e},m),{},{components:n})):i.createElement(g,l({ref:e},m))}));function o(a,e){var n=arguments,t=e&&e.mdxType;if("string"==typeof a||t){var r=n.length,l=new Array(r);l[0]=d;var k={};for(var s in e)hasOwnProperty.call(e,s)&&(k[s]=e[s]);k.originalType=a,k.mdxType="string"==typeof a?a:t,l[1]=k;for(var u=2;u<r;u++)l[u]=n[u];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7274:(a,e,n)=>{n.r(e),n.d(e,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>k,toc:()=>u});var i=n(7462),t=(n(7294),n(3905));const r={id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Middleware Otorisasi Kubernetes (K8s) RBAC & ABAC berbasis Casbin",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},l=void 0,k={unversionedId:"k8s-gatekeeper",id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Middleware Otorisasi Kubernetes (K8s) RBAC & ABAC berbasis Casbin",source:"@site/i18n/id/docusaurus-plugin-content-docs/current/K8sGateKeeper.mdx",sourceDirName:".",slug:"/k8s-gatekeeper",permalink:"/id/docs/k8s-gatekeeper",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sGateKeeper.mdx",tags:[],version:"current",frontMatter:{id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Middleware Otorisasi Kubernetes (K8s) RBAC & ABAC berbasis Casbin",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},sidebar:"docs",previous:{title:"Authorization of Kubernetes",permalink:"/id/docs/k8s"},next:{title:"Authorization of Service Mesh through Envoy",permalink:"/id/docs/envoy"}},s={},u=[{value:"1. Ikhtisar &amp; Dokumen untuk Casbin K8s-Gatekeeper",id:"1-ikhtisar--dokumen-untuk-casbin-k8s-gatekeeper",level:2},{value:"0.1 Contoh Sederhana",id:"01-contoh-sederhana",level:3},{value:"1.1 Bagaimana Cara Kerja Casbin K8s-Gatekeeper?",id:"11-bagaimana-cara-kerja-casbin-k8s-gatekeeper",level:3},{value:"1.2 Contoh Menggambarkan Cara Kerjanya",id:"12-contoh-menggambarkan-cara-kerjanya",level:3},{value:"2 Instal K8s-gatekeeper",id:"2-instal-k8s-gatekeeper",level:2},{value:"2.1 Webhook internal",id:"21-webhook-internal",level:3},{value:"2.1.1 Langkah 1: Bangun gambar",id:"211-langkah-1-bangun-gambar",level:4},{value:"2.1.2 Langkah 2: Menyiapkan layanan dan penyebaran untuk K8s-gatekeeper",id:"212-langkah-2-menyiapkan-layanan-dan-penyebaran-untuk-k8s-gatekeeper",level:4},{value:"2.1.3 Langkah 3: Menginstal Sumber Daya CRD untuk K8s-gatekeeper",id:"213-langkah-3-menginstal-sumber-daya-crd-untuk-k8s-gatekeeper",level:4},{value:"2.2 Webhook Eksternal",id:"22-webhook-eksternal",level:3},{value:"2.3 Instal K8s-gatekeeper melalui Helm",id:"23-instal-k8s-gatekeeper-melalui-helm",level:3},{value:"2.3.1 Langkah 1: Bangun image",id:"231-langkah-1-bangun-image",level:4},{value:"2.3.2 Instalasi Helm",id:"232-instalasi-helm",level:4},{value:"3. Coba K8s-gatekeeper",id:"3-coba-k8s-gatekeeper",level:2},{value:"3.1 Membuat Model dan Kebijakan Casbin",id:"31-membuat-model-dan-kebijakan-casbin",level:3},{value:"3.1.1 Membuat/Memperbarui Model dan Kebijakan Casbin melalui kubectl",id:"311-membuatmemperbarui-model-dan-kebijakan-casbin-melalui-kubectl",level:4},{value:"3.1.2 Membuat/Memperbarui Model dan Kebijakan Casbin melalui go-client yang kami sediakan",id:"312-membuatmemperbarui-model-dan-kebijakan-casbin-melalui-go-client-yang-kami-sediakan",level:4},{value:"3.1.2 Coba Apakah K8s-gatekeeper Bekerja",id:"312-coba-apakah-k8s-gatekeeper-bekerja",level:3},{value:"4. Cara Menulis Model dan Kebijakan dengan K8s-gatekeeper",id:"4-cara-menulis-model-dan-kebijakan-dengan-k8s-gatekeeper",level:2},{value:"4.1 Definisi Permintaan Model",id:"41-definisi-permintaan-model",level:3},{value:"4.2 Matchers dari Model",id:"42-matchers-dari-model",level:3},{value:"4.2.1 Fungsi Ekstensi",id:"421-fungsi-ekstensi",level:3},{value:"4.2.1.1 akses",id:"4211-akses",level:4},{value:"4.2.1.2 aksesDenganWildcard",id:"4212-aksesdenganwildcard",level:4},{value:"4.2.1.3 Fungsi yang Mendukung Argumen Panjang Variabel",id:"4213-fungsi-yang-mendukung-argumen-panjang-variabel",level:3},{value:"4.2.1.2 Fungsi Konversi Tipe",id:"4212-fungsi-konversi-tipe",level:4},{value:"5. Pengaturan Lanjutan",id:"5-pengaturan-lanjutan",level:2},{value:"5.1 Tentang Sertifikat",id:"51-tentang-sertifikat",level:3},{value:"5.1.1 Sertifikat yang Ditandatangani Sendiri",id:"511-sertifikat-yang-ditandatangani-sendiri",level:4},{value:"5.1.2 Sertifikat Legal",id:"512-sertifikat-legal",level:4}],m={toc:u};function p(a){let{components:e,...n}=a;return(0,t.kt)("wrapper",(0,i.Z)({},m,n,{components:e,mdxType:"MDXLayout"}),(0,t.kt)("h2",{id:"1-ikhtisar--dokumen-untuk-casbin-k8s-gatekeeper"},"1. Ikhtisar & Dokumen untuk Casbin K8s-Gatekeeper"),(0,t.kt)("p",null,"Casbin K8s-GateKeeper adalah webhook adimisi Kubernetes yang mengintegrasikan Casbin sebagai alat Kontrol Akses. Dengan menggunakan Casbin K8s-GateKeeper, Anda dapat menetapkan aturan yang fleksibel untuk mengotorisasi atau memblokir operasi apapun pada sumber daya K8s, TANPA menulis satu baris kode pun, tetapi hanya beberapa baris konfigurasi deklaratif dari model dan kebijakan Casbin, yang merupakan bagian dari bahasa ACL (Access Control List) Casbin."),(0,t.kt)("p",null,"Casbin K8s-GateKeeper dikembangkan dan dipelihara oleh komunitas Casbin. Repositori proyek ini tersedia di sini: ",(0,t.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-gatekeeper"},"https://github.com/casbin/k8s-gatekeeper")),(0,t.kt)("h3",{id:"01-contoh-sederhana"},"0.1 Contoh Sederhana"),(0,t.kt)("p",null,'Misalnya, Anda tidak perlu menulis kode apa pun, tetapi gunakan beberapa baris konfigurasi berikut untuk mencapai fungsi ini: "Larang penggunaan gambar dengan beberapa tag tertentu dalam penyebaran apa pun":'),(0,t.kt)("p",null,"Model:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\ncontain(split(accessWithWildcard(${OBJECT}.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,t.kt)("p",null,"And Policy:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-csv"},'p, "1.14.1",deny\n')),(0,t.kt)("p",null,"Ini adalah dalam bahasa Casbin ACL biasa. Misalkan Anda sudah membaca bab tentang mereka, akan sangat mudah untuk dipahami."),(0,t.kt)("p",null,"Casbin K8s-GateKeeper memiliki keunggulan sebagai berikut:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Mudah digunakan. Menulis beberapa baris ACL jauh lebih baik daripada menulis banyak kode."),(0,t.kt)("li",{parentName:"ul"},"Ini memungkinkan pembaruan konfigurasi secara langsung. Anda tidak perlu mematikan seluruh plugin untuk mengubah konfigurasi."),(0,t.kt)("li",{parentName:"ul"},"Ini fleksibel. Aturan sewenang-wenang dapat dibuat pada sumber daya K8s apa pun, yang dapat dieksplorasi dengan ",(0,t.kt)("inlineCode",{parentName:"li"},"kubectl gatekeeper"),"."),(0,t.kt)("li",{parentName:"ul"},"Ini menyederhanakan implementasi webhook masuk K8s, yang sangat rumit. Anda tidak perlu tahu apa itu webhook masuk K8s atau bagaimana menulis kode untuk itu. Yang perlu Anda lakukan hanyalah mengetahui sumber daya yang ingin Anda batasi dan kemudian menulis ACL Casbin. Semua orang tahu bahwa K8s itu kompleks, tetapi dengan menggunakan Casbin K8s-Gatekeeper, waktu Anda dapat dihemat."),(0,t.kt)("li",{parentName:"ul"},"Ini dikelola oleh komunitas Casbin. Jangan ragu untuk menghubungi kami jika ada hal tentang plugin ini yang membuat Anda bingung atau jika Anda menemui masalah saat mencobanya.")),(0,t.kt)("h3",{id:"11-bagaimana-cara-kerja-casbin-k8s-gatekeeper"},"1.1 Bagaimana Cara Kerja Casbin K8s-Gatekeeper?"),(0,t.kt)("p",null,"K8s-Gatekeeper adalah webhook keberatan untuk K8s yang menggunakan ",(0,t.kt)("a",{parentName:"p",href:"/docs/overview"},"Casbin")," untuk menerapkan aturan kontrol akses yang ditentukan pengguna secara arbitrer guna mencegah operasi apa pun pada K8s yang tidak diinginkan oleh administrator."),(0,t.kt)("p",null,"Casbin adalah pustaka kontrol akses sumber terbuka yang kuat dan efisien. Pustaka ini menyediakan dukungan untuk menegakkan otorisasi berdasarkan berbagai model kontrol akses. Untuk informasi lebih lanjut tentang Casbin, lihat ",(0,t.kt)("a",{parentName:"p",href:"/docs/overview"},"Overview"),"."),(0,t.kt)("p",null,"Webhook keberatan dalam K8s adalah panggilan balik HTTP yang menerima 'permintaan keberatan' dan melakukan sesuatu dengan permintaan tersebut. Secara khusus, K8s-Gatekeeper adalah jenis webhook keberatan khusus: 'ValidatingAdmissionWebhook', yang dapat memutuskan apakah akan menerima atau menolak permintaan keberatan ini atau tidak. Mengenai permintaan keberatan, permintaan tersebut adalah permintaan HTTP yang menjelaskan operasi pada sumber daya yang ditentukan dari K8s (misalnya, membuat/menghapus sebuah deployment). Untuk informasi lebih lanjut tentang webhook keberatan, lihat ",(0,t.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks"},"dokumentasi resmi K8s"),"."),(0,t.kt)("h3",{id:"12-contoh-menggambarkan-cara-kerjanya"},"1.2 Contoh Menggambarkan Cara Kerjanya"),(0,t.kt)("p",null,"Misalnya, ketika seseorang ingin membuat penyebaran yang berisi pod menjalankan nginx (menggunakan kubectl atau klien K8s), K8s akan menghasilkan permintaan masuk, yang (jika diterjemahkan ke dalam format YAML) bisa menjadi seperti ini:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.14.1\n        ports:\n        - containerPort: 80\n")),(0,t.kt)("p",null,"Permintaan ini akan melalui proses semua middleware yang ditunjukkan dalam gambar, termasuk K8s-Gatekeeper kami. K8s-Gatekeeper dapat mendeteksi semua enforcer Casbin yang disimpan di etcd K8s, yang dibuat dan dipelihara oleh pengguna (melalui ",(0,t.kt)("inlineCode",{parentName:"p"},"kubectl")," atau klien Go yang kami sediakan). Setiap enforcer berisi model Casbin dan kebijakan Casbin. Permintaan masuk akan diproses oleh setiap enforcer, satu per satu, dan hanya dengan lulus semua enforcer, sebuah permintaan dapat diterima oleh K8s-Gatekeeper ini."),(0,t.kt)("p",null,"(Jika Anda tidak mengerti apa itu enforcer Casbin, model, atau kebijakan, lihat dokumen ini: ",(0,t.kt)("a",{parentName:"p",href:"/docs/get-started"},"Mulai"),")."),(0,t.kt)("p",null,"Misalnya, karena suatu alasan, administrator ingin melarang kemunculan gambar 'nginx:1.14.1' sementara mengizinkan 'nginx:1.3.1'. Sebuah enforcer yang berisi aturan dan kebijakan berikut dapat dibuat (Kami akan menjelaskan cara membuat enforcer, apa model dan kebijakan ini, dan bagaimana menulisnya di bab-bab berikutnya)."),(0,t.kt)("p",null,"Model:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n\n')),(0,t.kt)("p",null,"Policy:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-csv"},'p, "nginx:1.13.1",allow\np, "nginx:1.14.1",deny\n')),(0,t.kt)("p",null,"Dengan membuat enforcer yang mengandung model dan kebijakan di atas, permintaan masuk sebelumnya akan ditolak oleh enforcer ini, yang berarti K8s tidak akan membuat penyebaran ini."),(0,t.kt)("h2",{id:"2-instal-k8s-gatekeeper"},"2 Instal K8s-gatekeeper"),(0,t.kt)("p",null,"Ada tiga metode yang tersedia untuk menginstal K8s-gatekeeper: Webhook eksternal, webhook internal, dan Helm."),(0,t.kt)("admonition",{type:"note"},(0,t.kt)("p",{parentName:"admonition"},"Catatan: Metode ini hanya dimaksudkan untuk pengguna mencoba K8s-gatekeeper dan tidak aman. Jika Anda ingin menggunakannya dalam lingkungan produktif, pastikan Anda membaca ",(0,t.kt)("a",{parentName:"p",href:"#5-pengaturan-lanjutan"},"Bab 5. Pengaturan lanjutan")," dan melakukan modifikasi yang diperlukan sebelum instalasi.")),(0,t.kt)("h3",{id:"21-webhook-internal"},"2.1 Webhook internal"),(0,t.kt)("h4",{id:"211-langkah-1-bangun-gambar"},"2.1.1 Langkah 1: Bangun gambar"),(0,t.kt)("p",null,"Untuk metode webhook internal, webhook itu sendiri akan diimplementasikan sebagai layanan dalam Kubernetes. Untuk membuat layanan dan penyebaran yang diperlukan, Anda perlu membangun sebuah gambar dari K8s-gatekeeper. Anda dapat membangun gambar Anda sendiri dengan menjalankan perintah berikut:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"docker build --target webhook -t k8s-gatekeeper .\n")),(0,t.kt)("p",null,"Perintah ini akan membuat sebuah gambar lokal bernama 'k8s-gatekeeper:latest'."),(0,t.kt)("admonition",{type:"note"},(0,t.kt)("p",{parentName:"admonition"},"Catatan: Jika Anda menggunakan minikube, silakan jalankan ",(0,t.kt)("inlineCode",{parentName:"p"},"eval $(minikube -p minikube docker-env)")," sebelum menjalankan 'docker build'.")),(0,t.kt)("h4",{id:"212-langkah-2-menyiapkan-layanan-dan-penyebaran-untuk-k8s-gatekeeper"},"2.1.2 Langkah 2: Menyiapkan layanan dan penyebaran untuk K8s-gatekeeper"),(0,t.kt)("p",null,"Jalankan perintah berikut:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/rbac.yaml\nkubectl apply -f config/webhook_deployment.yaml \nkubectl apply -f config/webhook_internal.yaml \n")),(0,t.kt)("p",null,"Ini akan memulai K8s-gatekeeper, dan Anda dapat mengonfirmasi ini dengan menjalankan ",(0,t.kt)("inlineCode",{parentName:"p"},"kubectl get pods"),"."),(0,t.kt)("h4",{id:"213-langkah-3-menginstal-sumber-daya-crd-untuk-k8s-gatekeeper"},"2.1.3 Langkah 3: Menginstal Sumber Daya CRD untuk K8s-gatekeeper"),(0,t.kt)("p",null,"Jalankan perintah berikut:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\n")),(0,t.kt)("h3",{id:"22-webhook-eksternal"},"2.2 Webhook Eksternal"),(0,t.kt)("p",null,"Untuk metode webhook eksternal, K8s-gatekeeper akan berjalan di luar Kubernetes, dan Kubernetes akan mengakses K8s-gatekeeper seperti mengakses situs web biasa. Kubernetes memiliki persyaratan wajib bahwa webhook admission harus menggunakan HTTPS. Untuk tujuan mencoba K8s-gatekeeper, kami telah menyediakan seperangkat sertifikat dan kunci pribadi (meskipun ini tidak aman). Jika Anda lebih suka menggunakan sertifikat Anda sendiri, silakan merujuk ke ",(0,t.kt)("a",{parentName:"p",href:"#5-advanced-settings"},"Bab 5. Pengaturan Lanjutan")," untuk instruksi mengenai penyesuaian sertifikat dan kunci pribadi."),(0,t.kt)("p",null,"Sertifikat yang kami sediakan dikeluarkan untuk 'webhook.domain.local'. Jadi, modifikasi host (misalnya, /etc/hosts) dan arahkan 'webhook.domain.local' ke alamat IP di mana K8s-gatekeeper berjalan."),(0,t.kt)("p",null,"Kemudian jalankan perintah berikut:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"go mod tidy\ngo mod vendor\ngo run cmd/webhook/main.go\nkubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\nkubectl apply -f config/webhook_external.yaml \n")),(0,t.kt)("h3",{id:"23-instal-k8s-gatekeeper-melalui-helm"},"2.3 Instal K8s-gatekeeper melalui Helm"),(0,t.kt)("h4",{id:"231-langkah-1-bangun-image"},"2.3.1 Langkah 1: Bangun image"),(0,t.kt)("p",null,"Silakan merujuk ke ",(0,t.kt)("a",{parentName:"p",href:"#211-step-1-build-the-image"},"Bab 2.1.1"),"."),(0,t.kt)("h4",{id:"232-instalasi-helm"},"2.3.2 Instalasi Helm"),(0,t.kt)("p",null,"Jalankan perintah ",(0,t.kt)("inlineCode",{parentName:"p"},"helm install k8sgatekeeper ./k8sgatekeeper"),"."),(0,t.kt)("h2",{id:"3-coba-k8s-gatekeeper"},"3. Coba K8s-gatekeeper"),(0,t.kt)("h3",{id:"31-membuat-model-dan-kebijakan-casbin"},"3.1 Membuat Model dan Kebijakan Casbin"),(0,t.kt)("p",null,"Anda memiliki dua metode untuk membuat model dan kebijakan: melalui kubectl atau melalui go-client yang kami sediakan."),(0,t.kt)("h4",{id:"311-membuatmemperbarui-model-dan-kebijakan-casbin-melalui-kubectl"},"3.1.1 Membuat/Memperbarui Model dan Kebijakan Casbin melalui kubectl"),(0,t.kt)("p",null,"Di K8s-gatekeeper, model Casbin disimpan dalam sumber daya CRD yang disebut 'CasbinModel'. Definisinya terletak di ",(0,t.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinmodels.yaml"),"."),(0,t.kt)("p",null,"Terdapat contoh di ",(0,t.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml"),". Perhatikan bidang-bidang berikut:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"metadata.name: nama model. Nama ini HARUS sama dengan nama objek CasbinPolicy yang terkait dengan model ini, sehingga K8s-gatekeeper dapat memasangkannya dan membuat enforcer."),(0,t.kt)("li",{parentName:"ul"},'spec.enable: jika bidang ini diatur ke "false", model ini (serta objek CasbinPolicy yang terkait dengan model ini) akan diabaikan.'),(0,t.kt)("li",{parentName:"ul"},"spec.modelText: sebuah string yang berisi teks model dari model Casbin.")),(0,t.kt)("p",null,"Kebijakan Casbin disimpan dalam sumber daya CRD lain yang disebut 'CasbinPolicy', yang definisinya dapat ditemukan di ",(0,t.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinpolicies.yaml"),"."),(0,t.kt)("p",null,"Terdapat contoh di ",(0,t.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/policy.yaml"),". Perhatikan bidang-bidang berikut:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"metadata.name: nama kebijakan. Nama ini HARUS sama dengan nama objek CasbinModel yang terkait dengan kebijakan ini, agar K8s-gatekeeper dapat memasangkannya dan membuat pelaksana."),(0,t.kt)("li",{parentName:"ul"},"spec.policyItem: sebuah string yang berisi teks kebijakan dari model Casbin.")),(0,t.kt)("p",null,"Setelah membuat file CasbinModel dan CasbinPolicy Anda sendiri, gunakan perintah berikut untuk menerapkannya:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f <filename>\n")),(0,t.kt)("p",null,"Setelah sepasang CasbinModel dan CasbinPolicy dibuat, K8s-gatekeeper akan dapat mendeteksinya dalam waktu 5 detik."),(0,t.kt)("h4",{id:"312-membuatmemperbarui-model-dan-kebijakan-casbin-melalui-go-client-yang-kami-sediakan"},"3.1.2 Membuat/Memperbarui Model dan Kebijakan Casbin melalui go-client yang kami sediakan"),(0,t.kt)("p",null,"Kami mengerti bahwa mungkin ada situasi di mana tidak nyaman menggunakan shell untuk mengeksekusi perintah secara langsung pada sebuah node dari klaster K8s, seperti ketika Anda membangun platform cloud otomatis untuk perusahaan Anda. Oleh karena itu, kami telah mengembangkan go-client untuk membuat dan memelihara CasbinModel dan CasbinPolicy."),(0,t.kt)("p",null,"Pustaka go-client terletak di ",(0,t.kt)("inlineCode",{parentName:"p"},"pkg/client"),"."),(0,t.kt)("p",null,"Di ",(0,t.kt)("inlineCode",{parentName:"p"},"client.go"),", kami menyediakan fungsi untuk membuat klien."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-go"},"func NewK8sGateKeeperClient(externalClient bool) (*K8sGateKeeperClient, error) \n")),(0,t.kt)("p",null,"Parameter ",(0,t.kt)("inlineCode",{parentName:"p"},"externalClient")," menentukan apakah K8s-gatekeeper berjalan di dalam klaster K8s atau tidak."),(0,t.kt)("p",null,"Di ",(0,t.kt)("inlineCode",{parentName:"p"},"model.go"),", kami menyediakan berbagai fungsi untuk membuat, menghapus, dan memodifikasi CasbinModel. Anda dapat mengetahui cara menggunakan antarmuka ini di ",(0,t.kt)("inlineCode",{parentName:"p"},"model_test.go"),"."),(0,t.kt)("p",null,"Di ",(0,t.kt)("inlineCode",{parentName:"p"},"policy.go"),", kami menyediakan berbagai fungsi untuk membuat, menghapus, dan memodifikasi CasbiPolicy. Anda dapat mengetahui cara menggunakan antarmuka ini di ",(0,t.kt)("inlineCode",{parentName:"p"},"policy_test.go"),"."),(0,t.kt)("h3",{id:"312-coba-apakah-k8s-gatekeeper-bekerja"},"3.1.2 Coba Apakah K8s-gatekeeper Bekerja"),(0,t.kt)("p",null,"Misalkan Anda telah membuat model dan kebijakan yang tepat di ",(0,t.kt)("inlineCode",{parentName:"p"},"example/allowed_repo"),". Sekarang, coba perintah berikut:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f example/allowed_repo/testcase/reject_1.yaml\n")),(0,t.kt)("p",null,"Anda akan menemukan bahwa K8s akan menolak permintaan ini dan menyebutkan bahwa webhook adalah alasan mengapa permintaan ini ditolak. Namun, ketika Anda mencoba menerapkan ",(0,t.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/testcase/approve_2.yaml"),", permintaan tersebut akan diterima."),(0,t.kt)("h2",{id:"4-cara-menulis-model-dan-kebijakan-dengan-k8s-gatekeeper"},"4. Cara Menulis Model dan Kebijakan dengan K8s-gatekeeper"),(0,t.kt)("p",null,"Pertama-tama, pastikan Anda familiar dengan dasar-dasar tata bahasa Model dan Kebijakan Casbin. Jika belum, silakan baca bagian ",(0,t.kt)("a",{parentName:"p",href:"/docs/get-started"},"Memulai")," terlebih dahulu. Dalam bab ini, kami menganggap Anda sudah memahami apa itu Model dan Kebijakan Casbin."),(0,t.kt)("h3",{id:"41-definisi-permintaan-model"},"4.1 Definisi Permintaan Model"),(0,t.kt)("p",null,"Ketika K8s-gatekeeper mengotorisasi permintaan, inputnya selalu berupa objek: objek Go dari Permintaan Penyetujuan. Ini berarti enforcer akan selalu digunakan seperti ini:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-go"},"ok, err := enforcer.Enforce(admission)\n")),(0,t.kt)("p",null,"di mana ",(0,t.kt)("inlineCode",{parentName:"p"},"admission")," adalah objek ",(0,t.kt)("inlineCode",{parentName:"p"},"AdmissionReview")," yang didefinisikan oleh API resmi Go K8s ",(0,t.kt)("inlineCode",{parentName:"p"},'"k8s.io/api/admission/v1"'),". Anda dapat menemukan definisi struct ini di repositori ini: ",(0,t.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"},"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"),". Untuk informasi lebih lanjut, Anda juga dapat merujuk ke ",(0,t.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"},"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"),"."),(0,t.kt)("p",null,"Oleh karena itu, untuk setiap model yang digunakan oleh K8s-gatekeeper, definisi ",(0,t.kt)("inlineCode",{parentName:"p"},"request_definition")," harus selalu seperti ini:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},"    [request_definition]\n    r =  obj\n")),(0,t.kt)("p",null,"Nama 'obj' tidak wajib, selama nama tersebut konsisten dengan nama yang digunakan di bagian ",(0,t.kt)("inlineCode",{parentName:"p"},"[matchers]"),"."),(0,t.kt)("h3",{id:"42-matchers-dari-model"},"4.2 Matchers dari Model"),(0,t.kt)("p",null,"Anda seharusnya menggunakan fitur ABAC dari Casbin untuk menulis aturan Anda. Namun, evaluator ekspresi yang terintegrasi dalam Casbin tidak mendukung pengindeksan dalam peta atau array (slices), juga tidak mendukung ekspansi array. Oleh karena itu, K8s-gatekeeper menyediakan berbagai 'fungsi Casbin' sebagai ekstensi untuk mengimplementasikan fitur-fitur ini. Jika Anda masih menemukan bahwa permintaan Anda tidak dapat dipenuhi oleh ekstensi ini, jangan ragu untuk memulai sebuah masalah, atau membuat permintaan tarik."),(0,t.kt)("p",null,"Jika Anda tidak familiar dengan fungsi Casbin, Anda dapat merujuk ke ",(0,t.kt)("a",{parentName:"p",href:"/docs/function"},"Function")," untuk informasi lebih lanjut."),(0,t.kt)("p",null,"Berikut adalah fungsi ekstensi:"),(0,t.kt)("h3",{id:"421-fungsi-ekstensi"},"4.2.1 Fungsi Ekstensi"),(0,t.kt)("h4",{id:"4211-akses"},"4.2.1.1 akses"),(0,t.kt)("p",null,"Akses digunakan untuk menyelesaikan masalah bahwa Casbin tidak mendukung pengindeksan dalam peta atau array. Contoh ",(0,t.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml")," menunjukkan penggunaan fungsi ini:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n')),(0,t.kt)("p",null,"Dalam matcher ini, ",(0,t.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image")')," setara dengan ",(0,t.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Image"),", di mana ",(0,t.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers")," adalah sebuah slice."),(0,t.kt)("p",null,"Akses juga dapat memanggil fungsi sederhana yang tidak memiliki parameter dan mengembalikan satu nilai. Contoh ",(0,t.kt)("inlineCode",{parentName:"p"},"example/container_resource_limit/model.yaml")," menunjukkan hal ini:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\n  m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")) >= parseFloat(p.cpu) && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","memory","Value")) >= parseFloat(p.memory)\n')),(0,t.kt)("p",null,"Dalam matcher ini, ",(0,t.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")')," setara dengan ",(0,t.kt)("inlineCode",{parentName:"p"},'r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits["cpu"].Value()'),", di mana ",(0,t.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits")," adalah sebuah peta, dan ",(0,t.kt)("inlineCode",{parentName:"p"},"Value()")," adalah fungsi sederhana yang tidak memiliki parameter dan mengembalikan satu nilai."),(0,t.kt)("h4",{id:"4212-aksesdenganwildcard"},"4.2.1.2 aksesDenganWildcard"),(0,t.kt)("p",null,'Terkadang, Anda mungkin memiliki permintaan seperti ini: semua elemen dalam array harus memiliki awalan "aaa". Namun, Casbin tidak mendukung loop ',(0,t.kt)("inlineCode",{parentName:"p"},"for"),". Dengan ",(0,t.kt)("inlineCode",{parentName:"p"},"accessWithWildcard"),' dan fitur "ekspansi peta/slice", Anda dapat dengan mudah mengimplementasikan permintaan seperti itu.'),(0,t.kt)("p",null,"Misalnya, anggap ",(0,t.kt)("inlineCode",{parentName:"p"},"a.b.c")," adalah array ",(0,t.kt)("inlineCode",{parentName:"p"},"[aaa, bbb, ccc, ddd, eee]"),", maka hasil dari ",(0,t.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a, "b", "c", "*")')," akan menjadi slice ",(0,t.kt)("inlineCode",{parentName:"p"},"[aaa, bbb, ccc, ddd, eee]"),". Dengan menggunakan wildcard ",(0,t.kt)("inlineCode",{parentName:"p"},"*"),", slice akan di-expand."),(0,t.kt)("p",null,"Demikian pula, wildcard dapat digunakan lebih dari sekali. Misalnya, hasil dari ",(0,t.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a, "b", "c", "*", "*")')," akan menjadi ",(0,t.kt)("inlineCode",{parentName:"p"},"[a.b.c[0][0], a.b.c[0][1], ..., a.b.c[1][0], a.b.c[1][1], ...]"),"."),(0,t.kt)("h3",{id:"4213-fungsi-yang-mendukung-argumen-panjang-variabel"},"4.2.1.3 Fungsi yang Mendukung Argumen Panjang Variabel"),(0,t.kt)("p",null,"Dalam evaluator ekspresi Casbin, ketika sebuah parameter adalah array, itu akan secara otomatis di-expand sebagai argumen panjang variabel. Menggunakan fitur ini untuk mendukung ekspansi array/slice/peta, kami juga telah mengintegrasikan beberapa fungsi yang menerima array/slice sebagai parameter:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"contain(): menerima beberapa parameter dan mengembalikan apakah ada parameter (kecuali parameter terakhir) yang sama dengan parameter terakhir."),(0,t.kt)("li",{parentName:"ul"},"split(a, b, c..., sep, index): mengembalikan slice yang berisi ",(0,t.kt)("inlineCode",{parentName:"li"},"[splits(a, sep)[index], splits(b, sep)[index], splits(a, sep)[index], ...]"),"."),(0,t.kt)("li",{parentName:"ul"},"len(): mengembalikan panjang dari argumen berukuran variabel."),(0,t.kt)("li",{parentName:"ul"},"matchRegex(a, b, c..., regex): mengembalikan apakah semua parameter yang diberikan (",(0,t.kt)("inlineCode",{parentName:"li"},"a"),", ",(0,t.kt)("inlineCode",{parentName:"li"},"b"),", ",(0,t.kt)("inlineCode",{parentName:"li"},"c"),", ...) cocok dengan regex yang diberikan.")),(0,t.kt)("p",null,"Berikut adalah contoh dalam ",(0,t.kt)("inlineCode",{parentName:"p"},"example/disallowed_tag/model.yaml"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},'    [matchers]\n    m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n    contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,t.kt)("p",null,"Dengan asumsi bahwa ",(0,t.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image")')," mengembalikan ",(0,t.kt)("inlineCode",{parentName:"p"},'["a:b", "c:d", "e:f", "g:h"]'),", karena splits mendukung argumen berukuran variabel dan melakukan operasi split pada setiap elemen, elemen pada indeks 1 akan dipilih dan dikembalikan. Oleh karena itu, ",(0,t.kt)("inlineCode",{parentName:"p"},'split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1)')," mengembalikan ",(0,t.kt)("inlineCode",{parentName:"p"},'["b","d","f","h"]'),". Dan ",(0,t.kt)("inlineCode",{parentName:"p"},'contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)')," mengembalikan apakah ",(0,t.kt)("inlineCode",{parentName:"p"},"p.obj")," terdapat dalam ",(0,t.kt)("inlineCode",{parentName:"p"},'["b","d","f","h"]'),"."),(0,t.kt)("h4",{id:"4212-fungsi-konversi-tipe"},"4.2.1.2 Fungsi Konversi Tipe"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"ParseFloat(): Mengurai sebuah integer menjadi float (ini diperlukan karena setiap angka yang digunakan dalam perbandingan harus diubah menjadi float)."),(0,t.kt)("li",{parentName:"ul"},"ToString(): Mengonversi sebuah objek menjadi string. Objek ini harus memiliki tipe dasar string (misalnya, objek dari tipe ",(0,t.kt)("inlineCode",{parentName:"li"},"XXX")," ketika ada pernyataan ",(0,t.kt)("inlineCode",{parentName:"li"},"type XXX string"),")."),(0,t.kt)("li",{parentName:"ul"},"IsNil(): Mengembalikan apakah parameter tersebut nil.")),(0,t.kt)("h2",{id:"5-pengaturan-lanjutan"},"5. Pengaturan Lanjutan"),(0,t.kt)("h3",{id:"51-tentang-sertifikat"},"5.1 Tentang Sertifikat"),(0,t.kt)("p",null,"Di Kubernetes (k8s), wajib bagi webhook untuk menggunakan HTTPS. Ada dua pendekatan untuk mencapai ini:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Gunakan sertifikat yang ditandatangani sendiri (contoh dalam repositori ini menggunakan metode ini)"),(0,t.kt)("li",{parentName:"ul"},"Gunakan sertifikat normal")),(0,t.kt)("h4",{id:"511-sertifikat-yang-ditandatangani-sendiri"},"5.1.1 Sertifikat yang Ditandatangani Sendiri"),(0,t.kt)("p",null,"Menggunakan sertifikat yang ditandatangani sendiri berarti bahwa Otoritas Sertifikat (CA) yang mengeluarkan sertifikat tersebut bukan salah satu CA yang terkenal. Oleh karena itu, Anda harus memberi tahu k8s tentang CA ini."),(0,t.kt)("p",null,"Saat ini, contoh dalam repositori ini menggunakan CA buatan sendiri, yang kunci pribadi dan sertifikatnya disimpan masing-masing di ",(0,t.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.crt")," dan ",(0,t.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.key"),". Sertifikat untuk webhook adalah ",(0,t.kt)("inlineCode",{parentName:"p"},"config/certificate/server.crt"),', yang dikeluarkan oleh CA buatan sendiri. Domain dari sertifikat ini adalah "webhook.domain.local" (untuk webhook eksternal) dan "casbin-webhook-svc.default.svc" (untuk webhook internal).'),(0,t.kt)("p",null,"Informasi tentang CA diteruskan ke k8s melalui file konfigurasi webhook. Baik ",(0,t.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," maupun ",(0,t.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),' memiliki bidang yang disebut "CABundle", yang berisi string terenkripsi base64 dari sertifikat CA.'),(0,t.kt)("p",null,"Jika Anda perlu mengubah sertifikat/domain (misalnya, jika Anda ingin menempatkan webhook ini ke namespace lain di k8s sambil menggunakan webhook internal, atau jika Anda ingin mengubah domain sambil menggunakan webhook eksternal), prosedur berikut harus diikuti:"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Buat CA baru:"),(0,t.kt)("ul",{parentName:"li"},(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Hasilkan kunci pribadi untuk CA palsu:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out ca.key 2048\n"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Hapus perlindungan kata sandi dari kunci pribadi:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"openssl rsa -in ca.key -out ca.key\n"))))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Hasilkan kunci pribadi untuk server webhook:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out server.key 2048\nopenssl rsa -in server.key -out server.key\n"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Gunakan CA yang dihasilkan sendiri untuk menandatangani sertifikat untuk webhook:"),(0,t.kt)("ul",{parentName:"li"},(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Salin file konfigurasi openssl sistem Anda untuk penggunaan sementara. Anda dapat menemukan lokasi file konfigurasi dengan menjalankan ",(0,t.kt)("inlineCode",{parentName:"p"},"openssl version -a"),", biasanya disebut ",(0,t.kt)("inlineCode",{parentName:"p"},"openssl.cnf"),".")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Dalam file konfigurasi:"),(0,t.kt)("ul",{parentName:"li"},(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Temukan paragraf ",(0,t.kt)("inlineCode",{parentName:"p"},"[req]")," dan tambahkan baris berikut: ",(0,t.kt)("inlineCode",{parentName:"p"},"req_extensions = v3_req"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Temukan paragraf ",(0,t.kt)("inlineCode",{parentName:"p"},"[v3_req]")," dan tambahkan baris berikut: ",(0,t.kt)("inlineCode",{parentName:"p"},"subjectAltName = @alt_names"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Tambahkan baris berikut ke file:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-ini"},"[alt_names]\nDNS.2=<The domain you want>\n")),(0,t.kt)("p",{parentName:"li"},"Catatan: Ganti 'casbin-webhook-svc.default.svc' dengan nama layanan sebenarnya Anda sendiri jika Anda memutuskan untuk mengubah nama layanan.")))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Gunakan file konfigurasi yang dimodifikasi untuk menghasilkan file permintaan sertifikat:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"openssl req -new -nodes -keyout server.key -out server.csr -config openssl.cnf\n"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Gunakan CA buatan sendiri untuk merespon permintaan dan menandatangani sertifikat:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"openssl x509 -req -days 3650 -in server.csr -out server.crt -CA ca.crt -CAkey ca.key -CAcreateserial -extensions v3_req -extensions SAN -extfile openssl.cnf\n"))))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Ganti field 'CABundle': Perbarui field ini dengan sertifikat baru.")),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"Jika Anda menggunakan helm, perubahan serupa perlu diterapkan pada bagan helm."))),(0,t.kt)("h4",{id:"512-sertifikat-legal"},"5.1.2 Sertifikat Legal"),(0,t.kt)("p",null,'Jika Anda menggunakan sertifikat legal, Anda tidak perlu melalui semua prosedur ini. Hapus field "CABundle" di ',(0,t.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," dan ",(0,t.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),", dan ubah domain dalam file-file ini menjadi domain yang Anda miliki."))}p.isMDXComponent=!0}}]);