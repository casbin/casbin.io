<!doctype html>
<html lang="vi" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-k8s-gatekeeper" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Admission Webhook for K8s | Casbin</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://casbin.org/vi/docs/k8s-gatekeeper"><meta data-rh="true" name="docusaurus_locale" content="vi"><meta data-rh="true" name="docsearch:language" content="vi"><meta data-rh="true" name="Casbin" content="An authorization library that supports access control models like ACL, RBAC, ABAC for Golang, Java, C/C++, Node.js, Javascript, PHP, Laravel, Python, .NET (C#), Delphi, Rust, Ruby, Swift (Objective-C), Lua (OpenResty), Dart (Flutter) and Elixir"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Admission Webhook for K8s | Casbin"><meta data-rh="true" name="description" content="Kubernetes (K8s) RBAC &amp; ABAC Authorization Middleware dựa trên Casbin"><meta data-rh="true" property="og:description" content="Kubernetes (K8s) RBAC &amp; ABAC Authorization Middleware dựa trên Casbin"><meta data-rh="true" name="keywords" content="k8s-gatekeeper,Kubernetes,K8s"><link data-rh="true" rel="icon" href="/vi/img/favicon.png"><link data-rh="true" rel="canonical" href="https://casbin.org/vi/docs/k8s-gatekeeper"><link data-rh="true" rel="alternate" href="https://casbin.org/docs/k8s-gatekeeper" hreflang="en"><link data-rh="true" rel="alternate" href="https://casbin.org/zh/docs/k8s-gatekeeper" hreflang="zh"><link data-rh="true" rel="alternate" href="https://casbin.org/ko/docs/k8s-gatekeeper" hreflang="ko"><link data-rh="true" rel="alternate" href="https://casbin.org/ru/docs/k8s-gatekeeper" hreflang="ru"><link data-rh="true" rel="alternate" href="https://casbin.org/fr/docs/k8s-gatekeeper" hreflang="fr"><link data-rh="true" rel="alternate" href="https://casbin.org/de/docs/k8s-gatekeeper" hreflang="de"><link data-rh="true" rel="alternate" href="https://casbin.org/ja/docs/k8s-gatekeeper" hreflang="ja"><link data-rh="true" rel="alternate" href="https://casbin.org/es/docs/k8s-gatekeeper" hreflang="es"><link data-rh="true" rel="alternate" href="https://casbin.org/pt/docs/k8s-gatekeeper" hreflang="pt"><link data-rh="true" rel="alternate" href="https://casbin.org/uk/docs/k8s-gatekeeper" hreflang="uk"><link data-rh="true" rel="alternate" href="https://casbin.org/th/docs/k8s-gatekeeper" hreflang="th"><link data-rh="true" rel="alternate" href="https://casbin.org/ar/docs/k8s-gatekeeper" hreflang="ar"><link data-rh="true" rel="alternate" href="https://casbin.org/id/docs/k8s-gatekeeper" hreflang="id"><link data-rh="true" rel="alternate" href="https://casbin.org/vi/docs/k8s-gatekeeper" hreflang="vi"><link data-rh="true" rel="alternate" href="https://casbin.org/it/docs/k8s-gatekeeper" hreflang="it"><link data-rh="true" rel="alternate" href="https://casbin.org/ms/docs/k8s-gatekeeper" hreflang="ms"><link data-rh="true" rel="alternate" href="https://casbin.org/tr/docs/k8s-gatekeeper" hreflang="tr"><link data-rh="true" rel="alternate" href="https://casbin.org/docs/k8s-gatekeeper" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6NBEV8TOFK-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/vi/blog/rss.xml" title="Casbin RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/vi/blog/atom.xml" title="Casbin Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8S2TKCJ27X"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8S2TKCJ27X",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Casbin" href="/vi/opensearch.xml">
<script src="/js/isMainland.js" async></script>
<script src="/js/hotjar.js" async></script>
<script src="/js/probe.js" async></script>
<script src="/js/clarity.js" async></script><link rel="stylesheet" href="/vi/assets/css/styles.7fd4a8f6.css">
<link rel="preload" href="/vi/assets/js/runtime~main.50efc54a.js" as="script">
<link rel="preload" href="/vi/assets/js/main.f00983a6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Bỏ qua đến nội dung chính"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Bỏ qua đến nội dung chính</a></div><nav aria-label="Chính" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Chuyển đổi thanh điều hướng" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/vi/"><div class="navbar__logo"><img src="/vi/img/casbin.svg" alt="Logo Trang Của Tôi" class="themedImage_ToTc themedImage--light_HNdA"><img src="/vi/img/casbin.svg" alt="Logo Trang Của Tôi" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Casbin</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/vi/docs/overview">Tài liệu</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/vi/docs/get-started">Bắt đầu</a></li><li><a class="dropdown__link" href="/vi/docs/category/model">Mô hình</a></li><li><a class="dropdown__link" href="/vi/docs/category/storage">Lưu trữ</a></li><li><a class="dropdown__link" href="/vi/docs/adapters">Bộ điều hợp</a></li><li><a class="dropdown__link" href="/vi/docs/category/api">API</a></li><li><a class="dropdown__link" href="/vi/docs/ide-plugins">Plugin IDE</a></li><li><a class="dropdown__link" href="/vi/docs/contributing">Bắt đầu Đóng góp</a></li></ul></div><a class="navbar__item navbar__link" href="/vi/ecosystem">Hệ sinh thái</a><a class="navbar__item navbar__link" href="/vi/blog">Blog</a><a class="navbar__item navbar__link" href="/vi/help">Trợ giúp</a><a class="navbar__item navbar__link" href="/vi/editor">Trình soạn thảo</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Tiếng Việt</a><ul class="dropdown__menu"><li><a href="/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">中文</a></li><li><a href="/ko/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ko">한국어</a></li><li><a href="/ru/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ru">Русский</a></li><li><a href="/fr/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="fr">Français</a></li><li><a href="/de/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="de">Deutsch</a></li><li><a href="/ja/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li><li><a href="/es/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="es">Español</a></li><li><a href="/pt/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="pt">Português</a></li><li><a href="/uk/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="uk">Українська</a></li><li><a href="/th/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="th">ไทย</a></li><li><a href="/ar/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ar">العربية</a></li><li><a href="/id/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="id">Indonesia</a></li><li><a href="/vi/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="vi">Tiếng Việt</a></li><li><a href="/it/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="it">Italiano</a></li><li><a href="/ms/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ms">Melayu</a></li><li><a href="/tr/docs/k8s-gatekeeper" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="tr">Türkçe</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://crowdin.com/project/casbin-website" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help Us Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/casbin/casbin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://discord.gg/S5UjpzGZjN" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-community-discord"></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Tìm kiếm"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Tìm kiếm</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Chuyển đổi giữa chế độ tối và sáng (hiện tại là chế độ sáng)" aria-label="Chuyển đổi giữa chế độ tối và sáng (hiện tại là chế độ sáng)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Cuộn lại đầu trang" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/vi/"><img src="/vi/img/casbin.svg" alt="Logo Trang Của Tôi" class="themedImage_ToTc themedImage--light_HNdA"><img src="/vi/img/casbin.svg" alt="Logo Trang Của Tôi" class="themedImage_ToTc themedImage--dark_i4oU"><b>Casbin</b></a><nav aria-label="Thanh bên tài liệu" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/vi/docs/category/the-basics">Những điều cơ bản</a><button aria-label="Chuyển đổi danh mục thanh bên có thể thu gọn &#x27;Những điều cơ bản&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/get-started">Get Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/how-it-works">How It Works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/tutorials">Tutorials</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/understanding-casbin-detail">Understanding How Casbin Matching Works in Detail</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/pdf">Tải xuống PDF</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/vi/docs/category/model">Mô hình</a><button aria-label="Chuyển đổi danh mục thanh bên có thể thu gọn &#x27;Mô hình&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/supported-models">Supported Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/syntax-for-models">Syntax for Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/effector">Effector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/function">Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/rbac">RBAC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/rbac-with-pattern">RBAC with Pattern</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/rbac-with-domains">RBAC with Domains</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/rbac-with-conditions">RBAC with Conditions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/rbac-96">Casbin RBAC vs. RBAC96</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/abac">ABAC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/priority-model">Priority Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/superadmin">Super Admin</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/vi/docs/category/storage">Lưu trữ</a><button aria-label="Chuyển đổi danh mục thanh bên có thể thu gọn &#x27;Lưu trữ&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/model-storage">Model Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/policy-storage">Policy Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/policy-subset-loading">Policy Subset Loading</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/vi/docs/category/scenarios">Kịch bản</a><button aria-label="Chuyển đổi danh mục thanh bên có thể thu gọn &#x27;Kịch bản&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/data-permissions">Data Permissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/menu-permissions">Menu Permissions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/vi/docs/category/extensions">Mở rộng</a><button aria-label="Chuyển đổi danh mục thanh bên có thể thu gọn &#x27;Mở rộng&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/enforcers">Enforcers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/adapters">Adapters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/watchers">Watchers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/dispatchers">Dispatchers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/role-managers">Role Managers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/middlewares">Middlewares</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/graphql-middlewares">GraphQL Middlewares</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/cloud-native">Cloud Native Middlewares</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/vi/docs/category/api">API</a><button aria-label="Chuyển đổi danh mục thanh bên có thể thu gọn &#x27;API&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/api-overview">API Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/management-api">Management API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/rbac-api">RBAC API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/rbac-with-domains-api">RBAC with Domains API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/rbac-with-conditions-api">RBAC with Conditions API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/rolemanager-api">RoleManager API</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/vi/docs/category/advanced-usage">Sử dụng nâng cao</a><button aria-label="Chuyển đổi danh mục thanh bên có thể thu gọn &#x27;Sử dụng nâng cao&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/multi-threading">Multi-threading</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/benchmark">Benchmarks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/performance">Performance Optimization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/k8s">Authorization of Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/vi/docs/k8s-gatekeeper">Admission Webhook for K8s</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/envoy">Authorization of Service Mesh through Envoy</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/vi/docs/category/management">Quản lý</a><button aria-label="Chuyển đổi danh mục thanh bên có thể thu gọn &#x27;Quản lý&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/admin-portal">Admin Portal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/service">Casbin Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/log-error">Log &amp; Error Handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/frontend">Frontend Usage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/vi/docs/category/editor">Trình soạn thảo</a><button aria-label="Chuyển đổi danh mục thanh bên có thể thu gọn &#x27;Trình soạn thảo&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/online-editor">Online Editor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/ide-plugins">IDE Plugins</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/vi/docs/category/more">Thêm</a><button aria-label="Chuyển đổi danh mục thanh bên có thể thu gọn &#x27;Thêm&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/adopters">Our Adopters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/contributing">Contributing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/privacy-policy">Privacy Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/terms-of-service">Terms of Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vi/docs/refund-policy">Refund Policy</a></li></ul></li></ul></nav><button type="button" title="Thu gọn thanh bên" aria-label="Thu gọn thanh bên" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Đường dẫn"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Trang chủ" class="breadcrumbs__link" href="/vi/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/vi/docs/category/advanced-usage"><span itemprop="name">Sử dụng nâng cao</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Admission Webhook for K8s</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Trên trang này</button></div><div class="theme-doc-markdown markdown"><header><h1>Admission Webhook for K8s</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-tổng-quan--tài-liệu-cho-casbin-k8s-gatekeeper">1. Tổng quan &amp; Tài liệu cho Casbin K8s-Gatekeeper<a href="#1-tổng-quan--tài-liệu-cho-casbin-k8s-gatekeeper" class="hash-link" aria-label="Đường dẫn trực tiếp đến 1. Tổng quan &amp; Tài liệu cho Casbin K8s-Gatekeeper" title="Đường dẫn trực tiếp đến 1. Tổng quan &amp; Tài liệu cho Casbin K8s-Gatekeeper">​</a></h2><p>Casbin K8s-GateKeeper là một webhook kiểm soát truy cập của Kubernetes tích hợp Casbin như công cụ Quản lý Truy cập. Bằng cách sử dụng Casbin K8s-GateKeeper, bạn có thể thiết lập các quy tắc linh hoạt để ủy quyền hoặc chặn bất kỳ hoạt động nào trên tài nguyên K8s, KHÔNG CẦN viết bất kỳ đoạn mã nào, chỉ với một vài dòng cấu hình khai báo của mô hình và chính sách Casbin, đó là một phần của ngôn ngữ ACL (Access Control List) của Casbin.</p><p>Casbin K8s-GateKeeper được phát triển và bảo trì bởi cộng đồng Casbin. Kho lưu trữ của dự án này có sẵn tại đây: <a href="https://github.com/casbin/k8s-gatekeeper" target="_blank" rel="noopener noreferrer">https://github.com/casbin/k8s-gatekeeper</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="01-ví-dụ-đơn-giản">0.1 Ví dụ Đơn Giản<a href="#01-ví-dụ-đơn-giản" class="hash-link" aria-label="Đường dẫn trực tiếp đến 0.1 Ví dụ Đơn Giản" title="Đường dẫn trực tiếp đến 0.1 Ví dụ Đơn Giản">​</a></h3><p>Ví dụ, bạn không cần phải viết bất kỳ mã nào, nhưng sử dụng các dòng cấu hình sau để đạt được chức năng này: &quot;Cấm sử dụng các image có những tag được chỉ định trong bất kỳ deployment nào&quot;:</p><p>Model:</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">request_definition</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">r</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain">  </span><span class="token value attr-value" style="color:#e3116c">obj</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">policy_definition</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">p</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain">  </span><span class="token value attr-value" style="color:#e3116c">obj,eft</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">policy_effect</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">e</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">!some(where (p.eft == deny))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">matchers</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">m</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">r.obj.Request.Namespace == &quot;default&quot; &amp;&amp; r.obj.Request.Resource.Resource ==&quot;deployments&quot; &amp;&amp; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contain(split(accessWithWildcard(${OBJECT}.Spec.Template.Spec.Containers , &quot;*&quot;, &quot;Image&quot;),&quot;:&quot;,1) , p.obj)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And Policy:</p><div class="language-csv codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csv codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token value">p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> </span><span class="token value">&quot;1.14.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value">deny</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Đây là trong ngôn ngữ ACL thông thường của Casbin. Giả sử bạn đã đọc các chương về chúng, nó sẽ rất dễ hiểu.</p><p>Casbin K8s-GateKeeper có những ưu điểm sau:</p><ul><li>Dễ sử dụng. Viết một vài dòng mã ACL tốt hơn nhiều so với viết một lượng lớn mã nguồn.</li><li>Nó cho phép cập nhật cấu hình nóng. Bạn không cần phải tắt toàn bộ plugin để sửa đổi cấu hình.</li><li>Nó rất linh hoạt. Có thể tạo các quy tắc tùy ý trên bất kỳ tài nguyên K8s nào, có thể khám phá với <code>kubectl gatekeeper</code>.</li><li>Nó đơn giản hóa việc triển khai webhook kiểm soát truy cập K8s, điều này rất phức tạp. Bạn không cần biết webhook kiểm soát truy cập K8s là gì hoặc làm thế nào để viết mã cho nó. Tất cả những gì bạn cần làm là biết tài nguyên mà bạn muốn đặt ràng buộc và sau đó viết mã ACL Casbin. Mọi người đều biết rằng K8s rất phức tạp, nhưng bằng cách sử dụng Casbin K8s-Gatekeeper, thời gian của bạn có thể được tiết kiệm.</li><li>Nó được duy trì bởi cộng đồng Casbin. Hãy thoải mái liên hệ với chúng tôi nếu bạn có bất kỳ thắc mắc nào về plugin này hoặc gặp phải bất kỳ vấn đề gì khi thử nghiệm.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-cách-casbin-k8s-gatekeeper-hoạt-động">1.1 Cách Casbin K8s-Gatekeeper hoạt động?<a href="#11-cách-casbin-k8s-gatekeeper-hoạt-động" class="hash-link" aria-label="Đường dẫn trực tiếp đến 1.1 Cách Casbin K8s-Gatekeeper hoạt động?" title="Đường dẫn trực tiếp đến 1.1 Cách Casbin K8s-Gatekeeper hoạt động?">​</a></h3><p>K8s-Gatekeeper là một admission webhook cho K8s sử dụng <a href="/vi/docs/overview">Casbin</a> để áp dụng các quy tắc kiểm soát truy cập do người dùng định nghĩa tùy ý, giúp ngăn chặn bất kỳ hoạt động nào trên K8s mà quản trị viên không muốn.</p><p>Casbin là một thư viện kiểm soát truy cập mã nguồn mở mạnh mẽ và hiệu quả. Nó cung cấp hỗ trợ cho việc thực thi ủy quyền dựa trên nhiều mô hình kiểm soát truy cập khác nhau. Để biết thêm chi tiết về Casbin, hãy xem <a href="/vi/docs/overview">Tổng quan</a>.</p><p>Admission webhooks trong K8s là các cuộc gọi lại HTTP nhận &#x27;yêu cầu admission&#x27; và thực hiện một việc gì đó với chúng. Đặc biệt, K8s-Gatekeeper là một loại admission webhook đặc biệt: &#x27;ValidatingAdmissionWebhook&#x27;, có thể quyết định chấp nhận hay từ chối yêu cầu admission này. Đối với yêu cầu admission, chúng là các yêu cầu HTTP mô tả một hoạt động trên các tài nguyên được chỉ định của K8s (ví dụ: tạo/xóa một deployment). Để biết thêm về admission webhooks, hãy xem <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks" target="_blank" rel="noopener noreferrer">Tài liệu chính thức của K8s</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12-một-ví-dụ-minh-họa-cách-nó-hoạt-động">1.2 Một Ví Dụ Minh Họa Cách Nó Hoạt Động<a href="#12-một-ví-dụ-minh-họa-cách-nó-hoạt-động" class="hash-link" aria-label="Đường dẫn trực tiếp đến 1.2 Một Ví Dụ Minh Họa Cách Nó Hoạt Động" title="Đường dẫn trực tiếp đến 1.2 Một Ví Dụ Minh Họa Cách Nó Hoạt Động">​</a></h3><p>Ví dụ, khi ai đó muốn tạo một bản triển khai chứa một pod chạy nginx (sử dụng kubectl hoặc các client K8s), K8s sẽ tạo ra một yêu cầu nhập cảnh, mà (nếu được dịch sang định dạng YAML) có thể giống như thế này:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.14.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Yêu cầu này sẽ đi qua quá trình xử lý của tất cả các middleware được hiển thị trong hình, bao gồm cả K8s-Gatekeeper của chúng tôi. K8s-Gatekeeper có thể phát hiện tất cả các enforcer Casbin được lưu trữ trong etcd của K8s, được tạo và duy trì bởi người dùng (thông qua <code>kubectl</code> hoặc client Go mà chúng tôi cung cấp). Mỗi enforcer chứa một mô hình Casbin và một chính sách Casbin. Yêu cầu nhập cảnh sẽ được xử lý bởi từng enforcer, một cách tuần tự, và chỉ khi vượt qua tất cả các enforcer thì yêu cầu mới được chấp nhận bởi K8s-Gatekeeper này.</p><p>(Nếu bạn không hiểu enforcer Casbin, mô hình, hoặc chính sách là gì, hãy xem tài liệu này: <a href="/vi/docs/get-started">Bắt Đầu</a>).</p><p>Ví dụ, vì một lý do nào đó, người quản trị muốn cấm sự xuất hiện của image &#x27;nginx:1.14.1&#x27; trong khi cho phép &#x27;nginx:1.3.1&#x27;. Một enforcer chứa quy tắc và chính sách sau có thể được tạo ra (Chúng tôi sẽ giải thích cách tạo một enforcer, mô hình và chính sách là gì, và cách viết chúng trong các chương tiếp theo).</p><p>Model:</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">request_definition</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">r</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain">  </span><span class="token value attr-value" style="color:#e3116c">obj</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">policy_definition</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">p</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain">  </span><span class="token value attr-value" style="color:#e3116c">obj,eft</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">policy_effect</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">e</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">!some(where (p.eft == deny))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">matchers</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">m</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">r.obj.Request.Namespace == &quot;default&quot; &amp;&amp; r.obj.Request.Resource.Resource ==&quot;deployments&quot; &amp;&amp; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, &quot;Image&quot;)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">= p.obj</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Policy:</p><div class="language-csv codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csv codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token value">p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> </span><span class="token value">&quot;nginx:1.13.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value">allow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token value">p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> </span><span class="token value">&quot;nginx:1.14.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value">deny</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Bằng cách tạo một enforcer chứa mô hình và chính sách ở trên, yêu cầu nhập cảnh trước đó sẽ bị từ chối bởi enforcer này, điều đó có nghĩa là K8s sẽ không tạo ra bộ triển khai này.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-cài-đặt-k8s-gatekeeper">2 Cài đặt K8s-gatekeeper<a href="#2-cài-đặt-k8s-gatekeeper" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2 Cài đặt K8s-gatekeeper" title="Đường dẫn trực tiếp đến 2 Cài đặt K8s-gatekeeper">​</a></h2><p>Có ba phương pháp có sẵn để cài đặt K8s-gatekeeper: Webhook bên ngoài, Webhook nội bộ và Helm.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>ghi chú</div><div class="admonitionContent_S0QG"><p>Lưu ý: Những phương pháp này chỉ dành cho người dùng thử nghiệm K8s-gatekeeper và không an toàn. Nếu bạn muốn sử dụng nó trong môi trường sản xuất, vui lòng đảm bảo rằng bạn đã đọc <a href="#5-advanced-settings">Chương 5. Cài đặt nâng cao</a> và thực hiện bất kỳ sửa đổi cần thiết nào trước khi cài đặt.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-webhook-nội-bộ">2.1 Webhook nội bộ<a href="#21-webhook-nội-bộ" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2.1 Webhook nội bộ" title="Đường dẫn trực tiếp đến 2.1 Webhook nội bộ">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="211-bước-1-xây-dựng-hình-ảnh">2.1.1 Bước 1: Xây dựng hình ảnh<a href="#211-bước-1-xây-dựng-hình-ảnh" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2.1.1 Bước 1: Xây dựng hình ảnh" title="Đường dẫn trực tiếp đến 2.1.1 Bước 1: Xây dựng hình ảnh">​</a></h4><p>Đối với phương pháp webhook nội bộ, chính webhook sẽ được triển khai như một dịch vụ trong Kubernetes. Để tạo dịch vụ và triển khai cần thiết, bạn cần xây dựng một hình ảnh của K8s-gatekeeper. Bạn có thể xây dựng hình ảnh của riêng mình bằng cách chạy lệnh sau:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build --target webhook -t k8s-gatekeeper </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Lệnh này sẽ tạo một hình ảnh cục bộ có tên &#x27;k8s-gatekeeper:latest&#x27;.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>ghi chú</div><div class="admonitionContent_S0QG"><p>Lưu ý: Nếu bạn đang sử dụng minikube, vui lòng thực hiện <code>eval $(minikube -p minikube docker-env)</code> trước khi chạy &#x27;docker build&#x27;.</p></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="212-bước-2-thiết-lập-dịch-vụ-và-triển-khai-cho-k8s-gatekeeper">2.1.2 Bước 2: Thiết lập dịch vụ và triển khai cho K8s-gatekeeper<a href="#212-bước-2-thiết-lập-dịch-vụ-và-triển-khai-cho-k8s-gatekeeper" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2.1.2 Bước 2: Thiết lập dịch vụ và triển khai cho K8s-gatekeeper" title="Đường dẫn trực tiếp đến 2.1.2 Bước 2: Thiết lập dịch vụ và triển khai cho K8s-gatekeeper">​</a></h4><p>Chạy các lệnh sau:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f config/rbac.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f config/webhook_deployment.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f config/webhook_internal.yaml </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Điều này sẽ bắt đầu chạy K8s-gatekeeper, và bạn có thể xác nhận điều này bằng cách chạy <code>kubectl get pods</code>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="213-bước-3-cài-đặt-tài-nguyên-crd-cho-k8s-gatekeeper">2.1.3 Bước 3: Cài đặt Tài nguyên CRD cho K8s-gatekeeper<a href="#213-bước-3-cài-đặt-tài-nguyên-crd-cho-k8s-gatekeeper" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2.1.3 Bước 3: Cài đặt Tài nguyên CRD cho K8s-gatekeeper" title="Đường dẫn trực tiếp đến 2.1.3 Bước 3: Cài đặt Tài nguyên CRD cho K8s-gatekeeper">​</a></h4><p>Chạy các lệnh sau:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f config/auth.casbin.org_casbinmodels.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f config/auth.casbin.org_casbinpolicies.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22-webhook-bên-ngoài">2.2 Webhook bên ngoài<a href="#22-webhook-bên-ngoài" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2.2 Webhook bên ngoài" title="Đường dẫn trực tiếp đến 2.2 Webhook bên ngoài">​</a></h3><p>Đối với phương thức webhook bên ngoài, K8s-gatekeeper sẽ chạy bên ngoài Kubernetes, và Kubernetes sẽ truy cập K8s-gatekeeper như thể nó truy cập một trang web thông thường. Kubernetes có một yêu cầu bắt buộc là webhook kiểm soát truy cập phải sử dụng giao thức HTTPS. Vì mục đích thử nghiệm K8s-gatekeeper, chúng tôi đã cung cấp một bộ chứng chỉ và một khóa riêng (mặc dù điều này không an toàn). Nếu bạn muốn sử dụng chứng chỉ của riêng mình, vui lòng tham khảo <a href="#5-advanced-settings">Chương 5. Cài đặt nâng cao</a> để được hướng dẫn điều chỉnh chứng chỉ và khóa riêng. Chứng chỉ mà chúng tôi cung cấp được cấp cho &#x27;webhook.domain.local&#x27;.</p><p>Vì vậy, hãy sửa đổi máy chủ (ví dụ: /etc/hosts) và trỏ &#x27;webhook.domain.local&#x27; đến địa chỉ IP mà K8s-gatekeeper đang chạy. Sau đó thực hiện lệnh sau:</p><p>2.3 Cài đặt K8s-gatekeeper thông qua Helm</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go mod tidy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go mod vendor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go run cmd/webhook/main.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f config/auth.casbin.org_casbinmodels.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f config/auth.casbin.org_casbinpolicies.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f config/webhook_external.yaml </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="231-bước-1-xây-dựng-hình-ảnh">2.3.1 Bước 1: Xây dựng hình ảnh<a href="#231-bước-1-xây-dựng-hình-ảnh" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2.3.1 Bước 1: Xây dựng hình ảnh" title="Đường dẫn trực tiếp đến 2.3.1 Bước 1: Xây dựng hình ảnh">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="231-adım-1-görüntüyü-oluşturun">2.3.1 Adım 1: Görüntüyü oluşturun<a href="#231-adım-1-görüntüyü-oluşturun" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2.3.1 Adım 1: Görüntüyü oluşturun" title="Đường dẫn trực tiếp đến 2.3.1 Adım 1: Görüntüyü oluşturun">​</a></h4><p>Vui lòng tham khảo <a href="#211-step-1-build-the-image">Chương 2.1.1</a>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="232-cài-đặt-helm">2.3.2 Cài đặt Helm<a href="#232-cài-đặt-helm" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2.3.2 Cài đặt Helm" title="Đường dẫn trực tiếp đến 2.3.2 Cài đặt Helm">​</a></h4><p>Chạy lệnh <code>helm install k8sgatekeeper ./k8sgatekeeper</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-thử-k8s-gatekeeper">3. Thử K8s-gatekeeper<a href="#3-thử-k8s-gatekeeper" class="hash-link" aria-label="Đường dẫn trực tiếp đến 3. Thử K8s-gatekeeper" title="Đường dẫn trực tiếp đến 3. Thử K8s-gatekeeper">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-tạo-mô-hình-và-chính-sách-casbin">3.1 Tạo Mô hình và Chính sách Casbin<a href="#31-tạo-mô-hình-và-chính-sách-casbin" class="hash-link" aria-label="Đường dẫn trực tiếp đến 3.1 Tạo Mô hình và Chính sách Casbin" title="Đường dẫn trực tiếp đến 3.1 Tạo Mô hình và Chính sách Casbin">​</a></h3><p>Bạn có hai phương pháp để tạo một mô hình và chính sách: thông qua kubectl hoặc thông qua go-client mà chúng tôi cung cấp.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="311-tạocập-nhật-mô-hình-và-chính-sách-casbin-qua-kubectl">3.1.1 Tạo/Cập nhật Mô hình và Chính sách Casbin qua kubectl<a href="#311-tạocập-nhật-mô-hình-và-chính-sách-casbin-qua-kubectl" class="hash-link" aria-label="Đường dẫn trực tiếp đến 3.1.1 Tạo/Cập nhật Mô hình và Chính sách Casbin qua kubectl" title="Đường dẫn trực tiếp đến 3.1.1 Tạo/Cập nhật Mô hình và Chính sách Casbin qua kubectl">​</a></h4><p>Trong K8s-gatekeeper, mô hình Casbin được lưu trữ trong một tài nguyên CRD có tên là &#x27;CasbinModel&#x27;. Định nghĩa của nó nằm trong <code>config/auth.casbin.org_casbinmodels.yaml</code>.</p><p>Có ví dụ trong <code>example/allowed_repo/model.yaml</code>. Chú ý đến các trường sau:</p><ul><li>metadata.name: tên của mô hình. Tên này PHẢI giống với tên của đối tượng CasbinPolicy liên quan đến mô hình này, để K8s-gatekeeper có thể ghép cặp chúng và tạo một enforcer.</li><li>spec.enable: nếu trường này được đặt thành &quot;false&quot;, mô hình này (cũng như đối tượng CasbinPolicy liên quan đến mô hình này) sẽ bị bỏ qua.</li><li>spec.modelText: một chuỗi chứa văn bản mô hình của một mô hình Casbin.</li></ul><p>Chính sách Casbin được lưu trữ trong một tài nguyên CRD khác được gọi là &#x27;CasbinPolicy&#x27;, định nghĩa của nó có thể được tìm thấy trong <code>config/auth.casbin.org_casbinpolicies.yaml</code>.</p><p>Có ví dụ trong <code>example/allowed_repo/policy.yaml</code>. Chú ý đến các trường sau:</p><ul><li>metadata.name: tên của chính sách. Tên này PHẢI giống với tên của đối tượng CasbinModel liên quan đến chính sách này, để K8s-gatekeeper có thể ghép cặp chúng và tạo ra một enforcer.</li><li>spec.policyItem: một chuỗi chứa văn bản chính sách của một mô hình Casbin.</li></ul><p>Sau khi tạo các tệp CasbinModel và CasbinPolicy của riêng bạn, sử dụng lệnh sau để áp dụng chúng:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">filename</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Một khi một cặp CasbinModel và CasbinPolicy được tạo, K8s-gatekeeper sẽ có thể phát hiện nó trong vòng 5 giây.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="312-tạocập-nhật-mô-hình-và-chính-sách-casbin-thông-qua-go-client-mà-chúng-tôi-cung-cấp">3.1.2 Tạo/Cập nhật Mô hình và Chính sách Casbin thông qua go-client mà chúng tôi cung cấp<a href="#312-tạocập-nhật-mô-hình-và-chính-sách-casbin-thông-qua-go-client-mà-chúng-tôi-cung-cấp" class="hash-link" aria-label="Đường dẫn trực tiếp đến 3.1.2 Tạo/Cập nhật Mô hình và Chính sách Casbin thông qua go-client mà chúng tôi cung cấp" title="Đường dẫn trực tiếp đến 3.1.2 Tạo/Cập nhật Mô hình và Chính sách Casbin thông qua go-client mà chúng tôi cung cấp">​</a></h4><p>Chúng tôi hiểu rằng có thể có tình huống mà việc sử dụng shell để thực thi các lệnh trực tiếp trên một nút của cụm K8s không thuận tiện, chẳng hạn như khi bạn đang xây dựng một nền tảng điện toán đám mây tự động cho công ty của mình. Do đó, chúng tôi đã phát triển một go-client để tạo và duy trì CasbinModel và CasbinPolicy.</p><p>Thư viện go-client nằm trong <code>pkg/client</code>.</p><p>Trong <code>client.go</code>, chúng tôi cung cấp một hàm để tạo một client.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewK8sGateKeeperClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">externalClient </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">K8sGateKeeperClient</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Tham số <code>externalClient</code> xác định liệu K8s-gatekeeper có đang chạy bên trong cụm K8s hay không.</p><p>Trong <code>model.go</code>, chúng tôi cung cấp nhiều hàm để tạo, xóa và sửa đổi CasbinModel. Bạn có thể tìm hiểu cách sử dụng các giao diện này trong <code>model_test.go</code>.</p><p>Trong <code>policy.go</code>, chúng tôi cung cấp nhiều hàm để tạo, xóa và sửa đổi CasbiPolicy. Bạn có thể tìm hiểu cách sử dụng các giao diện này trong <code>policy_test.go</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="312-thử-xem-k8s-gatekeeper-có-hoạt-động-không">3.1.2 Thử xem K8s-gatekeeper có hoạt động không<a href="#312-thử-xem-k8s-gatekeeper-có-hoạt-động-không" class="hash-link" aria-label="Đường dẫn trực tiếp đến 3.1.2 Thử xem K8s-gatekeeper có hoạt động không" title="Đường dẫn trực tiếp đến 3.1.2 Thử xem K8s-gatekeeper có hoạt động không">​</a></h3><p>Giả sử bạn đã tạo chính xác mô hình và chính sách trong <code>example/allowed_repo</code>. Bây giờ, hãy thử lệnh sau:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f example/allowed_repo/testcase/reject_1.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Bạn sẽ thấy rằng K8s sẽ từ chối yêu cầu này và đề cập rằng webhook là lý do tại sao yêu cầu này bị từ chối. Tuy nhiên, khi bạn thử áp dụng <code>example/allowed_repo/testcase/approve_2.yaml</code>, nó sẽ được chấp nhận.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-cách-viết-mô-hình-và-chính-sách-với-k8s-gatekeeper">4. Cách Viết Mô hình và Chính sách với K8s-gatekeeper<a href="#4-cách-viết-mô-hình-và-chính-sách-với-k8s-gatekeeper" class="hash-link" aria-label="Đường dẫn trực tiếp đến 4. Cách Viết Mô hình và Chính sách với K8s-gatekeeper" title="Đường dẫn trực tiếp đến 4. Cách Viết Mô hình và Chính sách với K8s-gatekeeper">​</a></h2><p>Trước hết, hãy đảm bảo bạn quen thuộc với cú pháp cơ bản của Mô hình và Chính sách Casbin. Nếu không, vui lòng đọc phần <a href="/vi/docs/get-started">Bắt đầu</a> trước. Trong chương này, chúng tôi giả định rằng bạn đã hiểu Mô hình và Chính sách Casbin là gì.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41-định-nghĩa-yêu-cầu-của-mô-hình">4.1 Định nghĩa Yêu cầu của Mô hình<a href="#41-định-nghĩa-yêu-cầu-của-mô-hình" class="hash-link" aria-label="Đường dẫn trực tiếp đến 4.1 Định nghĩa Yêu cầu của Mô hình" title="Đường dẫn trực tiếp đến 4.1 Định nghĩa Yêu cầu của Mô hình">​</a></h3><p>Khi K8s-gatekeeper đang cấp quyền cho một yêu cầu, đầu vào luôn là một đối tượng: đối tượng Go của Yêu cầu Nhập cảnh. Điều này có nghĩa là enforcer sẽ luôn được sử dụng như thế này:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> enforcer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Enforce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">admission</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>trong đó <code>admission</code> là một đối tượng <code>AdmissionReview</code> được định nghĩa bởi api chính thức của K8s <code>&quot;k8s.io/api/admission/v1&quot;</code>. Bạn có thể tìm thấy định nghĩa của cấu trúc này trong kho lưu trữ này: <a href="https://github.com/kubernetes/api/blob/master/admission/v1/types.go" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/api/blob/master/admission/v1/types.go</a>. Để biết thêm thông tin, bạn cũng có thể tham khảo <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response</a>.</p><p>Do đó, đối với bất kỳ mô hình nào được sử dụng bởi K8s-gatekeeper, định nghĩa của <code>request_definition</code> luôn phải như sau:</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">request_definition</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key attr-name" style="color:#00a4db">r</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain">  </span><span class="token value attr-value" style="color:#e3116c">obj</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Tên &#x27;obj&#x27; không bắt buộc, miễn là tên đó nhất quán với tên được sử dụng trong phần <code>[matchers]</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42-matchers-của-mô-hình">4.2 Matchers của Mô hình<a href="#42-matchers-của-mô-hình" class="hash-link" aria-label="Đường dẫn trực tiếp đến 4.2 Matchers của Mô hình" title="Đường dẫn trực tiếp đến 4.2 Matchers của Mô hình">​</a></h3><p>Bạn được kỳ vọng sử dụng tính năng ABAC của Casbin để viết các quy tắc của bạn. Tuy nhiên, bộ đánh giá biểu thức tích hợp trong Casbin không hỗ trợ lập chỉ mục trong bản đồ hoặc mảng (slices), cũng như không hỗ trợ mở rộng mảng. Do đó, K8s-gatekeeper cung cấp các &#x27;hàm Casbin&#x27; khác nhau như các phần mở rộng để thực hiện các tính năng này. Nếu bạn vẫn thấy rằng nhu cầu của bạn không thể được đáp ứng bởi các phần mở rộng này, hãy thoải mái bắt đầu một vấn đề, hoặc tạo một pull request.</p><p>Nếu bạn không quen thuộc với các hàm Casbin, bạn có thể tham khảo <a href="/vi/docs/function">Function</a> để biết thêm thông tin.</p><p>Dưới đây là các hàm mở rộng:</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="421-các-hàm-mở-rộng">4.2.1 Các hàm mở rộng<a href="#421-các-hàm-mở-rộng" class="hash-link" aria-label="Đường dẫn trực tiếp đến 4.2.1 Các hàm mở rộng" title="Đường dẫn trực tiếp đến 4.2.1 Các hàm mở rộng">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4211-truy-cập">4.2.1.1 truy cập<a href="#4211-truy-cập" class="hash-link" aria-label="Đường dẫn trực tiếp đến 4.2.1.1 truy cập" title="Đường dẫn trực tiếp đến 4.2.1.1 truy cập">​</a></h4><p>Truy cập được sử dụng để giải quyết vấn đề mà Casbin không hỗ trợ đánh chỉ mục trong bản đồ hoặc mảng. Ví dụ <code>example/allowed_repo/model.yaml</code> minh họa việc sử dụng chức năng này:</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">matchers</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">m</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">r.obj.Request.Namespace == &quot;default&quot; &amp;&amp; r.obj.Request.Resource.Resource ==&quot;deployments&quot; &amp;&amp; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, &quot;Image&quot;)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">= p.obj</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Trong bộ so khớp này, <code>access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, &quot;Image&quot;)</code> tương đương với <code>r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Image</code>, trong đó <code>r.obj.Request.Object.Object.Spec.Template.Spec.Containers</code> là một slice.</p><p>Truy cập cũng có thể gọi các hàm đơn giản không có tham số và trả về một giá trị duy nhất. Ví dụ <code>example/container_resource_limit/model.yaml</code> minh họa điều này:</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">matchers</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key attr-name" style="color:#00a4db">m</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">r.obj.Request.Namespace == &quot;default&quot; &amp;&amp; r.obj.Request.Resource.Resource ==&quot;deployments&quot; &amp;&amp; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key attr-name" style="color:#00a4db">parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, &quot;Resources&quot;,&quot;Limits&quot;,&quot;cpu&quot;,&quot;Value&quot;)) &gt;</span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">parseFloat(p.cpu) &amp;&amp; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key attr-name" style="color:#00a4db">parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, &quot;Resources&quot;,&quot;Limits&quot;,&quot;memory&quot;,&quot;Value&quot;)) &gt;</span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">parseFloat(p.memory)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Trong bộ so khớp này, <code>access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, &quot;Resources&quot;,&quot;Limits&quot;,&quot;cpu&quot;,&quot;Value&quot;)</code> tương đương với <code>r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits[&quot;cpu&quot;].Value()</code>, trong đó <code>r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits</code> là một bản đồ, và <code>Value()</code> là một hàm đơn giản không có tham số và trả về một giá trị duy nhất.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4212-truycậpvớikýtựđạidiện">4.2.1.2 truyCậpVớiKýTựĐạiDiện<a href="#4212-truycậpvớikýtựđạidiện" class="hash-link" aria-label="Đường dẫn trực tiếp đến 4.2.1.2 truyCậpVớiKýTựĐạiDiện" title="Đường dẫn trực tiếp đến 4.2.1.2 truyCậpVớiKýTựĐạiDiện">​</a></h4><p>Đôi khi, bạn có thể có nhu cầu như thế này: tất cả các phần tử trong một mảng phải có tiền tố &quot;aaa&quot;. Tuy nhiên, Casbin không hỗ trợ vòng lặp <code>for</code>. Với <code>accessWithWildcard</code> và tính năng &quot;mở rộng bản đồ/slice&quot;, bạn có thể dễ dàng thực hiện yêu cầu như vậy.</p><p>Ví dụ, giả sử <code>a.b.c</code> là một mảng <code>[aaa, bbb, ccc, ddd, eee]</code>, thì kết quả của <code>accessWithWildcard(a, &quot;b&quot;, &quot;c&quot;, &quot;*&quot;)</code> sẽ là một slice <code>[aaa, bbb, ccc, ddd, eee]</code>. Bằng cách sử dụng ký tự đại diện <code>*</code>, slice được mở rộng.</p><p>Tương tự, ký tự đại diện có thể được sử dụng nhiều hơn một lần. Ví dụ, kết quả của <code>accessWithWildcard(a, &quot;b&quot;, &quot;c&quot;, &quot;*&quot;, &quot;*&quot;)</code> sẽ là <code>[a.b.c[0][0], a.b.c[0][1], ..., a.b.c[1][0], a.b.c[1][1], ...]</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4213-các-hàm-hỗ-trợ-đối-số-có-độ-dài-biến-đổi">4.2.1.3 Các hàm hỗ trợ đối số có độ dài biến đổi<a href="#4213-các-hàm-hỗ-trợ-đối-số-có-độ-dài-biến-đổi" class="hash-link" aria-label="Đường dẫn trực tiếp đến 4.2.1.3 Các hàm hỗ trợ đối số có độ dài biến đổi" title="Đường dẫn trực tiếp đến 4.2.1.3 Các hàm hỗ trợ đối số có độ dài biến đổi">​</a></h3><p>Trong trình đánh giá biểu thức của Casbin, khi một tham số là một mảng, nó sẽ được tự động mở rộng thành một đối số có độ dài biến đổi. Sử dụng tính năng này để hỗ trợ mở rộng mảng/slice/bản đồ, chúng tôi cũng đã tích hợp một số hàm chấp nhận mảng/slice làm tham số:</p><ul><li>contain(): chấp nhận nhiều tham số và trả về xem bất kỳ tham số nào (ngoại trừ tham số cuối cùng) có bằng tham số cuối cùng hay không.</li><li>split(a, b, c..., sep, index): trả về một slice chứa <code>[splits(a, sep)[index], splits(b, sep)[index], splits(a, sep)[index], ...]</code>.</li><li><code>len()</code>: trả về độ dài của đối số có độ dài thay đổi.</li><li><code>matchRegex(a, b, c..., regex)</code>: trả về xem tất cả các tham số đã cho (<code>a</code>, <code>b</code>, <code>c</code>, ...) có khớp với regex đã cho.</li></ul><p>Đây là một ví dụ trong <code>example/disallowed_tag/model.yaml</code>:</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">matchers</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key attr-name" style="color:#00a4db">m</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">r.obj.Request.Namespace == &quot;default&quot; &amp;&amp; r.obj.Request.Resource.Resource ==&quot;deployments&quot; &amp;&amp; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , &quot;*&quot;, &quot;Image&quot;),&quot;:&quot;,1) , p.obj)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Giả sử rằng <code>accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers, &quot;*&quot;, &quot;Image&quot;)</code> trả về <code>[&quot;a:b&quot;, &quot;c:d&quot;, &quot;e:f&quot;, &quot;g:h&quot;]</code>, bởi vì <code>splits</code> hỗ trợ đối số có độ dài thay đổi và thực hiện phép chia trên mỗi phần tử, phần tử tại chỉ số 1 sẽ được chọn và trả về. Do đó, <code>split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers, &quot;*&quot;, &quot;Image&quot;), &quot;:&quot;, 1)</code> trả về <code>[&quot;b&quot;, &quot;d&quot;, &quot;f&quot;, &quot;h&quot;]</code>. Và <code>contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers, &quot;*&quot;, &quot;Image&quot;), &quot;:&quot;, 1), p.obj)</code> trả về xem <code>p.obj</code> có được chứa trong <code>[&quot;b&quot;, &quot;d&quot;, &quot;f&quot;, &quot;h&quot;]</code>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4212-các-hàm-chuyển-đổi-kiểu">4.2.1.2 Các Hàm Chuyển Đổi Kiểu<a href="#4212-các-hàm-chuyển-đổi-kiểu" class="hash-link" aria-label="Đường dẫn trực tiếp đến 4.2.1.2 Các Hàm Chuyển Đổi Kiểu" title="Đường dẫn trực tiếp đến 4.2.1.2 Các Hàm Chuyển Đổi Kiểu">​</a></h4><ul><li><code>ParseFloat()</code>: Chuyển đổi một số nguyên thành một số thực (điều này là cần thiết vì bất kỳ số nào được sử dụng trong so sánh phải được chuyển đổi thành số thực).</li><li><code>ToString()</code>: Chuyển đổi một đối tượng thành một chuỗi. Đối tượng này phải có một kiểu cơ bản là chuỗi (ví dụ, một đối tượng kiểu <code>XXX</code> khi có một câu lệnh <code>type XXX string</code>).</li><li>IsNil(): Trả về liệu tham số có phải là nil hay không.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-cài-đặt-nâng-cao">5. Cài đặt Nâng cao<a href="#5-cài-đặt-nâng-cao" class="hash-link" aria-label="Đường dẫn trực tiếp đến 5. Cài đặt Nâng cao" title="Đường dẫn trực tiếp đến 5. Cài đặt Nâng cao">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51-về-chứng-chỉ">5.1 Về Chứng chỉ<a href="#51-về-chứng-chỉ" class="hash-link" aria-label="Đường dẫn trực tiếp đến 5.1 Về Chứng chỉ" title="Đường dẫn trực tiếp đến 5.1 Về Chứng chỉ">​</a></h3><p>Trong Kubernetes (k8s), bắt buộc phải sử dụng HTTPS cho một webhook. Có hai cách tiếp cận để đạt được điều này:</p><ul><li>Sử dụng chứng chỉ tự ký (các ví dụ trong kho lưu trữ này sử dụng phương pháp này)</li><li>Sử dụng chứng chỉ bình thường</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="511-chứng-chỉ-tự-ký">5.1.1 Chứng chỉ tự ký<a href="#511-chứng-chỉ-tự-ký" class="hash-link" aria-label="Đường dẫn trực tiếp đến 5.1.1 Chứng chỉ tự ký" title="Đường dẫn trực tiếp đến 5.1.1 Chứng chỉ tự ký">​</a></h4><p>Sử dụng chứng chỉ tự ký có nghĩa là Tổ chức Chứng chỉ (CA) cấp chứng chỉ không phải là một trong những CA nổi tiếng. Do đó, bạn phải cho k8s biết về CA này.</p><p>Hiện tại, ví dụ trong kho lưu trữ này sử dụng một CA tự làm, khóa riêng và chứng chỉ của nó được lưu trữ trong <code>config/certificate/ca.crt</code> và <code>config/certificate/ca.key</code> tương ứng. Chứng chỉ cho webhook là <code>config/certificate/server.crt</code>, được cấp bởi CA tự làm. Các tên miền của chứng chỉ này là &quot;webhook.domain.local&quot; (cho webhook bên ngoài) và &quot;casbin-webhook-svc.default.svc&quot; (cho webhook nội bộ).</p><p>Thông tin về CA được truyền cho k8s thông qua các tệp cấu hình webhook. Cả <code>config/webhook_external.yaml</code> và <code>config/webhook_internal.yaml</code> đều có một trường gọi là &quot;CABundle&quot;, chứa một chuỗi được mã hóa base64 của chứng chỉ CA.</p><p>Trong trường hợp bạn cần thay đổi chứng chỉ/tên miền (ví dụ, nếu bạn muốn đặt webhook này vào một namespace khác của k8s trong khi sử dụng webhook nội bộ, hoặc nếu bạn muốn thay đổi tên miền trong khi sử dụng webhook bên ngoài), các thủ tục sau đây nên được tuân theo:</p><ol><li><p>Tạo một CA mới:</p><ul><li><p>Tạo khóa riêng cho CA giả:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl genrsa -des3 -out ca.key </span><span class="token number" style="color:#36acaa">2048</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Xóa bảo vệ mật khẩu của khóa riêng:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl rsa -in ca.key -out ca.key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>Tạo một khóa riêng cho máy chủ webhook:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl genrsa -des3 -out server.key </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl rsa -in server.key -out server.key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Sử dụng CA tự tạo để ký chứng chỉ cho webhook:</p><ul><li><p>Sao chép tệp cấu hình openssl của hệ thống của bạn để sử dụng tạm thời. Bạn có thể tìm ra vị trí của tệp cấu hình bằng cách chạy <code>openssl version -a</code>, thường được gọi là <code>openssl.cnf</code>.</p></li><li><p>Trong tệp cấu hình:</p><ul><li><p>Tìm đoạn <code>[req]</code> và thêm dòng sau: <code>req_extensions = v3_req</code></p></li><li><p>Tìm đoạn <code>[v3_req]</code> và thêm dòng sau: <code>subjectAltName = @alt_names</code></p></li><li><p>Nối các dòng sau vào tệp:</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">alt_names</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">DNS.2</span><span class="token punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">&lt;The domain you want&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Lưu ý: Thay thế &#x27;casbin-webhook-svc.default.svc&#x27; bằng tên dịch vụ thực tế của dịch vụ của bạn nếu bạn quyết định sửa đổi tên dịch vụ.</p></li></ul></li><li><p>Sử dụng tệp cấu hình đã sửa đổi để tạo tệp yêu cầu chứng chỉ:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req -new -nodes -keyout server.key -out server.csr -config openssl.cnf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Sử dụng CA tự tạo để đáp ứng yêu cầu và ký chứng chỉ:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl x509 -req -days </span><span class="token number" style="color:#36acaa">3650</span><span class="token plain"> -in server.csr -out server.crt -CA ca.crt -CAkey ca.key -CAcreateserial -extensions v3_req -extensions SAN -extfile openssl.cnf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Sao chép mã vào khay nhớ tạm" title="Sao chép" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>Thay thế trường &#x27;CABundle&#x27;: Cập nhật trường này với chứng chỉ mới.</p></li><li><p>Nếu bạn đang sử dụng helm, cần áp dụng các thay đổi tương tự cho biểu đồ helm.</p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="512-chứng-chỉ-pháp-lý">5.1.2 Chứng chỉ pháp lý<a href="#512-chứng-chỉ-pháp-lý" class="hash-link" aria-label="Đường dẫn trực tiếp đến 5.1.2 Chứng chỉ pháp lý" title="Đường dẫn trực tiếp đến 5.1.2 Chứng chỉ pháp lý">​</a></h4><p>Nếu bạn sử dụng chứng chỉ pháp lý, bạn không cần phải trải qua tất cả các thủ tục này. Xóa trường &quot;CABundle&quot; trong <code>config/webhook_external.yaml</code> và <code>config/webhook_internal.yaml</code>, và thay đổi tên miền trong các tệp này thành tên miền mà bạn sở hữu.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sGateKeeper.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Chỉnh sửa trang này</a> <a href="https://crowdin.com/project/casdoor-website/vi" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page" transurl="https://crowdin.com/project/casdoor-website/vi" style="margin-left:2rem"><svg fill="currentColor" height="20" width="20" viewBox="0 0 25 25" aria-hidden="true" style="margin-right:0.3em;vertical-align:sub"><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Dịch trang này</a></div><div class="col lastUpdated_VsjB"><span>Created by</span><a href="https://github.com/ComradeProgrammer" target="_blank" rel="noreferrer"><img alt="ComradeProgrammer" src="https://avatars.githubusercontent.com/ComradeProgrammer" width="24px" style="border-radius:12px;vertical-align:sub;margin-left:4px">  <!-- -->ComradeProgrammer</a></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Trang tài liệu"><a class="pagination-nav__link pagination-nav__link--prev" href="/vi/docs/k8s"><div class="pagination-nav__sublabel">Trước</div><div class="pagination-nav__label">Authorization of Kubernetes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/vi/docs/envoy"><div class="pagination-nav__sublabel">Tiếp theo</div><div class="pagination-nav__label">Authorization of Service Mesh through Envoy</div></a></nav><br></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-tổng-quan--tài-liệu-cho-casbin-k8s-gatekeeper" class="table-of-contents__link toc-highlight">1. Tổng quan &amp; Tài liệu cho Casbin K8s-Gatekeeper</a><ul><li><a href="#01-ví-dụ-đơn-giản" class="table-of-contents__link toc-highlight">0.1 Ví dụ Đơn Giản</a></li><li><a href="#11-cách-casbin-k8s-gatekeeper-hoạt-động" class="table-of-contents__link toc-highlight">1.1 Cách Casbin K8s-Gatekeeper hoạt động?</a></li><li><a href="#12-một-ví-dụ-minh-họa-cách-nó-hoạt-động" class="table-of-contents__link toc-highlight">1.2 Một Ví Dụ Minh Họa Cách Nó Hoạt Động</a></li></ul></li><li><a href="#2-cài-đặt-k8s-gatekeeper" class="table-of-contents__link toc-highlight">2 Cài đặt K8s-gatekeeper</a><ul><li><a href="#21-webhook-nội-bộ" class="table-of-contents__link toc-highlight">2.1 Webhook nội bộ</a></li><li><a href="#22-webhook-bên-ngoài" class="table-of-contents__link toc-highlight">2.2 Webhook bên ngoài</a></li><li><a href="#231-bước-1-xây-dựng-hình-ảnh" class="table-of-contents__link toc-highlight">2.3.1 Bước 1: Xây dựng hình ảnh</a></li></ul></li><li><a href="#3-thử-k8s-gatekeeper" class="table-of-contents__link toc-highlight">3. Thử K8s-gatekeeper</a><ul><li><a href="#31-tạo-mô-hình-và-chính-sách-casbin" class="table-of-contents__link toc-highlight">3.1 Tạo Mô hình và Chính sách Casbin</a></li><li><a href="#312-thử-xem-k8s-gatekeeper-có-hoạt-động-không" class="table-of-contents__link toc-highlight">3.1.2 Thử xem K8s-gatekeeper có hoạt động không</a></li></ul></li><li><a href="#4-cách-viết-mô-hình-và-chính-sách-với-k8s-gatekeeper" class="table-of-contents__link toc-highlight">4. Cách Viết Mô hình và Chính sách với K8s-gatekeeper</a><ul><li><a href="#41-định-nghĩa-yêu-cầu-của-mô-hình" class="table-of-contents__link toc-highlight">4.1 Định nghĩa Yêu cầu của Mô hình</a></li><li><a href="#42-matchers-của-mô-hình" class="table-of-contents__link toc-highlight">4.2 Matchers của Mô hình</a></li><li><a href="#421-các-hàm-mở-rộng" class="table-of-contents__link toc-highlight">4.2.1 Các hàm mở rộng</a></li><li><a href="#4213-các-hàm-hỗ-trợ-đối-số-có-độ-dài-biến-đổi" class="table-of-contents__link toc-highlight">4.2.1.3 Các hàm hỗ trợ đối số có độ dài biến đổi</a></li></ul></li><li><a href="#5-cài-đặt-nâng-cao" class="table-of-contents__link toc-highlight">5. Cài đặt Nâng cao</a><ul><li><a href="#51-về-chứng-chỉ" class="table-of-contents__link toc-highlight">5.1 Về Chứng chỉ</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Tài liệu</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/vi/docs/get-started">Bắt đầu</a></li><li class="footer__item"><a class="footer__link-item" href="/vi/docs/management-api">API Quản lý</a></li><li class="footer__item"><a class="footer__link-item" href="/vi/docs/rbac-api">API RBAC</a></li><li class="footer__item"><a class="footer__link-item" href="/vi/docs/middlewares">Middlewares</a></li></ul></div><div class="col footer__col"><div class="footer__title">Cộng đồng</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://forum.casbin.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Diễn đàn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/search?q=casbin" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/S5UjpzGZjN" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://cdn.casdoor.com/casdoor/resource/built-in/admin/qq_casbin.png" target="_blank" rel="noopener noreferrer" class="footer__link-item">Nhóm QQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Thêm</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://github.com/casbin/casbin" target="_blank">
                  <img alt="GitHub Repo stars" src="https://img.shields.io/github/stars/casbin/casbin?label=Casbin&style=social">
                </a>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="https://github.com/casbin/jcasbin" target="_blank">
                  <img alt="GitHub Repo stars" src="https://img.shields.io/github/stars/casbin/jcasbin?label=jCasbin&style=social">
                </a>
              </li><li class="footer__item">
                <a href="https://github.com/casbin/node-casbin" target="_blank">
                  <img alt="GitHub Repo stars" src="https://img.shields.io/github/stars/casbin/node-casbin?label=Node-Casbin&style=social">
                </a>
                &nbsp;&nbsp;
                <a href="https://github.com/php-casbin/php-casbin" target="_blank">
                  <img alt="GitHub Repo stars" src="https://img.shields.io/github/stars/php-casbin/php-casbin?label=PHP-Casbin&style=social">
                </a>
              </li><li class="footer__item">
                <a href="https://github.com/casbin/pycasbin" target="_blank">
                  <img alt="GitHub Repo stars" src="https://img.shields.io/github/stars/casbin/pycasbin?label=PyCasbin&style=social">
                </a>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="https://github.com/casbin/Casbin.NET" target="_blank">
                  <img alt="GitHub Repo stars" src="https://img.shields.io/github/stars/casbin/Casbin.NET?label=Casbin.NET&style=social">
                </a>
              </li><li class="footer__item">
                <a href="https://github.com/casbin/casbin-cpp" target="_blank">
                  <img alt="GitHub Repo stars" src="https://img.shields.io/github/stars/casbin/casbin-cpp?label=Casbin-CPP&style=social">
                </a>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <a href="https://github.com/casbin/casbin-rs" target="_blank">
                  <img alt="GitHub Repo stars" src="https://img.shields.io/github/stars/casbin/casbin-rs?label=Casbin-RS&style=social">
                </a>
              </li><li class="footer__item">
                <a href="https://twitter.com/casbinHQ" target="_blank">
                  <img alt="Twitter Follow" src="https://img.shields.io/twitter/follow/casbinHQ?style=social">
                </a>
              </li><li class="footer__item">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?2c0ffc6f8d49e98d964d59d7aa4cbf34";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
</li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_BH7S" href="/vi/"><img src="/vi/img/casbin_min.svg" alt="Logo Casbin" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/vi/img/casbin_min.svg" alt="Logo Casbin" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Bản quyền © 2024 Tổ chức Casbin</div></div></div></footer></div>
<script src="/vi/assets/js/runtime~main.50efc54a.js"></script>
<script src="/vi/assets/js/main.f00983a6.js"></script>
</body>
</html>