"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[6075],{3905:(n,e,t)=>{t.d(e,{Zo:()=>p,kt:()=>u});var c=t(7294);function a(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function i(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);e&&(c=c.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,c)}return t}function h(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?i(Object(t),!0).forEach((function(e){a(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function l(n,e){if(null==n)return{};var t,c,a=function(n,e){if(null==n)return{};var t,c,a={},i=Object.keys(n);for(c=0;c<i.length;c++)t=i[c],e.indexOf(t)>=0||(a[t]=n[t]);return a}(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(c=0;c<i.length;c++)t=i[c],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(a[t]=n[t])}return a}var r=c.createContext({}),o=function(n){var e=c.useContext(r),t=e;return n&&(t="function"==typeof n?n(e):h(h({},e),n)),t},p=function(n){var e=o(n.components);return c.createElement(r.Provider,{value:e},n.children)},s={inlineCode:"code",wrapper:function(n){var e=n.children;return c.createElement(c.Fragment,{},e)}},g=c.forwardRef((function(n,e){var t=n.components,a=n.mdxType,i=n.originalType,r=n.parentName,p=l(n,["components","mdxType","originalType","parentName"]),g=o(t),u=a,m=g["".concat(r,".").concat(u)]||g[u]||s[u]||i;return t?c.createElement(m,h(h({ref:e},p),{},{components:t})):c.createElement(m,h({ref:e},p))}));function u(n,e){var t=arguments,a=e&&e.mdxType;if("string"==typeof n||a){var i=t.length,h=new Array(i);h[0]=g;var l={};for(var r in e)hasOwnProperty.call(e,r)&&(l[r]=e[r]);l.originalType=n,l.mdxType="string"==typeof n?n:a,h[1]=l;for(var o=2;o<i;o++)h[o]=t[o];return c.createElement.apply(null,h)}return c.createElement.apply(null,t)}g.displayName="MDXCreateElement"},6750:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>r,contentTitle:()=>h,default:()=>s,frontMatter:()=>i,metadata:()=>l,toc:()=>o});var c=t(7462),a=(t(7294),t(3905));const i={id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Kubernetes (K8s) RBAC & ABAC Authorization Middleware d\u1ef1a tr\xean Casbin",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},h=void 0,l={unversionedId:"k8s-gatekeeper",id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Kubernetes (K8s) RBAC & ABAC Authorization Middleware d\u1ef1a tr\xean Casbin",source:"@site/i18n/vi/docusaurus-plugin-content-docs/current/K8sGateKeeper.mdx",sourceDirName:".",slug:"/k8s-gatekeeper",permalink:"/vi/docs/k8s-gatekeeper",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sGateKeeper.mdx",tags:[],version:"current",frontMatter:{id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Kubernetes (K8s) RBAC & ABAC Authorization Middleware d\u1ef1a tr\xean Casbin",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},sidebar:"docs",previous:{title:"Authorization of Kubernetes",permalink:"/vi/docs/k8s"},next:{title:"Authorization of Service Mesh through Envoy",permalink:"/vi/docs/envoy"}},r={},o=[{value:"1. T\u1ed5ng quan &amp; T\xe0i li\u1ec7u cho Casbin K8s-Gatekeeper",id:"1-t\u1ed5ng-quan--t\xe0i-li\u1ec7u-cho-casbin-k8s-gatekeeper",level:2},{value:"0.1 V\xed d\u1ee5 \u0110\u01a1n Gi\u1ea3n",id:"01-v\xed-d\u1ee5-\u0111\u01a1n-gi\u1ea3n",level:3},{value:"1.1 C\xe1ch Casbin K8s-Gatekeeper ho\u1ea1t \u0111\u1ed9ng?",id:"11-c\xe1ch-casbin-k8s-gatekeeper-ho\u1ea1t-\u0111\u1ed9ng",level:3},{value:"1.2 M\u1ed9t V\xed D\u1ee5 Minh H\u1ecda C\xe1ch N\xf3 Ho\u1ea1t \u0110\u1ed9ng",id:"12-m\u1ed9t-v\xed-d\u1ee5-minh-h\u1ecda-c\xe1ch-n\xf3-ho\u1ea1t-\u0111\u1ed9ng",level:3},{value:"2 C\xe0i \u0111\u1eb7t K8s-gatekeeper",id:"2-c\xe0i-\u0111\u1eb7t-k8s-gatekeeper",level:2},{value:"2.1 Webhook n\u1ed9i b\u1ed9",id:"21-webhook-n\u1ed9i-b\u1ed9",level:3},{value:"2.1.1 B\u01b0\u1edbc 1: X\xe2y d\u1ef1ng h\xecnh \u1ea3nh",id:"211-b\u01b0\u1edbc-1-x\xe2y-d\u1ef1ng-h\xecnh-\u1ea3nh",level:4},{value:"2.1.2 B\u01b0\u1edbc 2: Thi\u1ebft l\u1eadp d\u1ecbch v\u1ee5 v\xe0 tri\u1ec3n khai cho K8s-gatekeeper",id:"212-b\u01b0\u1edbc-2-thi\u1ebft-l\u1eadp-d\u1ecbch-v\u1ee5-v\xe0-tri\u1ec3n-khai-cho-k8s-gatekeeper",level:4},{value:"2.1.3 B\u01b0\u1edbc 3: C\xe0i \u0111\u1eb7t T\xe0i nguy\xean CRD cho K8s-gatekeeper",id:"213-b\u01b0\u1edbc-3-c\xe0i-\u0111\u1eb7t-t\xe0i-nguy\xean-crd-cho-k8s-gatekeeper",level:4},{value:"2.2 Webhook b\xean ngo\xe0i",id:"22-webhook-b\xean-ngo\xe0i",level:3},{value:"2.3.1 B\u01b0\u1edbc 1: X\xe2y d\u1ef1ng h\xecnh \u1ea3nh",id:"231-b\u01b0\u1edbc-1-x\xe2y-d\u1ef1ng-h\xecnh-\u1ea3nh",level:3},{value:"2.3.1 Ad\u0131m 1: G\xf6r\xfcnt\xfcy\xfc olu\u015fturun",id:"231-ad\u0131m-1-g\xf6r\xfcnt\xfcy\xfc-olu\u015fturun",level:4},{value:"2.3.2 C\xe0i \u0111\u1eb7t Helm",id:"232-c\xe0i-\u0111\u1eb7t-helm",level:4},{value:"3. Th\u1eed K8s-gatekeeper",id:"3-th\u1eed-k8s-gatekeeper",level:2},{value:"3.1 T\u1ea1o M\xf4 h\xecnh v\xe0 Ch\xednh s\xe1ch Casbin",id:"31-t\u1ea1o-m\xf4-h\xecnh-v\xe0-ch\xednh-s\xe1ch-casbin",level:3},{value:"3.1.1 T\u1ea1o/C\u1eadp nh\u1eadt M\xf4 h\xecnh v\xe0 Ch\xednh s\xe1ch Casbin qua kubectl",id:"311-t\u1ea1oc\u1eadp-nh\u1eadt-m\xf4-h\xecnh-v\xe0-ch\xednh-s\xe1ch-casbin-qua-kubectl",level:4},{value:"3.1.2 T\u1ea1o/C\u1eadp nh\u1eadt M\xf4 h\xecnh v\xe0 Ch\xednh s\xe1ch Casbin th\xf4ng qua go-client m\xe0 ch\xfang t\xf4i cung c\u1ea5p",id:"312-t\u1ea1oc\u1eadp-nh\u1eadt-m\xf4-h\xecnh-v\xe0-ch\xednh-s\xe1ch-casbin-th\xf4ng-qua-go-client-m\xe0-ch\xfang-t\xf4i-cung-c\u1ea5p",level:4},{value:"3.1.2 Th\u1eed xem K8s-gatekeeper c\xf3 ho\u1ea1t \u0111\u1ed9ng kh\xf4ng",id:"312-th\u1eed-xem-k8s-gatekeeper-c\xf3-ho\u1ea1t-\u0111\u1ed9ng-kh\xf4ng",level:3},{value:"4. C\xe1ch Vi\u1ebft M\xf4 h\xecnh v\xe0 Ch\xednh s\xe1ch v\u1edbi K8s-gatekeeper",id:"4-c\xe1ch-vi\u1ebft-m\xf4-h\xecnh-v\xe0-ch\xednh-s\xe1ch-v\u1edbi-k8s-gatekeeper",level:2},{value:"4.1 \u0110\u1ecbnh ngh\u0129a Y\xeau c\u1ea7u c\u1ee7a M\xf4 h\xecnh",id:"41-\u0111\u1ecbnh-ngh\u0129a-y\xeau-c\u1ea7u-c\u1ee7a-m\xf4-h\xecnh",level:3},{value:"4.2 Matchers c\u1ee7a M\xf4 h\xecnh",id:"42-matchers-c\u1ee7a-m\xf4-h\xecnh",level:3},{value:"4.2.1 C\xe1c h\xe0m m\u1edf r\u1ed9ng",id:"421-c\xe1c-h\xe0m-m\u1edf-r\u1ed9ng",level:3},{value:"4.2.1.1 truy c\u1eadp",id:"4211-truy-c\u1eadp",level:4},{value:"4.2.1.2 truyC\u1eadpV\u1edbiK\xfdT\u1ef1\u0110\u1ea1iDi\u1ec7n",id:"4212-truyc\u1eadpv\u1edbik\xfdt\u1ef1\u0111\u1ea1idi\u1ec7n",level:4},{value:"4.2.1.3 C\xe1c h\xe0m h\u1ed7 tr\u1ee3 \u0111\u1ed1i s\u1ed1 c\xf3 \u0111\u1ed9 d\xe0i bi\u1ebfn \u0111\u1ed5i",id:"4213-c\xe1c-h\xe0m-h\u1ed7-tr\u1ee3-\u0111\u1ed1i-s\u1ed1-c\xf3-\u0111\u1ed9-d\xe0i-bi\u1ebfn-\u0111\u1ed5i",level:3},{value:"4.2.1.2 C\xe1c H\xe0m Chuy\u1ec3n \u0110\u1ed5i Ki\u1ec3u",id:"4212-c\xe1c-h\xe0m-chuy\u1ec3n-\u0111\u1ed5i-ki\u1ec3u",level:4},{value:"5. C\xe0i \u0111\u1eb7t N\xe2ng cao",id:"5-c\xe0i-\u0111\u1eb7t-n\xe2ng-cao",level:2},{value:"5.1 V\u1ec1 Ch\u1ee9ng ch\u1ec9",id:"51-v\u1ec1-ch\u1ee9ng-ch\u1ec9",level:3},{value:"5.1.1 Ch\u1ee9ng ch\u1ec9 t\u1ef1 k\xfd",id:"511-ch\u1ee9ng-ch\u1ec9-t\u1ef1-k\xfd",level:4},{value:"5.1.2 Ch\u1ee9ng ch\u1ec9 ph\xe1p l\xfd",id:"512-ch\u1ee9ng-ch\u1ec9-ph\xe1p-l\xfd",level:4}],p={toc:o};function s(n){let{components:e,...t}=n;return(0,a.kt)("wrapper",(0,c.Z)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"1-t\u1ed5ng-quan--t\xe0i-li\u1ec7u-cho-casbin-k8s-gatekeeper"},"1. T\u1ed5ng quan & T\xe0i li\u1ec7u cho Casbin K8s-Gatekeeper"),(0,a.kt)("p",null,"Casbin K8s-GateKeeper l\xe0 m\u1ed9t webhook ki\u1ec3m so\xe1t truy c\u1eadp c\u1ee7a Kubernetes t\xedch h\u1ee3p Casbin nh\u01b0 c\xf4ng c\u1ee5 Qu\u1ea3n l\xfd Truy c\u1eadp. B\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng Casbin K8s-GateKeeper, b\u1ea1n c\xf3 th\u1ec3 thi\u1ebft l\u1eadp c\xe1c quy t\u1eafc linh ho\u1ea1t \u0111\u1ec3 \u1ee7y quy\u1ec1n ho\u1eb7c ch\u1eb7n b\u1ea5t k\u1ef3 ho\u1ea1t \u0111\u1ed9ng n\xe0o tr\xean t\xe0i nguy\xean K8s, KH\xd4NG C\u1ea6N vi\u1ebft b\u1ea5t k\u1ef3 \u0111o\u1ea1n m\xe3 n\xe0o, ch\u1ec9 v\u1edbi m\u1ed9t v\xe0i d\xf2ng c\u1ea5u h\xecnh khai b\xe1o c\u1ee7a m\xf4 h\xecnh v\xe0 ch\xednh s\xe1ch Casbin, \u0111\xf3 l\xe0 m\u1ed9t ph\u1ea7n c\u1ee7a ng\xf4n ng\u1eef ACL (Access Control List) c\u1ee7a Casbin."),(0,a.kt)("p",null,"Casbin K8s-GateKeeper \u0111\u01b0\u1ee3c ph\xe1t tri\u1ec3n v\xe0 b\u1ea3o tr\xec b\u1edfi c\u1ed9ng \u0111\u1ed3ng Casbin. Kho l\u01b0u tr\u1eef c\u1ee7a d\u1ef1 \xe1n n\xe0y c\xf3 s\u1eb5n t\u1ea1i \u0111\xe2y: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-gatekeeper"},"https://github.com/casbin/k8s-gatekeeper")),(0,a.kt)("h3",{id:"01-v\xed-d\u1ee5-\u0111\u01a1n-gi\u1ea3n"},"0.1 V\xed d\u1ee5 \u0110\u01a1n Gi\u1ea3n"),(0,a.kt)("p",null,'V\xed d\u1ee5, b\u1ea1n kh\xf4ng c\u1ea7n ph\u1ea3i vi\u1ebft b\u1ea5t k\u1ef3 m\xe3 n\xe0o, nh\u01b0ng s\u1eed d\u1ee5ng c\xe1c d\xf2ng c\u1ea5u h\xecnh sau \u0111\u1ec3 \u0111\u1ea1t \u0111\u01b0\u1ee3c ch\u1ee9c n\u0103ng n\xe0y: "C\u1ea5m s\u1eed d\u1ee5ng c\xe1c image c\xf3 nh\u1eefng tag \u0111\u01b0\u1ee3c ch\u1ec9 \u0111\u1ecbnh trong b\u1ea5t k\u1ef3 deployment n\xe0o":'),(0,a.kt)("p",null,"Model:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\ncontain(split(accessWithWildcard(${OBJECT}.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,a.kt)("p",null,"And Policy:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csv"},'p, "1.14.1",deny\n')),(0,a.kt)("p",null,"\u0110\xe2y l\xe0 trong ng\xf4n ng\u1eef ACL th\xf4ng th\u01b0\u1eddng c\u1ee7a Casbin. Gi\u1ea3 s\u1eed b\u1ea1n \u0111\xe3 \u0111\u1ecdc c\xe1c ch\u01b0\u01a1ng v\u1ec1 ch\xfang, n\xf3 s\u1ebd r\u1ea5t d\u1ec5 hi\u1ec3u."),(0,a.kt)("p",null,"Casbin K8s-GateKeeper c\xf3 nh\u1eefng \u01b0u \u0111i\u1ec3m sau:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"D\u1ec5 s\u1eed d\u1ee5ng. Vi\u1ebft m\u1ed9t v\xe0i d\xf2ng m\xe3 ACL t\u1ed1t h\u01a1n nhi\u1ec1u so v\u1edbi vi\u1ebft m\u1ed9t l\u01b0\u1ee3ng l\u1edbn m\xe3 ngu\u1ed3n."),(0,a.kt)("li",{parentName:"ul"},"N\xf3 cho ph\xe9p c\u1eadp nh\u1eadt c\u1ea5u h\xecnh n\xf3ng. B\u1ea1n kh\xf4ng c\u1ea7n ph\u1ea3i t\u1eaft to\xe0n b\u1ed9 plugin \u0111\u1ec3 s\u1eeda \u0111\u1ed5i c\u1ea5u h\xecnh."),(0,a.kt)("li",{parentName:"ul"},"N\xf3 r\u1ea5t linh ho\u1ea1t. C\xf3 th\u1ec3 t\u1ea1o c\xe1c quy t\u1eafc t\xf9y \xfd tr\xean b\u1ea5t k\u1ef3 t\xe0i nguy\xean K8s n\xe0o, c\xf3 th\u1ec3 kh\xe1m ph\xe1 v\u1edbi ",(0,a.kt)("inlineCode",{parentName:"li"},"kubectl gatekeeper"),"."),(0,a.kt)("li",{parentName:"ul"},"N\xf3 \u0111\u01a1n gi\u1ea3n h\xf3a vi\u1ec7c tri\u1ec3n khai webhook ki\u1ec3m so\xe1t truy c\u1eadp K8s, \u0111i\u1ec1u n\xe0y r\u1ea5t ph\u1ee9c t\u1ea1p. B\u1ea1n kh\xf4ng c\u1ea7n bi\u1ebft webhook ki\u1ec3m so\xe1t truy c\u1eadp K8s l\xe0 g\xec ho\u1eb7c l\xe0m th\u1ebf n\xe0o \u0111\u1ec3 vi\u1ebft m\xe3 cho n\xf3. T\u1ea5t c\u1ea3 nh\u1eefng g\xec b\u1ea1n c\u1ea7n l\xe0m l\xe0 bi\u1ebft t\xe0i nguy\xean m\xe0 b\u1ea1n mu\u1ed1n \u0111\u1eb7t r\xe0ng bu\u1ed9c v\xe0 sau \u0111\xf3 vi\u1ebft m\xe3 ACL Casbin. M\u1ecdi ng\u01b0\u1eddi \u0111\u1ec1u bi\u1ebft r\u1eb1ng K8s r\u1ea5t ph\u1ee9c t\u1ea1p, nh\u01b0ng b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng Casbin K8s-Gatekeeper, th\u1eddi gian c\u1ee7a b\u1ea1n c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c ti\u1ebft ki\u1ec7m."),(0,a.kt)("li",{parentName:"ul"},"N\xf3 \u0111\u01b0\u1ee3c duy tr\xec b\u1edfi c\u1ed9ng \u0111\u1ed3ng Casbin. H\xe3y tho\u1ea3i m\xe1i li\xean h\u1ec7 v\u1edbi ch\xfang t\xf4i n\u1ebfu b\u1ea1n c\xf3 b\u1ea5t k\u1ef3 th\u1eafc m\u1eafc n\xe0o v\u1ec1 plugin n\xe0y ho\u1eb7c g\u1eb7p ph\u1ea3i b\u1ea5t k\u1ef3 v\u1ea5n \u0111\u1ec1 g\xec khi th\u1eed nghi\u1ec7m.")),(0,a.kt)("h3",{id:"11-c\xe1ch-casbin-k8s-gatekeeper-ho\u1ea1t-\u0111\u1ed9ng"},"1.1 C\xe1ch Casbin K8s-Gatekeeper ho\u1ea1t \u0111\u1ed9ng?"),(0,a.kt)("p",null,"K8s-Gatekeeper l\xe0 m\u1ed9t admission webhook cho K8s s\u1eed d\u1ee5ng ",(0,a.kt)("a",{parentName:"p",href:"/docs/overview"},"Casbin")," \u0111\u1ec3 \xe1p d\u1ee5ng c\xe1c quy t\u1eafc ki\u1ec3m so\xe1t truy c\u1eadp do ng\u01b0\u1eddi d\xf9ng \u0111\u1ecbnh ngh\u0129a t\xf9y \xfd, gi\xfap ng\u0103n ch\u1eb7n b\u1ea5t k\u1ef3 ho\u1ea1t \u0111\u1ed9ng n\xe0o tr\xean K8s m\xe0 qu\u1ea3n tr\u1ecb vi\xean kh\xf4ng mu\u1ed1n."),(0,a.kt)("p",null,"Casbin l\xe0 m\u1ed9t th\u01b0 vi\u1ec7n ki\u1ec3m so\xe1t truy c\u1eadp m\xe3 ngu\u1ed3n m\u1edf m\u1ea1nh m\u1ebd v\xe0 hi\u1ec7u qu\u1ea3. N\xf3 cung c\u1ea5p h\u1ed7 tr\u1ee3 cho vi\u1ec7c th\u1ef1c thi \u1ee7y quy\u1ec1n d\u1ef1a tr\xean nhi\u1ec1u m\xf4 h\xecnh ki\u1ec3m so\xe1t truy c\u1eadp kh\xe1c nhau. \u0110\u1ec3 bi\u1ebft th\xeam chi ti\u1ebft v\u1ec1 Casbin, h\xe3y xem ",(0,a.kt)("a",{parentName:"p",href:"/docs/overview"},"T\u1ed5ng quan"),"."),(0,a.kt)("p",null,"Admission webhooks trong K8s l\xe0 c\xe1c cu\u1ed9c g\u1ecdi l\u1ea1i HTTP nh\u1eadn 'y\xeau c\u1ea7u admission' v\xe0 th\u1ef1c hi\u1ec7n m\u1ed9t vi\u1ec7c g\xec \u0111\xf3 v\u1edbi ch\xfang. \u0110\u1eb7c bi\u1ec7t, K8s-Gatekeeper l\xe0 m\u1ed9t lo\u1ea1i admission webhook \u0111\u1eb7c bi\u1ec7t: 'ValidatingAdmissionWebhook', c\xf3 th\u1ec3 quy\u1ebft \u0111\u1ecbnh ch\u1ea5p nh\u1eadn hay t\u1eeb ch\u1ed1i y\xeau c\u1ea7u admission n\xe0y. \u0110\u1ed1i v\u1edbi y\xeau c\u1ea7u admission, ch\xfang l\xe0 c\xe1c y\xeau c\u1ea7u HTTP m\xf4 t\u1ea3 m\u1ed9t ho\u1ea1t \u0111\u1ed9ng tr\xean c\xe1c t\xe0i nguy\xean \u0111\u01b0\u1ee3c ch\u1ec9 \u0111\u1ecbnh c\u1ee7a K8s (v\xed d\u1ee5: t\u1ea1o/x\xf3a m\u1ed9t deployment). \u0110\u1ec3 bi\u1ebft th\xeam v\u1ec1 admission webhooks, h\xe3y xem ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks"},"T\xe0i li\u1ec7u ch\xednh th\u1ee9c c\u1ee7a K8s"),"."),(0,a.kt)("h3",{id:"12-m\u1ed9t-v\xed-d\u1ee5-minh-h\u1ecda-c\xe1ch-n\xf3-ho\u1ea1t-\u0111\u1ed9ng"},"1.2 M\u1ed9t V\xed D\u1ee5 Minh H\u1ecda C\xe1ch N\xf3 Ho\u1ea1t \u0110\u1ed9ng"),(0,a.kt)("p",null,"V\xed d\u1ee5, khi ai \u0111\xf3 mu\u1ed1n t\u1ea1o m\u1ed9t b\u1ea3n tri\u1ec3n khai ch\u1ee9a m\u1ed9t pod ch\u1ea1y nginx (s\u1eed d\u1ee5ng kubectl ho\u1eb7c c\xe1c client K8s), K8s s\u1ebd t\u1ea1o ra m\u1ed9t y\xeau c\u1ea7u nh\u1eadp c\u1ea3nh, m\xe0 (n\u1ebfu \u0111\u01b0\u1ee3c d\u1ecbch sang \u0111\u1ecbnh d\u1ea1ng YAML) c\xf3 th\u1ec3 gi\u1ed1ng nh\u01b0 th\u1ebf n\xe0y:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.14.1\n        ports:\n        - containerPort: 80\n")),(0,a.kt)("p",null,"Y\xeau c\u1ea7u n\xe0y s\u1ebd \u0111i qua qu\xe1 tr\xecnh x\u1eed l\xfd c\u1ee7a t\u1ea5t c\u1ea3 c\xe1c middleware \u0111\u01b0\u1ee3c hi\u1ec3n th\u1ecb trong h\xecnh, bao g\u1ed3m c\u1ea3 K8s-Gatekeeper c\u1ee7a ch\xfang t\xf4i. K8s-Gatekeeper c\xf3 th\u1ec3 ph\xe1t hi\u1ec7n t\u1ea5t c\u1ea3 c\xe1c enforcer Casbin \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef trong etcd c\u1ee7a K8s, \u0111\u01b0\u1ee3c t\u1ea1o v\xe0 duy tr\xec b\u1edfi ng\u01b0\u1eddi d\xf9ng (th\xf4ng qua ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl")," ho\u1eb7c client Go m\xe0 ch\xfang t\xf4i cung c\u1ea5p). M\u1ed7i enforcer ch\u1ee9a m\u1ed9t m\xf4 h\xecnh Casbin v\xe0 m\u1ed9t ch\xednh s\xe1ch Casbin. Y\xeau c\u1ea7u nh\u1eadp c\u1ea3nh s\u1ebd \u0111\u01b0\u1ee3c x\u1eed l\xfd b\u1edfi t\u1eebng enforcer, m\u1ed9t c\xe1ch tu\u1ea7n t\u1ef1, v\xe0 ch\u1ec9 khi v\u01b0\u1ee3t qua t\u1ea5t c\u1ea3 c\xe1c enforcer th\xec y\xeau c\u1ea7u m\u1edbi \u0111\u01b0\u1ee3c ch\u1ea5p nh\u1eadn b\u1edfi K8s-Gatekeeper n\xe0y."),(0,a.kt)("p",null,"(N\u1ebfu b\u1ea1n kh\xf4ng hi\u1ec3u enforcer Casbin, m\xf4 h\xecnh, ho\u1eb7c ch\xednh s\xe1ch l\xe0 g\xec, h\xe3y xem t\xe0i li\u1ec7u n\xe0y: ",(0,a.kt)("a",{parentName:"p",href:"/docs/get-started"},"B\u1eaft \u0110\u1ea7u"),")."),(0,a.kt)("p",null,"V\xed d\u1ee5, v\xec m\u1ed9t l\xfd do n\xe0o \u0111\xf3, ng\u01b0\u1eddi qu\u1ea3n tr\u1ecb mu\u1ed1n c\u1ea5m s\u1ef1 xu\u1ea5t hi\u1ec7n c\u1ee7a image 'nginx:1.14.1' trong khi cho ph\xe9p 'nginx:1.3.1'. M\u1ed9t enforcer ch\u1ee9a quy t\u1eafc v\xe0 ch\xednh s\xe1ch sau c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c t\u1ea1o ra (Ch\xfang t\xf4i s\u1ebd gi\u1ea3i th\xedch c\xe1ch t\u1ea1o m\u1ed9t enforcer, m\xf4 h\xecnh v\xe0 ch\xednh s\xe1ch l\xe0 g\xec, v\xe0 c\xe1ch vi\u1ebft ch\xfang trong c\xe1c ch\u01b0\u01a1ng ti\u1ebfp theo)."),(0,a.kt)("p",null,"Model:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n\n')),(0,a.kt)("p",null,"Policy:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csv"},'p, "nginx:1.13.1",allow\np, "nginx:1.14.1",deny\n')),(0,a.kt)("p",null,"B\u1eb1ng c\xe1ch t\u1ea1o m\u1ed9t enforcer ch\u1ee9a m\xf4 h\xecnh v\xe0 ch\xednh s\xe1ch \u1edf tr\xean, y\xeau c\u1ea7u nh\u1eadp c\u1ea3nh tr\u01b0\u1edbc \u0111\xf3 s\u1ebd b\u1ecb t\u1eeb ch\u1ed1i b\u1edfi enforcer n\xe0y, \u0111i\u1ec1u \u0111\xf3 c\xf3 ngh\u0129a l\xe0 K8s s\u1ebd kh\xf4ng t\u1ea1o ra b\u1ed9 tri\u1ec3n khai n\xe0y."),(0,a.kt)("h2",{id:"2-c\xe0i-\u0111\u1eb7t-k8s-gatekeeper"},"2 C\xe0i \u0111\u1eb7t K8s-gatekeeper"),(0,a.kt)("p",null,"C\xf3 ba ph\u01b0\u01a1ng ph\xe1p c\xf3 s\u1eb5n \u0111\u1ec3 c\xe0i \u0111\u1eb7t K8s-gatekeeper: Webhook b\xean ngo\xe0i, Webhook n\u1ed9i b\u1ed9 v\xe0 Helm."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"L\u01b0u \xfd: Nh\u1eefng ph\u01b0\u01a1ng ph\xe1p n\xe0y ch\u1ec9 d\xe0nh cho ng\u01b0\u1eddi d\xf9ng th\u1eed nghi\u1ec7m K8s-gatekeeper v\xe0 kh\xf4ng an to\xe0n. N\u1ebfu b\u1ea1n mu\u1ed1n s\u1eed d\u1ee5ng n\xf3 trong m\xf4i tr\u01b0\u1eddng s\u1ea3n xu\u1ea5t, vui l\xf2ng \u0111\u1ea3m b\u1ea3o r\u1eb1ng b\u1ea1n \u0111\xe3 \u0111\u1ecdc ",(0,a.kt)("a",{parentName:"p",href:"#5-advanced-settings"},"Ch\u01b0\u01a1ng 5. C\xe0i \u0111\u1eb7t n\xe2ng cao")," v\xe0 th\u1ef1c hi\u1ec7n b\u1ea5t k\u1ef3 s\u1eeda \u0111\u1ed5i c\u1ea7n thi\u1ebft n\xe0o tr\u01b0\u1edbc khi c\xe0i \u0111\u1eb7t.")),(0,a.kt)("h3",{id:"21-webhook-n\u1ed9i-b\u1ed9"},"2.1 Webhook n\u1ed9i b\u1ed9"),(0,a.kt)("h4",{id:"211-b\u01b0\u1edbc-1-x\xe2y-d\u1ef1ng-h\xecnh-\u1ea3nh"},"2.1.1 B\u01b0\u1edbc 1: X\xe2y d\u1ef1ng h\xecnh \u1ea3nh"),(0,a.kt)("p",null,"\u0110\u1ed1i v\u1edbi ph\u01b0\u01a1ng ph\xe1p webhook n\u1ed9i b\u1ed9, ch\xednh webhook s\u1ebd \u0111\u01b0\u1ee3c tri\u1ec3n khai nh\u01b0 m\u1ed9t d\u1ecbch v\u1ee5 trong Kubernetes. \u0110\u1ec3 t\u1ea1o d\u1ecbch v\u1ee5 v\xe0 tri\u1ec3n khai c\u1ea7n thi\u1ebft, b\u1ea1n c\u1ea7n x\xe2y d\u1ef1ng m\u1ed9t h\xecnh \u1ea3nh c\u1ee7a K8s-gatekeeper. B\u1ea1n c\xf3 th\u1ec3 x\xe2y d\u1ef1ng h\xecnh \u1ea3nh c\u1ee7a ri\xeang m\xecnh b\u1eb1ng c\xe1ch ch\u1ea1y l\u1ec7nh sau:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"docker build --target webhook -t k8s-gatekeeper .\n")),(0,a.kt)("p",null,"L\u1ec7nh n\xe0y s\u1ebd t\u1ea1o m\u1ed9t h\xecnh \u1ea3nh c\u1ee5c b\u1ed9 c\xf3 t\xean 'k8s-gatekeeper:latest'."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"L\u01b0u \xfd: N\u1ebfu b\u1ea1n \u0111ang s\u1eed d\u1ee5ng minikube, vui l\xf2ng th\u1ef1c hi\u1ec7n ",(0,a.kt)("inlineCode",{parentName:"p"},"eval $(minikube -p minikube docker-env)")," tr\u01b0\u1edbc khi ch\u1ea1y 'docker build'.")),(0,a.kt)("h4",{id:"212-b\u01b0\u1edbc-2-thi\u1ebft-l\u1eadp-d\u1ecbch-v\u1ee5-v\xe0-tri\u1ec3n-khai-cho-k8s-gatekeeper"},"2.1.2 B\u01b0\u1edbc 2: Thi\u1ebft l\u1eadp d\u1ecbch v\u1ee5 v\xe0 tri\u1ec3n khai cho K8s-gatekeeper"),(0,a.kt)("p",null,"Ch\u1ea1y c\xe1c l\u1ec7nh sau:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/rbac.yaml\nkubectl apply -f config/webhook_deployment.yaml \nkubectl apply -f config/webhook_internal.yaml \n")),(0,a.kt)("p",null,"\u0110i\u1ec1u n\xe0y s\u1ebd b\u1eaft \u0111\u1ea7u ch\u1ea1y K8s-gatekeeper, v\xe0 b\u1ea1n c\xf3 th\u1ec3 x\xe1c nh\u1eadn \u0111i\u1ec1u n\xe0y b\u1eb1ng c\xe1ch ch\u1ea1y ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pods"),"."),(0,a.kt)("h4",{id:"213-b\u01b0\u1edbc-3-c\xe0i-\u0111\u1eb7t-t\xe0i-nguy\xean-crd-cho-k8s-gatekeeper"},"2.1.3 B\u01b0\u1edbc 3: C\xe0i \u0111\u1eb7t T\xe0i nguy\xean CRD cho K8s-gatekeeper"),(0,a.kt)("p",null,"Ch\u1ea1y c\xe1c l\u1ec7nh sau:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\n")),(0,a.kt)("h3",{id:"22-webhook-b\xean-ngo\xe0i"},"2.2 Webhook b\xean ngo\xe0i"),(0,a.kt)("p",null,"\u0110\u1ed1i v\u1edbi ph\u01b0\u01a1ng th\u1ee9c webhook b\xean ngo\xe0i, K8s-gatekeeper s\u1ebd ch\u1ea1y b\xean ngo\xe0i Kubernetes, v\xe0 Kubernetes s\u1ebd truy c\u1eadp K8s-gatekeeper nh\u01b0 th\u1ec3 n\xf3 truy c\u1eadp m\u1ed9t trang web th\xf4ng th\u01b0\u1eddng. Kubernetes c\xf3 m\u1ed9t y\xeau c\u1ea7u b\u1eaft bu\u1ed9c l\xe0 webhook ki\u1ec3m so\xe1t truy c\u1eadp ph\u1ea3i s\u1eed d\u1ee5ng giao th\u1ee9c HTTPS. V\xec m\u1ee5c \u0111\xedch th\u1eed nghi\u1ec7m K8s-gatekeeper, ch\xfang t\xf4i \u0111\xe3 cung c\u1ea5p m\u1ed9t b\u1ed9 ch\u1ee9ng ch\u1ec9 v\xe0 m\u1ed9t kh\xf3a ri\xeang (m\u1eb7c d\xf9 \u0111i\u1ec1u n\xe0y kh\xf4ng an to\xe0n). N\u1ebfu b\u1ea1n mu\u1ed1n s\u1eed d\u1ee5ng ch\u1ee9ng ch\u1ec9 c\u1ee7a ri\xeang m\xecnh, vui l\xf2ng tham kh\u1ea3o ",(0,a.kt)("a",{parentName:"p",href:"#5-advanced-settings"},"Ch\u01b0\u01a1ng 5. C\xe0i \u0111\u1eb7t n\xe2ng cao")," \u0111\u1ec3 \u0111\u01b0\u1ee3c h\u01b0\u1edbng d\u1eabn \u0111i\u1ec1u ch\u1ec9nh ch\u1ee9ng ch\u1ec9 v\xe0 kh\xf3a ri\xeang. Ch\u1ee9ng ch\u1ec9 m\xe0 ch\xfang t\xf4i cung c\u1ea5p \u0111\u01b0\u1ee3c c\u1ea5p cho 'webhook.domain.local'."),(0,a.kt)("p",null,"V\xec v\u1eady, h\xe3y s\u1eeda \u0111\u1ed5i m\xe1y ch\u1ee7 (v\xed d\u1ee5: /etc/hosts) v\xe0 tr\u1ecf 'webhook.domain.local' \u0111\u1ebfn \u0111\u1ecba ch\u1ec9 IP m\xe0 K8s-gatekeeper \u0111ang ch\u1ea1y. Sau \u0111\xf3 th\u1ef1c hi\u1ec7n l\u1ec7nh sau:"),(0,a.kt)("p",null,"2.3 C\xe0i \u0111\u1eb7t K8s-gatekeeper th\xf4ng qua Helm"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"go mod tidy\ngo mod vendor\ngo run cmd/webhook/main.go\nkubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\nkubectl apply -f config/webhook_external.yaml \n")),(0,a.kt)("h3",{id:"231-b\u01b0\u1edbc-1-x\xe2y-d\u1ef1ng-h\xecnh-\u1ea3nh"},"2.3.1 B\u01b0\u1edbc 1: X\xe2y d\u1ef1ng h\xecnh \u1ea3nh"),(0,a.kt)("h4",{id:"231-ad\u0131m-1-g\xf6r\xfcnt\xfcy\xfc-olu\u015fturun"},"2.3.1 Ad\u0131m 1: G\xf6r\xfcnt\xfcy\xfc olu\u015fturun"),(0,a.kt)("p",null,"Vui l\xf2ng tham kh\u1ea3o ",(0,a.kt)("a",{parentName:"p",href:"#211-step-1-build-the-image"},"Ch\u01b0\u01a1ng 2.1.1"),"."),(0,a.kt)("h4",{id:"232-c\xe0i-\u0111\u1eb7t-helm"},"2.3.2 C\xe0i \u0111\u1eb7t Helm"),(0,a.kt)("p",null,"Ch\u1ea1y l\u1ec7nh ",(0,a.kt)("inlineCode",{parentName:"p"},"helm install k8sgatekeeper ./k8sgatekeeper"),"."),(0,a.kt)("h2",{id:"3-th\u1eed-k8s-gatekeeper"},"3. Th\u1eed K8s-gatekeeper"),(0,a.kt)("h3",{id:"31-t\u1ea1o-m\xf4-h\xecnh-v\xe0-ch\xednh-s\xe1ch-casbin"},"3.1 T\u1ea1o M\xf4 h\xecnh v\xe0 Ch\xednh s\xe1ch Casbin"),(0,a.kt)("p",null,"B\u1ea1n c\xf3 hai ph\u01b0\u01a1ng ph\xe1p \u0111\u1ec3 t\u1ea1o m\u1ed9t m\xf4 h\xecnh v\xe0 ch\xednh s\xe1ch: th\xf4ng qua kubectl ho\u1eb7c th\xf4ng qua go-client m\xe0 ch\xfang t\xf4i cung c\u1ea5p."),(0,a.kt)("h4",{id:"311-t\u1ea1oc\u1eadp-nh\u1eadt-m\xf4-h\xecnh-v\xe0-ch\xednh-s\xe1ch-casbin-qua-kubectl"},"3.1.1 T\u1ea1o/C\u1eadp nh\u1eadt M\xf4 h\xecnh v\xe0 Ch\xednh s\xe1ch Casbin qua kubectl"),(0,a.kt)("p",null,"Trong K8s-gatekeeper, m\xf4 h\xecnh Casbin \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef trong m\u1ed9t t\xe0i nguy\xean CRD c\xf3 t\xean l\xe0 'CasbinModel'. \u0110\u1ecbnh ngh\u0129a c\u1ee7a n\xf3 n\u1eb1m trong ",(0,a.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinmodels.yaml"),"."),(0,a.kt)("p",null,"C\xf3 v\xed d\u1ee5 trong ",(0,a.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml"),". Ch\xfa \xfd \u0111\u1ebfn c\xe1c tr\u01b0\u1eddng sau:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"metadata.name: t\xean c\u1ee7a m\xf4 h\xecnh. T\xean n\xe0y PH\u1ea2I gi\u1ed1ng v\u1edbi t\xean c\u1ee7a \u0111\u1ed1i t\u01b0\u1ee3ng CasbinPolicy li\xean quan \u0111\u1ebfn m\xf4 h\xecnh n\xe0y, \u0111\u1ec3 K8s-gatekeeper c\xf3 th\u1ec3 gh\xe9p c\u1eb7p ch\xfang v\xe0 t\u1ea1o m\u1ed9t enforcer."),(0,a.kt)("li",{parentName:"ul"},'spec.enable: n\u1ebfu tr\u01b0\u1eddng n\xe0y \u0111\u01b0\u1ee3c \u0111\u1eb7t th\xe0nh "false", m\xf4 h\xecnh n\xe0y (c\u0169ng nh\u01b0 \u0111\u1ed1i t\u01b0\u1ee3ng CasbinPolicy li\xean quan \u0111\u1ebfn m\xf4 h\xecnh n\xe0y) s\u1ebd b\u1ecb b\u1ecf qua.'),(0,a.kt)("li",{parentName:"ul"},"spec.modelText: m\u1ed9t chu\u1ed7i ch\u1ee9a v\u0103n b\u1ea3n m\xf4 h\xecnh c\u1ee7a m\u1ed9t m\xf4 h\xecnh Casbin.")),(0,a.kt)("p",null,"Ch\xednh s\xe1ch Casbin \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef trong m\u1ed9t t\xe0i nguy\xean CRD kh\xe1c \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 'CasbinPolicy', \u0111\u1ecbnh ngh\u0129a c\u1ee7a n\xf3 c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c t\xecm th\u1ea5y trong ",(0,a.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinpolicies.yaml"),"."),(0,a.kt)("p",null,"C\xf3 v\xed d\u1ee5 trong ",(0,a.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/policy.yaml"),". Ch\xfa \xfd \u0111\u1ebfn c\xe1c tr\u01b0\u1eddng sau:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"metadata.name: t\xean c\u1ee7a ch\xednh s\xe1ch. T\xean n\xe0y PH\u1ea2I gi\u1ed1ng v\u1edbi t\xean c\u1ee7a \u0111\u1ed1i t\u01b0\u1ee3ng CasbinModel li\xean quan \u0111\u1ebfn ch\xednh s\xe1ch n\xe0y, \u0111\u1ec3 K8s-gatekeeper c\xf3 th\u1ec3 gh\xe9p c\u1eb7p ch\xfang v\xe0 t\u1ea1o ra m\u1ed9t enforcer."),(0,a.kt)("li",{parentName:"ul"},"spec.policyItem: m\u1ed9t chu\u1ed7i ch\u1ee9a v\u0103n b\u1ea3n ch\xednh s\xe1ch c\u1ee7a m\u1ed9t m\xf4 h\xecnh Casbin.")),(0,a.kt)("p",null,"Sau khi t\u1ea1o c\xe1c t\u1ec7p CasbinModel v\xe0 CasbinPolicy c\u1ee7a ri\xeang b\u1ea1n, s\u1eed d\u1ee5ng l\u1ec7nh sau \u0111\u1ec3 \xe1p d\u1ee5ng ch\xfang:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f <filename>\n")),(0,a.kt)("p",null,"M\u1ed9t khi m\u1ed9t c\u1eb7p CasbinModel v\xe0 CasbinPolicy \u0111\u01b0\u1ee3c t\u1ea1o, K8s-gatekeeper s\u1ebd c\xf3 th\u1ec3 ph\xe1t hi\u1ec7n n\xf3 trong v\xf2ng 5 gi\xe2y."),(0,a.kt)("h4",{id:"312-t\u1ea1oc\u1eadp-nh\u1eadt-m\xf4-h\xecnh-v\xe0-ch\xednh-s\xe1ch-casbin-th\xf4ng-qua-go-client-m\xe0-ch\xfang-t\xf4i-cung-c\u1ea5p"},"3.1.2 T\u1ea1o/C\u1eadp nh\u1eadt M\xf4 h\xecnh v\xe0 Ch\xednh s\xe1ch Casbin th\xf4ng qua go-client m\xe0 ch\xfang t\xf4i cung c\u1ea5p"),(0,a.kt)("p",null,"Ch\xfang t\xf4i hi\u1ec3u r\u1eb1ng c\xf3 th\u1ec3 c\xf3 t\xecnh hu\u1ed1ng m\xe0 vi\u1ec7c s\u1eed d\u1ee5ng shell \u0111\u1ec3 th\u1ef1c thi c\xe1c l\u1ec7nh tr\u1ef1c ti\u1ebfp tr\xean m\u1ed9t n\xfat c\u1ee7a c\u1ee5m K8s kh\xf4ng thu\u1eadn ti\u1ec7n, ch\u1eb3ng h\u1ea1n nh\u01b0 khi b\u1ea1n \u0111ang x\xe2y d\u1ef1ng m\u1ed9t n\u1ec1n t\u1ea3ng \u0111i\u1ec7n to\xe1n \u0111\xe1m m\xe2y t\u1ef1 \u0111\u1ed9ng cho c\xf4ng ty c\u1ee7a m\xecnh. Do \u0111\xf3, ch\xfang t\xf4i \u0111\xe3 ph\xe1t tri\u1ec3n m\u1ed9t go-client \u0111\u1ec3 t\u1ea1o v\xe0 duy tr\xec CasbinModel v\xe0 CasbinPolicy."),(0,a.kt)("p",null,"Th\u01b0 vi\u1ec7n go-client n\u1eb1m trong ",(0,a.kt)("inlineCode",{parentName:"p"},"pkg/client"),"."),(0,a.kt)("p",null,"Trong ",(0,a.kt)("inlineCode",{parentName:"p"},"client.go"),", ch\xfang t\xf4i cung c\u1ea5p m\u1ed9t h\xe0m \u0111\u1ec3 t\u1ea1o m\u1ed9t client."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"func NewK8sGateKeeperClient(externalClient bool) (*K8sGateKeeperClient, error) \n")),(0,a.kt)("p",null,"Tham s\u1ed1 ",(0,a.kt)("inlineCode",{parentName:"p"},"externalClient")," x\xe1c \u0111\u1ecbnh li\u1ec7u K8s-gatekeeper c\xf3 \u0111ang ch\u1ea1y b\xean trong c\u1ee5m K8s hay kh\xf4ng."),(0,a.kt)("p",null,"Trong ",(0,a.kt)("inlineCode",{parentName:"p"},"model.go"),", ch\xfang t\xf4i cung c\u1ea5p nhi\u1ec1u h\xe0m \u0111\u1ec3 t\u1ea1o, x\xf3a v\xe0 s\u1eeda \u0111\u1ed5i CasbinModel. B\u1ea1n c\xf3 th\u1ec3 t\xecm hi\u1ec3u c\xe1ch s\u1eed d\u1ee5ng c\xe1c giao di\u1ec7n n\xe0y trong ",(0,a.kt)("inlineCode",{parentName:"p"},"model_test.go"),"."),(0,a.kt)("p",null,"Trong ",(0,a.kt)("inlineCode",{parentName:"p"},"policy.go"),", ch\xfang t\xf4i cung c\u1ea5p nhi\u1ec1u h\xe0m \u0111\u1ec3 t\u1ea1o, x\xf3a v\xe0 s\u1eeda \u0111\u1ed5i CasbiPolicy. B\u1ea1n c\xf3 th\u1ec3 t\xecm hi\u1ec3u c\xe1ch s\u1eed d\u1ee5ng c\xe1c giao di\u1ec7n n\xe0y trong ",(0,a.kt)("inlineCode",{parentName:"p"},"policy_test.go"),"."),(0,a.kt)("h3",{id:"312-th\u1eed-xem-k8s-gatekeeper-c\xf3-ho\u1ea1t-\u0111\u1ed9ng-kh\xf4ng"},"3.1.2 Th\u1eed xem K8s-gatekeeper c\xf3 ho\u1ea1t \u0111\u1ed9ng kh\xf4ng"),(0,a.kt)("p",null,"Gi\u1ea3 s\u1eed b\u1ea1n \u0111\xe3 t\u1ea1o ch\xednh x\xe1c m\xf4 h\xecnh v\xe0 ch\xednh s\xe1ch trong ",(0,a.kt)("inlineCode",{parentName:"p"},"example/allowed_repo"),". B\xe2y gi\u1edd, h\xe3y th\u1eed l\u1ec7nh sau:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f example/allowed_repo/testcase/reject_1.yaml\n")),(0,a.kt)("p",null,"B\u1ea1n s\u1ebd th\u1ea5y r\u1eb1ng K8s s\u1ebd t\u1eeb ch\u1ed1i y\xeau c\u1ea7u n\xe0y v\xe0 \u0111\u1ec1 c\u1eadp r\u1eb1ng webhook l\xe0 l\xfd do t\u1ea1i sao y\xeau c\u1ea7u n\xe0y b\u1ecb t\u1eeb ch\u1ed1i. Tuy nhi\xean, khi b\u1ea1n th\u1eed \xe1p d\u1ee5ng ",(0,a.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/testcase/approve_2.yaml"),", n\xf3 s\u1ebd \u0111\u01b0\u1ee3c ch\u1ea5p nh\u1eadn."),(0,a.kt)("h2",{id:"4-c\xe1ch-vi\u1ebft-m\xf4-h\xecnh-v\xe0-ch\xednh-s\xe1ch-v\u1edbi-k8s-gatekeeper"},"4. C\xe1ch Vi\u1ebft M\xf4 h\xecnh v\xe0 Ch\xednh s\xe1ch v\u1edbi K8s-gatekeeper"),(0,a.kt)("p",null,"Tr\u01b0\u1edbc h\u1ebft, h\xe3y \u0111\u1ea3m b\u1ea3o b\u1ea1n quen thu\u1ed9c v\u1edbi c\xfa ph\xe1p c\u01a1 b\u1ea3n c\u1ee7a M\xf4 h\xecnh v\xe0 Ch\xednh s\xe1ch Casbin. N\u1ebfu kh\xf4ng, vui l\xf2ng \u0111\u1ecdc ph\u1ea7n ",(0,a.kt)("a",{parentName:"p",href:"/docs/get-started"},"B\u1eaft \u0111\u1ea7u")," tr\u01b0\u1edbc. Trong ch\u01b0\u01a1ng n\xe0y, ch\xfang t\xf4i gi\u1ea3 \u0111\u1ecbnh r\u1eb1ng b\u1ea1n \u0111\xe3 hi\u1ec3u M\xf4 h\xecnh v\xe0 Ch\xednh s\xe1ch Casbin l\xe0 g\xec."),(0,a.kt)("h3",{id:"41-\u0111\u1ecbnh-ngh\u0129a-y\xeau-c\u1ea7u-c\u1ee7a-m\xf4-h\xecnh"},"4.1 \u0110\u1ecbnh ngh\u0129a Y\xeau c\u1ea7u c\u1ee7a M\xf4 h\xecnh"),(0,a.kt)("p",null,"Khi K8s-gatekeeper \u0111ang c\u1ea5p quy\u1ec1n cho m\u1ed9t y\xeau c\u1ea7u, \u0111\u1ea7u v\xe0o lu\xf4n l\xe0 m\u1ed9t \u0111\u1ed1i t\u01b0\u1ee3ng: \u0111\u1ed1i t\u01b0\u1ee3ng Go c\u1ee7a Y\xeau c\u1ea7u Nh\u1eadp c\u1ea3nh. \u0110i\u1ec1u n\xe0y c\xf3 ngh\u0129a l\xe0 enforcer s\u1ebd lu\xf4n \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng nh\u01b0 th\u1ebf n\xe0y:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"ok, err := enforcer.Enforce(admission)\n")),(0,a.kt)("p",null,"trong \u0111\xf3 ",(0,a.kt)("inlineCode",{parentName:"p"},"admission")," l\xe0 m\u1ed9t \u0111\u1ed1i t\u01b0\u1ee3ng ",(0,a.kt)("inlineCode",{parentName:"p"},"AdmissionReview")," \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a b\u1edfi api ch\xednh th\u1ee9c c\u1ee7a K8s ",(0,a.kt)("inlineCode",{parentName:"p"},'"k8s.io/api/admission/v1"'),". B\u1ea1n c\xf3 th\u1ec3 t\xecm th\u1ea5y \u0111\u1ecbnh ngh\u0129a c\u1ee7a c\u1ea5u tr\xfac n\xe0y trong kho l\u01b0u tr\u1eef n\xe0y: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"},"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"),". \u0110\u1ec3 bi\u1ebft th\xeam th\xf4ng tin, b\u1ea1n c\u0169ng c\xf3 th\u1ec3 tham kh\u1ea3o ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"},"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"),"."),(0,a.kt)("p",null,"Do \u0111\xf3, \u0111\u1ed1i v\u1edbi b\u1ea5t k\u1ef3 m\xf4 h\xecnh n\xe0o \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng b\u1edfi K8s-gatekeeper, \u0111\u1ecbnh ngh\u0129a c\u1ee7a ",(0,a.kt)("inlineCode",{parentName:"p"},"request_definition")," lu\xf4n ph\u1ea3i nh\u01b0 sau:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"    [request_definition]\n    r =  obj\n")),(0,a.kt)("p",null,"T\xean 'obj' kh\xf4ng b\u1eaft bu\u1ed9c, mi\u1ec5n l\xe0 t\xean \u0111\xf3 nh\u1ea5t qu\xe1n v\u1edbi t\xean \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng trong ph\u1ea7n ",(0,a.kt)("inlineCode",{parentName:"p"},"[matchers]"),"."),(0,a.kt)("h3",{id:"42-matchers-c\u1ee7a-m\xf4-h\xecnh"},"4.2 Matchers c\u1ee7a M\xf4 h\xecnh"),(0,a.kt)("p",null,"B\u1ea1n \u0111\u01b0\u1ee3c k\u1ef3 v\u1ecdng s\u1eed d\u1ee5ng t\xednh n\u0103ng ABAC c\u1ee7a Casbin \u0111\u1ec3 vi\u1ebft c\xe1c quy t\u1eafc c\u1ee7a b\u1ea1n. Tuy nhi\xean, b\u1ed9 \u0111\xe1nh gi\xe1 bi\u1ec3u th\u1ee9c t\xedch h\u1ee3p trong Casbin kh\xf4ng h\u1ed7 tr\u1ee3 l\u1eadp ch\u1ec9 m\u1ee5c trong b\u1ea3n \u0111\u1ed3 ho\u1eb7c m\u1ea3ng (slices), c\u0169ng nh\u01b0 kh\xf4ng h\u1ed7 tr\u1ee3 m\u1edf r\u1ed9ng m\u1ea3ng. Do \u0111\xf3, K8s-gatekeeper cung c\u1ea5p c\xe1c 'h\xe0m Casbin' kh\xe1c nhau nh\u01b0 c\xe1c ph\u1ea7n m\u1edf r\u1ed9ng \u0111\u1ec3 th\u1ef1c hi\u1ec7n c\xe1c t\xednh n\u0103ng n\xe0y. N\u1ebfu b\u1ea1n v\u1eabn th\u1ea5y r\u1eb1ng nhu c\u1ea7u c\u1ee7a b\u1ea1n kh\xf4ng th\u1ec3 \u0111\u01b0\u1ee3c \u0111\xe1p \u1ee9ng b\u1edfi c\xe1c ph\u1ea7n m\u1edf r\u1ed9ng n\xe0y, h\xe3y tho\u1ea3i m\xe1i b\u1eaft \u0111\u1ea7u m\u1ed9t v\u1ea5n \u0111\u1ec1, ho\u1eb7c t\u1ea1o m\u1ed9t pull request."),(0,a.kt)("p",null,"N\u1ebfu b\u1ea1n kh\xf4ng quen thu\u1ed9c v\u1edbi c\xe1c h\xe0m Casbin, b\u1ea1n c\xf3 th\u1ec3 tham kh\u1ea3o ",(0,a.kt)("a",{parentName:"p",href:"/docs/function"},"Function")," \u0111\u1ec3 bi\u1ebft th\xeam th\xf4ng tin."),(0,a.kt)("p",null,"D\u01b0\u1edbi \u0111\xe2y l\xe0 c\xe1c h\xe0m m\u1edf r\u1ed9ng:"),(0,a.kt)("h3",{id:"421-c\xe1c-h\xe0m-m\u1edf-r\u1ed9ng"},"4.2.1 C\xe1c h\xe0m m\u1edf r\u1ed9ng"),(0,a.kt)("h4",{id:"4211-truy-c\u1eadp"},"4.2.1.1 truy c\u1eadp"),(0,a.kt)("p",null,"Truy c\u1eadp \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1 m\xe0 Casbin kh\xf4ng h\u1ed7 tr\u1ee3 \u0111\xe1nh ch\u1ec9 m\u1ee5c trong b\u1ea3n \u0111\u1ed3 ho\u1eb7c m\u1ea3ng. V\xed d\u1ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml")," minh h\u1ecda vi\u1ec7c s\u1eed d\u1ee5ng ch\u1ee9c n\u0103ng n\xe0y:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n')),(0,a.kt)("p",null,"Trong b\u1ed9 so kh\u1edbp n\xe0y, ",(0,a.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image")')," t\u01b0\u01a1ng \u0111\u01b0\u01a1ng v\u1edbi ",(0,a.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Image"),", trong \u0111\xf3 ",(0,a.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers")," l\xe0 m\u1ed9t slice."),(0,a.kt)("p",null,"Truy c\u1eadp c\u0169ng c\xf3 th\u1ec3 g\u1ecdi c\xe1c h\xe0m \u0111\u01a1n gi\u1ea3n kh\xf4ng c\xf3 tham s\u1ed1 v\xe0 tr\u1ea3 v\u1ec1 m\u1ed9t gi\xe1 tr\u1ecb duy nh\u1ea5t. V\xed d\u1ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"example/container_resource_limit/model.yaml")," minh h\u1ecda \u0111i\u1ec1u n\xe0y:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\n  m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")) >= parseFloat(p.cpu) && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","memory","Value")) >= parseFloat(p.memory)\n')),(0,a.kt)("p",null,"Trong b\u1ed9 so kh\u1edbp n\xe0y, ",(0,a.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")')," t\u01b0\u01a1ng \u0111\u01b0\u01a1ng v\u1edbi ",(0,a.kt)("inlineCode",{parentName:"p"},'r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits["cpu"].Value()'),", trong \u0111\xf3 ",(0,a.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits")," l\xe0 m\u1ed9t b\u1ea3n \u0111\u1ed3, v\xe0 ",(0,a.kt)("inlineCode",{parentName:"p"},"Value()")," l\xe0 m\u1ed9t h\xe0m \u0111\u01a1n gi\u1ea3n kh\xf4ng c\xf3 tham s\u1ed1 v\xe0 tr\u1ea3 v\u1ec1 m\u1ed9t gi\xe1 tr\u1ecb duy nh\u1ea5t."),(0,a.kt)("h4",{id:"4212-truyc\u1eadpv\u1edbik\xfdt\u1ef1\u0111\u1ea1idi\u1ec7n"},"4.2.1.2 truyC\u1eadpV\u1edbiK\xfdT\u1ef1\u0110\u1ea1iDi\u1ec7n"),(0,a.kt)("p",null,'\u0110\xf4i khi, b\u1ea1n c\xf3 th\u1ec3 c\xf3 nhu c\u1ea7u nh\u01b0 th\u1ebf n\xe0y: t\u1ea5t c\u1ea3 c\xe1c ph\u1ea7n t\u1eed trong m\u1ed9t m\u1ea3ng ph\u1ea3i c\xf3 ti\u1ec1n t\u1ed1 "aaa". Tuy nhi\xean, Casbin kh\xf4ng h\u1ed7 tr\u1ee3 v\xf2ng l\u1eb7p ',(0,a.kt)("inlineCode",{parentName:"p"},"for"),". V\u1edbi ",(0,a.kt)("inlineCode",{parentName:"p"},"accessWithWildcard"),' v\xe0 t\xednh n\u0103ng "m\u1edf r\u1ed9ng b\u1ea3n \u0111\u1ed3/slice", b\u1ea1n c\xf3 th\u1ec3 d\u1ec5 d\xe0ng th\u1ef1c hi\u1ec7n y\xeau c\u1ea7u nh\u01b0 v\u1eady.'),(0,a.kt)("p",null,"V\xed d\u1ee5, gi\u1ea3 s\u1eed ",(0,a.kt)("inlineCode",{parentName:"p"},"a.b.c")," l\xe0 m\u1ed9t m\u1ea3ng ",(0,a.kt)("inlineCode",{parentName:"p"},"[aaa, bbb, ccc, ddd, eee]"),", th\xec k\u1ebft qu\u1ea3 c\u1ee7a ",(0,a.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a, "b", "c", "*")')," s\u1ebd l\xe0 m\u1ed9t slice ",(0,a.kt)("inlineCode",{parentName:"p"},"[aaa, bbb, ccc, ddd, eee]"),". B\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng k\xfd t\u1ef1 \u0111\u1ea1i di\u1ec7n ",(0,a.kt)("inlineCode",{parentName:"p"},"*"),", slice \u0111\u01b0\u1ee3c m\u1edf r\u1ed9ng."),(0,a.kt)("p",null,"T\u01b0\u01a1ng t\u1ef1, k\xfd t\u1ef1 \u0111\u1ea1i di\u1ec7n c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng nhi\u1ec1u h\u01a1n m\u1ed9t l\u1ea7n. V\xed d\u1ee5, k\u1ebft qu\u1ea3 c\u1ee7a ",(0,a.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a, "b", "c", "*", "*")')," s\u1ebd l\xe0 ",(0,a.kt)("inlineCode",{parentName:"p"},"[a.b.c[0][0], a.b.c[0][1], ..., a.b.c[1][0], a.b.c[1][1], ...]"),"."),(0,a.kt)("h3",{id:"4213-c\xe1c-h\xe0m-h\u1ed7-tr\u1ee3-\u0111\u1ed1i-s\u1ed1-c\xf3-\u0111\u1ed9-d\xe0i-bi\u1ebfn-\u0111\u1ed5i"},"4.2.1.3 C\xe1c h\xe0m h\u1ed7 tr\u1ee3 \u0111\u1ed1i s\u1ed1 c\xf3 \u0111\u1ed9 d\xe0i bi\u1ebfn \u0111\u1ed5i"),(0,a.kt)("p",null,"Trong tr\xecnh \u0111\xe1nh gi\xe1 bi\u1ec3u th\u1ee9c c\u1ee7a Casbin, khi m\u1ed9t tham s\u1ed1 l\xe0 m\u1ed9t m\u1ea3ng, n\xf3 s\u1ebd \u0111\u01b0\u1ee3c t\u1ef1 \u0111\u1ed9ng m\u1edf r\u1ed9ng th\xe0nh m\u1ed9t \u0111\u1ed1i s\u1ed1 c\xf3 \u0111\u1ed9 d\xe0i bi\u1ebfn \u0111\u1ed5i. S\u1eed d\u1ee5ng t\xednh n\u0103ng n\xe0y \u0111\u1ec3 h\u1ed7 tr\u1ee3 m\u1edf r\u1ed9ng m\u1ea3ng/slice/b\u1ea3n \u0111\u1ed3, ch\xfang t\xf4i c\u0169ng \u0111\xe3 t\xedch h\u1ee3p m\u1ed9t s\u1ed1 h\xe0m ch\u1ea5p nh\u1eadn m\u1ea3ng/slice l\xe0m tham s\u1ed1:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"contain(): ch\u1ea5p nh\u1eadn nhi\u1ec1u tham s\u1ed1 v\xe0 tr\u1ea3 v\u1ec1 xem b\u1ea5t k\u1ef3 tham s\u1ed1 n\xe0o (ngo\u1ea1i tr\u1eeb tham s\u1ed1 cu\u1ed1i c\xf9ng) c\xf3 b\u1eb1ng tham s\u1ed1 cu\u1ed1i c\xf9ng hay kh\xf4ng."),(0,a.kt)("li",{parentName:"ul"},"split(a, b, c..., sep, index): tr\u1ea3 v\u1ec1 m\u1ed9t slice ch\u1ee9a ",(0,a.kt)("inlineCode",{parentName:"li"},"[splits(a, sep)[index], splits(b, sep)[index], splits(a, sep)[index], ...]"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"len()"),": tr\u1ea3 v\u1ec1 \u0111\u1ed9 d\xe0i c\u1ee7a \u0111\u1ed1i s\u1ed1 c\xf3 \u0111\u1ed9 d\xe0i thay \u0111\u1ed5i."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"matchRegex(a, b, c..., regex)"),": tr\u1ea3 v\u1ec1 xem t\u1ea5t c\u1ea3 c\xe1c tham s\u1ed1 \u0111\xe3 cho (",(0,a.kt)("inlineCode",{parentName:"li"},"a"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"b"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"c"),", ...) c\xf3 kh\u1edbp v\u1edbi regex \u0111\xe3 cho.")),(0,a.kt)("p",null,"\u0110\xe2y l\xe0 m\u1ed9t v\xed d\u1ee5 trong ",(0,a.kt)("inlineCode",{parentName:"p"},"example/disallowed_tag/model.yaml"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},'    [matchers]\n    m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n    contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,a.kt)("p",null,"Gi\u1ea3 s\u1eed r\u1eb1ng ",(0,a.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers, "*", "Image")')," tr\u1ea3 v\u1ec1 ",(0,a.kt)("inlineCode",{parentName:"p"},'["a:b", "c:d", "e:f", "g:h"]'),", b\u1edfi v\xec ",(0,a.kt)("inlineCode",{parentName:"p"},"splits")," h\u1ed7 tr\u1ee3 \u0111\u1ed1i s\u1ed1 c\xf3 \u0111\u1ed9 d\xe0i thay \u0111\u1ed5i v\xe0 th\u1ef1c hi\u1ec7n ph\xe9p chia tr\xean m\u1ed7i ph\u1ea7n t\u1eed, ph\u1ea7n t\u1eed t\u1ea1i ch\u1ec9 s\u1ed1 1 s\u1ebd \u0111\u01b0\u1ee3c ch\u1ecdn v\xe0 tr\u1ea3 v\u1ec1. Do \u0111\xf3, ",(0,a.kt)("inlineCode",{parentName:"p"},'split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers, "*", "Image"), ":", 1)')," tr\u1ea3 v\u1ec1 ",(0,a.kt)("inlineCode",{parentName:"p"},'["b", "d", "f", "h"]'),". V\xe0 ",(0,a.kt)("inlineCode",{parentName:"p"},'contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers, "*", "Image"), ":", 1), p.obj)')," tr\u1ea3 v\u1ec1 xem ",(0,a.kt)("inlineCode",{parentName:"p"},"p.obj")," c\xf3 \u0111\u01b0\u1ee3c ch\u1ee9a trong ",(0,a.kt)("inlineCode",{parentName:"p"},'["b", "d", "f", "h"]'),"."),(0,a.kt)("h4",{id:"4212-c\xe1c-h\xe0m-chuy\u1ec3n-\u0111\u1ed5i-ki\u1ec3u"},"4.2.1.2 C\xe1c H\xe0m Chuy\u1ec3n \u0110\u1ed5i Ki\u1ec3u"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ParseFloat()"),": Chuy\u1ec3n \u0111\u1ed5i m\u1ed9t s\u1ed1 nguy\xean th\xe0nh m\u1ed9t s\u1ed1 th\u1ef1c (\u0111i\u1ec1u n\xe0y l\xe0 c\u1ea7n thi\u1ebft v\xec b\u1ea5t k\u1ef3 s\u1ed1 n\xe0o \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng trong so s\xe1nh ph\u1ea3i \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ed5i th\xe0nh s\u1ed1 th\u1ef1c)."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ToString()"),": Chuy\u1ec3n \u0111\u1ed5i m\u1ed9t \u0111\u1ed1i t\u01b0\u1ee3ng th\xe0nh m\u1ed9t chu\u1ed7i. \u0110\u1ed1i t\u01b0\u1ee3ng n\xe0y ph\u1ea3i c\xf3 m\u1ed9t ki\u1ec3u c\u01a1 b\u1ea3n l\xe0 chu\u1ed7i (v\xed d\u1ee5, m\u1ed9t \u0111\u1ed1i t\u01b0\u1ee3ng ki\u1ec3u ",(0,a.kt)("inlineCode",{parentName:"li"},"XXX")," khi c\xf3 m\u1ed9t c\xe2u l\u1ec7nh ",(0,a.kt)("inlineCode",{parentName:"li"},"type XXX string"),")."),(0,a.kt)("li",{parentName:"ul"},"IsNil(): Tr\u1ea3 v\u1ec1 li\u1ec7u tham s\u1ed1 c\xf3 ph\u1ea3i l\xe0 nil hay kh\xf4ng.")),(0,a.kt)("h2",{id:"5-c\xe0i-\u0111\u1eb7t-n\xe2ng-cao"},"5. C\xe0i \u0111\u1eb7t N\xe2ng cao"),(0,a.kt)("h3",{id:"51-v\u1ec1-ch\u1ee9ng-ch\u1ec9"},"5.1 V\u1ec1 Ch\u1ee9ng ch\u1ec9"),(0,a.kt)("p",null,"Trong Kubernetes (k8s), b\u1eaft bu\u1ed9c ph\u1ea3i s\u1eed d\u1ee5ng HTTPS cho m\u1ed9t webhook. C\xf3 hai c\xe1ch ti\u1ebfp c\u1eadn \u0111\u1ec3 \u0111\u1ea1t \u0111\u01b0\u1ee3c \u0111i\u1ec1u n\xe0y:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"S\u1eed d\u1ee5ng ch\u1ee9ng ch\u1ec9 t\u1ef1 k\xfd (c\xe1c v\xed d\u1ee5 trong kho l\u01b0u tr\u1eef n\xe0y s\u1eed d\u1ee5ng ph\u01b0\u01a1ng ph\xe1p n\xe0y)"),(0,a.kt)("li",{parentName:"ul"},"S\u1eed d\u1ee5ng ch\u1ee9ng ch\u1ec9 b\xecnh th\u01b0\u1eddng")),(0,a.kt)("h4",{id:"511-ch\u1ee9ng-ch\u1ec9-t\u1ef1-k\xfd"},"5.1.1 Ch\u1ee9ng ch\u1ec9 t\u1ef1 k\xfd"),(0,a.kt)("p",null,"S\u1eed d\u1ee5ng ch\u1ee9ng ch\u1ec9 t\u1ef1 k\xfd c\xf3 ngh\u0129a l\xe0 T\u1ed5 ch\u1ee9c Ch\u1ee9ng ch\u1ec9 (CA) c\u1ea5p ch\u1ee9ng ch\u1ec9 kh\xf4ng ph\u1ea3i l\xe0 m\u1ed9t trong nh\u1eefng CA n\u1ed5i ti\u1ebfng. Do \u0111\xf3, b\u1ea1n ph\u1ea3i cho k8s bi\u1ebft v\u1ec1 CA n\xe0y."),(0,a.kt)("p",null,"Hi\u1ec7n t\u1ea1i, v\xed d\u1ee5 trong kho l\u01b0u tr\u1eef n\xe0y s\u1eed d\u1ee5ng m\u1ed9t CA t\u1ef1 l\xe0m, kh\xf3a ri\xeang v\xe0 ch\u1ee9ng ch\u1ec9 c\u1ee7a n\xf3 \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef trong ",(0,a.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.crt")," v\xe0 ",(0,a.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.key")," t\u01b0\u01a1ng \u1ee9ng. Ch\u1ee9ng ch\u1ec9 cho webhook l\xe0 ",(0,a.kt)("inlineCode",{parentName:"p"},"config/certificate/server.crt"),', \u0111\u01b0\u1ee3c c\u1ea5p b\u1edfi CA t\u1ef1 l\xe0m. C\xe1c t\xean mi\u1ec1n c\u1ee7a ch\u1ee9ng ch\u1ec9 n\xe0y l\xe0 "webhook.domain.local" (cho webhook b\xean ngo\xe0i) v\xe0 "casbin-webhook-svc.default.svc" (cho webhook n\u1ed9i b\u1ed9).'),(0,a.kt)("p",null,"Th\xf4ng tin v\u1ec1 CA \u0111\u01b0\u1ee3c truy\u1ec1n cho k8s th\xf4ng qua c\xe1c t\u1ec7p c\u1ea5u h\xecnh webhook. C\u1ea3 ",(0,a.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," v\xe0 ",(0,a.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),' \u0111\u1ec1u c\xf3 m\u1ed9t tr\u01b0\u1eddng g\u1ecdi l\xe0 "CABundle", ch\u1ee9a m\u1ed9t chu\u1ed7i \u0111\u01b0\u1ee3c m\xe3 h\xf3a base64 c\u1ee7a ch\u1ee9ng ch\u1ec9 CA.'),(0,a.kt)("p",null,"Trong tr\u01b0\u1eddng h\u1ee3p b\u1ea1n c\u1ea7n thay \u0111\u1ed5i ch\u1ee9ng ch\u1ec9/t\xean mi\u1ec1n (v\xed d\u1ee5, n\u1ebfu b\u1ea1n mu\u1ed1n \u0111\u1eb7t webhook n\xe0y v\xe0o m\u1ed9t namespace kh\xe1c c\u1ee7a k8s trong khi s\u1eed d\u1ee5ng webhook n\u1ed9i b\u1ed9, ho\u1eb7c n\u1ebfu b\u1ea1n mu\u1ed1n thay \u0111\u1ed5i t\xean mi\u1ec1n trong khi s\u1eed d\u1ee5ng webhook b\xean ngo\xe0i), c\xe1c th\u1ee7 t\u1ee5c sau \u0111\xe2y n\xean \u0111\u01b0\u1ee3c tu\xe2n theo:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"T\u1ea1o m\u1ed9t CA m\u1edbi:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"T\u1ea1o kh\xf3a ri\xeang cho CA gi\u1ea3:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out ca.key 2048\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"X\xf3a b\u1ea3o v\u1ec7 m\u1eadt kh\u1ea9u c\u1ee7a kh\xf3a ri\xeang:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"openssl rsa -in ca.key -out ca.key\n"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"T\u1ea1o m\u1ed9t kh\xf3a ri\xeang cho m\xe1y ch\u1ee7 webhook:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out server.key 2048\nopenssl rsa -in server.key -out server.key\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"S\u1eed d\u1ee5ng CA t\u1ef1 t\u1ea1o \u0111\u1ec3 k\xfd ch\u1ee9ng ch\u1ec9 cho webhook:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Sao ch\xe9p t\u1ec7p c\u1ea5u h\xecnh openssl c\u1ee7a h\u1ec7 th\u1ed1ng c\u1ee7a b\u1ea1n \u0111\u1ec3 s\u1eed d\u1ee5ng t\u1ea1m th\u1eddi. B\u1ea1n c\xf3 th\u1ec3 t\xecm ra v\u1ecb tr\xed c\u1ee7a t\u1ec7p c\u1ea5u h\xecnh b\u1eb1ng c\xe1ch ch\u1ea1y ",(0,a.kt)("inlineCode",{parentName:"p"},"openssl version -a"),", th\u01b0\u1eddng \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 ",(0,a.kt)("inlineCode",{parentName:"p"},"openssl.cnf"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Trong t\u1ec7p c\u1ea5u h\xecnh:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"T\xecm \u0111o\u1ea1n ",(0,a.kt)("inlineCode",{parentName:"p"},"[req]")," v\xe0 th\xeam d\xf2ng sau: ",(0,a.kt)("inlineCode",{parentName:"p"},"req_extensions = v3_req"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"T\xecm \u0111o\u1ea1n ",(0,a.kt)("inlineCode",{parentName:"p"},"[v3_req]")," v\xe0 th\xeam d\xf2ng sau: ",(0,a.kt)("inlineCode",{parentName:"p"},"subjectAltName = @alt_names"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"N\u1ed1i c\xe1c d\xf2ng sau v\xe0o t\u1ec7p:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"[alt_names]\nDNS.2=<The domain you want>\n")),(0,a.kt)("p",{parentName:"li"},"L\u01b0u \xfd: Thay th\u1ebf 'casbin-webhook-svc.default.svc' b\u1eb1ng t\xean d\u1ecbch v\u1ee5 th\u1ef1c t\u1ebf c\u1ee7a d\u1ecbch v\u1ee5 c\u1ee7a b\u1ea1n n\u1ebfu b\u1ea1n quy\u1ebft \u0111\u1ecbnh s\u1eeda \u0111\u1ed5i t\xean d\u1ecbch v\u1ee5.")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"S\u1eed d\u1ee5ng t\u1ec7p c\u1ea5u h\xecnh \u0111\xe3 s\u1eeda \u0111\u1ed5i \u0111\u1ec3 t\u1ea1o t\u1ec7p y\xeau c\u1ea7u ch\u1ee9ng ch\u1ec9:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"openssl req -new -nodes -keyout server.key -out server.csr -config openssl.cnf\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"S\u1eed d\u1ee5ng CA t\u1ef1 t\u1ea1o \u0111\u1ec3 \u0111\xe1p \u1ee9ng y\xeau c\u1ea7u v\xe0 k\xfd ch\u1ee9ng ch\u1ec9:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"openssl x509 -req -days 3650 -in server.csr -out server.crt -CA ca.crt -CAkey ca.key -CAcreateserial -extensions v3_req -extensions SAN -extfile openssl.cnf\n"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Thay th\u1ebf tr\u01b0\u1eddng 'CABundle': C\u1eadp nh\u1eadt tr\u01b0\u1eddng n\xe0y v\u1edbi ch\u1ee9ng ch\u1ec9 m\u1edbi.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"N\u1ebfu b\u1ea1n \u0111ang s\u1eed d\u1ee5ng helm, c\u1ea7n \xe1p d\u1ee5ng c\xe1c thay \u0111\u1ed5i t\u01b0\u01a1ng t\u1ef1 cho bi\u1ec3u \u0111\u1ed3 helm."))),(0,a.kt)("h4",{id:"512-ch\u1ee9ng-ch\u1ec9-ph\xe1p-l\xfd"},"5.1.2 Ch\u1ee9ng ch\u1ec9 ph\xe1p l\xfd"),(0,a.kt)("p",null,'N\u1ebfu b\u1ea1n s\u1eed d\u1ee5ng ch\u1ee9ng ch\u1ec9 ph\xe1p l\xfd, b\u1ea1n kh\xf4ng c\u1ea7n ph\u1ea3i tr\u1ea3i qua t\u1ea5t c\u1ea3 c\xe1c th\u1ee7 t\u1ee5c n\xe0y. X\xf3a tr\u01b0\u1eddng "CABundle" trong ',(0,a.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," v\xe0 ",(0,a.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),", v\xe0 thay \u0111\u1ed5i t\xean mi\u1ec1n trong c\xe1c t\u1ec7p n\xe0y th\xe0nh t\xean mi\u1ec1n m\xe0 b\u1ea1n s\u1edf h\u1eefu."))}s.isMDXComponent=!0}}]);