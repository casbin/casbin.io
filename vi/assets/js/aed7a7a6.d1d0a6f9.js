"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[4357],{3905:(n,t,e)=>{e.d(t,{Zo:()=>l,kt:()=>g});var h=e(7294);function i(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function c(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(n);t&&(h=h.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,h)}return e}function a(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?c(Object(e),!0).forEach((function(t){i(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):c(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function u(n,t){if(null==n)return{};var e,h,i=function(n,t){if(null==n)return{};var e,h,i={},c=Object.keys(n);for(h=0;h<c.length;h++)e=c[h],t.indexOf(e)>=0||(i[e]=n[e]);return i}(n,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);for(h=0;h<c.length;h++)e=c[h],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(i[e]=n[e])}return i}var r=h.createContext({}),o=function(n){var t=h.useContext(r),e=t;return n&&(e="function"==typeof n?n(t):a(a({},t),n)),e},l=function(n){var t=o(n.components);return h.createElement(r.Provider,{value:t},n.children)},p={inlineCode:"code",wrapper:function(n){var t=n.children;return h.createElement(h.Fragment,{},t)}},s=h.forwardRef((function(n,t){var e=n.components,i=n.mdxType,c=n.originalType,r=n.parentName,l=u(n,["components","mdxType","originalType","parentName"]),s=o(e),g=i,m=s["".concat(r,".").concat(g)]||s[g]||p[g]||c;return e?h.createElement(m,a(a({ref:t},l),{},{components:e})):h.createElement(m,a({ref:t},l))}));function g(n,t){var e=arguments,i=t&&t.mdxType;if("string"==typeof n||i){var c=e.length,a=new Array(c);a[0]=s;var u={};for(var r in t)hasOwnProperty.call(t,r)&&(u[r]=t[r]);u.originalType=n,u.mdxType="string"==typeof n?n:i,a[1]=u;for(var o=2;o<c;o++)a[o]=e[o];return h.createElement.apply(null,a)}return h.createElement.apply(null,e)}s.displayName="MDXCreateElement"},7718:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>r,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>u,toc:()=>o});var h=e(7462),i=(e(7294),e(3905));const c={title:"\u1ee6y quy\u1ec1n trong APISIX s\u1eed d\u1ee5ng Casbin",author:"Rushikesh Tote",authorTitle:"Th\xe0nh vi\xean c\u1ee7a Casbin",authorURL:"http://github.com/rushitote",authorImageURL:"https://avatars.githubusercontent.com/rushitote"},a=void 0,u={permalink:"/vi/blog/2021/08/19/apisix-casbin-authorization",editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/i18n/vi/docusaurus-plugin-content-blog/2021-08-19-apisix-casbin-authorization.md",source:"@site/i18n/vi/docusaurus-plugin-content-blog/2021-08-19-apisix-casbin-authorization.md",title:"\u1ee6y quy\u1ec1n trong APISIX s\u1eed d\u1ee5ng Casbin",description:"Gi\u1edbi thi\u1ec7u",date:"2021-08-19T00:00:00.000Z",formattedDate:"19 th\xe1ng 8, 2021",tags:[],readingTime:6.985,hasTruncateMarker:!1,authors:[{name:"Rushikesh Tote",title:"Th\xe0nh vi\xean c\u1ee7a Casbin",url:"http://github.com/rushitote",imageURL:"https://avatars.githubusercontent.com/rushitote"}],frontMatter:{title:"\u1ee6y quy\u1ec1n trong APISIX s\u1eed d\u1ee5ng Casbin",author:"Rushikesh Tote",authorTitle:"Th\xe0nh vi\xean c\u1ee7a Casbin",authorURL:"http://github.com/rushitote",authorImageURL:"https://avatars.githubusercontent.com/rushitote"},prevItem:{title:"Understanding How Casbin Matching Works in Detail",permalink:"/vi/blog/2023/12/08/understanding-casbin-matching-in-detail"},nextItem:{title:"Yang Luo - Ng\u01b0\u1eddi th\u1eafng gi\u1ea3i Google Open Source Peer Bonus",permalink:"/vi/blog/2020/04/21/google-award"}},r={authorsImageUrls:[void 0]},o=[{value:"Gi\u1edbi thi\u1ec7u",id:"gi\u1edbi-thi\u1ec7u",level:2},{value:"T\u1ea1o m\u1ed9t m\xf4 h\xecnh",id:"t\u1ea1o-m\u1ed9t-m\xf4-h\xecnh",level:2},{value:"T\u1ea1o m\u1ed9t ch\xednh s\xe1ch",id:"t\u1ea1o-m\u1ed9t-ch\xednh-s\xe1ch",level:2},{value:"K\xedch ho\u1ea1t plugin tr\xean tuy\u1ebfn \u0111\u01b0\u1eddng",id:"k\xedch-ho\u1ea1t-plugin-tr\xean-tuy\u1ebfn-\u0111\u01b0\u1eddng",level:2},{value:"K\xedch ho\u1ea1t plugin s\u1eed d\u1ee5ng m\xf4 h\xecnh/ch\xednh s\xe1ch to\xe0n c\u1ee5c",id:"k\xedch-ho\u1ea1t-plugin-s\u1eed-d\u1ee5ng-m\xf4-h\xecnhch\xednh-s\xe1ch-to\xe0n-c\u1ee5c",level:2},{value:"Tr\u01b0\u1eddng h\u1ee3p s\u1eed d\u1ee5ng",id:"tr\u01b0\u1eddng-h\u1ee3p-s\u1eed-d\u1ee5ng",level:2}],l={toc:o};function p(n){let{components:t,...c}=n;return(0,i.kt)("wrapper",(0,h.Z)({},l,c,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"gi\u1edbi-thi\u1ec7u"},"Gi\u1edbi thi\u1ec7u"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://apisix.apache.org/"},"APISIX")," l\xe0 m\u1ed9t c\u1ed5ng API \u0111\xe1ng tin c\u1eady, hi\u1ec7u su\u1ea5t cao v\xe0 c\xf3 kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng d\u1ef1a tr\xean Nginx v\xe0 etcd. N\xf3 l\xe0 m\u1ed9t d\u1ef1 \xe1n ngu\u1ed3n m\u1edf c\u1ee7a Qu\u1ef9 Ph\u1ea7n m\u1ec1m Apache. Ngo\xe0i ra, \u0111i\u1ec1u l\xe0m cho APISIX tr\u1edf n\xean tuy\u1ec7t v\u1eddi l\xe0 s\u1ef1 h\u1ed7 tr\u1ee3 c\u1ee7a nhi\u1ec1u plugin t\xedch h\u1ee3p \u0111\u1ec9nh cao c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 tri\u1ec3n khai c\xe1c t\xednh n\u0103ng nh\u01b0 x\xe1c th\u1ef1c, gi\xe1m s\xe1t, \u0111\u1ecbnh tuy\u1ebfn, v.v. V\xe0 th\u1ef1c t\u1ebf l\xe0 c\xe1c plugin trong APISIX \u0111\u01b0\u1ee3c t\u1ea3i l\u1ea1i n\xf3ng (kh\xf4ng c\u1ea7n kh\u1edfi \u0111\u1ed9ng l\u1ea1i) l\xe0m cho n\xf3 r\u1ea5t linh ho\u1ea1t."),(0,i.kt)("p",null,"Tuy nhi\xean, khi s\u1eed d\u1ee5ng APISIX, c\xf3 th\u1ec3 c\xf3 nh\u1eefng t\xecnh hu\u1ed1ng m\xe0 b\u1ea1n mu\u1ed1n th\xeam logic \u1ee7y quy\u1ec1n ph\u1ee9c t\u1ea1p v\xe0o \u1ee9ng d\u1ee5ng c\u1ee7a m\xecnh. \u0110\xe2y l\xe0 n\u01a1i m\xe0 authz-casbin c\xf3 th\u1ec3 gi\xfap b\u1ea1n, authz-casbin l\xe0 m\u1ed9t plugin c\u1ee7a APISIX d\u1ef1a tr\xean ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/casbin/lua-casbin/"},"Lua Casbin")," cho ph\xe9p \u1ee7y quy\u1ec1n m\u1ea1nh m\u1ebd d\u1ef1a tr\xean nhi\u1ec1u m\xf4 h\xecnh ki\u1ec3m so\xe1t truy c\u1eadp kh\xe1c nhau. ",(0,i.kt)("a",{parentName:"p",href:"/"},"Casbin")," l\xe0 m\u1ed9t th\u01b0 vi\u1ec7n \u1ee7y quy\u1ec1n h\u1ed7 tr\u1ee3 c\xe1c m\xf4 h\xecnh ki\u1ec3m so\xe1t truy c\u1eadp nh\u01b0 ACL, RBAC, ABAC. Ban \u0111\u1ea7u \u0111\u01b0\u1ee3c vi\u1ebft b\u1eb1ng Go, n\xf3 \u0111\xe3 \u0111\u01b0\u1ee3c chuy\u1ec3n sang nhi\u1ec1u ng\xf4n ng\u1eef kh\xe1c v\xe0 Lua Casbin l\xe0 vi\u1ec7c tri\u1ec3n khai Lua c\u1ee7a Casbin. S\u1ef1 ph\xe1t tri\u1ec3n c\u1ee7a authz-casbin b\u1eaft \u0111\u1ea7u khi ch\xfang t\xf4i \u0111\u1ec1 xu\u1ea5t m\u1ed9t plugin m\u1edbi cho \u1ee7y quy\u1ec1n trong kho l\u01b0u tr\u1eef APISIX (",(0,i.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/issues/4674"},"#4674"),") m\xe0 c\xe1c th\xe0nh vi\xean ch\xednh \u0111\xe3 \u0111\u1ed3ng \xfd. V\xe0 sau nh\u1eefng \u0111\xe1nh gi\xe1 h\u1eefu \xedch d\u1eabn \u0111\u1ebfn m\u1ed9t s\u1ed1 thay \u0111\u1ed5i v\xe0 c\u1ea3i ti\u1ebfn l\u1edbn, PR (",(0,i.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/pull/4710"},"#4710"),") cu\u1ed1i c\xf9ng \u0111\xe3 \u0111\u01b0\u1ee3c h\u1ee3p nh\u1ea5t."),(0,i.kt)("p",null,"Trong b\xe0i blog n\xe0y, ch\xfang t\xf4i s\u1ebd s\u1eed d\u1ee5ng plugin authz-casbin \u0111\u1ec3 ch\u1ec9 ra c\xe1ch b\u1ea1n c\xf3 th\u1ec3 tri\u1ec3n khai m\u1ed9t m\xf4 h\xecnh \u1ee7y quy\u1ec1n d\u1ef1a tr\xean Ki\u1ec3m so\xe1t Truy c\u1eadp D\u1ef1a tr\xean Vai tr\xf2 (RBAC) trong APISIX."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"L\u01afU \xdd"),": B\u1ea1n s\u1ebd c\u1ea7n s\u1eed d\u1ee5ng m\u1ed9t s\u1ed1 plugin kh\xe1c ho\u1eb7c quy tr\xecnh l\xe0m vi\u1ec7c t\xf9y ch\u1ec9nh \u0111\u1ec3 x\xe1c th\u1ef1c ng\u01b0\u1eddi d\xf9ng v\xec Casbin ch\u1ec9 th\u1ef1c hi\u1ec7n \u1ee7y quy\u1ec1n, kh\xf4ng ph\u1ea3i x\xe1c th\u1ef1c."),(0,i.kt)("h2",{id:"t\u1ea1o-m\u1ed9t-m\xf4-h\xecnh"},"T\u1ea1o m\u1ed9t m\xf4 h\xecnh"),(0,i.kt)("p",null,"Plugin s\u1eed d\u1ee5ng ba tham s\u1ed1 \u0111\u1ec3 \u1ee7y quy\u1ec1n b\u1ea5t k\u1ef3 y\xeau c\u1ea7u n\xe0o - ch\u1ee7 th\u1ec3, \u0111\u1ed1i t\u01b0\u1ee3ng v\xe0 h\xe0nh \u0111\u1ed9ng. \u1ede \u0111\xe2y, ch\u1ee7 th\u1ec3 l\xe0 gi\xe1 tr\u1ecb c\u1ee7a ti\xeau \u0111\u1ec1 t\xean ng\u01b0\u1eddi d\xf9ng, c\xf3 th\u1ec3 l\xe0 m\u1ed9t c\xe1i g\xec \u0111\xf3 nh\u01b0 ",(0,i.kt)("inlineCode",{parentName:"p"},"[username: alice]"),". Sau \u0111\xf3, \u0111\u1ed1i t\u01b0\u1ee3ng l\xe0 \u0111\u01b0\u1eddng d\u1eabn URL \u0111ang \u0111\u01b0\u1ee3c truy c\u1eadp v\xe0 h\xe0nh \u0111\u1ed9ng l\xe0 ph\u01b0\u01a1ng th\u1ee9c y\xeau c\u1ea7u \u0111ang \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng."),(0,i.kt)("p",null,"Gi\u1ea3 s\u1eed ch\xfang ta mu\u1ed1n t\u1ea1o m\u1ed9t m\xf4 h\xecnh v\u1edbi ba t\xe0i nguy\xean t\u1ea1i c\xe1c \u0111\u01b0\u1eddng d\u1eabn - ",(0,i.kt)("inlineCode",{parentName:"p"},"/`\\`, "),"/res1",(0,i.kt)("inlineCode",{parentName:"p"},"\\")," v\xe0 `",(0,i.kt)("inlineCode",{parentName:"p"},"/res2"),"`",". V\xe0 ch\xfang ta mu\u1ed1n c\xf3 m\u1ed9t m\xf4 h\xecnh nh\u01b0 th\u1ebf n\xe0y:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"h\xecnh \u1ea3nh",src:e(8478).Z,width:"4520",height:"1720"})),(0,i.kt)("p",null,"\u0110i\u1ec1u n\xe0y c\xf3 ngh\u0129a l\xe0 t\u1ea5t c\u1ea3 ng\u01b0\u1eddi d\xf9ng (",(0,i.kt)("inlineCode",{parentName:"p"},"*`\\`) v\xed d\u1ee5 nh\u01b0 "),"jack",(0,i.kt)("inlineCode",{parentName:"p"},"\\")," c\xf3 th\u1ec3 truy c\u1eadp trang ch\u1ee7 (",(0,i.kt)("inlineCode",{parentName:"p"},"/`\\`). V\xe0 ng\u01b0\u1eddi d\xf9ng c\xf3 quy\u1ec1n "),"admin",(0,i.kt)("inlineCode",{parentName:"p"},"\\")," nh\u01b0 ",(0,i.kt)("inlineCode",{parentName:"p"},"alice`\\` v\xe0 "),"bob",(0,i.kt)("inlineCode",{parentName:"p"},"\\")," c\xf3 th\u1ec3 truy c\u1eadp t\u1ea5t c\u1ea3 c\xe1c trang v\xe0 t\xe0i nguy\xean (nh\u01b0 ",(0,i.kt)("inlineCode",{parentName:"p"},"res1`\\` v\xe0 "),"res2",(0,i.kt)("inlineCode",{parentName:"p"},"\\"),"). Ngo\xe0i ra, h\xe3y gi\u1edbi h\u1ea1n ng\u01b0\u1eddi d\xf9ng kh\xf4ng c\xf3 b\u1ea5t k\u1ef3 quy\u1ec1n admin n\xe0o ch\u1ec9 s\u1eed d\u1ee5ng ph\u01b0\u01a1ng th\u1ee9c y\xeau c\u1ea7u `",(0,i.kt)("inlineCode",{parentName:"p"},"GET"),"`",". \u0110\u1ed1i v\u1edbi k\u1ecbch b\u1ea3n n\xe0y, ch\xfang ta c\xf3 th\u1ec3 \u0111\u1ecbnh ngh\u0129a m\xf4 h\xecnh nh\u01b0 sau:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ini"},"[request_definition]\nr = sub, obj, act\n\n[policy_definition]\np = sub, obj, act\n\n[role_definition]\ng = _, _\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) && keyMatch(r.obj, p.obj) && keyMatch(r.act, p.act)\n")),(0,i.kt)("h2",{id:"t\u1ea1o-m\u1ed9t-ch\xednh-s\xe1ch"},"T\u1ea1o m\u1ed9t ch\xednh s\xe1ch"),(0,i.kt)("p",null,"T\u1eeb t\xecnh hu\u1ed1ng tr\xean, ch\xednh s\xe1ch s\u1ebd l\xe0:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csv"},"p, *, /, GET\np, admin, *, *\ng, alice, admin\ng, bob, admin\n")),(0,i.kt)("p",null,"B\u1ed9 so kh\u1edbp t\u1eeb m\xf4 h\xecnh c\xf3 ngh\u0129a l\xe0:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"(g(r.sub, p.sub) || keyMatch(r.sub, p.sub))"),": Ho\u1eb7c l\xe0 ch\u1ee7 th\u1ec3 c\u1ee7a y\xeau c\u1ea7u c\xf3 m\u1ed9t vai tr\xf2 nh\u01b0 ch\u1ee7 th\u1ec3 c\u1ee7a ch\xednh s\xe1ch ho\u1eb7c ch\u1ee7 th\u1ec3 c\u1ee7a y\xeau c\u1ea7u kh\u1edbp v\u1edbi ch\u1ee7 th\u1ec3 c\u1ee7a ch\xednh s\xe1ch trong ",(0,i.kt)("inlineCode",{parentName:"li"},"keyMatch"),". ",(0,i.kt)("inlineCode",{parentName:"li"},"keyMatch")," l\xe0 h\xe0m t\xedch h\u1ee3p s\u1eb5n trong Lua Casbin, b\u1ea1n c\xf3 th\u1ec3 xem m\xf4 t\u1ea3 c\u1ee7a h\xe0m v\xe0 nhi\u1ec1u h\xe0m kh\xe1c c\xf3 th\u1ec3 h\u1eefu \xedch ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/casbin/lua-casbin/blob/master/src/util/BuiltInFunctions.lua"},"t\u1ea1i \u0111\xe2y"),"."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"keyMatch(r.obj, p.obj)"),": \u0110\u1ed1i t\u01b0\u1ee3ng c\u1ee7a y\xeau c\u1ea7u kh\u1edbp v\u1edbi \u0111\u1ed1i t\u01b0\u1ee3ng c\u1ee7a ch\xednh s\xe1ch (\u0111\u01b0\u1eddng d\u1eabn URL \u1edf \u0111\xe2y)."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"keyMatch(r.act, p.act)"),": H\xe0nh \u0111\u1ed9ng c\u1ee7a y\xeau c\u1ea7u kh\u1edbp v\u1edbi h\xe0nh \u0111\u1ed9ng c\u1ee7a ch\xednh s\xe1ch (ph\u01b0\u01a1ng th\u1ee9c y\xeau c\u1ea7u HTTP \u1edf \u0111\xe2y).")),(0,i.kt)("h2",{id:"k\xedch-ho\u1ea1t-plugin-tr\xean-tuy\u1ebfn-\u0111\u01b0\u1eddng"},"K\xedch ho\u1ea1t plugin tr\xean tuy\u1ebfn \u0111\u01b0\u1eddng"),(0,i.kt)("p",null,"Sau khi b\u1ea1n \u0111\xe3 t\u1ea1o m\xf4 h\xecnh v\xe0 ch\xednh s\xe1ch, b\u1ea1n c\xf3 th\u1ec3 k\xedch ho\u1ea1t n\xf3 tr\xean m\u1ed9t tuy\u1ebfn \u0111\u01b0\u1eddng b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng APISIX Admin API. \u0110\u1ec3 k\xedch ho\u1ea1t n\xf3 s\u1eed d\u1ee5ng \u0111\u01b0\u1eddng d\u1eabn t\u1ec7p m\xf4 h\xecnh v\xe0 ch\xednh s\xe1ch:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "plugins": {\n        "authz-casbin": {\n            "model_path": "/path/to/model.conf",\n            "policy_path": "/path/to/policy.csv",\n            "username": "username"\n        }\n    },\n    "upstream": {\n        "nodes": {\n            "127.0.0.1:1980": 1\n        },\n        "type": "roundrobin"\n    },\n    "uri": "/*"\n}\'\n')),(0,i.kt)("p",null,"\u1ede \u0111\xe2y, tr\u01b0\u1eddng ",(0,i.kt)("inlineCode",{parentName:"p"},"username")," l\xe0 t\xean ti\xeau \u0111\u1ec1 m\xe0 b\u1ea1n s\u1ebd s\u1eed d\u1ee5ng \u0111\u1ec3 truy\u1ec1n v\xe0o ch\u1ee7 th\u1ec3. V\xed d\u1ee5, n\u1ebfu b\u1ea1n s\u1ebd truy\u1ec1n ti\xeau \u0111\u1ec1 ",(0,i.kt)("inlineCode",{parentName:"p"},"username")," l\xe0 ",(0,i.kt)("inlineCode",{parentName:"p"},"user: alice`\\`, b\u1ea1n s\u1ebd s\u1eed d\u1ee5ng "),'"username": "user"',(0,i.kt)("inlineCode",{parentName:"p"},"\\"),"."),(0,i.kt)("p",null,"\u0110\u1ec3 s\u1eed d\u1ee5ng v\u0103n b\u1ea3n m\xf4 h\xecnh/ch\xednh s\xe1ch thay v\xec t\u1ec7p, b\u1ea1n c\xf3 th\u1ec3 s\u1eed d\u1ee5ng c\xe1c tr\u01b0\u1eddng ",(0,i.kt)("inlineCode",{parentName:"p"},"model")," v\xe0 ",(0,i.kt)("inlineCode",{parentName:"p"},"policy")," thay th\u1ebf:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "plugins": {\n        "authz-casbin": {\n            "model": "[request_definition]\n            r = sub, obj, act\n\n            [policy_definition]\n            p = sub, obj, act\n\n            [role_definition]\n            g = _, _\n\n            [policy_effect]\n            e = some(where (p.eft == allow))\n\n            [matchers]\n            m = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) && keyMatch(r.obj, p.obj) && keyMatch(r.act, p.act)",\n\n            "policy": "p, *, /, GET\n            p, admin, *, *\n            g, alice, admin\n            g, bob, admin",\n\n            "username": "username"\n        }\n    },\n    "upstream": {\n        "nodes": {\n            "127.0.0.1:1980": 1\n        },\n        "type": "roundrobin"\n    },\n    "uri": "/*"\n}\'\n')),(0,i.kt)("h2",{id:"k\xedch-ho\u1ea1t-plugin-s\u1eed-d\u1ee5ng-m\xf4-h\xecnhch\xednh-s\xe1ch-to\xe0n-c\u1ee5c"},"K\xedch ho\u1ea1t plugin s\u1eed d\u1ee5ng m\xf4 h\xecnh/ch\xednh s\xe1ch to\xe0n c\u1ee5c"),(0,i.kt)("p",null,"C\xf3 th\u1ec3 c\xf3 nh\u1eefng t\xecnh hu\u1ed1ng m\xe0 b\u1ea1n mu\u1ed1n s\u1eed d\u1ee5ng m\u1ed9t c\u1ea5u h\xecnh m\xf4 h\xecnh v\xe0 ch\xednh s\xe1ch duy nh\u1ea5t tr\xean nhi\u1ec1u tuy\u1ebfn. B\u1ea1n c\xf3 th\u1ec3 l\xe0m \u0111i\u1ec1u \u0111\xf3 b\u1eb1ng c\xe1ch g\u1eedi m\u1ed9t y\xeau c\u1ea7u ",(0,i.kt)("inlineCode",{parentName:"p"},"PUT")," \u0111\u1ec3 th\xeam c\u1ea5u h\xecnh m\xf4 h\xecnh v\xe0 ch\xednh s\xe1ch v\xe0o si\xeau d\u1eef li\u1ec7u c\u1ee7a plugin b\u1eb1ng:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'curl http://127.0.0.1:9080/apisix/admin/plugin_metadata/authz-casbin -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -i -X PUT -d \'\n{\n"model": "[request_definition]\nr = sub, obj, act\n\n[policy_definition]\np = sub, obj, act\n\n[role_definition]\ng = _, _\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) && keyMatch(r.obj, p.obj) && keyMatch(r.act, p.act)",\n\n"policy": "p, *, /, GET\np, admin, *, *\ng, alice, admin\ng, bob, admin"\n}\'\n')),(0,i.kt)("p",null,"V\xe0 sau \u0111\xf3 \u0111\u1ec3 k\xedch ho\u1ea1t c\u1ea5u h\xecnh gi\u1ed1ng nhau tr\xean m\u1ed9t tuy\u1ebfn \u0111\u01b0\u1eddng, g\u1eedi m\u1ed9t y\xeau c\u1ea7u s\u1eed d\u1ee5ng Admin API:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "plugins": {\n        "authz-casbin": {\n            "username": "username"\n        }\n    },\n    "upstream": {\n        "nodes": {\n            "127.0.0.1:1980": 1\n        },\n        "type": "roundrobin"\n    },\n    "uri": "/route1/*"\n}\'\n')),(0,i.kt)("p",null,"\u0110i\u1ec1u n\xe0y s\u1ebd th\xeam c\u1ea5u h\xecnh si\xeau d\u1eef li\u1ec7u plugin v\xe0o tuy\u1ebfn \u0111\u01b0\u1eddng. B\u1ea1n c\u0169ng c\xf3 th\u1ec3 d\u1ec5 d\xe0ng c\u1eadp nh\u1eadt c\u1ea5u h\xecnh si\xeau d\u1eef li\u1ec7u plugin b\u1eb1ng c\xe1ch g\u1eedi l\u1ea1i y\xeau c\u1ea7u \u0111\u1ebfn si\xeau d\u1eef li\u1ec7u c\u1ee7a plugin v\u1edbi c\u1ea5u h\xecnh m\xf4 h\xecnh v\xe0 ch\xednh s\xe1ch \u0111\xe3 c\u1eadp nh\u1eadt, plugin s\u1ebd t\u1ef1 \u0111\u1ed9ng c\u1eadp nh\u1eadt t\u1ea5t c\u1ea3 c\xe1c tuy\u1ebfn \u0111\u01b0\u1eddng s\u1eed d\u1ee5ng si\xeau d\u1eef li\u1ec7u plugin."),(0,i.kt)("h2",{id:"tr\u01b0\u1eddng-h\u1ee3p-s\u1eed-d\u1ee5ng"},"Tr\u01b0\u1eddng h\u1ee3p s\u1eed d\u1ee5ng"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Tr\u01b0\u1eddng h\u1ee3p s\u1eed d\u1ee5ng ch\xednh c\u1ee7a plugin n\xe0y s\u1ebd l\xe0 trong vi\u1ec7c th\u1ef1c hi\u1ec7n \u1ee7y quy\u1ec1n trong c\xe1c API c\u1ee7a b\u1ea1n. B\u1ea1n c\xf3 th\u1ec3 d\u1ec5 d\xe0ng th\xeam plugin n\xe0y v\xe0o b\u1ea5t k\u1ef3 tuy\u1ebfn \u0111\u01b0\u1eddng API n\xe0o m\xe0 b\u1ea1n \u0111ang s\u1eed d\u1ee5ng v\u1edbi m\xf4 h\xecnh \u1ee7y quy\u1ec1n v\xe0 c\u1ea5u h\xecnh ch\xednh s\xe1ch c\u1ee7a m\xecnh."),(0,i.kt)("li",{parentName:"ul"},"N\u1ebfu b\u1ea1n mu\u1ed1n c\xf3 m\u1ed9t m\xf4 h\xecnh \u1ee7y quy\u1ec1n duy nh\u1ea5t cho t\u1ea5t c\u1ea3 c\xe1c API c\u1ee7a m\xecnh, b\u1ea1n c\xf3 th\u1ec3 s\u1eed d\u1ee5ng ph\u01b0\u01a1ng ph\xe1p m\xf4 h\xecnh/ch\xednh s\xe1ch to\xe0n c\u1ea7u. \u0110i\u1ec1u n\xe0y gi\xfap c\u1eadp nh\u1eadt ch\xednh s\xe1ch d\u1ec5 d\xe0ng cho t\u1ea5t c\u1ea3 c\xe1c tuy\u1ebfn \u0111\u01b0\u1eddng, v\xec b\u1ea1n ch\u1ec9 c\u1ea7n c\u1eadp nh\u1eadt si\xeau d\u1eef li\u1ec7u trong etcd."),(0,i.kt)("li",{parentName:"ul"},"Trong khi \u0111\xf3, n\u1ebfu b\u1ea1n mu\u1ed1n s\u1eed d\u1ee5ng m\u1ed9t m\xf4 h\xecnh kh\xe1c nhau cho m\u1ed7i tuy\u1ebfn \u0111\u01b0\u1eddng kh\xe1c nhau, b\u1ea1n c\xf3 th\u1ec3 s\u1eed d\u1ee5ng ph\u01b0\u01a1ng ph\xe1p tuy\u1ebfn \u0111\u01b0\u1eddng. \u0110i\u1ec1u n\xe0y r\u1ea5t h\u1eefu \xedch khi c\xe1c tuy\u1ebfn API kh\xe1c nhau c\xf3 c\xe1c t\u1eadp h\u1ee3p quy\u1ec1n ng\u01b0\u1eddi d\xf9ng kh\xe1c nhau. B\u1ea1n c\u0169ng c\xf3 th\u1ec3 s\u1eed d\u1ee5ng \u0111i\u1ec1u n\xe0y khi b\u1ea1n \u0111ang x\u1eed l\xfd c\xe1c ch\xednh s\xe1ch l\u1edbn h\u01a1n, v\xec n\xf3 s\u1ebd l\xe0m cho vi\u1ec7c \u1ee7y quy\u1ec1n nhanh h\u01a1n khi \u0111\u01b0\u1ee3c l\u1ecdc v\xe0o nhi\u1ec1u tuy\u1ebfn.")))}p.isMDXComponent=!0},8478:(n,t,e)=>{e.d(t,{Z:()=>h});const h=e.p+"assets/images/model-1c0c2441dd19f8b957744635985283eb.png"}}]);