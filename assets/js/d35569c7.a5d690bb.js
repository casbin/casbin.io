"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[911],{5290(n,e,i){i.r(e),i.d(e,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"rbac-with-domains","title":"RBAC with Domains","description":"Usage of RBAC with domains","source":"@site/docs/RBACWithDomains.mdx","sourceDirName":".","slug":"/rbac-with-domains","permalink":"/docs/rbac-with-domains","draft":false,"unlisted":false,"editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/docs/RBACWithDomains.mdx","tags":[],"version":"current","frontMatter":{"id":"rbac-with-domains","title":"RBAC with Domains","description":"Usage of RBAC with domains","keywords":["RBAC with domains"],"authors":["hsluoyz"]},"sidebar":"docs","previous":{"title":"RBAC with Pattern","permalink":"/docs/rbac-with-pattern"},"next":{"title":"RBAC with Conditions","permalink":"/docs/rbac-with-conditions"}}');var s=i(4848),o=i(8453);const a={id:"rbac-with-domains",title:"RBAC with Domains",description:"Usage of RBAC with domains",keywords:["RBAC with domains"],authors:["hsluoyz"]},d=void 0,r={},c=[{value:"Role definition with domains",id:"role-definition-with-domains",level:2},{value:"Custom domain token name",id:"custom-domain-token-name",level:3}];function l(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"role-definition-with-domains",children:"Role definition with domains"}),"\n",(0,s.jsxs)(e.p,{children:["In Casbin, roles can be ",(0,s.jsx)(e.strong,{children:"domain-scoped"}),": the same user can have different roles in different domains (tenants). That fits multi-tenant and cloud systems where one user works in many tenants."]}),"\n",(0,s.jsxs)(e.p,{children:["Use a role definition with ",(0,s.jsx)(e.strong,{children:"three"})," elements; the third is the domain:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[role_definition]\ng = _, _, _\n"})}),"\n",(0,s.jsx)(e.p,{children:"The third field is the domain. Example policy:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-csv",children:"p, admin, tenant1, data1, read\np, admin, tenant2, data2, read\n\ng, alice, admin, tenant1\ng, alice, user, tenant2\n"})}),"\n",(0,s.jsxs)(e.p,{children:["So: ",(0,s.jsx)(e.code,{children:"admin"})," in ",(0,s.jsx)(e.code,{children:"tenant1"})," can read ",(0,s.jsx)(e.code,{children:"data1"}),". Alice is ",(0,s.jsx)(e.code,{children:"admin"})," in ",(0,s.jsx)(e.code,{children:"tenant1"})," and ",(0,s.jsx)(e.code,{children:"user"})," in ",(0,s.jsx)(e.code,{children:"tenant2"}),"; she can read ",(0,s.jsx)(e.code,{children:"data1"})," but not ",(0,s.jsx)(e.code,{children:"data2"})," (only ",(0,s.jsx)(e.code,{children:"admin"})," in ",(0,s.jsx)(e.code,{children:"tenant2"})," can read ",(0,s.jsx)(e.code,{children:"data2"}),")."]}),"\n",(0,s.jsxs)(e.p,{children:["Matcher: include the domain in ",(0,s.jsx)(e.code,{children:"g"})," and require it to match:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[matchers]\nm = g(r.sub, p.sub, r.dom) && r.dom == p.dom && r.obj == p.obj && r.act == p.act\n"})}),"\n",(0,s.jsx)(e.h3,{id:"custom-domain-token-name",children:"Custom domain token name"}),"\n",(0,s.jsxs)(e.p,{children:["By convention the domain is named ",(0,s.jsx)(e.code,{children:"dom"}),", but you can use any name (",(0,s.jsx)(e.code,{children:"tenant"}),", ",(0,s.jsx)(e.code,{children:"workspace"}),", etc.) in the request and policy definitions:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[request_definition]\nr = sub, tenant, obj, act\n\n[policy_definition]\np = sub, tenant, obj, act\n\n[role_definition]\ng = _, _, _\n\n[matchers]\nm = g(r.sub, p.sub, r.tenant) && r.tenant == p.tenant && r.obj == p.obj && r.act == p.act\n"})}),"\n",(0,s.jsxs)(e.p,{children:["With pattern matching (e.g. ",(0,s.jsx)(e.code,{children:"keyMatch"}),") for domains, Casbin infers the domain token from the model as long as the domain is at index 1 in both request and policy:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[matchers]\nm = g(r.sub, p.sub, r.tenant) && keyMatch(r.tenant, p.tenant) && r.obj == p.obj && r.act == p.act\n"})}),"\n",(0,s.jsxs)(e.p,{children:["For domain APIs (e.g. ",(0,s.jsx)(e.code,{children:"GetAllUsersByDomain()"}),") with a ",(0,s.jsx)(e.strong,{children:"custom"})," domain token name or position, set the index after creating the enforcer. Full example: ",(0,s.jsx)(e.a,{href:"https://github.com/casbin/casbin/blob/master/examples/rbac_with_domains_model.conf",children:"rbac_with_domains_model.conf"}),"."]}),"\n",(0,s.jsxs)(e.admonition,{title:"Token name and position",type:"info",children:[(0,s.jsxs)(e.p,{children:["The domain is usually named ",(0,s.jsx)(e.code,{children:"dom"})," and placed second (",(0,s.jsx)(e.code,{children:"sub, dom, obj, act"}),"). In Go Casbin you can use another name or position; then call ",(0,s.jsx)(e.code,{children:'e.SetFieldIndex("p", constant.DomainIndex, index)'})," after init so APIs like ",(0,s.jsx)(e.code,{children:"GetAllUsersByDomain()"})," work correctly."]}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"# Using `domain` instead of `dom`\n[policy_definition]\np = sub, obj, act, domain\n"})}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'e.SetFieldIndex("p", constant.DomainIndex, 3) // index starts from 0\nusers := e.GetAllUsersByDomain("domain1") // without SetFieldIndex, this will raise an error\n'})})]})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}},8453(n,e,i){i.d(e,{R:()=>a,x:()=>d});var t=i(6540);const s={},o=t.createContext(s);function a(n){const e=t.useContext(o);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:a(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);