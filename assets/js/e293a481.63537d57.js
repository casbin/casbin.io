"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[3878],{8215:function(t,e,a){var n=a(7294);e.Z=function(t){var e=t.children,a=t.hidden,r=t.className;return n.createElement("div",{role:"tabpanel",hidden:a,className:r},e)}},5064:function(t,e,a){a.d(e,{Z:function(){return d}});var n=a(3117),r=a(7294),l=a(2389),i=a(9443);var o=function(){var t=(0,r.useContext)(i.Z);if(null==t)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return t},c=a(9558),u=a(6010),s="tabItem_1uMI";function p(t){var e,a,n,l=t.lazy,i=t.block,p=t.defaultValue,d=t.values,m=t.groupId,k=t.className,b=r.Children.map(t.children,(function(t){if((0,r.isValidElement)(t)&&"string"==typeof t.props.value)return t;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof t.type?t.type:t.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),h=null!=d?d:b.map((function(t){var e=t.props;return{value:e.value,label:e.label}})),f=(0,c.lx)(h,(function(t,e){return t.value===e.value}));if(f.length>0)throw new Error('Docusaurus error: Duplicate values "'+f.map((function(t){return t.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var g=null===p?p:null!=(e=null!=p?p:null==(a=b.find((function(t){return t.props.default})))?void 0:a.props.value)?e:null==(n=b[0])?void 0:n.props.value;if(null!==g&&!h.some((function(t){return t.value===g})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+g+'" but none of its children has the corresponding value. Available values are: '+h.map((function(t){return t.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var N=o(),y=N.tabGroupChoices,v=N.setTabGroupChoices,_=(0,r.useState)(g),C=_[0],w=_[1],x=[],L=(0,c.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var E=y[m];null!=E&&E!==C&&h.some((function(t){return t.value===E}))&&w(E)}var M=function(t){var e=t.currentTarget,a=x.indexOf(e),n=h[a].value;n!==C&&(L(e),w(n),null!=m&&v(m,n))},R=function(t){var e,a=null;switch(t.key){case"ArrowRight":var n=x.indexOf(t.currentTarget)+1;a=x[n]||x[0];break;case"ArrowLeft":var r=x.indexOf(t.currentTarget)-1;a=x[r]||x[x.length-1]}null==(e=a)||e.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":i},k)},h.map((function(t){var e=t.value,a=t.label;return r.createElement("li",{role:"tab",tabIndex:C===e?0:-1,"aria-selected":C===e,className:(0,u.Z)("tabs__item",s,{"tabs__item--active":C===e}),key:e,ref:function(t){return x.push(t)},onKeyDown:R,onFocus:M,onClick:M},null!=a?a:e)}))),l?(0,r.cloneElement)(b.filter((function(t){return t.props.value===C}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},b.map((function(t,e){return(0,r.cloneElement)(t,{key:e,hidden:t.props.value!==C})}))))}function d(t){var e=(0,l.Z)();return r.createElement(p,(0,n.Z)({key:String(e)},t))}},3345:function(t,e,a){a.r(e),a.d(e,{frontMatter:function(){return o},contentTitle:function(){return c},metadata:function(){return u},toc:function(){return s},default:function(){return d}});var n=a(3117),r=a(102),l=(a(7294),a(3905)),i=(a(5064),a(8215),["components"]),o={id:"function",title:"Function"},c=void 0,u={unversionedId:"function",id:"function",isDocsHomePage:!1,title:"Function",description:"Functions in matchers",source:"@site/docs/Function.mdx",sourceDirName:".",slug:"/function",permalink:"/docs/function",editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/Function.mdx",tags:[],version:"current",frontMatter:{id:"function",title:"Function"},sidebar:"docs",previous:{title:"Effector",permalink:"/docs/effector"},next:{title:"RBAC",permalink:"/docs/rbac"}},s=[{value:"Functions in matchers",id:"functions-in-matchers",children:[],level:2},{value:"How to add a customized function",id:"how-to-add-a-customized-function",children:[],level:2}],p={toc:s};function d(t){var e=t.components,a=(0,r.Z)(t,i);return(0,l.kt)("wrapper",(0,n.Z)({},p,a,{components:e,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"functions-in-matchers"},"Functions in matchers"),(0,l.kt)("p",null,"You can even specify functions in a matcher to make it more powerful. You can use the built-in functions or specify your own function. All built-in functions take such a format(except ",(0,l.kt)("inlineCode",{parentName:"p"},"keyGet")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"keyGet2"),"):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-C"},"bool function_name(string arg1, string arg2)\n")),(0,l.kt)("p",null,"It returns whether ",(0,l.kt)("inlineCode",{parentName:"p"},"arg1")," matches ",(0,l.kt)("inlineCode",{parentName:"p"},"arg2"),"."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"keyGet")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"keyGet2")," will return the string which matching the wildcard, and return ",(0,l.kt)("inlineCode",{parentName:"p"},'""')," if nothing was matched."),(0,l.kt)("p",null,"The supported built-in functions are:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Function"),(0,l.kt)("th",{parentName:"tr",align:null},"arg1"),(0,l.kt)("th",{parentName:"tr",align:null},"arg2"),(0,l.kt)("th",{parentName:"tr",align:null},"Example"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"keyMatch"),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/resource1")),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path or a ",(0,l.kt)("inlineCode",{parentName:"td"},"*")," pattern like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/*")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/keymatch_model.conf"},"keymatch_model.conf"),"/",(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/keymatch_policy.csv"},"keymatch_policy.csv"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"keyGet"),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/resource1")),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path or a ",(0,l.kt)("inlineCode",{parentName:"td"},"*")," pattern like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/*")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/keyget_model.conf"},"keyget_model.conf"),"/",(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/keymatch_policy.csv"},"keymatch_policy.csv"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"keyMatch2"),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/resource1")),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path or a ",(0,l.kt)("inlineCode",{parentName:"td"},":")," pattern like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/:resource")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/keymatch2_model.conf"},"keymatch2_model.conf"),"/",(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/keymatch2_policy.csv"},"keymatch2_policy.csv"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"keyGet2"),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/resource1")),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path or ",(0,l.kt)("inlineCode",{parentName:"td"},":")," pattern like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/:resource")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/keyget2_model.conf"},"keyget2_model.conf"),"/",(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/keymatch2_policy.csv"},"keymatch2_policy.csv"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"keyMatch3"),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/resource1")),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path or a ",(0,l.kt)("inlineCode",{parentName:"td"},"{}")," pattern like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/{resource}")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/277c1a2b85698272f764d71a94d2595a8d425915/util/builtin_operators_test.go#L171-L196"},"https://github.com/casbin/casbin/blob/277c1a2b85698272f764d71a94d2595a8d425915/util/builtin_operators_test.go#L171-L196"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"keyMatch4"),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/123/book/123")),(0,l.kt)("td",{parentName:"tr",align:null},"a URL path or a ",(0,l.kt)("inlineCode",{parentName:"td"},"{}")," pattern like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/{id}/book/{id}")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/277c1a2b85698272f764d71a94d2595a8d425915/util/builtin_operators_test.go#L208-L222"},"https://github.com/casbin/casbin/blob/277c1a2b85698272f764d71a94d2595a8d425915/util/builtin_operators_test.go#L208-L222"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"regexMatch"),(0,l.kt)("td",{parentName:"tr",align:null},"any string"),(0,l.kt)("td",{parentName:"tr",align:null},"a regular expression pattern"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/keymatch_model.conf"},"keymatch_model.conf"),"/",(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/keymatch_policy.csv"},"keymatch_policy.csv"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ipMatch"),(0,l.kt)("td",{parentName:"tr",align:null},"an IP address like ",(0,l.kt)("inlineCode",{parentName:"td"},"192.168.2.123")),(0,l.kt)("td",{parentName:"tr",align:null},"an IP address or a CIDR like ",(0,l.kt)("inlineCode",{parentName:"td"},"192.168.2.0/24")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/ipmatch_model.conf"},"ipmatch_model.conf"),"/",(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/master/examples/ipmatch_policy.csv"},"ipmatch_policy.csv"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"globMatch"),(0,l.kt)("td",{parentName:"tr",align:null},"a path-like path like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/resource1")),(0,l.kt)("td",{parentName:"tr",align:null},"a glob pattern like ",(0,l.kt)("inlineCode",{parentName:"td"},"/alice_data/*")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://github.com/casbin/casbin/blob/277c1a2b85698272f764d71a94d2595a8d425915/util/builtin_operators_test.go#L426-L466"},"https://github.com/casbin/casbin/blob/277c1a2b85698272f764d71a94d2595a8d425915/util/builtin_operators_test.go#L426-L466"))))),(0,l.kt)("p",null,"See details for above functions at: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/casbin/casbin/blob/master/util/builtin_operators_test.go"},"https://github.com/casbin/casbin/blob/master/util/builtin_operators_test.go")),(0,l.kt)("h2",{id:"how-to-add-a-customized-function"},"How to add a customized function"),(0,l.kt)("p",null,"First prepare your function. It takes several parameters and return a bool:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'func KeyMatch(key1 string, key2 string) bool {\n    i := strings.Index(key2, "*")\n    if i == -1 {\n        return key1 == key2\n    }\n\n    if len(key1) > i {\n        return key1[:i] == key2[:i]\n    }\n    return key1 == key2[:i]\n}\n')),(0,l.kt)("p",null,"Then wrap it with ",(0,l.kt)("inlineCode",{parentName:"p"},"interface{}")," types:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"func KeyMatchFunc(args ...interface{}) (interface{}, error) {\n    name1 := args[0].(string)\n    name2 := args[1].(string)\n\n    return (bool)(KeyMatch(name1, name2)), nil\n}\n")),(0,l.kt)("p",null,"At last, register the function to the Casbin enforcer:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'e.AddFunction("my_func", KeyMatchFunc)\n')),(0,l.kt)("p",null,"Now, you can use the function in your model CONF like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},"[matchers]\nm = r.sub == p.sub && my_func(r.obj, p.obj) && r.act == p.act\n")))}d.isMDXComponent=!0}}]);