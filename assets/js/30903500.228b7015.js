"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[2953],{2519:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"k8s","title":"Authorization of Kubernetes","description":"Kubernetes (k8s) RBAC & ABAC authorization middleware based on Casbin","source":"@site/docs/K8sAuthz.mdx","sourceDirName":".","slug":"/k8s","permalink":"/docs/k8s","draft":false,"unlisted":false,"editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sAuthz.mdx","tags":[],"version":"current","frontMatter":{"id":"k8s","title":"Authorization of Kubernetes","description":"Kubernetes (k8s) RBAC & ABAC authorization middleware based on Casbin","keywords":["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],"authors":["hsluoyz"]},"sidebar":"docs","previous":{"title":"Performance Optimization","permalink":"/docs/performance"},"next":{"title":"Admission Webhook for K8s","permalink":"/docs/k8s-gatekeeper"}}');var i=t(4848),r=t(8453);const o={id:"k8s",title:"Authorization of Kubernetes",description:"Kubernetes (k8s) RBAC & ABAC authorization middleware based on Casbin",keywords:["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],authors:["hsluoyz"]},a=void 0,c={},l=[{value:"Requirements",id:"requirements",level:2},{value:"Usage",id:"usage",level:2}];function h(e){const s={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz",children:"K8s-authz"})," is a Kubernetes (k8s) authorization middleware based on Casbin that utilizes RBAC (Role-Based Access Control) and ABAC (Attribute-Based Access Control) for policy enforcement. This middleware integrates with the K8s validation admission webhook to validate the policies defined by Casbin for each request made to K8s resources. Custom admission controllers are registered with Kubernetes using the ",(0,i.jsx)(s.code,{children:"ValidatingAdmissionWebhook"})," to perform validations on request objects forwarded by the API server and provide a response indicating whether the request should be allowed or rejected."]}),"\n",(0,i.jsxs)(s.p,{children:["To determine when to send incoming requests to the admission controller, a validation webhook has been implemented. This webhook proxies requests for any type of K8s resource or sub-resource and performs policy verification. Users are only allowed to perform operations on these resources if they are authorized by the Casbin enforcer. The ",(0,i.jsx)(s.a,{href:"/docs/get-started#new-a-casbin-enforcer",children:"enforcer"})," checks the roles of the user as defined in the policies. The K8s cluster is the deployment target for this middleware."]}),"\n",(0,i.jsx)(s.h2,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsx)(s.p,{children:"Before proceeding, ensure that you have the following:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["A running Kubernetes cluster. You can set up a local cluster using Docker or set up a complete Kubernetes ecosystem on your server. For detailed instructions, refer to this ",(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/",children:"guide"})," for setting up a local Kubernetes cluster on Windows or this ",(0,i.jsx)(s.a,{href:"https://www.digitalocean.com/community/tutorials/how-to-create-a-kubernetes-cluster-using-kubeadm-on-ubuntu-18-04",children:"guide"})," for setting up a cluster on Linux."]}),"\n",(0,i.jsxs)(s.li,{children:["Kubectl CLI. Instructions for installing Kubectl on Windows can be found ",(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/",children:"here"}),", and for Linux ",(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/",children:"here"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"OpenSSL"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(s.p,{children:"Follow these steps to use K8s-authz:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Generate certificates and keys for each user using OpenSSL. Run the script below:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"./gen_cert.sh\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Build the Docker image from the ",(0,i.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/Dockerfile",children:"Dockerfile"})," manually by running the following command. Remember to change the build version in the command and in the deployment ",(0,i.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/718f58c46e3dbf79063b5b1c18348c2fee5de9e9/manifests/deployment.yaml#L18",children:"file"})," accordingly."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"docker build -t casbin/k8s_authz:0.1 .\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Define the Casbin policies in the ",(0,i.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/config/model.conf",children:"model.conf"})," and ",(0,i.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/config/policy.csv",children:"policy.csv"})," files. For more information on how these policies work, refer to the ",(0,i.jsx)(s.a,{href:"/docs/how-it-works",children:"documentation"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Before deploying, you can modify the ports in the ",(0,i.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/main.go",children:"main.go"})," file, as well as in the validation webhook configuration ",(0,i.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/manifests/deployment.yaml",children:"file"}),", based on your specific requirements."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Deploy the validation controller and the webhook on the Kubernetes cluster by running the following command:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f deployment.yaml\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["For a production server, it is recommended to create a Kubernetes ",(0,i.jsx)(s.code,{children:"secret"})," to secure the certificates:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"kubectl create secret generic casbin -n default \\\n  --from-file=key.pem=certs/casbin-key.pem \\\n  --from-file=cert.pem=certs/casbin-crt.pem\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["After completing the above steps, you need to update the certificate directory in ",(0,i.jsx)(s.a,{href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/main.go#L26",children:"main.go"})," and the ",(0,i.jsx)(s.a,{href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/manifests/deployment.yaml#L22",children:"manifests"})," with the directory of the created ",(0,i.jsx)(s.code,{children:"secret"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Now, the server should be up and running, ready to validate requests made to K8s resources and enforce policies accordingly."})]})}function d(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>o,x:()=>a});var n=t(6540);const i={},r=n.createContext(i);function o(e){const s=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);