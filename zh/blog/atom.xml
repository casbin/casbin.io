<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://casbin.org/zh/blog</id>
    <title>Casbin Blog</title>
    <updated>2021-08-19T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://casbin.org/zh/blog"/>
    <subtitle>Casbin Blog</subtitle>
    <icon>https://casbin.org/zh/img/favicon.png</icon>
    <entry>
        <title type="html"><![CDATA[在 APISIX 中使用 Casbin 進行授權]]></title>
        <id>https://casbin.org/zh/blog/2021/08/19/apisix-casbin-authorization</id>
        <link href="https://casbin.org/zh/blog/2021/08/19/apisix-casbin-authorization"/>
        <updated>2021-08-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[介紹]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="介紹">介紹<a href="#介紹" class="hash-link" aria-label="直接鏈接到介紹" title="直接鏈接到介紹">​</a></h2><p><a href="https://apisix.apache.org/" target="_blank" rel="noopener noreferrer">APISIX</a> 是一個基於 Nginx 和 etcd 的高性能和可擴展的雲原生 API 網關。 它是由 Apache 軟件基金會支持的開源項目。 APISIX 之所以出色，除了其基礎架構外，還在於它支持許多內建的優秀插件，可以用於實現認證、監控、路由等功能。 而且，APISIX 中的插件是熱加載的（無需重啟），這使得它非常動態。</p><p>但在使用 APISIX 時，可能會遇到需要在應用程序中添加複雜授權邏輯的場景。 這時，authz-casbin 插件可能會對你有所幫助。 authz-casbin 是一個基於 <a href="https://github.com/casbin/lua-casbin/" target="_blank" rel="noopener noreferrer">Lua Casbin</a> 的 APISIX 插件，它支持基於各種訪問控制模型的強大授權功能。 <a href="/zh/">Casbin</a> 是一個授權庫，支持 ACL、RBAC、ABAC 等訪問控制模型。 最初用 Go 編寫，它已被移植到許多語言，Lua Casbin 是 Casbin 的 Lua 實現。 authz-casbin 的開發始於我們在 APISIX 倉庫中提出了一個新的授權插件提案（<!-- -->[<!-- -->#4674<!-- -->]<!-- -->(<a href="https://github.com/apache/apisix/issues/4674%EF%BC%89%EF%BC%8C%E6%A0%B8%E5%BF%83%E6%88%90%E5%93%A1%E5%90%8C%E6%84%8F%E4%BA%86%E9%80%99%E4%B8%80%E6%8F%90%E6%A1%88%E3%80%82" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix/issues/4674），核心成員同意了這一提案。</a> 經過一些有益的評審，導致了一些重大變更和改進，最終 PR（<!-- -->[<!-- -->#4710<!-- -->]<!-- -->(<a href="https://github.com/apache/apisix/pull/4710%EF%BC%89%E8%A2%AB%E5%90%88%E4%BD%B5%E3%80%82" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix/pull/4710）被合併。</a></p><p>在這篇博客中，我們將使用 authz-casbin 插件來展示如何在 APISIX 中實現基於角色訪問控制（RBAC）的授權模型。</p><p><strong>注意</strong>：你需要使用其他插件或自定義工作流程來驗證用戶，因為 Casbin 僅負責授權，不負責驗證。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="創建模型">創建模型<a href="#創建模型" class="hash-link" aria-label="直接鏈接到創建模型" title="直接鏈接到創建模型">​</a></h2><p>該插件使用三個參數來授權任何請求 - 主體、對象和動作。 在這裡，主體是 username 標頭的值，可能是類似 <code>[username: alice]</code> 的內容。 然後，對象是正在訪問的 URL 路徑，動作是正在使用的請求方法。</p><p>假設我們想要創建一個模型，其中有三個資源位於路徑 - <code>/</code>、<code>/res1</code> 和 <code>/res2</code>。 我們希望模型如下：</p><p><img loading="lazy" alt="image" src="/zh/assets/images/model-1c0c2441dd19f8b957744635985283eb.png" width="4520" height="1720" class="img_ev3q"></p><p>這意味著所有用戶（<code>*</code>）例如 <code>jack</code> 可以訪問主頁（<code>/</code>）。 具有 <code>admin</code> 權限的用戶如 <code>alice</code> 和 <code>bob</code> 可以訪問所有頁面和資源（如 <code>res1</code> 和 <code>res2</code>）。 此外，讓我們限制沒有任何管理權限的用戶僅使用 <code>GET</code> 請求方法。 對於這種情況，我們可以定義模型為：</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">request_definition</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">r</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">sub, obj, act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">policy_definition</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">p</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">sub, obj, act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">role_definition</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">g</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">_, _</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">policy_effect</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">e</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">some(where (p.eft == allow))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token section punctuation" style="color:#393A34">[</span><span class="token section section-name selector" style="color:#00009f">matchers</span><span class="token section punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">m</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">(g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) &amp;&amp; keyMatch(r.obj, p.obj) &amp;&amp; keyMatch(r.act, p.act)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製代碼到剪貼板" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="創建策略">創建策略<a href="#創建策略" class="hash-link" aria-label="直接鏈接到創建策略" title="直接鏈接到創建策略">​</a></h2><p>根據上述場景，策略將是：</p><div class="language-csv codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csv codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token value">p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> *</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> /</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> GET</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token value">p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> admin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> *</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> *</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token value">g</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> alice</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> admin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token value">g</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> bob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token value"> admin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製代碼到剪貼板" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>模型中的匹配器意味著：</p><ol><li><code>(g(r.sub, p.sub) || keyMatch(r.sub, p.sub))</code>: 請求的主體具有策略的主體角色，或者請求的主體在 keyMatch 中匹配策略的主體。 keyMatch 是 Lua Casbin 中的內建函數, 你可以在<a href="https://github.com/casbin/lua-casbin/blob/master/src/util/BuiltInFunctions.lua" target="_blank" rel="noopener noreferrer">這裡</a>.查看該函數的描述和其他可能有用的函數。</li><li><code>keyMatch(r.obj, p.obj)</code>: 請求的對象匹配策略的對象（此處為 URL 路徑）。</li><li><code>keyMatch(r.act, p.act)</code>: 請求的動作匹配策略的動作（此處為 HTTP 請求方法）。</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="在路由上啟用插件">在路由上啟用插件<a href="#在路由上啟用插件" class="hash-link" aria-label="直接鏈接到在路由上啟用插件" title="直接鏈接到在路由上啟用插件">​</a></h2><p>一旦你創建了模型和策略，你可以使用 APISIX Admin API 在路由上啟用它。 要使用模型和策略文件路徑啟用它：</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://127.0.0.1:9080/apisix/admin/routes/1 -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -d '</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "plugins": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "authz-casbin": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "model_path": "/path/to/model.conf",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "policy_path": "/path/to/policy.csv",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "username": "username"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "upstream": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "nodes": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "127.0.0.1:1980": 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "roundrobin"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "uri": "/*"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製代碼到剪貼板" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在這裡，username 字段是你將用於傳遞主體的標頭名稱。 例如，如果你將傳遞 username 標頭為 <code>user: alice</code>，你將使用 <code>"username": "user"</code>。</p><p>對於使用模型/策略文本而不是文件，你可以使用 <code>model</code> 和 <code>policy</code> 字段：</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://127.0.0.1:9080/apisix/admin/routes/1 -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -d '</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "plugins": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "authz-casbin": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "model": "[request_definition]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            r = sub, obj, act</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [policy_definition]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            p = sub, obj, act</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [role_definition]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            g = _, _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [policy_effect]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e = some(where (p.eft == allow))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [matchers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            m = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) &amp;&amp; keyMatch(r.obj, p.obj) &amp;&amp; keyMatch(r.act, p.act)",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "policy": "p, *, /, GET</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            p, admin, *, *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            g, alice, admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            g, bob, admin",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "username": "username"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "upstream": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "nodes": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "127.0.0.1:1980": 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "roundrobin"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "uri": "/*"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製代碼到剪貼板" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用全局模型策略啟用插件">使用全局模型/策略啟用插件<a href="#使用全局模型策略啟用插件" class="hash-link" aria-label="直接鏈接到使用全局模型/策略啟用插件" title="直接鏈接到使用全局模型/策略啟用插件">​</a></h2><p>在某些情況下，你可能希望在多個路由上使用單一的模型和策略配置。 你可以通過首先發送一個 <code>PUT</code> 請求，將模型和策略配置添加到插件的元數據中來實現這一點：</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://127.0.0.1:9080/apisix/admin/plugin_metadata/authz-casbin -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -i -X PUT -d '</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"model": "[request_definition]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">r = sub, obj, act</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[policy_definition]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p = sub, obj, act</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[role_definition]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">g = _, _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[policy_effect]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e = some(where (p.eft == allow))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[matchers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) &amp;&amp; keyMatch(r.obj, p.obj) &amp;&amp; keyMatch(r.act, p.act)",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"policy": "p, *, /, GET</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p, admin, *, *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">g, alice, admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">g, bob, admin"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製代碼到剪貼板" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然後，要在某個路由上啟用相同的配置，使用 Admin API 發送請求：</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://127.0.0.1:9080/apisix/admin/routes/1 -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -d '</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "plugins": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "authz-casbin": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "username": "username"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "upstream": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "nodes": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "127.0.0.1:1980": 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "roundrobin"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "uri": "/route1/*"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製代碼到剪貼板" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這將把插件元數據配置添加到路由中。 你還可以通過重新發送帶有更新模型和策略配置的請求到插件的元數據來輕鬆更新插件元數據配置，插件將自動更新所有使用插件元數據的路由。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用案例">使用案例<a href="#使用案例" class="hash-link" aria-label="直接鏈接到使用案例" title="直接鏈接到使用案例">​</a></h2><ul><li>該插件的主要使用案例是在你的 API 中實現授權。 你可以輕鬆地在任何使用授權模型和策略配置的 API 路由上添加此插件。</li><li>如果你希望為所有 API 使用單一的授權模型，你可以使用全局模型/策略方法。 這使得更新所有路由的策略變得容易，因為你只需要在 etcd 中更新元數據。</li><li>如果你希望為每個不同的路由使用不同的模型，你可以使用路由方法。 當不同的 API 路由有不同的用戶權限集時，這很有幫助。 當你處理較大的策略時，這也很有用，因為它將授權過濾到多個路由中，從而使授權更快。</li></ul>]]></content>
        <author>
            <name>Rushikesh Tote</name>
            <uri>http://github.com/rushitote</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[楊羅 - Google 開源同行獎金得主]]></title>
        <id>https://casbin.org/zh/blog/2020/04/21/google-award</id>
        <link href="https://casbin.org/zh/blog/2020/04/21/google-award"/>
        <updated>2020-04-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[今天，我們很高興地宣布，Casbin 的創始人，楊羅 因其 2019 年第三季度在 Casbin、Npcap 和 Nmap 的工作，榮獲 "Google 開源同行獎金得主"。]]></summary>
        <content type="html"><![CDATA[<p>今天，我們很高興地宣布，Casbin 的創始人，<a href="https://github.com/hsluoyz" target="_blank" rel="noopener noreferrer">楊羅</a> 因其 2019 年第三季度在 <a href="/zh/">Casbin</a>、<a href="https://nmap.org/npcap/" target="_blank" rel="noopener noreferrer">Npcap</a> 和 <a href="https://nmap.org/" target="_blank" rel="noopener noreferrer">Nmap</a> 的工作，榮獲 "Google 開源同行獎金得主"。</p><p><img loading="lazy" src="https://hsluoyz.github.io/download/Open%20Source%20Peer%20Bonus%20Q3%202019%20-%20Yang%20Luo%20-%20OSPB%20Award%20Letter.png" alt="ospb" class="img_ev3q"></p><blockquote><p>原始獎勵信函可在此處 <a href="https://github.com/hsluoyz/hsluoyz.github.io/blob/master/download/Open%20Source%20Peer%20Bonus%20Q3%202019%20-%20Yang%20Luo%20-%20OSPB%20Award%20Letter.pdf" target="_blank" rel="noopener noreferrer">訪問</a>。</p></blockquote><p><a href="https://opensource.google.com/docs/growing/peer-bonus/" target="_blank" rel="noopener noreferrer">Google 開源同行獎金</a> 計劃被描述為：</p><blockquote><p><em>就像Google員工獎勵用於表彰那些超越期望的同事一樣，開源員工獎勵則是表彰那些對開源做出卓越貢獻的外部人士。</em></p></blockquote><p>2019年獲獎者的公告可以在以下網址找到：</p><blockquote><p><a href="https://opensource.googleblog.com/2020/01/announcing-2019-second-cycle-google.html" target="_blank" rel="noopener noreferrer">https://opensource.googleblog.com/2020/01/announcing-2019-second-cycle-google.html</a></p></blockquote><p>楊和Casbin被列為對外界有相關影響的開源開發者和項目，如Git、TensorFlow、V8、CPython、LLVM、Apache項目、Angular或Jenkins。</p><p>我們很高興看到Casbin因其對開源和雲安全的貢獻而以這種方式受到認可！</p><p><em>感謝您選擇Casbin！</em></p>]]></content>
        <author>
            <name>Casbin</name>
            <uri>http://github.com/casbin</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[重整我們的文件]]></title>
        <id>https://casbin.org/zh/blog/2018/09/23/new-website</id>
        <link href="https://casbin.org/zh/blog/2018/09/23/new-website"/>
        <updated>2018-09-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[今天，我們將 Casbin 的文件從 GitHub Wiki 遷移到了這個網站的 Docs 部分，該部分由 Docusaurus 提供支持。 Docusaurus 提供了許多出色的功能，如更好的 Markdown 樣式、全文搜索、版本控制、翻譯等。]]></summary>
        <content type="html"><![CDATA[<p>今天，我們將 Casbin 的文件從 GitHub Wiki 遷移到了這個網站的 <code>Docs</code> 部分，該部分由 Docusaurus 提供支持。 Docusaurus 提供了許多出色的功能，如更好的 Markdown 樣式、全文搜索、版本控制、翻譯等。</p><p>文件尚未完美，仍需調整。 源代碼托管在 GitHub 上：<a href="https://github.com/casbin/casbin-website-v2" target="_blank" rel="noopener noreferrer">https://github.com/casbin/casbin-website-v2</a> 。</p><p>歡迎任何貢獻或建議！</p>]]></content>
        <author>
            <name>Yang Luo</name>
            <uri>http://github.com/hsluoyz</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[node-Casbin：Casbin 家庭新成員]]></title>
        <id>https://casbin.org/zh/blog/2018/08/27/node-casbin</id>
        <link href="https://casbin.org/zh/blog/2018/08/27/node-casbin"/>
        <updated>2018-08-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[今天，我們成功地將 Casbin 移植到 Node.js，命名為： node-Casbin]]></summary>
        <content type="html"><![CDATA[<p>今天，我們成功地將 Casbin 移植到 Node.js，命名為： <a href="https://github.com/casbin/node-casbin" target="_blank" rel="noopener noreferrer">node-Casbin</a></p><p><strong>node-Casbin</strong> 分享了類似的用法和 API 與其他 Casbin 的實現。 Express、 Koa2 和 Egg.js 的中間件已準備好使用 。 序列化的存儲適配器也已準備好。</p><p>希望它能夠很好地滿足您的需要:)</p><p>GitHub: <a href="https://github.com/casbin/node-casbin" target="_blank" rel="noopener noreferrer">https://github.com/casbin/node-casbin</a></p>]]></content>
        <author>
            <name>Zixuan Liu</name>
            <uri>http://github.com/nodece</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Casbin 伺服器已啟動！]]></title>
        <id>https://casbin.org/zh/blog/2018/08/07/launching-casbin-server</id>
        <link href="https://casbin.org/zh/blog/2018/08/07/launching-casbin-server"/>
        <updated>2018-08-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[我們的一些客戶詢問 Casbin 是否可以作為服務而不是庫使用。 答案是 肯定的。 今天，我們推出了 Casbin Server 項目，作為 訪問控制即服務 的具體解決方案。]]></summary>
        <content type="html"><![CDATA[<p>我們的一些客戶詢問 Casbin 是否可以作為服務而不是庫使用。 答案是 <strong>肯定的</strong>。 今天，我們推出了 <a href="https://github.com/casbin/casbin-server" target="_blank" rel="noopener noreferrer">Casbin Server</a> 項目，作為 <strong>訪問控制即服務</strong> 的具體解決方案。</p><p><strong>Casbin Server</strong> 由我們的核心團隊積極開發。 它具有以下特點：</p><ul><li>完全使用 Golang 開發。</li><li>可以管理數千個 Casbin 實例，因此你可以將多個服務中的策略執行邏輯移至一個 Casbin Server。</li><li>使用 <strong>gRPC</strong> 與 Casbin Server 通信。 我們還考慮在不久的將來添加 <strong>RESTful</strong> 支持。</li><li>提供友好的網絡管理員入口，供非開發人員管理員管理所有細節，如 Casbin 實例、模型、策略存儲和負載均衡。</li></ul><p>源代碼托管在 GitHub 上：<a href="https://github.com/casbin/casbin-server" target="_blank" rel="noopener noreferrer">https://github.com/casbin/casbin-server</a></p><p>歡迎任何問題或拉取請求 :)</p>]]></content>
        <author>
            <name>Helong Zhang</name>
            <uri>http://github.com/BetaCat0</uri>
        </author>
    </entry>
</feed>