"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[2420],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(n),h=a,d=m["".concat(l,".").concat(h)]||m[h]||p[h]||o;return n?r.createElement(d,i(i({ref:t},u),{},{components:n})):r.createElement(d,i({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6628:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return p}});var r=n(3117),a=n(102),o=(n(7294),n(3905)),i=["components"],s={id:"k8s",title:"Kubernetes\u7684\u6388\u6743"},l=void 0,c={unversionedId:"k8s",id:"k8s",title:"Kubernetes\u7684\u6388\u6743",description:"K8s-authz is a Kubernetes (k8s) RBAC & ABAC authorization middleware based on Casbin. This middleware uses K8s validation admission webhook to check the policies defined by casbin, for every request of the k8s resources. These custom admission controllers perform some kind of validation on the request object that was forwarded by api server and based on a logic, sends back a response to api server that contains information on whether to allow or reject the request. These controllers are registered with Kubernetes using the ValidatingAdmissionWebhook.",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/K8sAuthz.mdx",sourceDirName:".",slug:"/k8s",permalink:"/zh/docs/k8s",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sAuthz.mdx",tags:[],version:"current",frontMatter:{id:"k8s",title:"Kubernetes\u7684\u6388\u6743"},sidebar:"docs",previous:{title:"\u6027\u80fd\u4f18\u5316",permalink:"/zh/docs/performance"},next:{title:"\u4f7f\u7528 Envoy \u5b9e\u73b0 Service Mesh \u6743\u9650\u7ba1\u7406",permalink:"/zh/docs/envoy"}},u={},p=[{value:"Requirements",id:"requirements",level:2},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:2}],m={toc:p};function h(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz"},"K8s-authz")," is a Kubernetes (k8s) RBAC & ABAC authorization middleware based on Casbin. This middleware uses K8s validation admission webhook to check the policies defined by casbin, for every request of the k8s resources. These custom admission controllers perform some kind of validation on the request object that was forwarded by api server and based on a logic, sends back a response to api server that contains information on whether to allow or reject the request. These controllers are registered with Kubernetes using the ",(0,o.kt)("inlineCode",{parentName:"p"},"ValidatingAdmissionWebhook"),"."),(0,o.kt)("p",null,"K8s API\u670d\u52a1\u5668\u9700\u8981\u77e5\u9053\u4f55\u65f6\u5c06\u4f20\u5165\u8bf7\u6c42\u53d1\u9001\u5230\u6211\u4eec\u7684\u63a5\u5165\u63a7\u5236\u5668\u3002 \u8fd9\u65b9\u9762\uff0c \u6211\u4eec\u5df2\u7ecf\u5b9a\u4e49\u4e86\u4e00\u4e2a\u9a8c\u8bc1 webhook\uff0c\u5b83\u5c06\u4ee3\u7406\u4efb\u4f55\u7c7b\u578b\u7684 K8s \u8d44\u6e90/\u5b50\u8d44\u6e90\u7684\u8bf7\u6c42\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u7b56\u7565\u6838\u67e5\u3002 \u53ea\u6709\u5728casbin enforcer \u6388\u6743\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u5141\u8bb8\u7528\u6237\u5229\u7528\u8fd9\u4e9b\u8d44\u6e90\u8fdb\u884c\u64cd\u4f5c\u3002 The ",(0,o.kt)("a",{parentName:"p",href:"/docs/get-started#new-a-casbin-enforcer"},"enforcer")," checks the roles of the user defined in the policies. \u8fd9\u79cd\u4e2d\u95f4\u4ef6\u5c06\u90e8\u7f72\u5728K8s\u96c6\u7fa4\u4e2d\u3002"),(0,o.kt)("h2",{id:"requirements"},"Requirements"),(0,o.kt)("p",null,"\u5728\u7ee7\u7eed\u4e4b\u524d\uff0c\u8bf7\u786e\u4fdd\u4ee5\u4e0b\u5404\u9879\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A running k8s Cluster. You can either run the clusters through Docker by enabling it on the Docker Desktop or you can setup the complete K8s ecosytem locally or on your server. You can follow this detailed ",(0,o.kt)("a",{parentName:"li",href:"https://rominirani.com/tutorial-getting-started-with-kubernetes-on-your-windows-laptop-with-minikube-3269b54a226"},"guide")," to setup the k8s cluster locally on Windows or this ",(0,o.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/how-to-create-a-kubernetes-cluster-using-kubeadm-on-ubuntu-18-04"},"guide")," if want to setup for Linux."),(0,o.kt)("li",{parentName:"ul"},"Kubectl CLI This is the ",(0,o.kt)("a",{parentName:"li",href:"https://master--kubernetes-io-master-staging.netlify.app/docs/tasks/tools/install-kubectl-windows/"},"guide")," to setup it on Windows and this ",(0,o.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/"},"guide")," for Linux."),(0,o.kt)("li",{parentName:"ul"},"OpenSSL")),(0,o.kt)("h2",{id:"\u4f7f\u7528\u65b9\u6cd5"},"\u4f7f\u7528\u65b9\u6cd5"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Generate the certificates and keys for every user by using openssl and running the following script:-")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./gen_cert.sh\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u901a\u8fc7 ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/casbin/k8s-authz/blob/master/Dockerfile"},"Dockerfile")," \u624b\u52a8\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u6784\u5efaDockerfile\uff0c\u7136\u540e\u6839\u636ebuild\u5728 ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/casbin/k8s-authz/blob/718f58c46e3dbf79063b5b1c18348c2fee5de9e9/manifests/deployment.yaml#L18"},"\u90e8\u7f72\u6587\u4ef6\u4e0a\u66f4\u6539\u6784\u5efa\u7248\u672c"),"\u3002")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"}," docker build-t casbin/k8s_authz:0.1\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Define the casbin policies in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/config/model.conf"},"model.conf")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/config/policy.csv"},"policy.csv"),". You can refer the ",(0,o.kt)("a",{parentName:"p",href:"/docs/how-it-works"},"docs")," to get to know more about the working of these policies.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u5728\u90e8\u7f72\u4e4b\u524d\uff0c\u60a8\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u7528\u6cd5\u66f4\u6539 ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/main.go"},"main.go")," \u7684\u7aef\u53e3\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u66f4\u6539\u9a8c\u8bc1webhook \u914d\u7f6e\u6587\u4ef6 ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-authz/blob/master/manifests/deployment.yaml"})," \u4e2d\u7684\u7aef\u53e3\u3002")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u7a0b\u5e8f\u6765\u5728 k8s \u96c6\u7fa4\u4e0a\u90e8\u7f72\u9a8c\u8bc1\u63a7\u5236\u5668\u548c webhook \ufe30 -"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kubectl apply -f deployment.yaml\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u751f\u4ea7\u670d\u52a1\u5668\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a k8s ",(0,o.kt)("inlineCode",{parentName:"li"},"secret")," \u6765\u653e\u7f6e\u8bc1\u4e66\u4ee5\u4fdd\u8bc1\u5b89\u5168\u6027\u3002")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kubectl create secret generic casbin -n default \\\n  --from-file=key.pem=certs/casbin-key.pem \\\n  --from-file=cert.pem=certs/casbin-crt.pem\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u53ea\u8981\u5b8c\u6210\u4e86\u8fd9\u4e00\u90e8\u5206\u6211\u4eec\u9700\u8981\u66f4\u6539 ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/main.go#L26"},"\u8bc1\u4e66\u76ee\u5f55")," \uff0c\u7136\u540e\u5728 ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/manifests/deployment.yaml#L22"},"manifest"),"\u4e2d\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"secret")," \u663e\u793a")),(0,o.kt)("p",null,"\u73b0\u5728\u670d\u52a1\u5668\u5e94\u8be5\u8fd0\u884c\u5e76\u51c6\u5907\u9a8c\u8bc1\u5728 k8s \u8d44\u6e90\u4e0a\u64cd\u4f5c\u7684\u8bf7\u6c42\u3002"),(0,o.kt)("p",null,"\u5982\u679c\u6709\u4efb\u4f55\u7591\u95ee\uff0c\u60a8\u53ef\u4ee5\u5728\u6211\u4eec\u7684 ",(0,o.kt)("a",{parentName:"p",href:"https://gitter.im/casbin/lobby"}," Gitter\u9891\u9053 ")," \u4e0a\u8be2\u95ee\u3002"))}h.isMDXComponent=!0}}]);