"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[6884],{1762(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/hrbac-1350d755e04234a34394996344d2b259.png"},2475(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/hrbac-sub-match-55dffd4e5fadb9773658dc90bacbb091.png"},2965(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/hrbac-act-match-bbb086158782591771f2df01419dc4b8.png"},4159(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/rbac-4c8e405408b9e4df554f7cd619eae897.png"},4493(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});var r=i(6559),s=i(4848),t=i(8453);const a={title:"Understanding How Casbin Matching Works in Detail",authors:["aravindarc"]},o=void 0,c={authorsImageUrls:[void 0]},l=[{value:"Introduction to RBAC",id:"introduction-to-rbac",level:2},{value:"Azure\u2019s hierarchical RBAC",id:"azures-hierarchical-rbac",level:2},{value:"How Casbin works",id:"how-casbin-works",level:2},{value:"What is ACL?",id:"what-is-acl",level:2},{value:"Model definition",id:"model-definition",level:3},{value:"Try it in the Casbin editor",id:"try-it-in-the-casbin-editor",level:3},{value:"Visual representation of the ACL model, policy, and request matching",id:"visual-representation-of-the-acl-model-policy-and-request-matching",level:3},{value:"What is RBAC?",id:"what-is-rbac",level:2},{value:"Model definition",id:"model-definition-1",level:3},{value:"Try it in the Casbin editor",id:"try-it-in-the-casbin-editor-1",level:3},{value:"Visual representation of the RBAC model, policy, and request matching",id:"visual-representation-of-the-rbac-model-policy-and-request-matching",level:3},{value:"Hierarchical RBAC",id:"hierarchical-rbac",level:2},{value:"Model definition",id:"model-definition-2",level:3},{value:"Try it in the Casbin editor",id:"try-it-in-the-casbin-editor-2",level:3},{value:"Visual representation of the RBAC model, policy, and request matching",id:"visual-representation-of-the-rbac-model-policy-and-request-matching-1",level:3},{value:"Subject Matching Visual representation",id:"subject-matching-visual-representation",level:4},{value:"Action Matching Visual representation",id:"action-matching-visual-representation",level:4},{value:"Object Matching Visual representation",id:"object-matching-visual-representation",level:4},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["This post explains how to design and implement RBAC with the ",(0,s.jsx)(n.a,{href:"https://casbin.org/",children:"Casbin"})," library. For SaaS platforms with resource hierarchies and roles that inherit permissions, Casbin is a performant option."]}),"\n",(0,s.jsx)(n.h2,{id:"introduction-to-rbac",children:"Introduction to RBAC"}),"\n",(0,s.jsxs)(n.p,{children:["RBAC restricts access based on the roles users hold. To see how ",(0,s.jsx)(n.strong,{children:"hierarchical"})," RBAC works, we look at Azure\u2019s RBAC and then implement something similar in Casbin."]}),"\n",(0,s.jsx)(n.h2,{id:"azures-hierarchical-rbac",children:"Azure\u2019s hierarchical RBAC"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-setup-guide/media/organize-resources/scope-levels.png",alt:"Azure Hierarchy"})}),"\n",(0,s.jsxs)(n.p,{children:["In Azure, the ",(0,s.jsx)(n.strong,{children:"Owner"})," role applies at different scopes. If I have ",(0,s.jsx)(n.strong,{children:"Owner"})," at the subscription level, I am Owner of all resource groups and resources under that subscription. If I have Owner at a resource group level, I am Owner of all resources in that group."]}),"\n",(0,s.jsxs)(n.p,{children:["The image below shows Owner access at the subscription level. ",(0,s.jsx)(n.img,{alt:"Subscription Owner",src:i(8929).A+"",width:"3456",height:"1836"})]}),"\n",(0,s.jsxs)(n.p,{children:["Checking IAM for a resource group under that subscription shows inherited Owner access. ",(0,s.jsx)(n.img,{alt:"RG Owner",src:i(7803).A+"",width:"3456",height:"1836"})]}),"\n",(0,s.jsx)(n.p,{children:"That is how Azure\u2019s RBAC is hierarchical. Many systems use similar hierarchies. In this tutorial we implement a comparable model with Casbin."}),"\n",(0,s.jsx)(n.h2,{id:"how-casbin-works",children:"How Casbin works"}),"\n",(0,s.jsx)(n.p,{children:"Understanding Casbin\u2019s building blocks (request, policy, matcher, effect) makes it easier to design and tune your RBAC model."}),"\n",(0,s.jsx)(n.h2,{id:"what-is-acl",children:"What is ACL?"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"ACL (Access Control List)"})," maps users to actions and actions to resources."]}),"\n",(0,s.jsx)(n.h3,{id:"model-definition",children:"Model definition"}),"\n",(0,s.jsx)(n.p,{children:"A minimal ACL model:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:"[request_definition]\nr = sub, act, obj\n\n[policy_definition]\np = sub, act, obj\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = r.sub == p.sub && r.obj == p.obj && r.act == p.act\n"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"request_definition"})," \u2014 Defines the request format. E.g. ",(0,s.jsx)(n.code,{children:"alice, write, data1"})," means \u201cCan Alice write data1?\u201d"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"policy_definition"})," \u2014 Defines the policy format. E.g. a policy ",(0,s.jsx)(n.code,{children:"alice, write, data1"})," grants Alice permission to write data1."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"policy_effect"})," \u2014 How multiple matching policies are combined (e.g. allow-override)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"matchers"})," \u2014 The condition that must hold: ",(0,s.jsx)(n.code,{children:"r.sub == p.sub && r.obj == p.obj && r.act == p.act"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"try-it-in-the-casbin-editor",children:"Try it in the Casbin editor"}),"\n",(0,s.jsxs)(n.p,{children:["Open the ",(0,s.jsx)(n.a,{href:"https://casbin.org/editor",children:"Casbin editor"})," and paste the model above into the Model editor."]}),"\n",(0,s.jsx)(n.p,{children:"Paste the following in the Policy editor:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",children:"p, alice, read, data1\np, bob, write, data2\n"})}),"\n",(0,s.jsx)(n.p,{children:"and the following in the Request editor:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",children:"alice, read, data1\n"})}),"\n",(0,s.jsx)(n.p,{children:"The result will be:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"true\n"})}),"\n",(0,s.jsx)(n.h3,{id:"visual-representation-of-the-acl-model-policy-and-request-matching",children:"Visual representation of the ACL model, policy, and request matching"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"acl",src:i(9194).A+"",width:"6968",height:"3096"})}),"\n",(0,s.jsx)(n.h2,{id:"what-is-rbac",children:"What is RBAC?"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"RBAC (Role-Based Access Control)"})," assigns users to roles; roles have permissions on resources. A request checks whether the user\u2019s role allows the action on the resource."]}),"\n",(0,s.jsx)(n.h3,{id:"model-definition-1",children:"Model definition"}),"\n",(0,s.jsx)(n.p,{children:"A simple RBAC model:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:"[request_definition]\nr = sub, act, obj\n\n[policy_definition]\np = sub, act, obj\n\n[role_definition]\ng = _, _\ng2 = _, _\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = r.sub == p.sub && g(p.act, r.act) && r.obj == p.obj\n"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"role_definition"})," \u2014 Defines graph relations (e.g. ",(0,s.jsx)(n.code,{children:"g"})," for role\u2013role or user\u2013role). The matcher uses these to resolve roles and permissions."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"try-it-in-the-casbin-editor-1",children:"Try it in the Casbin editor"}),"\n",(0,s.jsxs)(n.p,{children:["Open the ",(0,s.jsx)(n.a,{href:"https://casbin.org/editor",children:"editor"})," and paste the model above."]}),"\n",(0,s.jsx)(n.p,{children:"Paste the following in the Policy editor:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",children:"p, alice, reader, data1\np, bob, owner, data2\n\ng, reader, read\ng, owner, read\ng, owner, write\n"})}),"\n",(0,s.jsx)(n.p,{children:"and the following in the Request editor:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",children:"alice, read, data1\nalice, write, data1\nbob, write, data2\nbob, read, data2\nbob, write, data1\n"})}),"\n",(0,s.jsx)(n.p,{children:"The result will be:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"true\nfalse\ntrue\ntrue\nfalse\n"})}),"\n",(0,s.jsx)(n.h3,{id:"visual-representation-of-the-rbac-model-policy-and-request-matching",children:"Visual representation of the RBAC model, policy, and request matching"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"rbac",src:i(4159).A+"",width:"7016",height:"2844"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"g"})," (role-to-action) relation is a graph. In policy it is written as edges, for example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",children:"g, reader, read\ng, owner, read\ng, owner, write\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"p"})," is a normal policy (compared with ",(0,s.jsx)(n.code,{children:"=="}),"). ",(0,s.jsx)(n.strong,{children:"g"})," is a graph relation. You can add more with suffixes: ",(0,s.jsx)(n.strong,{children:"g2"}),", ",(0,s.jsx)(n.strong,{children:"g3"}),", etc."]})}),"\n",(0,s.jsx)(n.h2,{id:"hierarchical-rbac",children:"Hierarchical RBAC"}),"\n",(0,s.jsxs)(n.p,{children:["In hierarchical RBAC there are multiple ",(0,s.jsx)(n.strong,{children:"resource types"})," with inheritance (e.g. Subscription \u2192 ResourceGroup). A subscription ",(0,s.jsx)(n.strong,{children:"sub1"})," can contain resource groups ",(0,s.jsx)(n.strong,{children:"rg1"}),", ",(0,s.jsx)(n.strong,{children:"rg2"}),". Similarly, there are subscription-level roles/actions and resource-group-level roles/actions, with inheritance between them. For example, the subscription role ",(0,s.jsx)(n.strong,{children:"sub-owner"})," might inherit to the resource-group role ",(0,s.jsx)(n.strong,{children:"rg-owner"}),": if I have ",(0,s.jsx)(n.strong,{children:"sub-owner"})," on ",(0,s.jsx)(n.strong,{children:"sub1"}),", I effectively have ",(0,s.jsx)(n.strong,{children:"rg-owner"})," on ",(0,s.jsx)(n.strong,{children:"rg1"})," and ",(0,s.jsx)(n.strong,{children:"rg2"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"model-definition-2",children:"Model definition"}),"\n",(0,s.jsx)(n.p,{children:"A minimal hierarchical RBAC model:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:"[request_definition]\nr = sub, act, obj\n\n[policy_definition]\np = sub, act, obj\n\n[role_definition]\ng = _, _\ng2 = _, _\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = r.sub == p.sub && g(p.act, r.act) && g2(p.obj, r.obj)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Here ",(0,s.jsx)(n.strong,{children:"g"})," links roles/actions and ",(0,s.jsx)(n.strong,{children:"g2"})," links resources (e.g. subscription to resource group)."]}),"\n",(0,s.jsx)(n.h3,{id:"try-it-in-the-casbin-editor-2",children:"Try it in the Casbin editor"}),"\n",(0,s.jsxs)(n.p,{children:["Open the ",(0,s.jsx)(n.a,{href:"https://casbin.org/editor",children:"editor"})," and paste the model above."]}),"\n",(0,s.jsx)(n.p,{children:"Paste the following in the Policy editor:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",children:"p, alice, sub-reader, sub1\np, bob, rg-owner, rg2\n\n// subscription role to subscription action mapping\ng, sub-reader, sub-read\ng, sub-owner, sub-read\ng, sub-owner, sub-write\n\n// resourceGroup role to resourceGroup action mapping\ng, rg-reader, rg-read\ng, rg-owner, rg-read\ng, rg-owner, rg-write\n\n// subscription role to resourceGroup role mapping\ng, sub-reader, rg-reader\ng, sub-owner, rg-owner\n\n// subscription resource to resourceGroup resource mapping\ng2, sub1, rg1\ng2, sub2, rg2\n"})}),"\n",(0,s.jsx)(n.p,{children:"And paste the following in the Request editor:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",children:"alice, rg-read, rg1\n"})}),"\n",(0,s.jsx)(n.p,{children:"The result will be:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"true\n"})}),"\n",(0,s.jsx)(n.h3,{id:"visual-representation-of-the-rbac-model-policy-and-request-matching-1",children:"Visual representation of the RBAC model, policy, and request matching"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hrbac",src:i(1762).A+"",width:"7968",height:"4204"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"g"})," edges (role \u2192 action, role \u2192 role) can be written in policy as:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",children:"// subscription role to subscription action mapping\ng, sub-reader, sub-read\ng, sub-owner, sub-read\ng, sub-owner, sub-write\n\n// resourceGroup role to resourceGroup action mapping\ng, rg-reader, rg-read\ng, rg-owner, rg-read\ng, rg-owner, rg-write\n\n// subscription role to resourceGroup role mapping\ng, sub-reader, rg-reader\ng, sub-owner, rg-owner\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"g2"})," edges map subscription to resource group:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",children:"// subscription resource to resourceGroup resource mapping\ng2, sub1, rg1\ng2, sub2, rg2\n"})}),"\n",(0,s.jsx)(n.h4,{id:"subject-matching-visual-representation",children:"Subject Matching Visual representation"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hrbac-sub-match",src:i(2475).A+"",width:"8176",height:"4336"})}),"\n",(0,s.jsx)(n.h4,{id:"action-matching-visual-representation",children:"Action Matching Visual representation"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hrbac-act-match",src:i(2965).A+"",width:"7964",height:"4376"})}),"\n",(0,s.jsx)(n.h4,{id:"object-matching-visual-representation",children:"Object Matching Visual representation"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hrbac-obj-match",src:i(6910).A+"",width:"7964",height:"4296"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Casbin evaluates the request against all policies. If at least one policy matches, the result is ",(0,s.jsx)(n.strong,{children:"true"}),"; otherwise ",(0,s.jsx)(n.strong,{children:"false"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(n.p,{children:"This tutorial showed how ACL, RBAC, and hierarchical RBAC can be expressed in Casbin. In a follow-up, we will implement this in a Spring Boot app and secure APIs with Casbin."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},6559(e){e.exports=JSON.parse('{"permalink":"/uk/blog/2023/12/08/understanding-casbin-matching-in-detail","editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/i18n/uk/docusaurus-plugin-content-blog/2023-12-08-understanding-casbin-matching-in-detail.md","source":"@site/i18n/uk/docusaurus-plugin-content-blog/2023-12-08-understanding-casbin-matching-in-detail.md","title":"Understanding How Casbin Matching Works in Detail","description":"This post explains how to design and implement RBAC with the Casbin library. For SaaS platforms with resource hierarchies and roles that inherit permissions, Casbin is a performant option.","date":"2023-12-08T00:00:00.000Z","tags":[],"readingTime":5.26,"hasTruncateMarker":true,"authors":[{"name":"Aravinda Kumar","url":"https://github.com/aravindarc","imageURL":"https://avatars.githubusercontent.com/aravindarc","key":"aravindarc","page":null}],"frontMatter":{"title":"Understanding How Casbin Matching Works in Detail","authors":["aravindarc"]},"unlisted":false,"prevItem":{"title":"Casbin in 2025: Authorization for the AI Agent Era","permalink":"/uk/blog/casbin-2025-ai-agent-era"},"nextItem":{"title":"Authorization in APISIX Using Casbin","permalink":"/uk/blog/2021/08/19/apisix-casbin-authorization"}}')},6910(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/hrbac-obj-match-aad370d5cbfe1020ec108b9242f8d4bd.png"},7803(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/rg-owner-9c6cd2ae5997a5fba717c445f43130e6.png"},8453(e,n,i){i.d(n,{R:()=>a,x:()=>o});var r=i(6540);const s={},t=r.createContext(s);function a(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(t.Provider,{value:n},e.children)}},8929(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/subscription-owner-f1a7e1c9c03d7c587ce910ae5e6d8a35.png"},9194(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/acl-704097c47b27a1f2235c82f593af469e.png"}}]);