"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[8018],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(7294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},k={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,i=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(a),m=l,d=u["".concat(o,".").concat(m)]||u[m]||k[m]||i;return a?n.createElement(d,r(r({ref:t},c),{},{components:a})):n.createElement(d,r({ref:t},c))}));function m(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=a.length,r=new Array(i);r[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:l,r[1]=s;for(var p=2;p<i;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},5354:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>k,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=a(7462),l=(a(7294),a(3905));const i={id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Kubernetes (K8s) RBAC & ABAC \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u0439\u043d\u0435 \u043f\u0440\u043e\u043c\u0456\u0436\u043d\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043d\u0435 \u0437\u0430\u0431\u0435\u0437\u043f\u0435\u0447\u0435\u043d\u043d\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0456 Casbin",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},r=void 0,s={unversionedId:"k8s-gatekeeper",id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Kubernetes (K8s) RBAC & ABAC \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u0439\u043d\u0435 \u043f\u0440\u043e\u043c\u0456\u0436\u043d\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043d\u0435 \u0437\u0430\u0431\u0435\u0437\u043f\u0435\u0447\u0435\u043d\u043d\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0456 Casbin",source:"@site/i18n/uk/docusaurus-plugin-content-docs/current/K8sGateKeeper.mdx",sourceDirName:".",slug:"/k8s-gatekeeper",permalink:"/uk/docs/k8s-gatekeeper",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sGateKeeper.mdx",tags:[],version:"current",frontMatter:{id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Kubernetes (K8s) RBAC & ABAC \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u0439\u043d\u0435 \u043f\u0440\u043e\u043c\u0456\u0436\u043d\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043d\u0435 \u0437\u0430\u0431\u0435\u0437\u043f\u0435\u0447\u0435\u043d\u043d\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0456 Casbin",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},sidebar:"docs",previous:{title:"Authorization of Kubernetes",permalink:"/uk/docs/k8s"},next:{title:"Authorization of Service Mesh through Envoy",permalink:"/uk/docs/envoy"}},o={},p=[{value:"1. \u041e\u0433\u043b\u044f\u0434 \u0442\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0456\u044f \u0434\u043b\u044f Casbin K8s-Gatekeeper",id:"1-\u043e\u0433\u043b\u044f\u0434-\u0442\u0430-\u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0456\u044f-\u0434\u043b\u044f-casbin-k8s-gatekeeper",level:2},{value:"0.1 \u041f\u0440\u043e\u0441\u0442\u0438\u0439 \u043f\u0440\u0438\u043a\u043b\u0430\u0434",id:"01-\u043f\u0440\u043e\u0441\u0442\u0438\u0439-\u043f\u0440\u0438\u043a\u043b\u0430\u0434",level:3},{value:"1.1 \u042f\u043a \u043f\u0440\u0430\u0446\u044e\u0454 Casbin K8s-Gatekeeper?",id:"11-\u044f\u043a-\u043f\u0440\u0430\u0446\u044e\u0454-casbin-k8s-gatekeeper",level:3},{value:"1.2 \u041f\u0440\u0438\u043a\u043b\u0430\u0434, \u0449\u043e \u0456\u043b\u044e\u0441\u0442\u0440\u0443\u0454, \u044f\u043a \u0446\u0435 \u043f\u0440\u0430\u0446\u044e\u0454",id:"12-\u043f\u0440\u0438\u043a\u043b\u0430\u0434-\u0449\u043e-\u0456\u043b\u044e\u0441\u0442\u0440\u0443\u0454-\u044f\u043a-\u0446\u0435-\u043f\u0440\u0430\u0446\u044e\u0454",level:3},{value:"2 \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f K8s-gatekeeper",id:"2-\u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f-k8s-gatekeeper",level:2},{value:"2.1.1 \u041a\u0440\u043e\u043a 1: \u041f\u043e\u0431\u0443\u0434\u043e\u0432\u0430 \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f",id:"211-\u043a\u0440\u043e\u043a-1-\u043f\u043e\u0431\u0443\u0434\u043e\u0432\u0430-\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f",level:3},{value:"2.1.1 Step 1: Build the image",id:"211-step-1-build-the-image",level:4},{value:"2.1.2 \u041a\u0440\u043e\u043a 2: \u041d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0432\u0456\u0441\u0456\u0432 \u0442\u0430 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u044c \u0434\u043b\u044f K8s-gatekeeper",id:"212-\u043a\u0440\u043e\u043a-2-\u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f-\u0441\u0435\u0440\u0432\u0456\u0441\u0456\u0432-\u0442\u0430-\u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u044c-\u0434\u043b\u044f-k8s-gatekeeper",level:4},{value:"2.1.3 \u041a\u0440\u043e\u043a 3: \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f CRD \u0440\u0435\u0441\u0443\u0440\u0441\u0456\u0432 \u0434\u043b\u044f K8s-gatekeeper",id:"213-\u043a\u0440\u043e\u043a-3-\u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f-crd-\u0440\u0435\u0441\u0443\u0440\u0441\u0456\u0432-\u0434\u043b\u044f-k8s-gatekeeper",level:4},{value:"2.2 \u0417\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439 webhook",id:"22-\u0437\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439-webhook",level:3},{value:"2.3.1 \u041a\u0440\u043e\u043a 1: \u041f\u043e\u0431\u0443\u0434\u043e\u0432\u0430 \u043e\u0431\u0440\u0430\u0437\u0443",id:"231-\u043a\u0440\u043e\u043a-1-\u043f\u043e\u0431\u0443\u0434\u043e\u0432\u0430-\u043e\u0431\u0440\u0430\u0437\u0443",level:3},{value:"\u0411\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u0437\u0432\u0435\u0440\u043d\u0456\u0442\u044c\u0441\u044f \u0434\u043e \u0420\u043e\u0437\u0434\u0456\u043b\u0443 2.1.1.",id:"\u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430-\u0437\u0432\u0435\u0440\u043d\u0456\u0442\u044c\u0441\u044f-\u0434\u043e-\u0440\u043e\u0437\u0434\u0456\u043b\u0443-211",level:4},{value:"\u0412\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>helm install k8sgatekeeper ./k8sgatekeeper</code>.",id:"\u0432\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435-\u043a\u043e\u043c\u0430\u043d\u0434\u0443-helm-install-k8sgatekeeper-k8sgatekeeper",level:4},{value:"\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 K8s-gatekeeper 3.1 \u0421\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438 Casbin",id:"\u0441\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435-k8s-gatekeeper-31-\u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f-\u043c\u043e\u0434\u0435\u043b\u0456-\u0442\u0430-\u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438-casbin",level:2},{value:"\u0423 \u0432\u0430\u0441 \u0454 \u0434\u0432\u0430 \u0441\u043f\u043e\u0441\u043e\u0431\u0438 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438: \u0447\u0435\u0440\u0435\u0437 kubectl \u0430\u0431\u043e \u0447\u0435\u0440\u0435\u0437 go-\u043a\u043b\u0456\u0454\u043d\u0442, \u044f\u043a\u0438\u0439 \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e.",id:"\u0443-\u0432\u0430\u0441-\u0454-\u0434\u0432\u0430-\u0441\u043f\u043e\u0441\u043e\u0431\u0438-\u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f-\u043c\u043e\u0434\u0435\u043b\u0456-\u0442\u0430-\u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438-\u0447\u0435\u0440\u0435\u0437-kubectl-\u0430\u0431\u043e-\u0447\u0435\u0440\u0435\u0437-go-\u043a\u043b\u0456\u0454\u043d\u0442-\u044f\u043a\u0438\u0439-\u043c\u0438-\u043d\u0430\u0434\u0430\u0454\u043c\u043e",level:3},{value:"\u0423 K8s-gatekeeper \u043c\u043e\u0434\u0435\u043b\u044c Casbin \u0437\u0431\u0435\u0440\u0456\u0433\u0430\u0454\u0442\u044c\u0441\u044f \u0443 \u0440\u0435\u0441\u0443\u0440\u0441\u0456 CRD \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e &#39;CasbinModel&#39;.",id:"\u0443-k8s-gatekeeper-\u043c\u043e\u0434\u0435\u043b\u044c-casbin-\u0437\u0431\u0435\u0440\u0456\u0433\u0430\u0454\u0442\u044c\u0441\u044f-\u0443-\u0440\u0435\u0441\u0443\u0440\u0441\u0456-crd-\u043f\u0456\u0434-\u043d\u0430\u0437\u0432\u043e\u044e-casbinmodel",level:4},{value:"\u041c\u0438 \u0440\u043e\u0437\u0443\u043c\u0456\u0454\u043c\u043e, \u0449\u043e \u043c\u043e\u0436\u0443\u0442\u044c \u0431\u0443\u0442\u0438 \u0441\u0438\u0442\u0443\u0430\u0446\u0456\u0457, \u043a\u043e\u043b\u0438 \u043d\u0435 \u0437\u0440\u0443\u0447\u043d\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u043e\u0431\u043e\u043b\u043e\u043d\u043a\u0443 \u0434\u043b\u044f \u0432\u0438\u043a\u043e\u043d\u0430\u043d\u043d\u044f \u043a\u043e\u043c\u0430\u043d\u0434 \u0431\u0435\u0437\u043f\u043e\u0441\u0435\u0440\u0435\u0434\u043d\u044c\u043e \u043d\u0430 \u0432\u0443\u0437\u043b\u0456 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430 K8s, \u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u043a\u043e\u043b\u0438 \u0432\u0438 \u0431\u0443\u0434\u0443\u0454\u0442\u0435 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0443 \u0445\u043c\u0430\u0440\u043d\u0443 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0443 \u0434\u043b\u044f \u0432\u0430\u0448\u043e\u0457 \u043a\u043e\u0440\u043f\u043e\u0440\u0430\u0446\u0456\u0457.",id:"\u043c\u0438-\u0440\u043e\u0437\u0443\u043c\u0456\u0454\u043c\u043e-\u0449\u043e-\u043c\u043e\u0436\u0443\u0442\u044c-\u0431\u0443\u0442\u0438-\u0441\u0438\u0442\u0443\u0430\u0446\u0456\u0457-\u043a\u043e\u043b\u0438-\u043d\u0435-\u0437\u0440\u0443\u0447\u043d\u043e-\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438-\u043e\u0431\u043e\u043b\u043e\u043d\u043a\u0443-\u0434\u043b\u044f-\u0432\u0438\u043a\u043e\u043d\u0430\u043d\u043d\u044f-\u043a\u043e\u043c\u0430\u043d\u0434-\u0431\u0435\u0437\u043f\u043e\u0441\u0435\u0440\u0435\u0434\u043d\u044c\u043e-\u043d\u0430-\u0432\u0443\u0437\u043b\u0456-\u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430-k8s-\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434-\u043a\u043e\u043b\u0438-\u0432\u0438-\u0431\u0443\u0434\u0443\u0454\u0442\u0435-\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0443-\u0445\u043c\u0430\u0440\u043d\u0443-\u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0443-\u0434\u043b\u044f-\u0432\u0430\u0448\u043e\u0457-\u043a\u043e\u0440\u043f\u043e\u0440\u0430\u0446\u0456\u0457",level:4},{value:"3.1.2 Try Whether K8s-gatekeeper Works",id:"312-try-whether-k8s-gatekeeper-works",level:3},{value:"4. How to Write Model and Policy with K8s-gatekeeper",id:"4-how-to-write-model-and-policy-with-k8s-gatekeeper",level:2},{value:"4.1 Request Definition of Model",id:"41-request-definition-of-model",level:3},{value:"4.2 Matchers of Model",id:"42-matchers-of-model",level:3},{value:"4.2.1 Extension functions",id:"421-extension-functions",level:3},{value:"4.2.1.1 access",id:"4211-access",level:4},{value:"4.2.1.2 accessWithWildcard",id:"4212-accesswithwildcard",level:4},{value:"4.2.1.3 Functions Supporting Variable-length Arguments",id:"4213-functions-supporting-variable-length-arguments",level:3},{value:"4.2.1.2 \u0424\u0443\u043d\u043a\u0446\u0456\u0457 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0456\u0457 \u0442\u0438\u043f\u0456\u0432",id:"4212-\u0444\u0443\u043d\u043a\u0446\u0456\u0457-\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0456\u0457-\u0442\u0438\u043f\u0456\u0432",level:4},{value:"5. \u0420\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456 \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f",id:"5-\u0440\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456-\u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f",level:2},{value:"5.1 \u041f\u0440\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438",id:"51-\u043f\u0440\u043e-\u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438",level:3},{value:"5.1.1 \u0421\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u0456 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438",id:"511-\u0441\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u0456-\u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438",level:4},{value:"\u042f\u043a\u0449\u043e \u0432\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435 helm, \u043f\u043e\u0434\u0456\u0431\u043d\u0456 \u0437\u043c\u0456\u043d\u0438 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u0442\u0438 \u0434\u043e helm charts.",id:"\u044f\u043a\u0449\u043e-\u0432\u0438-\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435-helm-\u043f\u043e\u0434\u0456\u0431\u043d\u0456-\u0437\u043c\u0456\u043d\u0438-\u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e-\u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u0442\u0438-\u0434\u043e-helm-charts",level:4}],c={toc:p};function k(e){let{components:t,...a}=e;return(0,l.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"1-\u043e\u0433\u043b\u044f\u0434-\u0442\u0430-\u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0456\u044f-\u0434\u043b\u044f-casbin-k8s-gatekeeper"},"1. \u041e\u0433\u043b\u044f\u0434 \u0442\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0456\u044f \u0434\u043b\u044f Casbin K8s-Gatekeeper"),(0,l.kt)("p",null,"Casbin K8s-GateKeeper - \u0446\u0435 \u0432\u0435\u0431\u0445\u0443\u043a \u0434\u043b\u044f \u043f\u0440\u0438\u0439\u043e\u043c\u0443 \u0432 Kubernetes, \u044f\u043a\u0438\u0439 \u0456\u043d\u0442\u0435\u0433\u0440\u0443\u0454 Casbin \u044f\u043a \u0456\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u0443. \u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 Casbin K8s-GateKeeper, \u0432\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u0441\u0442\u0432\u043e\u0440\u044e\u0432\u0430\u0442\u0438 \u0433\u043d\u0443\u0447\u043a\u0456 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u0457 \u0430\u0431\u043e \u043f\u0435\u0440\u0435\u0445\u043e\u043f\u043b\u0435\u043d\u043d\u044f \u0431\u0443\u0434\u044c-\u044f\u043a\u043e\u0457 \u043e\u043f\u0435\u0440\u0430\u0446\u0456\u0457 \u0437 \u0440\u0435\u0441\u0443\u0440\u0441\u0430\u043c\u0438 K8s, \u041d\u0415 \u043f\u0438\u0448\u0443\u0447\u0438 \u0436\u043e\u0434\u043d\u043e\u0433\u043e \u0440\u044f\u0434\u043a\u0430 \u043a\u043e\u0434\u0443, \u0430 \u043b\u0438\u0448\u0435 \u043a\u0456\u043b\u044c\u043a\u0430 \u0440\u044f\u0434\u043a\u0456\u0432 \u0434\u0435\u043a\u043b\u0430\u0440\u0430\u0442\u0438\u0432\u043d\u0438\u0445 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439 \u043c\u043e\u0434\u0435\u043b\u0435\u0439 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a Casbin, \u044f\u043a\u0456 \u0454 \u0447\u0430\u0441\u0442\u0438\u043d\u043e\u044e \u043c\u043e\u0432\u0438 ACL (\u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u0443) Casbin."),(0,l.kt)("p",null,"Casbin K8s-GateKeeper \u0440\u043e\u0437\u0440\u043e\u0431\u043b\u0435\u043d\u0438\u0439 \u0442\u0430 \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u0443\u0454\u0442\u044c\u0441\u044f \u0441\u043f\u0456\u043b\u044c\u043d\u043e\u0442\u043e\u044e Casbin. \u0420\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0456\u0439 \u0446\u044c\u043e\u0433\u043e \u043f\u0440\u043e\u0435\u043a\u0442\u0443 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0438\u0439 \u0442\u0443\u0442: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-gatekeeper"},"https://github.com/casbin/k8s-gatekeeper")),(0,l.kt)("h3",{id:"01-\u043f\u0440\u043e\u0441\u0442\u0438\u0439-\u043f\u0440\u0438\u043a\u043b\u0430\u0434"},"0.1 \u041f\u0440\u043e\u0441\u0442\u0438\u0439 \u043f\u0440\u0438\u043a\u043b\u0430\u0434"),(0,l.kt)("p",null,'\u041d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u0432\u0430\u043c \u043d\u0435 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u043f\u0438\u0441\u0430\u0442\u0438 \u0436\u043e\u0434\u043d\u043e\u0433\u043e \u043a\u043e\u0434\u0443, \u0430 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u0440\u044f\u0434\u043a\u0438 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0457 \u0434\u043b\u044f \u0434\u043e\u0441\u044f\u0433\u043d\u0435\u043d\u043d\u044f \u0446\u0456\u0454\u0457 \u0444\u0443\u043d\u043a\u0446\u0456\u0457: "\u0417\u0430\u0431\u043e\u0440\u043e\u043d\u0438\u0442\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u044c \u0437 \u0434\u0435\u044f\u043a\u0438\u043c\u0438 \u0432\u043a\u0430\u0437\u0430\u043d\u0438\u043c\u0438 \u0442\u0435\u0433\u0430\u043c\u0438 \u0432 \u0431\u0443\u0434\u044c-\u044f\u043a\u0438\u0445 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u043d\u044f\u0445":'),(0,l.kt)("p",null,"Model:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\ncontain(split(accessWithWildcard(${OBJECT}.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,l.kt)("p",null,"And Policy:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csv"},'p, "1.14.1",deny\n')),(0,l.kt)("p",null,"\u0426\u0435 \u0437\u0432\u0438\u0447\u0430\u0439\u043d\u0430 \u043c\u043e\u0432\u0430 ACL Casbin. \u041f\u0440\u0438\u043f\u0443\u0441\u0442\u0438\u043c\u043e, \u0432\u0438 \u0432\u0436\u0435 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043b\u0438 \u0440\u043e\u0437\u0434\u0456\u043b\u0438 \u043f\u0440\u043e \u043d\u0438\u0445, \u0442\u043e\u0434\u0456 \u0431\u0443\u0434\u0435 \u0434\u0443\u0436\u0435 \u043b\u0435\u0433\u043a\u043e \u0437\u0440\u043e\u0437\u0443\u043c\u0456\u0442\u0438."),(0,l.kt)("p",null,"Casbin K8s-Gatekeeper \u043c\u0430\u0454 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u043f\u0435\u0440\u0435\u0432\u0430\u0433\u0438:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u041b\u0435\u0433\u043a\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438. \u041d\u0430\u043f\u0438\u0441\u0430\u043d\u043d\u044f \u043a\u0456\u043b\u044c\u043a\u043e\u0445 \u0440\u044f\u0434\u043a\u0456\u0432 ACL \u043d\u0430\u0431\u0430\u0433\u0430\u0442\u043e \u043a\u0440\u0430\u0449\u0435, \u043d\u0456\u0436 \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u043d\u044f \u0431\u0430\u0433\u0430\u0442\u044c\u043e\u0445 \u0440\u044f\u0434\u043a\u0456\u0432 \u043a\u043e\u0434\u0443."),(0,l.kt)("li",{parentName:"ul"},"\u0414\u043e\u0437\u0432\u043e\u043b\u044f\u0454 \u0433\u0430\u0440\u044f\u0447\u0435 \u043e\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439. \u0412\u0430\u043c \u043d\u0435 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0432\u0438\u043c\u0438\u043a\u0430\u0442\u0438 \u0432\u0435\u0441\u044c \u043f\u043b\u0430\u0433\u0456\u043d, \u0449\u043e\u0431 \u0437\u043c\u0456\u043d\u0438\u0442\u0438 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0457."),(0,l.kt)("li",{parentName:"ul"},"\u0426\u0435 \u0433\u043d\u0443\u0447\u043a\u043e. \u041c\u043e\u0436\u043d\u0430 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0434\u043e\u0432\u0456\u043b\u044c\u043d\u0456 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u043d\u0430 \u0431\u0443\u0434\u044c-\u044f\u043a\u0438\u0439 \u0440\u0435\u0441\u0443\u0440\u0441 K8s, \u044f\u043a\u0438\u0439 \u043c\u043e\u0436\u043d\u0430 \u0434\u043e\u0441\u043b\u0456\u0434\u0438\u0442\u0438 \u0437\u0430 \u0434\u043e\u043f\u043e\u043c\u043e\u0433\u043e\u044e ",(0,l.kt)("inlineCode",{parentName:"li"},"kubectl gatekeeper"),"."),(0,l.kt)("li",{parentName:"ul"},"\u0426\u0435 \u0441\u043f\u0440\u043e\u0449\u0443\u0454 \u0440\u0435\u0430\u043b\u0456\u0437\u0430\u0446\u0456\u044e \u0432\u0435\u0431\u0445\u0443\u043a\u0430 \u043f\u0440\u0438\u0439\u043e\u043c\u0443 K8s, \u044f\u043a\u0438\u0439 \u0454 \u0434\u0443\u0436\u0435 \u0441\u043a\u043b\u0430\u0434\u043d\u0438\u043c. \u0412\u0430\u043c \u043d\u0435 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0437\u043d\u0430\u0442\u0438, \u0449\u043e \u0442\u0430\u043a\u0435 \u0432\u0435\u0431\u0445\u0443\u043a \u043f\u0440\u0438\u0439\u043e\u043c\u0443 K8s \u0430\u0431\u043e \u044f\u043a \u043f\u0438\u0441\u0430\u0442\u0438 \u043a\u043e\u0434 \u0434\u043b\u044f \u043d\u044c\u043e\u0433\u043e. \u0412\u0441\u0435, \u0449\u043e \u0432\u0430\u043c \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0437\u0440\u043e\u0431\u0438\u0442\u0438, \u0446\u0435 \u0437\u043d\u0430\u0442\u0438 \u0440\u0435\u0441\u0443\u0440\u0441, \u043d\u0430 \u044f\u043a\u043e\u043c\u0443 \u0432\u0438 \u0445\u043e\u0447\u0435\u0442\u0435 \u0432\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0438 \u043e\u0431\u043c\u0435\u0436\u0435\u043d\u043d\u044f, \u0430 \u043f\u043e\u0442\u0456\u043c \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u0438 Casbin ACL. \u0412\u0441\u0456 \u0437\u043d\u0430\u044e\u0442\u044c, \u0449\u043e K8s \u0441\u043a\u043b\u0430\u0434\u043d\u0438\u0439, \u0430\u043b\u0435 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 Casbin K8s-Gatekeeper, \u0432\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u0437\u0430\u043e\u0449\u0430\u0434\u0438\u0442\u0438 \u0447\u0430\u0441."),(0,l.kt)("li",{parentName:"ul"},"\u0426\u0435 \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u0443\u0454\u0442\u044c\u0441\u044f \u0441\u043f\u0456\u043b\u044c\u043d\u043e\u0442\u043e\u044e Casbin. \u041d\u0435 \u0441\u043e\u0440\u043e\u043c\u0442\u0435\u0441\u044f \u0437\u0432\u0435\u0440\u0442\u0430\u0442\u0438\u0441\u044f \u0434\u043e \u043d\u0430\u0441, \u044f\u043a\u0449\u043e \u0449\u043e\u0441\u044c \u0443 \u0446\u044c\u043e\u043c\u0443 \u043f\u043b\u0430\u0433\u0456\u043d\u0456 \u0432\u0430\u0441 \u0431\u0435\u043d\u0442\u0435\u0436\u0438\u0442\u044c \u0430\u0431\u043e \u044f\u043a\u0449\u043e \u0432\u0438 \u0437\u0456\u0442\u043a\u043d\u0443\u043b\u0438\u0441\u044f \u0437 \u0431\u0443\u0434\u044c-\u044f\u043a\u0438\u043c\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430\u043c\u0438 \u043f\u0456\u0434 \u0447\u0430\u0441 \u0441\u043f\u0440\u043e\u0431\u0438 \u0446\u044c\u043e\u0433\u043e.")),(0,l.kt)("h3",{id:"11-\u044f\u043a-\u043f\u0440\u0430\u0446\u044e\u0454-casbin-k8s-gatekeeper"},"1.1 \u042f\u043a \u043f\u0440\u0430\u0446\u044e\u0454 Casbin K8s-Gatekeeper?"),(0,l.kt)("p",null,"K8s-Gatekeeper - \u0446\u0435 \u0432\u0435\u0431\u0445\u0443\u043a \u0434\u043b\u044f \u043f\u0440\u0438\u0439\u043e\u043c\u0443 \u0432 K8s, \u044f\u043a\u0438\u0439 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454 ",(0,l.kt)("a",{parentName:"p",href:"/docs/overview"},"Casbin")," \u0434\u043b\u044f \u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u043d\u043d\u044f \u0434\u043e\u0432\u0456\u043b\u044c\u043d\u0438\u0445 \u043f\u0440\u0430\u0432\u0438\u043b \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u0443, \u0432\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0445 \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0435\u043c, \u0449\u043e\u0431 \u0434\u043e\u043f\u043e\u043c\u043e\u0433\u0442\u0438 \u0437\u0430\u043f\u043e\u0431\u0456\u0433\u0442\u0438 \u0431\u0443\u0434\u044c-\u044f\u043a\u0456\u0439 \u043e\u043f\u0435\u0440\u0430\u0446\u0456\u0457 \u0432 K8s, \u044f\u043a\u0443 \u0430\u0434\u043c\u0456\u043d\u0456\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \u043d\u0435 \u0445\u043e\u0447\u0435."),(0,l.kt)("p",null,"Casbin - \u0446\u0435 \u043f\u043e\u0442\u0443\u0436\u043d\u0430 \u0442\u0430 \u0435\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u0430 \u0431\u0456\u0431\u043b\u0456\u043e\u0442\u0435\u043a\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u0443 \u0437 \u0432\u0456\u0434\u043a\u0440\u0438\u0442\u0438\u043c \u0432\u0438\u0445\u0456\u0434\u043d\u0438\u043c \u043a\u043e\u0434\u043e\u043c. \u0412\u043e\u043d\u0430 \u043d\u0430\u0434\u0430\u0454 \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u043a\u0443 \u0434\u043b\u044f \u0437\u0430\u0431\u0435\u0437\u043f\u0435\u0447\u0435\u043d\u043d\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u0457 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0456 \u0440\u0456\u0437\u043d\u0438\u0445 \u043c\u043e\u0434\u0435\u043b\u0435\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u0443. \u0414\u043b\u044f \u043e\u0442\u0440\u0438\u043c\u0430\u043d\u043d\u044f \u0434\u043e\u0434\u0430\u0442\u043a\u043e\u0432\u043e\u0457 \u0456\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0456\u0457 \u043f\u0440\u043e Casbin, \u0434\u0438\u0432\u0456\u0442\u044c\u0441\u044f ",(0,l.kt)("a",{parentName:"p",href:"/docs/overview"},"\u041e\u0433\u043b\u044f\u0434"),"."),(0,l.kt)("p",null,"\u0412\u0435\u0431\u0445\u0443\u043a\u0438 \u043f\u0440\u0438\u0439\u043e\u043c\u0443 \u0432 K8s - \u0446\u0435 HTTP-\u0437\u0432\u043e\u0440\u043e\u0442\u043d\u0456 \u0432\u0438\u043a\u043b\u0438\u043a\u0438, \u044f\u043a\u0456 \u043e\u0442\u0440\u0438\u043c\u0443\u044e\u0442\u044c '\u0437\u0430\u043f\u0438\u0442\u0438 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c' \u0456 \u0440\u043e\u0431\u043b\u044f\u0442\u044c \u0437 \u043d\u0438\u043c\u0438 \u0449\u043e\u0441\u044c. \u0417\u043e\u043a\u0440\u0435\u043c\u0430, K8s-Gatekeeper - \u0446\u0435 \u0441\u043f\u0435\u0446\u0456\u0430\u043b\u044c\u043d\u0438\u0439 \u0442\u0438\u043f \u0432\u0435\u0431\u0445\u0443\u043a\u0430 \u043f\u0440\u0438\u0439\u043e\u043c\u0443: 'ValidatingAdmissionWebhook', \u044f\u043a\u0438\u0439 \u043c\u043e\u0436\u0435 \u0432\u0438\u0440\u0456\u0448\u0438\u0442\u0438, \u0447\u0438 \u043f\u0440\u0438\u0439\u043c\u0430\u0442\u0438 \u0446\u0435\u0439 \u0437\u0430\u043f\u0438\u0442 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c, \u0447\u0438 \u043d\u0456. \u0429\u043e \u0441\u0442\u043e\u0441\u0443\u0454\u0442\u044c\u0441\u044f \u0437\u0430\u043f\u0438\u0442\u0456\u0432 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c, \u0442\u043e \u0446\u0435 HTTP-\u0437\u0430\u043f\u0438\u0442\u0438, \u044f\u043a\u0456 \u043e\u043f\u0438\u0441\u0443\u044e\u0442\u044c \u043e\u043f\u0435\u0440\u0430\u0446\u0456\u044e \u043d\u0430\u0434 \u0432\u043a\u0430\u0437\u0430\u043d\u0438\u043c\u0438 \u0440\u0435\u0441\u0443\u0440\u0441\u0430\u043c\u0438 K8s (\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f/\u0432\u0438\u0434\u0430\u043b\u0435\u043d\u043d\u044f \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u043d\u044f). \u0414\u043b\u044f \u043e\u0442\u0440\u0438\u043c\u0430\u043d\u043d\u044f \u0434\u043e\u0434\u0430\u0442\u043a\u043e\u0432\u043e\u0457 \u0456\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0456\u0457 \u043f\u0440\u043e \u0432\u0435\u0431\u0445\u0443\u043a\u0438 \u043f\u0440\u0438\u0439\u043e\u043c\u0443, \u0434\u0438\u0432\u0456\u0442\u044c\u0441\u044f ",(0,l.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks"},"\u043e\u0444\u0456\u0446\u0456\u0439\u043d\u0443 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0456\u044e K8s"),"."),(0,l.kt)("h3",{id:"12-\u043f\u0440\u0438\u043a\u043b\u0430\u0434-\u0449\u043e-\u0456\u043b\u044e\u0441\u0442\u0440\u0443\u0454-\u044f\u043a-\u0446\u0435-\u043f\u0440\u0430\u0446\u044e\u0454"},"1.2 \u041f\u0440\u0438\u043a\u043b\u0430\u0434, \u0449\u043e \u0456\u043b\u044e\u0441\u0442\u0440\u0443\u0454, \u044f\u043a \u0446\u0435 \u043f\u0440\u0430\u0446\u044e\u0454"),(0,l.kt)("p",null,"\u041d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u043a\u043e\u043b\u0438 \u0445\u0442\u043e\u0441\u044c \u0445\u043e\u0447\u0435 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u043d\u044f, \u0449\u043e \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u043f\u043e\u0434 \u0437 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u0438\u043c nginx (\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 kubectl \u0430\u0431\u043e \u043a\u043b\u0456\u0454\u043d\u0442\u0438 K8s), K8s \u0437\u0433\u0435\u043d\u0435\u0440\u0443\u0454 \u0437\u0430\u043f\u0438\u0442 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c, \u044f\u043a\u0438\u0439 (\u044f\u043a\u0449\u043e \u043f\u0435\u0440\u0435\u043a\u043b\u0430\u0441\u0442\u0438 \u0443 \u0444\u043e\u0440\u043c\u0430\u0442 YAML) \u043c\u043e\u0436\u0435 \u0431\u0443\u0442\u0438 \u0442\u0430\u043a\u0438\u043c:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.14.1\n        ports:\n        - containerPort: 80\n")),(0,l.kt)("p",null,"\u0426\u0435\u0439 \u0437\u0430\u043f\u0438\u0442 \u043f\u0440\u043e\u0439\u0434\u0435 \u0447\u0435\u0440\u0435\u0437 \u043f\u0440\u043e\u0446\u0435\u0441 \u0432\u0441\u044c\u043e\u0433\u043e \u043f\u0440\u043e\u043c\u0456\u0436\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043d\u043e\u0433\u043e \u0437\u0430\u0431\u0435\u0437\u043f\u0435\u0447\u0435\u043d\u043d\u044f, \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u043e\u0433\u043e \u043d\u0430 \u043c\u0430\u043b\u044e\u043d\u043a\u0443, \u0432\u043a\u043b\u044e\u0447\u0430\u044e\u0447\u0438 \u043d\u0430\u0448 K8s-Gatekeeper. K8s-Gatekeeper \u043c\u043e\u0436\u0435 \u0432\u0438\u044f\u0432\u0438\u0442\u0438 \u0432\u0441\u0456 Casbin \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0456 \u043f\u0440\u0438\u0441\u0442\u0440\u043e\u0457, \u0437\u0431\u0435\u0440\u0435\u0436\u0435\u043d\u0456 \u0432 etcd K8s, \u044f\u043a\u0456 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0456 \u0442\u0430 \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u0443\u044e\u0442\u044c\u0441\u044f \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0435\u043c (\u0447\u0435\u0440\u0435\u0437 ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," \u0430\u0431\u043e Go \u043a\u043b\u0456\u0454\u043d\u0442, \u044f\u043a\u0438\u0439 \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e). \u041a\u043e\u0436\u0435\u043d \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u0439 \u043f\u0440\u0438\u0441\u0442\u0440\u0456\u0439 \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u043c\u043e\u0434\u0435\u043b\u044c Casbin \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0443 Casbin. \u0417\u0430\u043f\u0438\u0442 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c \u0431\u0443\u0434\u0435 \u043e\u0431\u0440\u043e\u0431\u043b\u0435\u043d\u0438\u0439 \u043a\u043e\u0436\u043d\u0438\u043c \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u043c \u043f\u0440\u0438\u0441\u0442\u0440\u043e\u0454\u043c, \u043f\u043e \u0447\u0435\u0440\u0437\u0456, \u0456 \u043b\u0438\u0448\u0435 \u043f\u0440\u043e\u0439\u0448\u043e\u0432\u0448\u0438 \u0432\u0441\u0456 \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0456 \u043f\u0440\u0438\u0441\u0442\u0440\u043e\u0457, \u0437\u0430\u043f\u0438\u0442 \u043c\u043e\u0436\u0435 \u0431\u0443\u0442\u0438 \u043f\u0440\u0438\u0439\u043d\u044f\u0442\u0438\u0439 \u0446\u0438\u043c K8s-Gatekeeper."),(0,l.kt)("p",null,"(\u042f\u043a\u0449\u043e \u0432\u0438 \u043d\u0435 \u0440\u043e\u0437\u0443\u043c\u0456\u0454\u0442\u0435, \u0449\u043e \u0442\u0430\u043a\u0435 \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u0439 \u043f\u0440\u0438\u0441\u0442\u0440\u0456\u0439 Casbin, \u043c\u043e\u0434\u0435\u043b\u044c \u0430\u0431\u043e \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0430, \u0434\u0438\u0432\u0456\u0442\u044c\u0441\u044f \u0446\u0435\u0439 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442: ",(0,l.kt)("a",{parentName:"p",href:"/docs/get-started"},"\u041f\u043e\u0447\u0430\u0442\u043e\u043a \u0440\u043e\u0431\u043e\u0442\u0438"),")."),(0,l.kt)("p",null,"\u041d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u0437 \u044f\u043a\u043e\u0457\u0441\u044c \u043f\u0440\u0438\u0447\u0438\u043d\u0438 \u0430\u0434\u043c\u0456\u043d\u0456\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \u0445\u043e\u0447\u0435 \u0437\u0430\u0431\u043e\u0440\u043e\u043d\u0438\u0442\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f 'nginx:1.14.1', \u0434\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0447\u0438 \u043f\u0440\u0438 \u0446\u044c\u043e\u043c\u0443 'nginx:1.3.1'. \u041c\u043e\u0436\u043d\u0430 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u0439 \u043f\u0440\u0438\u0441\u0442\u0440\u0456\u0439, \u0449\u043e \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0443 (\u041c\u0438 \u043f\u043e\u044f\u0441\u043d\u0438\u043c\u043e, \u044f\u043a \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u0439 \u043f\u0440\u0438\u0441\u0442\u0440\u0456\u0439, \u0449\u043e \u0442\u0430\u043a\u0435 \u0446\u0456 \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438, \u0456 \u044f\u043a \u0457\u0445 \u043f\u0438\u0441\u0430\u0442\u0438 \u0432 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0438\u0445 \u0440\u043e\u0437\u0434\u0456\u043b\u0430\u0445)."),(0,l.kt)("p",null,"Model:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n\n')),(0,l.kt)("p",null,"Policy:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csv"},'p, "nginx:1.13.1",allow\np, "nginx:1.14.1",deny\n')),(0,l.kt)("p",null,"\u0421\u0442\u0432\u043e\u0440\u0438\u0432\u0448\u0438 \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u0439 \u043f\u0440\u0438\u0441\u0442\u0440\u0456\u0439, \u0449\u043e \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u0432\u0438\u0449\u0435\u0437\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0443 \u043c\u043e\u0434\u0435\u043b\u044c \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0443, \u043f\u043e\u043f\u0435\u0440\u0435\u0434\u043d\u0456\u0439 \u0437\u0430\u043f\u0438\u0442 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c \u0431\u0443\u0434\u0435 \u0432\u0456\u0434\u0445\u0438\u043b\u0435\u043d\u0438\u0439 \u0446\u0438\u043c \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u043c \u043f\u0440\u0438\u0441\u0442\u0440\u043e\u0454\u043c, \u0449\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0454, \u0449\u043e K8s \u043d\u0435 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u044c \u0446\u0435 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u043d\u044f."),(0,l.kt)("h2",{id:"2-\u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f-k8s-gatekeeper"},"2 \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f K8s-gatekeeper"),(0,l.kt)("p",null,"\u0406\u0441\u043d\u0443\u0454 \u0442\u0440\u0438 \u043c\u0435\u0442\u043e\u0434\u0438 \u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f K8s-gatekeeper: \u0437\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439 \u0432\u0435\u0431\u0445\u0443\u043a, \u0432\u043d\u0443\u0442\u0440\u0456\u0448\u043d\u0456\u0439 \u0432\u0435\u0431\u0445\u0443\u043a \u0442\u0430 Helm."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"\u041f\u0440\u0438\u043c\u0456\u0442\u043a\u0430: \u0426\u0456 \u043c\u0435\u0442\u043e\u0434\u0438 \u043f\u0440\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u0456 \u043b\u0438\u0448\u0435 \u0434\u043b\u044f \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0456\u0432, \u044f\u043a\u0456 \u0445\u043e\u0447\u0443\u0442\u044c \u0441\u043f\u0440\u043e\u0431\u0443\u0432\u0430\u0442\u0438 K8s-gatekeeper, \u0456 \u043d\u0435 \u0454 \u0431\u0435\u0437\u043f\u0435\u0447\u043d\u0438\u043c\u0438. \u042f\u043a\u0449\u043e \u0432\u0438 \u0445\u043e\u0447\u0435\u0442\u0435 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0439\u043e\u0433\u043e \u0432 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0438\u0432\u043d\u043e\u043c\u0443 \u0441\u0435\u0440\u0435\u0434\u043e\u0432\u0438\u0449\u0456, \u0431\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u043f\u0435\u0440\u0435\u043a\u043e\u043d\u0430\u0439\u0442\u0435\u0441\u044f, \u0449\u043e \u0432\u0438 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043b\u0438 ",(0,l.kt)("a",{parentName:"p",href:"#5-advanced-settings"},"\u0420\u043e\u0437\u0434\u0456\u043b 5. \u0420\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456 \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f")," \u0456 \u0437\u0440\u043e\u0431\u0438\u043b\u0438 \u043d\u0435\u043e\u0431\u0445\u0456\u0434\u043d\u0456 \u0437\u043c\u0456\u043d\u0438 \u043f\u0435\u0440\u0435\u0434 \u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f\u043c. 2.1 \u0412\u043d\u0443\u0442\u0440\u0456\u0448\u043d\u0456\u0439 \u0432\u0435\u0431\u0445\u0443\u043a")),(0,l.kt)("h3",{id:"211-\u043a\u0440\u043e\u043a-1-\u043f\u043e\u0431\u0443\u0434\u043e\u0432\u0430-\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f"},"2.1.1 \u041a\u0440\u043e\u043a 1: \u041f\u043e\u0431\u0443\u0434\u043e\u0432\u0430 \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f"),(0,l.kt)("h4",{id:"211-step-1-build-the-image"},"2.1.1 Step 1: Build the image"),(0,l.kt)("p",null,"\u0414\u043b\u044f \u0432\u043d\u0443\u0442\u0440\u0456\u0448\u043d\u044c\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u0443 webhook \u0441\u0430\u043c webhook \u0431\u0443\u0434\u0435 \u0440\u0435\u0430\u043b\u0456\u0437\u043e\u0432\u0430\u043d\u0438\u0439 \u044f\u043a \u0441\u0435\u0440\u0432\u0456\u0441 \u0443 Kubernetes. \u0429\u043e\u0431 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u043d\u0435\u043e\u0431\u0445\u0456\u0434\u043d\u0438\u0439 \u0441\u0435\u0440\u0432\u0456\u0441 \u0442\u0430 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u043d\u044f, \u0432\u0430\u043c \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u043f\u043e\u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u043e\u0431\u0440\u0430\u0437 K8s-gatekeeper. \u0412\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0432\u043b\u0430\u0441\u043d\u0438\u0439 \u043e\u0431\u0440\u0430\u0437, \u0432\u0438\u043a\u043e\u043d\u0430\u0432\u0448\u0438 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0443 \u043a\u043e\u043c\u0430\u043d\u0434\u0443:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"docker build --target webhook -t k8s-gatekeeper .\n")),(0,l.kt)("p",null,"\u0426\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0438\u0439 \u043e\u0431\u0440\u0430\u0437 \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e 'k8s-gatekeeper:latest'."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"\u041f\u0440\u0438\u043c\u0456\u0442\u043a\u0430: \u042f\u043a\u0449\u043e \u0432\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435 minikube, \u0431\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u0432\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 ",(0,l.kt)("inlineCode",{parentName:"p"},"eval $(minikube -p minikube docker-env)")," \u043f\u0435\u0440\u0435\u0434 \u0437\u0430\u043f\u0443\u0441\u043a\u043e\u043c 'docker build'.")),(0,l.kt)("h4",{id:"212-\u043a\u0440\u043e\u043a-2-\u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f-\u0441\u0435\u0440\u0432\u0456\u0441\u0456\u0432-\u0442\u0430-\u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u044c-\u0434\u043b\u044f-k8s-gatekeeper"},"2.1.2 \u041a\u0440\u043e\u043a 2: \u041d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0432\u0456\u0441\u0456\u0432 \u0442\u0430 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u044c \u0434\u043b\u044f K8s-gatekeeper"),(0,l.kt)("p",null,"\u0412\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u043a\u043e\u043c\u0430\u043d\u0434\u0438:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/rbac.yaml\nkubectl apply -f config/webhook_deployment.yaml \nkubectl apply -f config/webhook_internal.yaml \n")),(0,l.kt)("p",null,"\u0426\u0435 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c K8s-gatekeeper, \u0456 \u0432\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u0435\u0440\u0435\u0432\u0456\u0440\u0438\u0442\u0438 \u0446\u0435, \u0432\u0438\u043a\u043e\u043d\u0430\u0432\u0448\u0438 ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl get pods"),"."),(0,l.kt)("h4",{id:"213-\u043a\u0440\u043e\u043a-3-\u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f-crd-\u0440\u0435\u0441\u0443\u0440\u0441\u0456\u0432-\u0434\u043b\u044f-k8s-gatekeeper"},"2.1.3 \u041a\u0440\u043e\u043a 3: \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f CRD \u0440\u0435\u0441\u0443\u0440\u0441\u0456\u0432 \u0434\u043b\u044f K8s-gatekeeper"),(0,l.kt)("p",null,"\u0412\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u043a\u043e\u043c\u0430\u043d\u0434\u0438:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\n")),(0,l.kt)("h3",{id:"22-\u0437\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439-webhook"},"2.2 \u0417\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439 webhook"),(0,l.kt)("p",null,"\u0414\u043b\u044f \u043c\u0435\u0442\u043e\u0434\u0443 \u0437\u043e\u0432\u043d\u0456\u0448\u043d\u044c\u043e\u0433\u043e webhook K8s-gatekeeper \u0431\u0443\u0434\u0435 \u043f\u0440\u0430\u0446\u044e\u0432\u0430\u0442\u0438 \u043f\u043e\u0437\u0430 Kubernetes, \u0456 Kubernetes \u0431\u0443\u0434\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0430\u0442\u0438\u0441\u044f \u0434\u043e K8s-gatekeeper, \u044f\u043a \u0434\u043e \u0437\u0432\u0438\u0447\u0430\u0439\u043d\u043e\u0433\u043e \u0432\u0435\u0431-\u0441\u0430\u0439\u0442\u0443. Kubernetes \u043c\u0430\u0454 \u043e\u0431\u043e\u0432'\u044f\u0437\u043a\u043e\u0432\u0443 \u0432\u0438\u043c\u043e\u0433\u0443, \u0449\u043e\u0431 admission webhook \u0431\u0443\u0432 HTTPS. \u0414\u043b\u044f \u0442\u0435\u0441\u0442\u0443\u0432\u0430\u043d\u043d\u044f K8s-gatekeeper \u043c\u0438 \u043d\u0430\u0434\u0430\u043b\u0438 \u043d\u0430\u0431\u0456\u0440 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0456\u0432 \u0442\u0430 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0438\u0439 \u043a\u043b\u044e\u0447 (\u0445\u043e\u0447\u0430 \u0446\u0435 \u043d\u0435 \u0454 \u0431\u0435\u0437\u043f\u0435\u0447\u043d\u0438\u043c). \u042f\u043a\u0449\u043e \u0432\u0438 \u0432\u0456\u0434\u0434\u0430\u0454\u0442\u0435 \u043f\u0435\u0440\u0435\u0432\u0430\u0433\u0443 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044e \u0432\u043b\u0430\u0441\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0443, \u0431\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u0437\u0432\u0435\u0440\u043d\u0456\u0442\u044c\u0441\u044f \u0434\u043e ",(0,l.kt)("a",{parentName:"p",href:"#5-advanced-settings"},"\u0420\u043e\u0437\u0434\u0456\u043b\u0443 5. \u0420\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456 \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f")," \u0434\u043b\u044f \u0456\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0456\u0439 \u0449\u043e\u0434\u043e \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0443 \u0442\u0430 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430. \u0421\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442, \u044f\u043a\u0438\u0439 \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e, \u0432\u0438\u0434\u0430\u043d\u0438\u0439 \u0434\u043b\u044f 'webhook.domain.local'."),(0,l.kt)("p",null,"\u041e\u0442\u0436\u0435, \u0437\u043c\u0456\u043d\u0456\u0442\u044c \u0445\u043e\u0441\u0442 (\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, /etc/hosts) \u0442\u0430 \u0441\u043f\u0440\u044f\u043c\u0443\u0439\u0442\u0435 'webhook.domain.local' \u043d\u0430 IP-\u0430\u0434\u0440\u0435\u0441\u0443, \u043d\u0430 \u044f\u043a\u0456\u0439 \u043f\u0440\u0430\u0446\u044e\u0454 K8s-gatekeeper. \u041f\u043e\u0442\u0456\u043c \u0432\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0443 \u043a\u043e\u043c\u0430\u043d\u0434\u0443:"),(0,l.kt)("p",null,"2.3 \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f K8s-gatekeeper \u0447\u0435\u0440\u0435\u0437 Helm"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"go mod tidy\ngo mod vendor\ngo run cmd/webhook/main.go\nkubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\nkubectl apply -f config/webhook_external.yaml \n")),(0,l.kt)("h3",{id:"231-\u043a\u0440\u043e\u043a-1-\u043f\u043e\u0431\u0443\u0434\u043e\u0432\u0430-\u043e\u0431\u0440\u0430\u0437\u0443"},"2.3.1 \u041a\u0440\u043e\u043a 1: \u041f\u043e\u0431\u0443\u0434\u043e\u0432\u0430 \u043e\u0431\u0440\u0430\u0437\u0443"),(0,l.kt)("h4",{id:"\u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430-\u0437\u0432\u0435\u0440\u043d\u0456\u0442\u044c\u0441\u044f-\u0434\u043e-\u0440\u043e\u0437\u0434\u0456\u043b\u0443-211"},"\u0411\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u0437\u0432\u0435\u0440\u043d\u0456\u0442\u044c\u0441\u044f \u0434\u043e ",(0,l.kt)("a",{parentName:"h4",href:"#211-step-1-build-the-image"},"\u0420\u043e\u0437\u0434\u0456\u043b\u0443 2.1.1"),"."),(0,l.kt)("p",null,"2.3.2 \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f \u0447\u0435\u0440\u0435\u0437 Helm"),(0,l.kt)("h4",{id:"\u0432\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435-\u043a\u043e\u043c\u0430\u043d\u0434\u0443-helm-install-k8sgatekeeper-k8sgatekeeper"},"\u0412\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 ",(0,l.kt)("inlineCode",{parentName:"h4"},"helm install k8sgatekeeper ./k8sgatekeeper"),"."),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"})),(0,l.kt)("h2",{id:"\u0441\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435-k8s-gatekeeper-31-\u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f-\u043c\u043e\u0434\u0435\u043b\u0456-\u0442\u0430-\u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438-casbin"},"\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 K8s-gatekeeper 3.1 \u0421\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438 Casbin"),(0,l.kt)("h3",{id:"\u0443-\u0432\u0430\u0441-\u0454-\u0434\u0432\u0430-\u0441\u043f\u043e\u0441\u043e\u0431\u0438-\u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f-\u043c\u043e\u0434\u0435\u043b\u0456-\u0442\u0430-\u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438-\u0447\u0435\u0440\u0435\u0437-kubectl-\u0430\u0431\u043e-\u0447\u0435\u0440\u0435\u0437-go-\u043a\u043b\u0456\u0454\u043d\u0442-\u044f\u043a\u0438\u0439-\u043c\u0438-\u043d\u0430\u0434\u0430\u0454\u043c\u043e"},"\u0423 \u0432\u0430\u0441 \u0454 \u0434\u0432\u0430 \u0441\u043f\u043e\u0441\u043e\u0431\u0438 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438: \u0447\u0435\u0440\u0435\u0437 kubectl \u0430\u0431\u043e \u0447\u0435\u0440\u0435\u0437 go-\u043a\u043b\u0456\u0454\u043d\u0442, \u044f\u043a\u0438\u0439 \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e."),(0,l.kt)("p",null,"3.1.1 \u0421\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f/\u041e\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438 Casbin \u0447\u0435\u0440\u0435\u0437 kubectl"),(0,l.kt)("h4",{id:"\u0443-k8s-gatekeeper-\u043c\u043e\u0434\u0435\u043b\u044c-casbin-\u0437\u0431\u0435\u0440\u0456\u0433\u0430\u0454\u0442\u044c\u0441\u044f-\u0443-\u0440\u0435\u0441\u0443\u0440\u0441\u0456-crd-\u043f\u0456\u0434-\u043d\u0430\u0437\u0432\u043e\u044e-casbinmodel"},"\u0423 K8s-gatekeeper \u043c\u043e\u0434\u0435\u043b\u044c Casbin \u0437\u0431\u0435\u0440\u0456\u0433\u0430\u0454\u0442\u044c\u0441\u044f \u0443 \u0440\u0435\u0441\u0443\u0440\u0441\u0456 CRD \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e 'CasbinModel'."),(0,l.kt)("p",null,"\u0407\u0457 \u0432\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u044f \u0440\u043e\u0437\u0442\u0430\u0448\u043e\u0432\u0430\u043d\u0435 \u0432 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinmodels.yaml"),". \u041f\u0440\u0438\u043a\u043b\u0430\u0434\u0438 \u0454 \u0432 ",(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml"),"."),(0,l.kt)("p",null,"\u0417\u0432\u0435\u0440\u043d\u0456\u0442\u044c \u0443\u0432\u0430\u0433\u0443 \u043d\u0430 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u043f\u043e\u043b\u044f: metadata.name: \u043d\u0430\u0437\u0432\u0430 \u043c\u043e\u0434\u0435\u043b\u0456."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u0426\u044f \u043d\u0430\u0437\u0432\u0430 \u041f\u041e\u0412\u0418\u041d\u041d\u0410 \u0431\u0443\u0442\u0438 \u0442\u0430\u043a\u043e\u044e \u0436, \u044f\u043a \u043d\u0430\u0437\u0432\u0430 \u043e\u0431'\u0454\u043a\u0442\u0430 CasbinPolicy, \u043f\u043e\u0432'\u044f\u0437\u0430\u043d\u043e\u0433\u043e \u0437 \u0446\u0456\u0454\u044e \u043c\u043e\u0434\u0435\u043b\u043b\u044e, \u0449\u043e\u0431 K8s-gatekeeper \u043c\u0456\u0433 \u0457\u0445 \u0441\u043f\u0430\u0440\u0443\u0432\u0430\u0442\u0438 \u0442\u0430 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0432\u0438\u043a\u043e\u043d\u0430\u0432\u0446\u044f. spec.enable: \u044f\u043a\u0449\u043e \u0446\u0435 \u043f\u043e\u043b\u0435 \u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e \u0432 'false', \u0446\u044f \u043c\u043e\u0434\u0435\u043b\u044c (\u0430 \u0442\u0430\u043a\u043e\u0436 \u043e\u0431'\u0454\u043a\u0442 CasbinPolicy, \u043f\u043e\u0432'\u044f\u0437\u0430\u043d\u0438\u0439 \u0437 \u0446\u0456\u0454\u044e \u043c\u043e\u0434\u0435\u043b\u043b\u044e) \u0431\u0443\u0434\u0435 \u0456\u0433\u043d\u043e\u0440\u0443\u0432\u0430\u0442\u0438\u0441\u044f."),(0,l.kt)("li",{parentName:"ul"},"spec.modelText: \u0440\u044f\u0434\u043e\u043a, \u044f\u043a\u0438\u0439 \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u043c\u043e\u0434\u0435\u043b\u0456 Casbin."),(0,l.kt)("li",{parentName:"ul"},"\u041f\u043e\u043b\u0456\u0442\u0438\u043a\u0430 Casbin \u0437\u0431\u0435\u0440\u0456\u0433\u0430\u0454\u0442\u044c\u0441\u044f \u0432 \u0456\u043d\u0448\u043e\u043c\u0443 \u0440\u0435\u0441\u0443\u0440\u0441\u0456 CRD \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e 'CasbinPolicy', \u0432\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u044f \u044f\u043a\u043e\u0433\u043e \u043c\u043e\u0436\u043d\u0430 \u0437\u043d\u0430\u0439\u0442\u0438 \u0432 ",(0,l.kt)("inlineCode",{parentName:"li"},"config/auth.casbin.org_casbinpolicies.yaml"),".")),(0,l.kt)("p",null,"\u041f\u0440\u0438\u043a\u043b\u0430\u0434\u0438 \u0454 \u0432 ",(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/policy.yaml"),"."),(0,l.kt)("p",null,"\u0417\u0432\u0435\u0440\u043d\u0456\u0442\u044c \u0443\u0432\u0430\u0433\u0443 \u043d\u0430 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u043f\u043e\u043b\u044f: metadata.name: \u043d\u0430\u0437\u0432\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u0426\u044f \u043d\u0430\u0437\u0432\u0430 \u041f\u041e\u0412\u0418\u041d\u041d\u0410 \u0431\u0443\u0442\u0438 \u0442\u0430\u043a\u043e\u044e \u0436, \u044f\u043a \u043d\u0430\u0437\u0432\u0430 \u043e\u0431'\u0454\u043a\u0442\u0430 CasbinModel, \u043f\u043e\u0432'\u044f\u0437\u0430\u043d\u043e\u0433\u043e \u0437 \u0446\u0456\u0454\u044e \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u043e\u044e, \u0449\u043e\u0431 K8s-gatekeeper \u043c\u0456\u0433 \u0457\u0445 \u0441\u043f\u0430\u0440\u0443\u0432\u0430\u0442\u0438 \u0442\u0430 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0432\u0438\u043a\u043e\u043d\u0430\u0432\u0446\u044f. spec.policyItem: \u0440\u044f\u0434\u043e\u043a, \u044f\u043a\u0438\u0439 \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438 \u043c\u043e\u0434\u0435\u043b\u0456 Casbin."),(0,l.kt)("li",{parentName:"ul"},"\u041f\u0456\u0441\u043b\u044f \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u0432\u043b\u0430\u0441\u043d\u0438\u0445 \u0444\u0430\u0439\u043b\u0456\u0432 CasbinModel \u0442\u0430 CasbinPolicy \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0443 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0434\u043b\u044f \u0457\u0445 \u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u043d\u043d\u044f:")),(0,l.kt)("p",null,"\u042f\u043a \u0442\u0456\u043b\u044c\u043a\u0438 \u043f\u0430\u0440\u0430 CasbinModel \u0442\u0430 CasbinPolicy \u0431\u0443\u0434\u0435 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0430, K8s-gatekeeper \u0437\u043c\u043e\u0436\u0435 \u0457\u0457 \u0432\u0438\u044f\u0432\u0438\u0442\u0438 \u043f\u0440\u043e\u0442\u044f\u0433\u043e\u043c 5 \u0441\u0435\u043a\u0443\u043d\u0434."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f <filename>\n")),(0,l.kt)("p",null,"3.1.2 \u0421\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f/\u041e\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438 Casbin \u0447\u0435\u0440\u0435\u0437 go-\u043a\u043b\u0456\u0454\u043d\u0442, \u044f\u043a\u0438\u0439 \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e"),(0,l.kt)("h4",{id:"\u043c\u0438-\u0440\u043e\u0437\u0443\u043c\u0456\u0454\u043c\u043e-\u0449\u043e-\u043c\u043e\u0436\u0443\u0442\u044c-\u0431\u0443\u0442\u0438-\u0441\u0438\u0442\u0443\u0430\u0446\u0456\u0457-\u043a\u043e\u043b\u0438-\u043d\u0435-\u0437\u0440\u0443\u0447\u043d\u043e-\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438-\u043e\u0431\u043e\u043b\u043e\u043d\u043a\u0443-\u0434\u043b\u044f-\u0432\u0438\u043a\u043e\u043d\u0430\u043d\u043d\u044f-\u043a\u043e\u043c\u0430\u043d\u0434-\u0431\u0435\u0437\u043f\u043e\u0441\u0435\u0440\u0435\u0434\u043d\u044c\u043e-\u043d\u0430-\u0432\u0443\u0437\u043b\u0456-\u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430-k8s-\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434-\u043a\u043e\u043b\u0438-\u0432\u0438-\u0431\u0443\u0434\u0443\u0454\u0442\u0435-\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0443-\u0445\u043c\u0430\u0440\u043d\u0443-\u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0443-\u0434\u043b\u044f-\u0432\u0430\u0448\u043e\u0457-\u043a\u043e\u0440\u043f\u043e\u0440\u0430\u0446\u0456\u0457"},"\u041c\u0438 \u0440\u043e\u0437\u0443\u043c\u0456\u0454\u043c\u043e, \u0449\u043e \u043c\u043e\u0436\u0443\u0442\u044c \u0431\u0443\u0442\u0438 \u0441\u0438\u0442\u0443\u0430\u0446\u0456\u0457, \u043a\u043e\u043b\u0438 \u043d\u0435 \u0437\u0440\u0443\u0447\u043d\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u043e\u0431\u043e\u043b\u043e\u043d\u043a\u0443 \u0434\u043b\u044f \u0432\u0438\u043a\u043e\u043d\u0430\u043d\u043d\u044f \u043a\u043e\u043c\u0430\u043d\u0434 \u0431\u0435\u0437\u043f\u043e\u0441\u0435\u0440\u0435\u0434\u043d\u044c\u043e \u043d\u0430 \u0432\u0443\u0437\u043b\u0456 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430 K8s, \u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u043a\u043e\u043b\u0438 \u0432\u0438 \u0431\u0443\u0434\u0443\u0454\u0442\u0435 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0443 \u0445\u043c\u0430\u0440\u043d\u0443 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0443 \u0434\u043b\u044f \u0432\u0430\u0448\u043e\u0457 \u043a\u043e\u0440\u043f\u043e\u0440\u0430\u0446\u0456\u0457."),(0,l.kt)("p",null,"\u0422\u043e\u043c\u0443 \u043c\u0438 \u0440\u043e\u0437\u0440\u043e\u0431\u0438\u043b\u0438 go-\u043a\u043b\u0456\u0454\u043d\u0442 \u0434\u043b\u044f \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u0442\u0430 \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u043a\u0438 CasbinModel \u0442\u0430 CasbinPolicy. \u0411\u0456\u0431\u043b\u0456\u043e\u0442\u0435\u043a\u0430 go-\u043a\u043b\u0456\u0454\u043d\u0442\u0430 \u0440\u043e\u0437\u0442\u0430\u0448\u043e\u0432\u0430\u043d\u0430 \u0432 ",(0,l.kt)("inlineCode",{parentName:"p"},"pkg/client"),"."),(0,l.kt)("p",null,"\u0423 ",(0,l.kt)("inlineCode",{parentName:"p"},"client.go")," \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e \u0444\u0443\u043d\u043a\u0446\u0456\u044e \u0434\u043b\u044f \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u043a\u043b\u0456\u0454\u043d\u0442\u0430."),(0,l.kt)("p",null,"In ",(0,l.kt)("inlineCode",{parentName:"p"},"client.go"),", we provide a function to create a client."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"func NewK8sGateKeeperClient(externalClient bool) (*K8sGateKeeperClient, error) \n")),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"externalClient")," parameter determines whether K8s-gatekeeper is running inside the K8s cluster or not."),(0,l.kt)("p",null,"In ",(0,l.kt)("inlineCode",{parentName:"p"},"model.go"),", we provide various functions to create, delete, and modify CasbinModel. You can find out how to use these interfaces in ",(0,l.kt)("inlineCode",{parentName:"p"},"model_test.go"),"."),(0,l.kt)("p",null,"In ",(0,l.kt)("inlineCode",{parentName:"p"},"policy.go"),", we provide various functions to create, delete, and modify CasbiPolicy. You can find out how to use these interfaces in ",(0,l.kt)("inlineCode",{parentName:"p"},"policy_test.go"),"."),(0,l.kt)("h3",{id:"312-try-whether-k8s-gatekeeper-works"},"3.1.2 Try Whether K8s-gatekeeper Works"),(0,l.kt)("p",null,"Suppose you have already created the exact model and policy in ",(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo"),". Now, try the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f example/allowed_repo/testcase/reject_1.yaml\n")),(0,l.kt)("p",null,"You should find that K8s will reject this request and mention that the webhook was the reason why this request is rejected. However, when you try to apply ",(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/testcase/approve_2.yaml"),", it will be accepted."),(0,l.kt)("h2",{id:"4-how-to-write-model-and-policy-with-k8s-gatekeeper"},"4. How to Write Model and Policy with K8s-gatekeeper"),(0,l.kt)("p",null,"First of all, make sure you are familiar with the basic grammar of Casbin Models and Policies. If you are not, please read the ",(0,l.kt)("a",{parentName:"p",href:"/docs/get-started"},"Get Started")," section first. In this chapter, we assume that you already understand what Casbin Models and Policies are."),(0,l.kt)("h3",{id:"41-request-definition-of-model"},"4.1 Request Definition of Model"),(0,l.kt)("p",null,"When K8s-gatekeeper is authorizing a request, the input is always an object: the Go object of the Admission Request. This means that the enforcer will always be used like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"ok, err := enforcer.Enforce(admission)\n")),(0,l.kt)("p",null,"where ",(0,l.kt)("inlineCode",{parentName:"p"},"admission")," is an ",(0,l.kt)("inlineCode",{parentName:"p"},"AdmissionReview")," object defined by K8s's official go api ",(0,l.kt)("inlineCode",{parentName:"p"},'"k8s.io/api/admission/v1"'),". You can find the definition of this struct in this repository: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"},"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"),". For more information, you can also refer to ",(0,l.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"},"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"),"."),(0,l.kt)("p",null,"Therefore, for any model used by K8s-gatekeeper, the definition of the ",(0,l.kt)("inlineCode",{parentName:"p"},"request_definition")," should always be like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},"    [request_definition]\n    r =  obj\n")),(0,l.kt)("p",null,"The name 'obj' is not mandatory, as long as the name is consistent with the name used in the ",(0,l.kt)("inlineCode",{parentName:"p"},"[matchers]")," part."),(0,l.kt)("h3",{id:"42-matchers-of-model"},"4.2 Matchers of Model"),(0,l.kt)("p",null,"You are supposed to use the ABAC feature of Casbin to write your rules. However, the expression evaluator integrated in Casbin does not support indexing in maps or arrays(slices), nor the expansion of arrays. Therefore, K8s-gatekeeper provides various 'Casbin functions' as extensions to implement these features. If you still find that your demand cannot be fulfilled by these extensions, feel free to start an issue, or create a pull request."),(0,l.kt)("p",null,"If you are not familiar with Casbin functions, you can refer to ",(0,l.kt)("a",{parentName:"p",href:"/docs/function"},"Function")," for more information."),(0,l.kt)("p",null,"Here are the extension functions:"),(0,l.kt)("h3",{id:"421-extension-functions"},"4.2.1 Extension functions"),(0,l.kt)("h4",{id:"4211-access"},"4.2.1.1 access"),(0,l.kt)("p",null,"Access is used to solve the problem that Casbin does not support indexing in maps or arrays. The example ",(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml")," demonstrates the usage of this function:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n')),(0,l.kt)("p",null,"In this matcher, ",(0,l.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image")')," is equivalent to ",(0,l.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Image"),", where ",(0,l.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers")," is a slice."),(0,l.kt)("p",null,"Access can also call simple functions that have no parameters and return a single value. The example ",(0,l.kt)("inlineCode",{parentName:"p"},"example/container_resource_limit/model.yaml")," demonstrates this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\n  m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")) >= parseFloat(p.cpu) && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","memory","Value")) >= parseFloat(p.memory)\n')),(0,l.kt)("p",null,"In this matcher, ",(0,l.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")')," is equivalent to ",(0,l.kt)("inlineCode",{parentName:"p"},'r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits["cpu"].Value()'),", where ",(0,l.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits")," is a map, and ",(0,l.kt)("inlineCode",{parentName:"p"},"Value()")," is a simple function that has no parameters and returns a single value."),(0,l.kt)("h4",{id:"4212-accesswithwildcard"},"4.2.1.2 accessWithWildcard"),(0,l.kt)("p",null,'Sometimes, you may have a demand like this: all elements in an array must have a prefix "aaa". However, Casbin does not support ',(0,l.kt)("inlineCode",{parentName:"p"},"for")," loops. With ",(0,l.kt)("inlineCode",{parentName:"p"},"accessWithWildcard"),' and the "map/slice expansion" feature, you can easily implement such a demand.'),(0,l.kt)("p",null,"For example, suppose ",(0,l.kt)("inlineCode",{parentName:"p"},"a.b.c")," is an array ",(0,l.kt)("inlineCode",{parentName:"p"},"[aaa,bbb,ccc,ddd,eee]"),", then the result of ",(0,l.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a,"b","c","*")')," will be a slice ",(0,l.kt)("inlineCode",{parentName:"p"},"[aaa,bbb,ccc,ddd,eee]"),". By using the wildcard ",(0,l.kt)("inlineCode",{parentName:"p"},"*"),", the slice is expanded."),(0,l.kt)("p",null,"Similarly, the wildcard can be used more than once. For example, the result of ",(0,l.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a,"b","c","*","*")')," will be ",(0,l.kt)("inlineCode",{parentName:"p"},"[a.b.c[0][0], a.b.c[0][1], ..., a.b.c[1][0], a.b.c[1][1], ...]"),"."),(0,l.kt)("h3",{id:"4213-functions-supporting-variable-length-arguments"},"4.2.1.3 Functions Supporting Variable-length Arguments"),(0,l.kt)("p",null,"In the expression evaluator of Casbin, when a parameter is an array, it will be automatically expanded as a variable-length argument. \u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 \u0446\u044e \u0444\u0443\u043d\u043a\u0446\u0456\u044e \u0434\u043b\u044f \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u043a\u0438 \u0440\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u043d\u044f \u043c\u0430\u0441\u0438\u0432\u0443/\u0437\u0440\u0456\u0437\u0443/\u043c\u0430\u043f\u0438, \u043c\u0438 \u0442\u0430\u043a\u043e\u0436 \u0456\u043d\u0442\u0435\u0433\u0440\u0443\u0432\u0430\u043b\u0438 \u043a\u0456\u043b\u044c\u043a\u0430 \u0444\u0443\u043d\u043a\u0446\u0456\u0439, \u044f\u043a\u0456 \u043f\u0440\u0438\u0439\u043c\u0430\u044e\u0442\u044c \u043c\u0430\u0441\u0438\u0432/\u0437\u0440\u0456\u0437 \u044f\u043a \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"contain(): \u043f\u0440\u0438\u0439\u043c\u0430\u0454 \u043a\u0456\u043b\u044c\u043a\u0430 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0456\u0432 \u0456 \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454, \u0447\u0438 \u0431\u0443\u0434\u044c-\u044f\u043a\u0438\u0439 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 (\u043a\u0440\u0456\u043c \u043e\u0441\u0442\u0430\u043d\u043d\u044c\u043e\u0433\u043e) \u0434\u043e\u0440\u0456\u0432\u043d\u044e\u0454 \u043e\u0441\u0442\u0430\u043d\u043d\u044c\u043e\u043c\u0443 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0443."),(0,l.kt)("li",{parentName:"ul"},"split(a,b,c...,sep,index): \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442, \u044f\u043a\u0438\u0439 \u043c\u0456\u0441\u0442\u0438\u0442\u044c [splits(a,sep)","[index]",", splits(b,sep)","[index]",", splits(a,sep)","[index]",", ...]."),(0,l.kt)("li",{parentName:"ul"},"len(): \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454 \u0434\u043e\u0432\u0436\u0438\u043d\u0443 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0443 \u0437\u043c\u0456\u043d\u043d\u043e\u0457 \u0434\u043e\u0432\u0436\u0438\u043d\u0438."),(0,l.kt)("li",{parentName:"ul"},"matchRegex(a,b,c...,regex): \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454, \u0447\u0438 \u0432\u0441\u0456 \u0434\u0430\u043d\u0456 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0438 (a, b, c, ...) \u0432\u0456\u0434\u043f\u043e\u0432\u0456\u0434\u0430\u044e\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u043e\u043c\u0443 regex. \u0432\u0456\u0434\u043f\u043e\u0432\u0456\u0434\u0430\u044e\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u043e\u043c\u0443 regex.")),(0,l.kt)("p",null,"\u041e\u0441\u044c \u043f\u0440\u0438\u043a\u043b\u0430\u0434 \u0443 ",(0,l.kt)("inlineCode",{parentName:"p"},"example/disallowed_tag/model.yaml"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'    [matchers]\n    m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n    contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,l.kt)("p",null,"\u041f\u0440\u0438\u043f\u0443\u0441\u043a\u0430\u044e\u0447\u0438, \u0449\u043e ",(0,l.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image")')," \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454 ",(0,l.kt)("inlineCode",{parentName:"p"},"['a:b', 'c:d', 'e:f', 'g:h']"),", \u043e\u0441\u043a\u0456\u043b\u044c\u043a\u0438 splits \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u0443\u0454 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0438 \u0437\u043c\u0456\u043d\u043d\u043e\u0457 \u0434\u043e\u0432\u0436\u0438\u043d\u0438 \u0442\u0430 \u0432\u0438\u043a\u043e\u043d\u0443\u0454 \u043e\u043f\u0435\u0440\u0430\u0446\u0456\u044e \u0440\u043e\u0437\u0431\u0438\u0442\u0442\u044f \u0434\u043b\u044f \u043a\u043e\u0436\u043d\u043e\u0433\u043e \u0435\u043b\u0435\u043c\u0435\u043d\u0442\u0430, \u0435\u043b\u0435\u043c\u0435\u043d\u0442 \u0437 \u0456\u043d\u0434\u0435\u043a\u0441\u043e\u043c 1 \u0431\u0443\u0434\u0435 \u0432\u0438\u0431\u0440\u0430\u043d\u0438\u0439 \u0442\u0430 \u043f\u043e\u0432\u0435\u0440\u043d\u0435\u043d\u0438\u0439. \u0422\u043e\u043c\u0443, ",(0,l.kt)("inlineCode",{parentName:"p"},'split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1)')," \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454 ",(0,l.kt)("inlineCode",{parentName:"p"},"['b','d','f','h']"),". \u0406 ",(0,l.kt)("inlineCode",{parentName:"p"},'contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)')," \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454, \u0447\u0438 ",(0,l.kt)("inlineCode",{parentName:"p"},"p.obj")," \u043c\u0456\u0441\u0442\u0438\u0442\u044c\u0441\u044f \u0432 ",(0,l.kt)("inlineCode",{parentName:"p"},"['b','d','f','h']"),"."),(0,l.kt)("h4",{id:"4212-\u0444\u0443\u043d\u043a\u0446\u0456\u0457-\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0456\u0457-\u0442\u0438\u043f\u0456\u0432"},"4.2.1.2 \u0424\u0443\u043d\u043a\u0446\u0456\u0457 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0456\u0457 \u0442\u0438\u043f\u0456\u0432"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"ParseFloat(): \u041f\u0435\u0440\u0435\u0442\u0432\u043e\u0440\u044e\u0454 \u0446\u0456\u043b\u0435 \u0447\u0438\u0441\u043b\u043e \u0432 \u0447\u0438\u0441\u043b\u043e \u0437 \u043f\u043b\u0430\u0432\u0430\u044e\u0447\u043e\u044e \u043a\u043e\u043c\u043e\u044e (\u0446\u0435 \u043d\u0435\u043e\u0431\u0445\u0456\u0434\u043d\u043e, \u043e\u0441\u043a\u0456\u043b\u044c\u043a\u0438 \u0431\u0443\u0434\u044c-\u044f\u043a\u0435 \u0447\u0438\u0441\u043b\u043e, \u0449\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u044c\u0441\u044f \u0443 \u043f\u043e\u0440\u0456\u0432\u043d\u044f\u043d\u043d\u0456, \u043c\u0430\u0454 \u0431\u0443\u0442\u0438 \u043f\u0435\u0440\u0435\u0442\u0432\u043e\u0440\u0435\u043d\u0435 \u0443 \u0447\u0438\u0441\u043b\u043e \u0437 \u043f\u043b\u0430\u0432\u0430\u044e\u0447\u043e\u044e \u043a\u043e\u043c\u043e\u044e)."),(0,l.kt)("li",{parentName:"ul"},"ToString(): \u041f\u0435\u0440\u0435\u0442\u0432\u043e\u0440\u044e\u0454 \u043e\u0431'\u0454\u043a\u0442 \u0443 \u0440\u044f\u0434\u043e\u043a. \u0426\u0435\u0439 \u043e\u0431'\u0454\u043a\u0442 \u043c\u0430\u0454 \u043c\u0430\u0442\u0438 \u0431\u0430\u0437\u043e\u0432\u0438\u0439 \u0442\u0438\u043f \u0440\u044f\u0434\u043a\u0430 (\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u043e\u0431'\u0454\u043a\u0442 \u0442\u0438\u043f\u0443 ",(0,l.kt)("inlineCode",{parentName:"li"},"XXX"),", \u043a\u043e\u043b\u0438 \u0454 \u0432\u0438\u0441\u043b\u043e\u0432\u043b\u044e\u0432\u0430\u043d\u043d\u044f ",(0,l.kt)("inlineCode",{parentName:"li"},"type XXX string"),")."),(0,l.kt)("li",{parentName:"ul"},"IsNil(): \u041f\u043e\u0432\u0435\u0440\u0442\u0430\u0454, \u0447\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u0454 nil.")),(0,l.kt)("h2",{id:"5-\u0440\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456-\u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f"},"5. \u0420\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456 \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f"),(0,l.kt)("h3",{id:"51-\u043f\u0440\u043e-\u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438"},"5.1 \u041f\u0440\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438"),(0,l.kt)("p",null,"\u0423 Kubernetes (k8s) \u043e\u0431\u043e\u0432'\u044f\u0437\u043a\u043e\u0432\u043e, \u0449\u043e\u0431 webhook \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0432 HTTPS. \u0406\u0441\u043d\u0443\u0454 \u0434\u0432\u0430 \u043f\u0456\u0434\u0445\u043e\u0434\u0438 \u0434\u043b\u044f \u0434\u043e\u0441\u044f\u0433\u043d\u0435\u043d\u043d\u044f \u0446\u044c\u043e\u0433\u043e:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0441\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u0438\u0445 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0456\u0432 (\u043f\u0440\u0438\u043a\u043b\u0430\u0434\u0438 \u0443 \u0446\u044c\u043e\u043c\u0443 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0456\u0457 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0442\u044c \u0446\u0435\u0439 \u043c\u0435\u0442\u043e\u0434)"),(0,l.kt)("li",{parentName:"ul"},"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0437\u0432\u0438\u0447\u0430\u0439\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430")),(0,l.kt)("h4",{id:"511-\u0441\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u0456-\u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438"},"5.1.1 \u0421\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u0456 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438"),(0,l.kt)("p",null,"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0441\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430 \u043e\u0437\u043d\u0430\u0447\u0430\u0454, \u0449\u043e \u0426\u0435\u043d\u0442\u0440 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0446\u0456\u0457 (CA), \u044f\u043a\u0438\u0439 \u0432\u0438\u0434\u0430\u0454 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442, \u043d\u0435 \u0454 \u043e\u0434\u043d\u0438\u043c \u0437 \u0432\u0456\u0434\u043e\u043c\u0438\u0445 CA. \u0422\u043e\u043c\u0443, \u0432\u0438 \u043f\u043e\u0432\u0438\u043d\u043d\u0456 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u0438\u0442\u0438 k8s \u043f\u0440\u043e \u0446\u0435\u0439 CA."),(0,l.kt)("p",null,"\u041d\u0430\u0440\u0430\u0437\u0456, \u043f\u0440\u0438\u043a\u043b\u0430\u0434 \u0443 \u0446\u044c\u043e\u043c\u0443 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0456\u0457 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454 \u0441\u0430\u043c\u043e\u0441\u0442\u0456\u0439\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0438\u0439 CA, \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0438\u0439 \u043a\u043b\u044e\u0447 \u0442\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442 \u044f\u043a\u043e\u0433\u043e \u0437\u0431\u0435\u0440\u0456\u0433\u0430\u044e\u0442\u044c\u0441\u044f \u0443 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.crt")," \u0442\u0430 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.key")," \u0432\u0456\u0434\u043f\u043e\u0432\u0456\u0434\u043d\u043e. \u0421\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442 \u0434\u043b\u044f webhook \u0454 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/certificate/server.crt"),', \u044f\u043a\u0438\u0439 \u0432\u0438\u043f\u0443\u0449\u0435\u043d\u0438\u0439 \u0441\u0430\u043c\u043e\u0441\u0442\u0456\u0439\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0438\u043c CA. \u0414\u043e\u043c\u0435\u043d\u0438 \u0446\u044c\u043e\u0433\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430 - "webhook.domain.local" (\u0434\u043b\u044f \u0437\u043e\u0432\u043d\u0456\u0448\u043d\u044c\u043e\u0433\u043e webhook) \u0442\u0430 "casbin-webhook-svc.default.svc" (\u0434\u043b\u044f \u0432\u043d\u0443\u0442\u0440\u0456\u0448\u043d\u044c\u043e\u0433\u043e webhook).'),(0,l.kt)("p",null,"\u0406\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0456\u044f \u043f\u0440\u043e CA \u043f\u0435\u0440\u0435\u0434\u0430\u0454\u0442\u044c\u0441\u044f \u0434\u043e k8s \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439\u043d\u0456 \u0444\u0430\u0439\u043b\u0438 webhook. \u041e\u0431\u0438\u0434\u0432\u0430 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," \u0442\u0430 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),' \u043c\u0430\u044e\u0442\u044c \u043f\u043e\u043b\u0435 \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e "CABundle", \u044f\u043a\u0435 \u043c\u0456\u0441\u0442\u0438\u0442\u044c base64 \u0437\u0430\u043a\u043e\u0434\u043e\u0432\u0430\u043d\u0438\u0439 \u0440\u044f\u0434\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430 CA.'),(0,l.kt)("p",null,"\u0423 \u0432\u0438\u043f\u0430\u0434\u043a\u0443, \u044f\u043a\u0449\u043e \u0432\u0430\u043c \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0437\u043c\u0456\u043d\u0438\u0442\u0438 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442/\u0434\u043e\u043c\u0435\u043d (\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u044f\u043a\u0449\u043e \u0432\u0438 \u0445\u043e\u0447\u0435\u0442\u0435 \u043f\u043e\u043c\u0456\u0441\u0442\u0438\u0442\u0438 \u0446\u0435\u0439 webhook \u0432 \u0456\u043d\u0448\u0438\u0439 \u043f\u0440\u043e\u0441\u0442\u0456\u0440 \u0456\u043c\u0435\u043d k8s, \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 \u0432\u043d\u0443\u0442\u0440\u0456\u0448\u043d\u0456\u0439 webhook, \u0430\u0431\u043e \u044f\u043a\u0449\u043e \u0432\u0438 \u0445\u043e\u0447\u0435\u0442\u0435 \u0437\u043c\u0456\u043d\u0438\u0442\u0438 \u0434\u043e\u043c\u0435\u043d, \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 \u0437\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439 webhook), \u0441\u043b\u0456\u0434 \u0434\u043e\u0442\u0440\u0438\u043c\u0443\u0432\u0430\u0442\u0438\u0441\u044f \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0438\u0445 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u0421\u0442\u0432\u043e\u0440\u0456\u0442\u044c \u043d\u043e\u0432\u0438\u0439 CA:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u0421\u0442\u0432\u043e\u0440\u0456\u0442\u044c \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0438\u0439 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0444\u0435\u0439\u043a\u043e\u0432\u043e\u0433\u043e CA:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out ca.key 2048\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u0412\u0438\u0434\u0430\u043b\u0456\u0442\u044c \u0437\u0430\u0445\u0438\u0441\u0442 \u043f\u0430\u0440\u043e\u043b\u0435\u043c \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl rsa -in ca.key -out ca.key\n"))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u0421\u0442\u0432\u043e\u0440\u0456\u0442\u044c \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0438\u0439 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 webhook:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out server.key 2048\nopenssl rsa -in server.key -out server.key\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0439\u0442\u0435 \u0441\u0430\u043c\u043e\u0441\u0442\u0456\u0439\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0438\u0439 CA \u0434\u043b\u044f \u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430 \u0434\u043b\u044f webhook:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u0421\u043a\u043e\u043f\u0456\u044e\u0439\u0442\u0435 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439\u043d\u0438\u0439 \u0444\u0430\u0439\u043b openssl \u0432\u0430\u0448\u043e\u0457 \u0441\u0438\u0441\u0442\u0435\u043c\u0438 \u0434\u043b\u044f \u0442\u0438\u043c\u0447\u0430\u0441\u043e\u0432\u043e\u0433\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f. \u0412\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u0434\u0456\u0437\u043d\u0430\u0442\u0438\u0441\u044f \u043c\u0456\u0441\u0446\u0435\u0437\u043d\u0430\u0445\u043e\u0434\u0436\u0435\u043d\u043d\u044f \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439\u043d\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0443, \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0432\u0448\u0438 ",(0,l.kt)("inlineCode",{parentName:"p"},"openssl version -a"),", \u0437\u0430\u0437\u0432\u0438\u0447\u0430\u0439 \u043d\u0430\u0437\u0438\u0432\u0430\u0454\u0442\u044c\u0441\u044f ",(0,l.kt)("inlineCode",{parentName:"p"},"openssl.cnf"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u0423 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439\u043d\u043e\u043c\u0443 \u0444\u0430\u0439\u043b\u0456:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u0417\u043d\u0430\u0439\u0434\u0456\u0442\u044c \u043f\u0430\u0440\u0430\u0433\u0440\u0430\u0444 ",(0,l.kt)("inlineCode",{parentName:"p"},"[req]")," \u0442\u0430 \u0434\u043e\u0434\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0438\u0439 \u0440\u044f\u0434\u043e\u043a: ",(0,l.kt)("inlineCode",{parentName:"p"},"req_extensions = v3_req"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u0417\u043d\u0430\u0439\u0434\u0456\u0442\u044c \u043f\u0430\u0440\u0430\u0433\u0440\u0430\u0444 ",(0,l.kt)("inlineCode",{parentName:"p"},"[v3_req]")," \u0442\u0430 \u0434\u043e\u0434\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0438\u0439 \u0440\u044f\u0434\u043e\u043a: ",(0,l.kt)("inlineCode",{parentName:"p"},"subjectAltName = @alt_names"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u0414\u043e\u0434\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u0440\u044f\u0434\u043a\u0438 \u0434\u043e \u0444\u0430\u0439\u043b\u0443:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-ini"},"[alt_names]\nDNS.2=<The domain you want>\n")),(0,l.kt)("p",{parentName:"li"},"\u041f\u0440\u0438\u043c\u0456\u0442\u043a\u0430: \u0417\u0430\u043c\u0456\u043d\u0456\u0442\u044c 'casbin-webhook-svc.default.svc' \u043d\u0430 \u0441\u043f\u0440\u0430\u0432\u0436\u043d\u0454 \u0456\u043c'\u044f \u0441\u0435\u0440\u0432\u0456\u0441\u0443 \u0432\u0430\u0448\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0456\u0441\u0443, \u044f\u043a\u0449\u043e \u0432\u0438 \u0432\u0438\u0440\u0456\u0448\u0438\u0442\u0435 \u0437\u043c\u0456\u043d\u0438\u0442\u0438 \u0456\u043c'\u044f \u0441\u0435\u0440\u0432\u0456\u0441\u0443.")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0439\u0442\u0435 \u0437\u043c\u0456\u043d\u0435\u043d\u0438\u0439 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439\u043d\u0438\u0439 \u0444\u0430\u0439\u043b \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0456\u0457 \u0444\u0430\u0439\u043b\u0443 \u0437\u0430\u043f\u0438\u0442\u0443 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl req -new -nodes -keyout server.key -out server.csr -config openssl.cnf\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0439\u0442\u0435 \u0441\u0430\u043c\u043e\u0441\u0442\u0456\u0439\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0438\u0439 CA \u0434\u043b\u044f \u0432\u0456\u0434\u043f\u043e\u0432\u0456\u0434\u0456 \u043d\u0430 \u0437\u0430\u043f\u0438\u0442 \u0442\u0430 \u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl x509 -req -days 3650 -in server.csr -out server.crt -CA ca.crt -CAkey ca.key -CAcreateserial -extensions v3_req -extensions SAN -extfile openssl.cnf\n"))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u0417\u0430\u043c\u0456\u043d\u0456\u0442\u044c \u043f\u043e\u043b\u0435 'CABundle': \u041e\u0431\u0438\u0434\u0432\u0430 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," \u0442\u0430 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),' \u043c\u0430\u044e\u0442\u044c \u043f\u043e\u043b\u0435 \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e "CABundle", \u044f\u043a\u0435 \u043c\u0456\u0441\u0442\u0438\u0442\u044c base64 \u0437\u0430\u043a\u043e\u0434\u043e\u0432\u0430\u043d\u0438\u0439 \u0440\u044f\u0434\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430 CA.')),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u041e\u043d\u043e\u0432\u0456\u0442\u044c \u0446\u0435 \u043f\u043e\u043b\u0435 \u043d\u043e\u0432\u0438\u043c \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u043e\u043c."))),(0,l.kt)("h4",{id:"\u044f\u043a\u0449\u043e-\u0432\u0438-\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435-helm-\u043f\u043e\u0434\u0456\u0431\u043d\u0456-\u0437\u043c\u0456\u043d\u0438-\u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e-\u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u0442\u0438-\u0434\u043e-helm-charts"},"\u042f\u043a\u0449\u043e \u0432\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435 helm, \u043f\u043e\u0434\u0456\u0431\u043d\u0456 \u0437\u043c\u0456\u043d\u0438 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u0442\u0438 \u0434\u043e helm charts."),(0,l.kt)("p",null,"5.1.2 \u041b\u0435\u0433\u0430\u043b\u044c\u043d\u0456 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438 \u042f\u043a\u0449\u043e \u0432\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435 \u043b\u0435\u0433\u0430\u043b\u044c\u043d\u0456 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438, \u0432\u0430\u043c \u043d\u0435 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442\u0438 \u0432\u0441\u0456 \u0446\u0456 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u0438."))}k.isMDXComponent=!0}}]);