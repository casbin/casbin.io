"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[2980],{1670:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"kong-authz","title":"Kong","description":"Authorization for Kong API Gateway using Casbin","source":"@site/i18n/uk/docusaurus-plugin-content-docs/current/KongAuthz.mdx","sourceDirName":".","slug":"/kong-authz","permalink":"/uk/docs/kong-authz","draft":false,"unlisted":false,"editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/docs/KongAuthz.mdx","tags":[],"version":"current","frontMatter":{"id":"kong-authz","title":"Kong","description":"Authorization for Kong API Gateway using Casbin","keywords":["Kong","Kong API Gateway","kong-authz","Lua"],"authors":["hsluoyz"]},"sidebar":"docs","previous":{"title":"Middlewares","permalink":"/uk/docs/middlewares"},"next":{"title":"GraphQL Middlewares","permalink":"/uk/docs/graphql-middlewares"}}');var i=a(4848),o=a(8453);const t={id:"kong-authz",title:"Kong",description:"Authorization for Kong API Gateway using Casbin",keywords:["Kong","Kong API Gateway","kong-authz","Lua"],authors:["hsluoyz"]},l=void 0,r={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"File-Based Policy Storage",id:"file-based-policy-storage",level:3},{value:"Database Policy Storage with LuaSQL",id:"database-policy-storage-with-luasql",level:3},{value:"Database Policy Storage with 4DaysORM",id:"database-policy-storage-with-4daysorm",level:3},{value:"How Authorization Works",id:"how-authorization-works",level:2},{value:"Example Usage",id:"example-usage",level:2},{value:"Resources",id:"resources",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://github.com/casbin-lua/kong-authz",children:"kong-authz"})," is an authorization plugin for Kong based on ",(0,i.jsx)(n.a,{href:"https://github.com/casbin/lua-casbin/",children:"lua-casbin"}),". This plugin enables request authorization in Kong API Gateway using Casbin's powerful and flexible access control models."]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"The following need to be installed in advance:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://konghq.com/",children:"Kong"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/casbin-lua/4daysorm-adapter",children:"4daysorm-adapter"})," (optional, if you want to use database as policy storage)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/casbin-lua/luasql-adapter",children:"luasql-adapter"})," (optional, if you want to use database as policy storage)"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"The Casbin policy is read from a file by default. If you want to use Casbin policy from a database, choose either 4daysorm-adapter or luasql-adapter."})}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.p,{children:"Ensure you have Casbin's system dependencies installed:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["For systems with ",(0,i.jsx)(n.code,{children:"apt"})," package manager:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt install gcc libpcre3 libpcre3-dev\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"For Alpine-based systems:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apk add gcc pcre pcre-dev libc-dev\n"})}),"\n",(0,i.jsx)(n.p,{children:"Install Casbin's latest release from LuaRocks:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo luarocks install casbin\n"})}),"\n",(0,i.jsx)(n.p,{children:"Install the kong-authz plugin:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo luarocks install https://raw.githubusercontent.com/casbin-lua/kong-authz/master/kong-authz-0.0.1-1.rockspec\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add the plugin to your ",(0,i.jsx)(n.code,{children:"kong.conf"})," file by appending ",(0,i.jsx)(n.code,{children:"kong-authz"})," (with a comma) to the ",(0,i.jsx)(n.code,{children:"plugins"})," variable:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:"# kong.conf\nplugins = bundled, kong-authz\n"})}),"\n",(0,i.jsx)(n.p,{children:"Finally, start or restart Kong:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kong start [-c /path/to/kong.conf]\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"You can add this plugin on top of any service/API or globally by sending a request through the Kong Admin API."}),"\n",(0,i.jsx)(n.h3,{id:"file-based-policy-storage",children:"File-Based Policy Storage"}),"\n",(0,i.jsx)(n.p,{children:"Add the plugin globally with file-based policy storage:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -i -X POST \\\n  --url http://localhost:8001/plugins/ \\\n  --data 'name=kong-authz' \\\n  --data 'config.model_path=/path/to/model_path.conf' \\\n  --data 'config.policy_path=/path/to/policy_path.csv' \\\n  --data 'config.username=user'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"database-policy-storage-with-luasql",children:"Database Policy Storage with LuaSQL"}),"\n",(0,i.jsx)(n.p,{children:"Add the plugin to a specific service with LuaSQL adapter:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -i -X POST \\\n  --url http://localhost:8001/services/example-service/plugins/ \\\n  --data 'name=kong-authz' \\\n  --data 'config.model_path=/mnt/kong/examples/authz_model.conf' \\\n  --data 'config.username=user' \\\n  --data 'config.adapter=luasql' \\\n  --data 'config.db_info.db_type=mysql' \\\n  --data 'config.db_info.database=casbin' \\\n  --data 'config.db_info.username=root' \\\n  --data 'config.db_info.password=********' \\\n  --data 'config.db_info.host=127.0.0.1' \\\n  --data 'config.db_info.port=3306'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"database-policy-storage-with-4daysorm",children:"Database Policy Storage with 4DaysORM"}),"\n",(0,i.jsx)(n.p,{children:"Add the plugin to a specific service with 4DaysORM adapter:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -i -X POST \\\n  --url http://localhost:8001/services/example-service/plugins/ \\\n  --data 'name=kong-authz' \\\n  --data 'config.model_path=/mnt/kong/examples/authz_model.conf' \\\n  --data 'config.username=user' \\\n  --data 'config.adapter=4daysorm' \\\n  --data 'config.db_info.db_type=mysql' \\\n  --data 'config.db_info.database=casbin' \\\n  --data 'config.db_info.username=root' \\\n  --data 'config.db_info.password=********' \\\n  --data 'config.db_info.host=127.0.0.1' \\\n  --data 'config.db_info.port=3306'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"how-authorization-works",children:"How Authorization Works"}),"\n",(0,i.jsxs)(n.p,{children:["The authorization determines a request based on ",(0,i.jsx)(n.code,{children:"{subject, object, action}"}),", which means what ",(0,i.jsx)(n.code,{children:"subject"})," can perform what ",(0,i.jsx)(n.code,{children:"action"})," on what ",(0,i.jsx)(n.code,{children:"object"}),". In this plugin:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"subject"}),": the logged-in username as passed in the header"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"object"}),': the URL path for the web resource like "dataset1/item1"']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"action"}),': HTTP method like GET, POST, PUT, DELETE, or high-level actions you defined like "read-file", "write-blog"']}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For details on writing authorization policies, refer to the ",(0,i.jsx)(n.a,{href:"/docs/how-it-works",children:"Casbin documentation"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,i.jsx)(n.p,{children:"Here's a complete example of setting up kong-authz for a service:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Set up an example service:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -i -X POST \\\n  --url http://localhost:8001/services/ \\\n  --data 'name=example-service' \\\n  --data 'url=http://mockbin.org'\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Set up a route for the service:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -i -X POST \\\n  --url http://localhost:8001/services/example-service/routes \\\n  --data 'hosts[]=example.com'\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Configure the kong-authz plugin:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -i -X POST \\\n  --url http://localhost:8001/services/example-service/plugins/ \\\n  --data 'name=kong-authz' \\\n  --data 'config.model_path=/path/to/authz_model.conf' \\\n  --data 'config.policy_path=/path/to/authz_policy.csv' \\\n  --data 'config.username=user'\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Test the authorization by sending a request:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -i -X GET \\\n  --url http://localhost:8000/ \\\n  --header 'Host: example.com' \\\n  --header 'user: anonymous'\n"})}),"\n",(0,i.jsx)(n.p,{children:"When run for the first time, it will create a Casbin Enforcer using the model and policy paths. If this returns any non-500 error, the configuration is successful. Otherwise, check the error.log file in your Kong setup."}),"\n",(0,i.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/casbin-lua/kong-authz",children:"kong-authz GitHub Repository"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/casbin/lua-casbin/",children:"Lua Casbin"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.konghq.com/",children:"Kong Documentation"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>t,x:()=>l});var s=a(6540);const i={},o=s.createContext(i);function t(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);