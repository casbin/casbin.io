"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[6764],{8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var i=s(6540);const l={},a=i.createContext(l);function r(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(a.Provider,{value:n},e.children)}},9200:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"k8s-gatekeeper","title":"Admission Webhook for K8s","description":"Kubernetes (K8s) RBAC & ABAC \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u0439\u043d\u0435 \u043f\u0440\u043e\u043c\u0456\u0436\u043d\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043d\u0435 \u0437\u0430\u0431\u0435\u0437\u043f\u0435\u0447\u0435\u043d\u043d\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0456 Casbin","source":"@site/i18n/uk/docusaurus-plugin-content-docs/current/K8sGateKeeper.mdx","sourceDirName":".","slug":"/k8s-gatekeeper","permalink":"/uk/docs/k8s-gatekeeper","draft":false,"unlisted":false,"editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sGateKeeper.mdx","tags":[],"version":"current","frontMatter":{"id":"k8s-gatekeeper","title":"Admission Webhook for K8s","description":"Kubernetes (K8s) RBAC & ABAC \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u0439\u043d\u0435 \u043f\u0440\u043e\u043c\u0456\u0436\u043d\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043d\u0435 \u0437\u0430\u0431\u0435\u0437\u043f\u0435\u0447\u0435\u043d\u043d\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0456 Casbin","keywords":["k8s-gatekeeper","Kubernetes","K8s"],"authors":["ComradeProgrammer"]},"sidebar":"docs","previous":{"title":"Authorization of Kubernetes","permalink":"/uk/docs/k8s"},"next":{"title":"Authorization of Service Mesh through Envoy","permalink":"/uk/docs/envoy"}}');var l=s(4848),a=s(8453);const r={id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Kubernetes (K8s) RBAC & ABAC \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u0439\u043d\u0435 \u043f\u0440\u043e\u043c\u0456\u0436\u043d\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043d\u0435 \u0437\u0430\u0431\u0435\u0437\u043f\u0435\u0447\u0435\u043d\u043d\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0456 Casbin",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},c=void 0,t={},o=[{value:"1. \u041e\u0433\u043b\u044f\u0434 \u0442\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0456\u044f \u0434\u043b\u044f Casbin K8s-Gatekeeper",id:"1-\u043e\u0433\u043b\u044f\u0434-\u0442\u0430-\u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0456\u044f-\u0434\u043b\u044f-casbin-k8s-gatekeeper",level:2},{value:"0.1 \u041f\u0440\u043e\u0441\u0442\u0438\u0439 \u043f\u0440\u0438\u043a\u043b\u0430\u0434",id:"01-\u043f\u0440\u043e\u0441\u0442\u0438\u0439-\u043f\u0440\u0438\u043a\u043b\u0430\u0434",level:3},{value:"1.1 \u042f\u043a \u043f\u0440\u0430\u0446\u044e\u0454 Casbin K8s-Gatekeeper?",id:"11-\u044f\u043a-\u043f\u0440\u0430\u0446\u044e\u0454-casbin-k8s-gatekeeper",level:3},{value:"1.2 \u041f\u0440\u0438\u043a\u043b\u0430\u0434, \u0449\u043e \u0456\u043b\u044e\u0441\u0442\u0440\u0443\u0454, \u044f\u043a \u0446\u0435 \u043f\u0440\u0430\u0446\u044e\u0454",id:"12-\u043f\u0440\u0438\u043a\u043b\u0430\u0434-\u0449\u043e-\u0456\u043b\u044e\u0441\u0442\u0440\u0443\u0454-\u044f\u043a-\u0446\u0435-\u043f\u0440\u0430\u0446\u044e\u0454",level:3},{value:"2 \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f K8s-gatekeeper",id:"2-\u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f-k8s-gatekeeper",level:2},{value:"2.1.1 \u041a\u0440\u043e\u043a 1: \u041f\u043e\u0431\u0443\u0434\u043e\u0432\u0430 \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f",id:"211-\u043a\u0440\u043e\u043a-1-\u043f\u043e\u0431\u0443\u0434\u043e\u0432\u0430-\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f",level:3},{value:"2.1.1 Step 1: Build the image",id:"211-step-1-build-the-image",level:4},{value:"2.1.2 \u041a\u0440\u043e\u043a 2: \u041d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0432\u0456\u0441\u0456\u0432 \u0442\u0430 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u044c \u0434\u043b\u044f K8s-gatekeeper",id:"212-\u043a\u0440\u043e\u043a-2-\u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f-\u0441\u0435\u0440\u0432\u0456\u0441\u0456\u0432-\u0442\u0430-\u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u044c-\u0434\u043b\u044f-k8s-gatekeeper",level:4},{value:"2.1.3 \u041a\u0440\u043e\u043a 3: \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f CRD \u0440\u0435\u0441\u0443\u0440\u0441\u0456\u0432 \u0434\u043b\u044f K8s-gatekeeper",id:"213-\u043a\u0440\u043e\u043a-3-\u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f-crd-\u0440\u0435\u0441\u0443\u0440\u0441\u0456\u0432-\u0434\u043b\u044f-k8s-gatekeeper",level:4},{value:"2.2 \u0417\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439 webhook",id:"22-\u0437\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439-webhook",level:3},{value:"2.3.1 \u041a\u0440\u043e\u043a 1: \u041f\u043e\u0431\u0443\u0434\u043e\u0432\u0430 \u043e\u0431\u0440\u0430\u0437\u0443",id:"231-\u043a\u0440\u043e\u043a-1-\u043f\u043e\u0431\u0443\u0434\u043e\u0432\u0430-\u043e\u0431\u0440\u0430\u0437\u0443",level:3},{value:"\u0411\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u0437\u0432\u0435\u0440\u043d\u0456\u0442\u044c\u0441\u044f \u0434\u043e \u0420\u043e\u0437\u0434\u0456\u043b\u0443 2.1.1.",id:"\u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430-\u0437\u0432\u0435\u0440\u043d\u0456\u0442\u044c\u0441\u044f-\u0434\u043e-\u0440\u043e\u0437\u0434\u0456\u043b\u0443-211",level:4},{value:"\u0412\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>helm install k8sgatekeeper ./k8sgatekeeper</code>.",id:"\u0432\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435-\u043a\u043e\u043c\u0430\u043d\u0434\u0443-helm-install-k8sgatekeeper-k8sgatekeeper",level:4},{value:"\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 K8s-gatekeeper 3.1 \u0421\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438 Casbin",id:"\u0441\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435-k8s-gatekeeper-31-\u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f-\u043c\u043e\u0434\u0435\u043b\u0456-\u0442\u0430-\u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438-casbin",level:2},{value:"\u0423 \u0432\u0430\u0441 \u0454 \u0434\u0432\u0430 \u0441\u043f\u043e\u0441\u043e\u0431\u0438 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438: \u0447\u0435\u0440\u0435\u0437 kubectl \u0430\u0431\u043e \u0447\u0435\u0440\u0435\u0437 go-\u043a\u043b\u0456\u0454\u043d\u0442, \u044f\u043a\u0438\u0439 \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e.",id:"\u0443-\u0432\u0430\u0441-\u0454-\u0434\u0432\u0430-\u0441\u043f\u043e\u0441\u043e\u0431\u0438-\u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f-\u043c\u043e\u0434\u0435\u043b\u0456-\u0442\u0430-\u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438-\u0447\u0435\u0440\u0435\u0437-kubectl-\u0430\u0431\u043e-\u0447\u0435\u0440\u0435\u0437-go-\u043a\u043b\u0456\u0454\u043d\u0442-\u044f\u043a\u0438\u0439-\u043c\u0438-\u043d\u0430\u0434\u0430\u0454\u043c\u043e",level:3},{value:"\u0423 K8s-gatekeeper \u043c\u043e\u0434\u0435\u043b\u044c Casbin \u0437\u0431\u0435\u0440\u0456\u0433\u0430\u0454\u0442\u044c\u0441\u044f \u0443 \u0440\u0435\u0441\u0443\u0440\u0441\u0456 CRD \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e &#39;CasbinModel&#39;.",id:"\u0443-k8s-gatekeeper-\u043c\u043e\u0434\u0435\u043b\u044c-casbin-\u0437\u0431\u0435\u0440\u0456\u0433\u0430\u0454\u0442\u044c\u0441\u044f-\u0443-\u0440\u0435\u0441\u0443\u0440\u0441\u0456-crd-\u043f\u0456\u0434-\u043d\u0430\u0437\u0432\u043e\u044e-casbinmodel",level:4},{value:"\u041c\u0438 \u0440\u043e\u0437\u0443\u043c\u0456\u0454\u043c\u043e, \u0449\u043e \u043c\u043e\u0436\u0443\u0442\u044c \u0431\u0443\u0442\u0438 \u0441\u0438\u0442\u0443\u0430\u0446\u0456\u0457, \u043a\u043e\u043b\u0438 \u043d\u0435 \u0437\u0440\u0443\u0447\u043d\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u043e\u0431\u043e\u043b\u043e\u043d\u043a\u0443 \u0434\u043b\u044f \u0432\u0438\u043a\u043e\u043d\u0430\u043d\u043d\u044f \u043a\u043e\u043c\u0430\u043d\u0434 \u0431\u0435\u0437\u043f\u043e\u0441\u0435\u0440\u0435\u0434\u043d\u044c\u043e \u043d\u0430 \u0432\u0443\u0437\u043b\u0456 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430 K8s, \u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u043a\u043e\u043b\u0438 \u0432\u0438 \u0431\u0443\u0434\u0443\u0454\u0442\u0435 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0443 \u0445\u043c\u0430\u0440\u043d\u0443 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0443 \u0434\u043b\u044f \u0432\u0430\u0448\u043e\u0457 \u043a\u043e\u0440\u043f\u043e\u0440\u0430\u0446\u0456\u0457.",id:"\u043c\u0438-\u0440\u043e\u0437\u0443\u043c\u0456\u0454\u043c\u043e-\u0449\u043e-\u043c\u043e\u0436\u0443\u0442\u044c-\u0431\u0443\u0442\u0438-\u0441\u0438\u0442\u0443\u0430\u0446\u0456\u0457-\u043a\u043e\u043b\u0438-\u043d\u0435-\u0437\u0440\u0443\u0447\u043d\u043e-\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438-\u043e\u0431\u043e\u043b\u043e\u043d\u043a\u0443-\u0434\u043b\u044f-\u0432\u0438\u043a\u043e\u043d\u0430\u043d\u043d\u044f-\u043a\u043e\u043c\u0430\u043d\u0434-\u0431\u0435\u0437\u043f\u043e\u0441\u0435\u0440\u0435\u0434\u043d\u044c\u043e-\u043d\u0430-\u0432\u0443\u0437\u043b\u0456-\u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430-k8s-\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434-\u043a\u043e\u043b\u0438-\u0432\u0438-\u0431\u0443\u0434\u0443\u0454\u0442\u0435-\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0443-\u0445\u043c\u0430\u0440\u043d\u0443-\u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0443-\u0434\u043b\u044f-\u0432\u0430\u0448\u043e\u0457-\u043a\u043e\u0440\u043f\u043e\u0440\u0430\u0446\u0456\u0457",level:4},{value:"3.1.2 Try Whether K8s-gatekeeper Works",id:"312-try-whether-k8s-gatekeeper-works",level:3},{value:"4. How to Write Model and Policy with K8s-gatekeeper",id:"4-how-to-write-model-and-policy-with-k8s-gatekeeper",level:2},{value:"4.1 Request Definition of Model",id:"41-request-definition-of-model",level:3},{value:"4.2 Matchers of Model",id:"42-matchers-of-model",level:3},{value:"4.2.1 Extension functions",id:"421-extension-functions",level:3},{value:"4.2.1.1 access",id:"4211-access",level:4},{value:"4.2.1.2 accessWithWildcard",id:"4212-accesswithwildcard",level:4},{value:"4.2.1.3 Functions Supporting Variable-length Arguments",id:"4213-functions-supporting-variable-length-arguments",level:3},{value:"4.2.1.2 \u0424\u0443\u043d\u043a\u0446\u0456\u0457 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0456\u0457 \u0442\u0438\u043f\u0456\u0432",id:"4212-\u0444\u0443\u043d\u043a\u0446\u0456\u0457-\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0456\u0457-\u0442\u0438\u043f\u0456\u0432",level:4},{value:"5. \u0420\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456 \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f",id:"5-\u0440\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456-\u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f",level:2},{value:"5.1 \u041f\u0440\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438",id:"51-\u043f\u0440\u043e-\u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438",level:3},{value:"5.1.1 \u0421\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u0456 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438",id:"511-\u0441\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u0456-\u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438",level:4},{value:"\u042f\u043a\u0449\u043e \u0432\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435 helm, \u043f\u043e\u0434\u0456\u0431\u043d\u0456 \u0437\u043c\u0456\u043d\u0438 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u0442\u0438 \u0434\u043e helm charts.",id:"\u044f\u043a\u0449\u043e-\u0432\u0438-\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435-helm-\u043f\u043e\u0434\u0456\u0431\u043d\u0456-\u0437\u043c\u0456\u043d\u0438-\u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e-\u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u0442\u0438-\u0434\u043e-helm-charts",level:4}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"1-\u043e\u0433\u043b\u044f\u0434-\u0442\u0430-\u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0456\u044f-\u0434\u043b\u044f-casbin-k8s-gatekeeper",children:"1. \u041e\u0433\u043b\u044f\u0434 \u0442\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0456\u044f \u0434\u043b\u044f Casbin K8s-Gatekeeper"}),"\n",(0,l.jsx)(n.p,{children:"Casbin K8s-GateKeeper - \u0446\u0435 \u0432\u0435\u0431\u0445\u0443\u043a \u0434\u043b\u044f \u043f\u0440\u0438\u0439\u043e\u043c\u0443 \u0432 Kubernetes, \u044f\u043a\u0438\u0439 \u0456\u043d\u0442\u0435\u0433\u0440\u0443\u0454 Casbin \u044f\u043a \u0456\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u0443. \u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 Casbin K8s-GateKeeper, \u0432\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u0441\u0442\u0432\u043e\u0440\u044e\u0432\u0430\u0442\u0438 \u0433\u043d\u0443\u0447\u043a\u0456 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u0457 \u0430\u0431\u043e \u043f\u0435\u0440\u0435\u0445\u043e\u043f\u043b\u0435\u043d\u043d\u044f \u0431\u0443\u0434\u044c-\u044f\u043a\u043e\u0457 \u043e\u043f\u0435\u0440\u0430\u0446\u0456\u0457 \u0437 \u0440\u0435\u0441\u0443\u0440\u0441\u0430\u043c\u0438 K8s, \u041d\u0415 \u043f\u0438\u0448\u0443\u0447\u0438 \u0436\u043e\u0434\u043d\u043e\u0433\u043e \u0440\u044f\u0434\u043a\u0430 \u043a\u043e\u0434\u0443, \u0430 \u043b\u0438\u0448\u0435 \u043a\u0456\u043b\u044c\u043a\u0430 \u0440\u044f\u0434\u043a\u0456\u0432 \u0434\u0435\u043a\u043b\u0430\u0440\u0430\u0442\u0438\u0432\u043d\u0438\u0445 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439 \u043c\u043e\u0434\u0435\u043b\u0435\u0439 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a Casbin, \u044f\u043a\u0456 \u0454 \u0447\u0430\u0441\u0442\u0438\u043d\u043e\u044e \u043c\u043e\u0432\u0438 ACL (\u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u0443) Casbin."}),"\n",(0,l.jsxs)(n.p,{children:["Casbin K8s-GateKeeper \u0440\u043e\u0437\u0440\u043e\u0431\u043b\u0435\u043d\u0438\u0439 \u0442\u0430 \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u0443\u0454\u0442\u044c\u0441\u044f \u0441\u043f\u0456\u043b\u044c\u043d\u043e\u0442\u043e\u044e Casbin. \u0420\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0456\u0439 \u0446\u044c\u043e\u0433\u043e \u043f\u0440\u043e\u0435\u043a\u0442\u0443 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0438\u0439 \u0442\u0443\u0442: ",(0,l.jsx)(n.a,{href:"https://github.com/casbin/k8s-gatekeeper",children:"https://github.com/casbin/k8s-gatekeeper"})]}),"\n",(0,l.jsx)(n.h3,{id:"01-\u043f\u0440\u043e\u0441\u0442\u0438\u0439-\u043f\u0440\u0438\u043a\u043b\u0430\u0434",children:"0.1 \u041f\u0440\u043e\u0441\u0442\u0438\u0439 \u043f\u0440\u0438\u043a\u043b\u0430\u0434"}),"\n",(0,l.jsx)(n.p,{children:'\u041d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u0432\u0430\u043c \u043d\u0435 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u043f\u0438\u0441\u0430\u0442\u0438 \u0436\u043e\u0434\u043d\u043e\u0433\u043e \u043a\u043e\u0434\u0443, \u0430 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u0440\u044f\u0434\u043a\u0438 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0457 \u0434\u043b\u044f \u0434\u043e\u0441\u044f\u0433\u043d\u0435\u043d\u043d\u044f \u0446\u0456\u0454\u0457 \u0444\u0443\u043d\u043a\u0446\u0456\u0457: "\u0417\u0430\u0431\u043e\u0440\u043e\u043d\u0438\u0442\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u044c \u0437 \u0434\u0435\u044f\u043a\u0438\u043c\u0438 \u0432\u043a\u0430\u0437\u0430\u043d\u0438\u043c\u0438 \u0442\u0435\u0433\u0430\u043c\u0438 \u0432 \u0431\u0443\u0434\u044c-\u044f\u043a\u0438\u0445 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u043d\u044f\u0445":'}),"\n",(0,l.jsx)(n.p,{children:"Model:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\ncontain(split(accessWithWildcard(${OBJECT}.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n'})}),"\n",(0,l.jsx)(n.p,{children:"And Policy:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-csv",children:'p, "1.14.1",deny\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u0426\u0435 \u0437\u0432\u0438\u0447\u0430\u0439\u043d\u0430 \u043c\u043e\u0432\u0430 ACL Casbin. \u041f\u0440\u0438\u043f\u0443\u0441\u0442\u0438\u043c\u043e, \u0432\u0438 \u0432\u0436\u0435 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043b\u0438 \u0440\u043e\u0437\u0434\u0456\u043b\u0438 \u043f\u0440\u043e \u043d\u0438\u0445, \u0442\u043e\u0434\u0456 \u0431\u0443\u0434\u0435 \u0434\u0443\u0436\u0435 \u043b\u0435\u0433\u043a\u043e \u0437\u0440\u043e\u0437\u0443\u043c\u0456\u0442\u0438."}),"\n",(0,l.jsx)(n.p,{children:"Casbin K8s-Gatekeeper \u043c\u0430\u0454 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u043f\u0435\u0440\u0435\u0432\u0430\u0433\u0438:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u041b\u0435\u0433\u043a\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438. \u041d\u0430\u043f\u0438\u0441\u0430\u043d\u043d\u044f \u043a\u0456\u043b\u044c\u043a\u043e\u0445 \u0440\u044f\u0434\u043a\u0456\u0432 ACL \u043d\u0430\u0431\u0430\u0433\u0430\u0442\u043e \u043a\u0440\u0430\u0449\u0435, \u043d\u0456\u0436 \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u043d\u044f \u0431\u0430\u0433\u0430\u0442\u044c\u043e\u0445 \u0440\u044f\u0434\u043a\u0456\u0432 \u043a\u043e\u0434\u0443."}),"\n",(0,l.jsx)(n.li,{children:"\u0414\u043e\u0437\u0432\u043e\u043b\u044f\u0454 \u0433\u0430\u0440\u044f\u0447\u0435 \u043e\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439. \u0412\u0430\u043c \u043d\u0435 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0432\u0438\u043c\u0438\u043a\u0430\u0442\u0438 \u0432\u0435\u0441\u044c \u043f\u043b\u0430\u0433\u0456\u043d, \u0449\u043e\u0431 \u0437\u043c\u0456\u043d\u0438\u0442\u0438 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0457."}),"\n",(0,l.jsxs)(n.li,{children:["\u0426\u0435 \u0433\u043d\u0443\u0447\u043a\u043e. \u041c\u043e\u0436\u043d\u0430 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0434\u043e\u0432\u0456\u043b\u044c\u043d\u0456 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u043d\u0430 \u0431\u0443\u0434\u044c-\u044f\u043a\u0438\u0439 \u0440\u0435\u0441\u0443\u0440\u0441 K8s, \u044f\u043a\u0438\u0439 \u043c\u043e\u0436\u043d\u0430 \u0434\u043e\u0441\u043b\u0456\u0434\u0438\u0442\u0438 \u0437\u0430 \u0434\u043e\u043f\u043e\u043c\u043e\u0433\u043e\u044e ",(0,l.jsx)(n.code,{children:"kubectl gatekeeper"}),"."]}),"\n",(0,l.jsx)(n.li,{children:"\u0426\u0435 \u0441\u043f\u0440\u043e\u0449\u0443\u0454 \u0440\u0435\u0430\u043b\u0456\u0437\u0430\u0446\u0456\u044e \u0432\u0435\u0431\u0445\u0443\u043a\u0430 \u043f\u0440\u0438\u0439\u043e\u043c\u0443 K8s, \u044f\u043a\u0438\u0439 \u0454 \u0434\u0443\u0436\u0435 \u0441\u043a\u043b\u0430\u0434\u043d\u0438\u043c. \u0412\u0430\u043c \u043d\u0435 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0437\u043d\u0430\u0442\u0438, \u0449\u043e \u0442\u0430\u043a\u0435 \u0432\u0435\u0431\u0445\u0443\u043a \u043f\u0440\u0438\u0439\u043e\u043c\u0443 K8s \u0430\u0431\u043e \u044f\u043a \u043f\u0438\u0441\u0430\u0442\u0438 \u043a\u043e\u0434 \u0434\u043b\u044f \u043d\u044c\u043e\u0433\u043e. \u0412\u0441\u0435, \u0449\u043e \u0432\u0430\u043c \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0437\u0440\u043e\u0431\u0438\u0442\u0438, \u0446\u0435 \u0437\u043d\u0430\u0442\u0438 \u0440\u0435\u0441\u0443\u0440\u0441, \u043d\u0430 \u044f\u043a\u043e\u043c\u0443 \u0432\u0438 \u0445\u043e\u0447\u0435\u0442\u0435 \u0432\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0438 \u043e\u0431\u043c\u0435\u0436\u0435\u043d\u043d\u044f, \u0430 \u043f\u043e\u0442\u0456\u043c \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u0438 Casbin ACL. \u0412\u0441\u0456 \u0437\u043d\u0430\u044e\u0442\u044c, \u0449\u043e K8s \u0441\u043a\u043b\u0430\u0434\u043d\u0438\u0439, \u0430\u043b\u0435 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 Casbin K8s-Gatekeeper, \u0432\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u0437\u0430\u043e\u0449\u0430\u0434\u0438\u0442\u0438 \u0447\u0430\u0441."}),"\n",(0,l.jsx)(n.li,{children:"\u0426\u0435 \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u0443\u0454\u0442\u044c\u0441\u044f \u0441\u043f\u0456\u043b\u044c\u043d\u043e\u0442\u043e\u044e Casbin. \u041d\u0435 \u0441\u043e\u0440\u043e\u043c\u0442\u0435\u0441\u044f \u0437\u0432\u0435\u0440\u0442\u0430\u0442\u0438\u0441\u044f \u0434\u043e \u043d\u0430\u0441, \u044f\u043a\u0449\u043e \u0449\u043e\u0441\u044c \u0443 \u0446\u044c\u043e\u043c\u0443 \u043f\u043b\u0430\u0433\u0456\u043d\u0456 \u0432\u0430\u0441 \u0431\u0435\u043d\u0442\u0435\u0436\u0438\u0442\u044c \u0430\u0431\u043e \u044f\u043a\u0449\u043e \u0432\u0438 \u0437\u0456\u0442\u043a\u043d\u0443\u043b\u0438\u0441\u044f \u0437 \u0431\u0443\u0434\u044c-\u044f\u043a\u0438\u043c\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430\u043c\u0438 \u043f\u0456\u0434 \u0447\u0430\u0441 \u0441\u043f\u0440\u043e\u0431\u0438 \u0446\u044c\u043e\u0433\u043e."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"11-\u044f\u043a-\u043f\u0440\u0430\u0446\u044e\u0454-casbin-k8s-gatekeeper",children:"1.1 \u042f\u043a \u043f\u0440\u0430\u0446\u044e\u0454 Casbin K8s-Gatekeeper?"}),"\n",(0,l.jsxs)(n.p,{children:["K8s-Gatekeeper - \u0446\u0435 \u0432\u0435\u0431\u0445\u0443\u043a \u0434\u043b\u044f \u043f\u0440\u0438\u0439\u043e\u043c\u0443 \u0432 K8s, \u044f\u043a\u0438\u0439 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454 ",(0,l.jsx)(n.a,{href:"/docs/overview",children:"Casbin"})," \u0434\u043b\u044f \u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u043d\u043d\u044f \u0434\u043e\u0432\u0456\u043b\u044c\u043d\u0438\u0445 \u043f\u0440\u0430\u0432\u0438\u043b \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u0443, \u0432\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0445 \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0435\u043c, \u0449\u043e\u0431 \u0434\u043e\u043f\u043e\u043c\u043e\u0433\u0442\u0438 \u0437\u0430\u043f\u043e\u0431\u0456\u0433\u0442\u0438 \u0431\u0443\u0434\u044c-\u044f\u043a\u0456\u0439 \u043e\u043f\u0435\u0440\u0430\u0446\u0456\u0457 \u0432 K8s, \u044f\u043a\u0443 \u0430\u0434\u043c\u0456\u043d\u0456\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \u043d\u0435 \u0445\u043e\u0447\u0435."]}),"\n",(0,l.jsxs)(n.p,{children:["Casbin - \u0446\u0435 \u043f\u043e\u0442\u0443\u0436\u043d\u0430 \u0442\u0430 \u0435\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u0430 \u0431\u0456\u0431\u043b\u0456\u043e\u0442\u0435\u043a\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u0443 \u0437 \u0432\u0456\u0434\u043a\u0440\u0438\u0442\u0438\u043c \u0432\u0438\u0445\u0456\u0434\u043d\u0438\u043c \u043a\u043e\u0434\u043e\u043c. \u0412\u043e\u043d\u0430 \u043d\u0430\u0434\u0430\u0454 \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u043a\u0443 \u0434\u043b\u044f \u0437\u0430\u0431\u0435\u0437\u043f\u0435\u0447\u0435\u043d\u043d\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u0457 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0456 \u0440\u0456\u0437\u043d\u0438\u0445 \u043c\u043e\u0434\u0435\u043b\u0435\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u0443. \u0414\u043b\u044f \u043e\u0442\u0440\u0438\u043c\u0430\u043d\u043d\u044f \u0434\u043e\u0434\u0430\u0442\u043a\u043e\u0432\u043e\u0457 \u0456\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0456\u0457 \u043f\u0440\u043e Casbin, \u0434\u0438\u0432\u0456\u0442\u044c\u0441\u044f ",(0,l.jsx)(n.a,{href:"/docs/overview",children:"\u041e\u0433\u043b\u044f\u0434"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["\u0412\u0435\u0431\u0445\u0443\u043a\u0438 \u043f\u0440\u0438\u0439\u043e\u043c\u0443 \u0432 K8s - \u0446\u0435 HTTP-\u0437\u0432\u043e\u0440\u043e\u0442\u043d\u0456 \u0432\u0438\u043a\u043b\u0438\u043a\u0438, \u044f\u043a\u0456 \u043e\u0442\u0440\u0438\u043c\u0443\u044e\u0442\u044c '\u0437\u0430\u043f\u0438\u0442\u0438 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c' \u0456 \u0440\u043e\u0431\u043b\u044f\u0442\u044c \u0437 \u043d\u0438\u043c\u0438 \u0449\u043e\u0441\u044c. \u0417\u043e\u043a\u0440\u0435\u043c\u0430, K8s-Gatekeeper - \u0446\u0435 \u0441\u043f\u0435\u0446\u0456\u0430\u043b\u044c\u043d\u0438\u0439 \u0442\u0438\u043f \u0432\u0435\u0431\u0445\u0443\u043a\u0430 \u043f\u0440\u0438\u0439\u043e\u043c\u0443: 'ValidatingAdmissionWebhook', \u044f\u043a\u0438\u0439 \u043c\u043e\u0436\u0435 \u0432\u0438\u0440\u0456\u0448\u0438\u0442\u0438, \u0447\u0438 \u043f\u0440\u0438\u0439\u043c\u0430\u0442\u0438 \u0446\u0435\u0439 \u0437\u0430\u043f\u0438\u0442 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c, \u0447\u0438 \u043d\u0456. \u0429\u043e \u0441\u0442\u043e\u0441\u0443\u0454\u0442\u044c\u0441\u044f \u0437\u0430\u043f\u0438\u0442\u0456\u0432 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c, \u0442\u043e \u0446\u0435 HTTP-\u0437\u0430\u043f\u0438\u0442\u0438, \u044f\u043a\u0456 \u043e\u043f\u0438\u0441\u0443\u044e\u0442\u044c \u043e\u043f\u0435\u0440\u0430\u0446\u0456\u044e \u043d\u0430\u0434 \u0432\u043a\u0430\u0437\u0430\u043d\u0438\u043c\u0438 \u0440\u0435\u0441\u0443\u0440\u0441\u0430\u043c\u0438 K8s (\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f/\u0432\u0438\u0434\u0430\u043b\u0435\u043d\u043d\u044f \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u043d\u044f). \u0414\u043b\u044f \u043e\u0442\u0440\u0438\u043c\u0430\u043d\u043d\u044f \u0434\u043e\u0434\u0430\u0442\u043a\u043e\u0432\u043e\u0457 \u0456\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0456\u0457 \u043f\u0440\u043e \u0432\u0435\u0431\u0445\u0443\u043a\u0438 \u043f\u0440\u0438\u0439\u043e\u043c\u0443, \u0434\u0438\u0432\u0456\u0442\u044c\u0441\u044f ",(0,l.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks",children:"\u043e\u0444\u0456\u0446\u0456\u0439\u043d\u0443 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0456\u044e K8s"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"12-\u043f\u0440\u0438\u043a\u043b\u0430\u0434-\u0449\u043e-\u0456\u043b\u044e\u0441\u0442\u0440\u0443\u0454-\u044f\u043a-\u0446\u0435-\u043f\u0440\u0430\u0446\u044e\u0454",children:"1.2 \u041f\u0440\u0438\u043a\u043b\u0430\u0434, \u0449\u043e \u0456\u043b\u044e\u0441\u0442\u0440\u0443\u0454, \u044f\u043a \u0446\u0435 \u043f\u0440\u0430\u0446\u044e\u0454"}),"\n",(0,l.jsx)(n.p,{children:"\u041d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u043a\u043e\u043b\u0438 \u0445\u0442\u043e\u0441\u044c \u0445\u043e\u0447\u0435 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u043d\u044f, \u0449\u043e \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u043f\u043e\u0434 \u0437 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u0438\u043c nginx (\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 kubectl \u0430\u0431\u043e \u043a\u043b\u0456\u0454\u043d\u0442\u0438 K8s), K8s \u0437\u0433\u0435\u043d\u0435\u0440\u0443\u0454 \u0437\u0430\u043f\u0438\u0442 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c, \u044f\u043a\u0438\u0439 (\u044f\u043a\u0449\u043e \u043f\u0435\u0440\u0435\u043a\u043b\u0430\u0441\u0442\u0438 \u0443 \u0444\u043e\u0440\u043c\u0430\u0442 YAML) \u043c\u043e\u0436\u0435 \u0431\u0443\u0442\u0438 \u0442\u0430\u043a\u0438\u043c:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.14.1\n        ports:\n        - containerPort: 80\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u0426\u0435\u0439 \u0437\u0430\u043f\u0438\u0442 \u043f\u0440\u043e\u0439\u0434\u0435 \u0447\u0435\u0440\u0435\u0437 \u043f\u0440\u043e\u0446\u0435\u0441 \u0432\u0441\u044c\u043e\u0433\u043e \u043f\u0440\u043e\u043c\u0456\u0436\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043d\u043e\u0433\u043e \u0437\u0430\u0431\u0435\u0437\u043f\u0435\u0447\u0435\u043d\u043d\u044f, \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u043e\u0433\u043e \u043d\u0430 \u043c\u0430\u043b\u044e\u043d\u043a\u0443, \u0432\u043a\u043b\u044e\u0447\u0430\u044e\u0447\u0438 \u043d\u0430\u0448 K8s-Gatekeeper. K8s-Gatekeeper \u043c\u043e\u0436\u0435 \u0432\u0438\u044f\u0432\u0438\u0442\u0438 \u0432\u0441\u0456 Casbin \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0456 \u043f\u0440\u0438\u0441\u0442\u0440\u043e\u0457, \u0437\u0431\u0435\u0440\u0435\u0436\u0435\u043d\u0456 \u0432 etcd K8s, \u044f\u043a\u0456 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0456 \u0442\u0430 \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u0443\u044e\u0442\u044c\u0441\u044f \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0435\u043c (\u0447\u0435\u0440\u0435\u0437 ",(0,l.jsx)(n.code,{children:"kubectl"})," \u0430\u0431\u043e Go \u043a\u043b\u0456\u0454\u043d\u0442, \u044f\u043a\u0438\u0439 \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e). \u041a\u043e\u0436\u0435\u043d \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u0439 \u043f\u0440\u0438\u0441\u0442\u0440\u0456\u0439 \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u043c\u043e\u0434\u0435\u043b\u044c Casbin \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0443 Casbin. \u0417\u0430\u043f\u0438\u0442 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c \u0431\u0443\u0434\u0435 \u043e\u0431\u0440\u043e\u0431\u043b\u0435\u043d\u0438\u0439 \u043a\u043e\u0436\u043d\u0438\u043c \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u043c \u043f\u0440\u0438\u0441\u0442\u0440\u043e\u0454\u043c, \u043f\u043e \u0447\u0435\u0440\u0437\u0456, \u0456 \u043b\u0438\u0448\u0435 \u043f\u0440\u043e\u0439\u0448\u043e\u0432\u0448\u0438 \u0432\u0441\u0456 \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0456 \u043f\u0440\u0438\u0441\u0442\u0440\u043e\u0457, \u0437\u0430\u043f\u0438\u0442 \u043c\u043e\u0436\u0435 \u0431\u0443\u0442\u0438 \u043f\u0440\u0438\u0439\u043d\u044f\u0442\u0438\u0439 \u0446\u0438\u043c K8s-Gatekeeper."]}),"\n",(0,l.jsxs)(n.p,{children:["(\u042f\u043a\u0449\u043e \u0432\u0438 \u043d\u0435 \u0440\u043e\u0437\u0443\u043c\u0456\u0454\u0442\u0435, \u0449\u043e \u0442\u0430\u043a\u0435 \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u0439 \u043f\u0440\u0438\u0441\u0442\u0440\u0456\u0439 Casbin, \u043c\u043e\u0434\u0435\u043b\u044c \u0430\u0431\u043e \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0430, \u0434\u0438\u0432\u0456\u0442\u044c\u0441\u044f \u0446\u0435\u0439 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442: ",(0,l.jsx)(n.a,{href:"/docs/get-started",children:"\u041f\u043e\u0447\u0430\u0442\u043e\u043a \u0440\u043e\u0431\u043e\u0442\u0438"}),")."]}),"\n",(0,l.jsx)(n.p,{children:"\u041d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u0437 \u044f\u043a\u043e\u0457\u0441\u044c \u043f\u0440\u0438\u0447\u0438\u043d\u0438 \u0430\u0434\u043c\u0456\u043d\u0456\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \u0445\u043e\u0447\u0435 \u0437\u0430\u0431\u043e\u0440\u043e\u043d\u0438\u0442\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f 'nginx:1.14.1', \u0434\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0447\u0438 \u043f\u0440\u0438 \u0446\u044c\u043e\u043c\u0443 'nginx:1.3.1'. \u041c\u043e\u0436\u043d\u0430 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u0439 \u043f\u0440\u0438\u0441\u0442\u0440\u0456\u0439, \u0449\u043e \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0443 (\u041c\u0438 \u043f\u043e\u044f\u0441\u043d\u0438\u043c\u043e, \u044f\u043a \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u0439 \u043f\u0440\u0438\u0441\u0442\u0440\u0456\u0439, \u0449\u043e \u0442\u0430\u043a\u0435 \u0446\u0456 \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438, \u0456 \u044f\u043a \u0457\u0445 \u043f\u0438\u0441\u0430\u0442\u0438 \u0432 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0438\u0445 \u0440\u043e\u0437\u0434\u0456\u043b\u0430\u0445)."}),"\n",(0,l.jsx)(n.p,{children:"Model:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n\n'})}),"\n",(0,l.jsx)(n.p,{children:"Policy:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-csv",children:'p, "nginx:1.13.1",allow\np, "nginx:1.14.1",deny\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u0421\u0442\u0432\u043e\u0440\u0438\u0432\u0448\u0438 \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u0439 \u043f\u0440\u0438\u0441\u0442\u0440\u0456\u0439, \u0449\u043e \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u0432\u0438\u0449\u0435\u0437\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0443 \u043c\u043e\u0434\u0435\u043b\u044c \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0443, \u043f\u043e\u043f\u0435\u0440\u0435\u0434\u043d\u0456\u0439 \u0437\u0430\u043f\u0438\u0442 \u043d\u0430 \u043f\u0440\u0438\u0439\u043e\u043c \u0431\u0443\u0434\u0435 \u0432\u0456\u0434\u0445\u0438\u043b\u0435\u043d\u0438\u0439 \u0446\u0438\u043c \u043f\u0440\u0438\u043c\u0443\u0441\u043e\u0432\u0438\u043c \u043f\u0440\u0438\u0441\u0442\u0440\u043e\u0454\u043c, \u0449\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0454, \u0449\u043e K8s \u043d\u0435 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u044c \u0446\u0435 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u043d\u044f."}),"\n",(0,l.jsx)(n.h2,{id:"2-\u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f-k8s-gatekeeper",children:"2 \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f K8s-gatekeeper"}),"\n",(0,l.jsx)(n.p,{children:"\u0406\u0441\u043d\u0443\u0454 \u0442\u0440\u0438 \u043c\u0435\u0442\u043e\u0434\u0438 \u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f K8s-gatekeeper: \u0437\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439 \u0432\u0435\u0431\u0445\u0443\u043a, \u0432\u043d\u0443\u0442\u0440\u0456\u0448\u043d\u0456\u0439 \u0432\u0435\u0431\u0445\u0443\u043a \u0442\u0430 Helm."}),"\n",(0,l.jsx)(n.admonition,{type:"note",children:(0,l.jsxs)(n.p,{children:["\u041f\u0440\u0438\u043c\u0456\u0442\u043a\u0430: \u0426\u0456 \u043c\u0435\u0442\u043e\u0434\u0438 \u043f\u0440\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u0456 \u043b\u0438\u0448\u0435 \u0434\u043b\u044f \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0456\u0432, \u044f\u043a\u0456 \u0445\u043e\u0447\u0443\u0442\u044c \u0441\u043f\u0440\u043e\u0431\u0443\u0432\u0430\u0442\u0438 K8s-gatekeeper, \u0456 \u043d\u0435 \u0454 \u0431\u0435\u0437\u043f\u0435\u0447\u043d\u0438\u043c\u0438. \u042f\u043a\u0449\u043e \u0432\u0438 \u0445\u043e\u0447\u0435\u0442\u0435 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0439\u043e\u0433\u043e \u0432 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0438\u0432\u043d\u043e\u043c\u0443 \u0441\u0435\u0440\u0435\u0434\u043e\u0432\u0438\u0449\u0456, \u0431\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u043f\u0435\u0440\u0435\u043a\u043e\u043d\u0430\u0439\u0442\u0435\u0441\u044f, \u0449\u043e \u0432\u0438 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043b\u0438 ",(0,l.jsx)(n.a,{href:"#5-advanced-settings",children:"\u0420\u043e\u0437\u0434\u0456\u043b 5. \u0420\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456 \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f"})," \u0456 \u0437\u0440\u043e\u0431\u0438\u043b\u0438 \u043d\u0435\u043e\u0431\u0445\u0456\u0434\u043d\u0456 \u0437\u043c\u0456\u043d\u0438 \u043f\u0435\u0440\u0435\u0434 \u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f\u043c. 2.1 \u0412\u043d\u0443\u0442\u0440\u0456\u0448\u043d\u0456\u0439 \u0432\u0435\u0431\u0445\u0443\u043a"]})}),"\n",(0,l.jsx)(n.h3,{id:"211-\u043a\u0440\u043e\u043a-1-\u043f\u043e\u0431\u0443\u0434\u043e\u0432\u0430-\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f",children:"2.1.1 \u041a\u0440\u043e\u043a 1: \u041f\u043e\u0431\u0443\u0434\u043e\u0432\u0430 \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f"}),"\n",(0,l.jsx)(n.h4,{id:"211-step-1-build-the-image",children:"2.1.1 Step 1: Build the image"}),"\n",(0,l.jsx)(n.p,{children:"\u0414\u043b\u044f \u0432\u043d\u0443\u0442\u0440\u0456\u0448\u043d\u044c\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u0443 webhook \u0441\u0430\u043c webhook \u0431\u0443\u0434\u0435 \u0440\u0435\u0430\u043b\u0456\u0437\u043e\u0432\u0430\u043d\u0438\u0439 \u044f\u043a \u0441\u0435\u0440\u0432\u0456\u0441 \u0443 Kubernetes. \u0429\u043e\u0431 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u043d\u0435\u043e\u0431\u0445\u0456\u0434\u043d\u0438\u0439 \u0441\u0435\u0440\u0432\u0456\u0441 \u0442\u0430 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u043d\u044f, \u0432\u0430\u043c \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u043f\u043e\u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u043e\u0431\u0440\u0430\u0437 K8s-gatekeeper. \u0412\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0432\u043b\u0430\u0441\u043d\u0438\u0439 \u043e\u0431\u0440\u0430\u0437, \u0432\u0438\u043a\u043e\u043d\u0430\u0432\u0448\u0438 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0443 \u043a\u043e\u043c\u0430\u043d\u0434\u0443:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker build --target webhook -t k8s-gatekeeper .\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u0426\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0438\u0439 \u043e\u0431\u0440\u0430\u0437 \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e 'k8s-gatekeeper",":latest","'."]}),"\n",(0,l.jsx)(n.admonition,{type:"note",children:(0,l.jsxs)(n.p,{children:["\u041f\u0440\u0438\u043c\u0456\u0442\u043a\u0430: \u042f\u043a\u0449\u043e \u0432\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435 minikube, \u0431\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u0432\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 ",(0,l.jsx)(n.code,{children:"eval $(minikube -p minikube docker-env)"})," \u043f\u0435\u0440\u0435\u0434 \u0437\u0430\u043f\u0443\u0441\u043a\u043e\u043c 'docker build'."]})}),"\n",(0,l.jsx)(n.h4,{id:"212-\u043a\u0440\u043e\u043a-2-\u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f-\u0441\u0435\u0440\u0432\u0456\u0441\u0456\u0432-\u0442\u0430-\u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u044c-\u0434\u043b\u044f-k8s-gatekeeper",children:"2.1.2 \u041a\u0440\u043e\u043a 2: \u041d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0432\u0456\u0441\u0456\u0432 \u0442\u0430 \u0440\u043e\u0437\u0433\u043e\u0440\u0442\u0430\u043d\u044c \u0434\u043b\u044f K8s-gatekeeper"}),"\n",(0,l.jsx)(n.p,{children:"\u0412\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u043a\u043e\u043c\u0430\u043d\u0434\u0438:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f config/rbac.yaml\nkubectl apply -f config/webhook_deployment.yaml \nkubectl apply -f config/webhook_internal.yaml \n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u0426\u0435 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c K8s-gatekeeper, \u0456 \u0432\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u0435\u0440\u0435\u0432\u0456\u0440\u0438\u0442\u0438 \u0446\u0435, \u0432\u0438\u043a\u043e\u043d\u0430\u0432\u0448\u0438 ",(0,l.jsx)(n.code,{children:"kubectl get pods"}),"."]}),"\n",(0,l.jsx)(n.h4,{id:"213-\u043a\u0440\u043e\u043a-3-\u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f-crd-\u0440\u0435\u0441\u0443\u0440\u0441\u0456\u0432-\u0434\u043b\u044f-k8s-gatekeeper",children:"2.1.3 \u041a\u0440\u043e\u043a 3: \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f CRD \u0440\u0435\u0441\u0443\u0440\u0441\u0456\u0432 \u0434\u043b\u044f K8s-gatekeeper"}),"\n",(0,l.jsx)(n.p,{children:"\u0412\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u043a\u043e\u043c\u0430\u043d\u0434\u0438:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\n"})}),"\n",(0,l.jsx)(n.h3,{id:"22-\u0437\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439-webhook",children:"2.2 \u0417\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439 webhook"}),"\n",(0,l.jsxs)(n.p,{children:["\u0414\u043b\u044f \u043c\u0435\u0442\u043e\u0434\u0443 \u0437\u043e\u0432\u043d\u0456\u0448\u043d\u044c\u043e\u0433\u043e webhook K8s-gatekeeper \u0431\u0443\u0434\u0435 \u043f\u0440\u0430\u0446\u044e\u0432\u0430\u0442\u0438 \u043f\u043e\u0437\u0430 Kubernetes, \u0456 Kubernetes \u0431\u0443\u0434\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0430\u0442\u0438\u0441\u044f \u0434\u043e K8s-gatekeeper, \u044f\u043a \u0434\u043e \u0437\u0432\u0438\u0447\u0430\u0439\u043d\u043e\u0433\u043e \u0432\u0435\u0431-\u0441\u0430\u0439\u0442\u0443. Kubernetes \u043c\u0430\u0454 \u043e\u0431\u043e\u0432'\u044f\u0437\u043a\u043e\u0432\u0443 \u0432\u0438\u043c\u043e\u0433\u0443, \u0449\u043e\u0431 admission webhook \u0431\u0443\u0432 HTTPS. \u0414\u043b\u044f \u0442\u0435\u0441\u0442\u0443\u0432\u0430\u043d\u043d\u044f K8s-gatekeeper \u043c\u0438 \u043d\u0430\u0434\u0430\u043b\u0438 \u043d\u0430\u0431\u0456\u0440 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0456\u0432 \u0442\u0430 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0438\u0439 \u043a\u043b\u044e\u0447 (\u0445\u043e\u0447\u0430 \u0446\u0435 \u043d\u0435 \u0454 \u0431\u0435\u0437\u043f\u0435\u0447\u043d\u0438\u043c). \u042f\u043a\u0449\u043e \u0432\u0438 \u0432\u0456\u0434\u0434\u0430\u0454\u0442\u0435 \u043f\u0435\u0440\u0435\u0432\u0430\u0433\u0443 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044e \u0432\u043b\u0430\u0441\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0443, \u0431\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u0437\u0432\u0435\u0440\u043d\u0456\u0442\u044c\u0441\u044f \u0434\u043e ",(0,l.jsx)(n.a,{href:"#5-advanced-settings",children:"\u0420\u043e\u0437\u0434\u0456\u043b\u0443 5. \u0420\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456 \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f"})," \u0434\u043b\u044f \u0456\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0456\u0439 \u0449\u043e\u0434\u043e \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0443 \u0442\u0430 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430. \u0421\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442, \u044f\u043a\u0438\u0439 \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e, \u0432\u0438\u0434\u0430\u043d\u0438\u0439 \u0434\u043b\u044f 'webhook.domain.local'."]}),"\n",(0,l.jsx)(n.p,{children:"\u041e\u0442\u0436\u0435, \u0437\u043c\u0456\u043d\u0456\u0442\u044c \u0445\u043e\u0441\u0442 (\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, /etc/hosts) \u0442\u0430 \u0441\u043f\u0440\u044f\u043c\u0443\u0439\u0442\u0435 'webhook.domain.local' \u043d\u0430 IP-\u0430\u0434\u0440\u0435\u0441\u0443, \u043d\u0430 \u044f\u043a\u0456\u0439 \u043f\u0440\u0430\u0446\u044e\u0454 K8s-gatekeeper. \u041f\u043e\u0442\u0456\u043c \u0432\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0443 \u043a\u043e\u043c\u0430\u043d\u0434\u0443:"}),"\n",(0,l.jsx)(n.p,{children:"2.3 \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f K8s-gatekeeper \u0447\u0435\u0440\u0435\u0437 Helm"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"go mod tidy\ngo mod vendor\ngo run cmd/webhook/main.go\nkubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\nkubectl apply -f config/webhook_external.yaml \n"})}),"\n",(0,l.jsx)(n.h3,{id:"231-\u043a\u0440\u043e\u043a-1-\u043f\u043e\u0431\u0443\u0434\u043e\u0432\u0430-\u043e\u0431\u0440\u0430\u0437\u0443",children:"2.3.1 \u041a\u0440\u043e\u043a 1: \u041f\u043e\u0431\u0443\u0434\u043e\u0432\u0430 \u043e\u0431\u0440\u0430\u0437\u0443"}),"\n",(0,l.jsxs)(n.h4,{id:"\u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430-\u0437\u0432\u0435\u0440\u043d\u0456\u0442\u044c\u0441\u044f-\u0434\u043e-\u0440\u043e\u0437\u0434\u0456\u043b\u0443-211",children:["\u0411\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u0437\u0432\u0435\u0440\u043d\u0456\u0442\u044c\u0441\u044f \u0434\u043e ",(0,l.jsx)(n.a,{href:"#211-step-1-build-the-image",children:"\u0420\u043e\u0437\u0434\u0456\u043b\u0443 2.1.1"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"2.3.2 \u0412\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f \u0447\u0435\u0440\u0435\u0437 Helm"}),"\n",(0,l.jsxs)(n.h4,{id:"\u0432\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435-\u043a\u043e\u043c\u0430\u043d\u0434\u0443-helm-install-k8sgatekeeper-k8sgatekeeper",children:["\u0412\u0438\u043a\u043e\u043d\u0430\u0439\u0442\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 ",(0,l.jsx)(n.code,{children:"helm install k8sgatekeeper ./k8sgatekeeper"}),"."]}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsx)(n.li,{}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u0441\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435-k8s-gatekeeper-31-\u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f-\u043c\u043e\u0434\u0435\u043b\u0456-\u0442\u0430-\u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438-casbin",children:"\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 K8s-gatekeeper 3.1 \u0421\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438 Casbin"}),"\n",(0,l.jsx)(n.h3,{id:"\u0443-\u0432\u0430\u0441-\u0454-\u0434\u0432\u0430-\u0441\u043f\u043e\u0441\u043e\u0431\u0438-\u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f-\u043c\u043e\u0434\u0435\u043b\u0456-\u0442\u0430-\u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438-\u0447\u0435\u0440\u0435\u0437-kubectl-\u0430\u0431\u043e-\u0447\u0435\u0440\u0435\u0437-go-\u043a\u043b\u0456\u0454\u043d\u0442-\u044f\u043a\u0438\u0439-\u043c\u0438-\u043d\u0430\u0434\u0430\u0454\u043c\u043e",children:"\u0423 \u0432\u0430\u0441 \u0454 \u0434\u0432\u0430 \u0441\u043f\u043e\u0441\u043e\u0431\u0438 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438: \u0447\u0435\u0440\u0435\u0437 kubectl \u0430\u0431\u043e \u0447\u0435\u0440\u0435\u0437 go-\u043a\u043b\u0456\u0454\u043d\u0442, \u044f\u043a\u0438\u0439 \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e."}),"\n",(0,l.jsx)(n.p,{children:"3.1.1 \u0421\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f/\u041e\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438 Casbin \u0447\u0435\u0440\u0435\u0437 kubectl"}),"\n",(0,l.jsx)(n.h4,{id:"\u0443-k8s-gatekeeper-\u043c\u043e\u0434\u0435\u043b\u044c-casbin-\u0437\u0431\u0435\u0440\u0456\u0433\u0430\u0454\u0442\u044c\u0441\u044f-\u0443-\u0440\u0435\u0441\u0443\u0440\u0441\u0456-crd-\u043f\u0456\u0434-\u043d\u0430\u0437\u0432\u043e\u044e-casbinmodel",children:"\u0423 K8s-gatekeeper \u043c\u043e\u0434\u0435\u043b\u044c Casbin \u0437\u0431\u0435\u0440\u0456\u0433\u0430\u0454\u0442\u044c\u0441\u044f \u0443 \u0440\u0435\u0441\u0443\u0440\u0441\u0456 CRD \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e 'CasbinModel'."}),"\n",(0,l.jsxs)(n.p,{children:["\u0407\u0457 \u0432\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u044f \u0440\u043e\u0437\u0442\u0430\u0448\u043e\u0432\u0430\u043d\u0435 \u0432 ",(0,l.jsx)(n.code,{children:"config/auth.casbin.org_casbinmodels.yaml"}),". \u041f\u0440\u0438\u043a\u043b\u0430\u0434\u0438 \u0454 \u0432 ",(0,l.jsx)(n.code,{children:"example/allowed_repo/model.yaml"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"\u0417\u0432\u0435\u0440\u043d\u0456\u0442\u044c \u0443\u0432\u0430\u0433\u0443 \u043d\u0430 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u043f\u043e\u043b\u044f: metadata.name: \u043d\u0430\u0437\u0432\u0430 \u043c\u043e\u0434\u0435\u043b\u0456."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u0426\u044f \u043d\u0430\u0437\u0432\u0430 \u041f\u041e\u0412\u0418\u041d\u041d\u0410 \u0431\u0443\u0442\u0438 \u0442\u0430\u043a\u043e\u044e \u0436, \u044f\u043a \u043d\u0430\u0437\u0432\u0430 \u043e\u0431'\u0454\u043a\u0442\u0430 CasbinPolicy, \u043f\u043e\u0432'\u044f\u0437\u0430\u043d\u043e\u0433\u043e \u0437 \u0446\u0456\u0454\u044e \u043c\u043e\u0434\u0435\u043b\u043b\u044e, \u0449\u043e\u0431 K8s-gatekeeper \u043c\u0456\u0433 \u0457\u0445 \u0441\u043f\u0430\u0440\u0443\u0432\u0430\u0442\u0438 \u0442\u0430 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0432\u0438\u043a\u043e\u043d\u0430\u0432\u0446\u044f. spec.enable: \u044f\u043a\u0449\u043e \u0446\u0435 \u043f\u043e\u043b\u0435 \u0432\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e \u0432 'false', \u0446\u044f \u043c\u043e\u0434\u0435\u043b\u044c (\u0430 \u0442\u0430\u043a\u043e\u0436 \u043e\u0431'\u0454\u043a\u0442 CasbinPolicy, \u043f\u043e\u0432'\u044f\u0437\u0430\u043d\u0438\u0439 \u0437 \u0446\u0456\u0454\u044e \u043c\u043e\u0434\u0435\u043b\u043b\u044e) \u0431\u0443\u0434\u0435 \u0456\u0433\u043d\u043e\u0440\u0443\u0432\u0430\u0442\u0438\u0441\u044f."}),"\n",(0,l.jsx)(n.li,{children:"spec.modelText: \u0440\u044f\u0434\u043e\u043a, \u044f\u043a\u0438\u0439 \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u043c\u043e\u0434\u0435\u043b\u0456 Casbin."}),"\n",(0,l.jsxs)(n.li,{children:["\u041f\u043e\u043b\u0456\u0442\u0438\u043a\u0430 Casbin \u0437\u0431\u0435\u0440\u0456\u0433\u0430\u0454\u0442\u044c\u0441\u044f \u0432 \u0456\u043d\u0448\u043e\u043c\u0443 \u0440\u0435\u0441\u0443\u0440\u0441\u0456 CRD \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e 'CasbinPolicy', \u0432\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u044f \u044f\u043a\u043e\u0433\u043e \u043c\u043e\u0436\u043d\u0430 \u0437\u043d\u0430\u0439\u0442\u0438 \u0432 ",(0,l.jsx)(n.code,{children:"config/auth.casbin.org_casbinpolicies.yaml"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u041f\u0440\u0438\u043a\u043b\u0430\u0434\u0438 \u0454 \u0432 ",(0,l.jsx)(n.code,{children:"example/allowed_repo/policy.yaml"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"\u0417\u0432\u0435\u0440\u043d\u0456\u0442\u044c \u0443\u0432\u0430\u0433\u0443 \u043d\u0430 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u043f\u043e\u043b\u044f: metadata.name: \u043d\u0430\u0437\u0432\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u0426\u044f \u043d\u0430\u0437\u0432\u0430 \u041f\u041e\u0412\u0418\u041d\u041d\u0410 \u0431\u0443\u0442\u0438 \u0442\u0430\u043a\u043e\u044e \u0436, \u044f\u043a \u043d\u0430\u0437\u0432\u0430 \u043e\u0431'\u0454\u043a\u0442\u0430 CasbinModel, \u043f\u043e\u0432'\u044f\u0437\u0430\u043d\u043e\u0433\u043e \u0437 \u0446\u0456\u0454\u044e \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u043e\u044e, \u0449\u043e\u0431 K8s-gatekeeper \u043c\u0456\u0433 \u0457\u0445 \u0441\u043f\u0430\u0440\u0443\u0432\u0430\u0442\u0438 \u0442\u0430 \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0432\u0438\u043a\u043e\u043d\u0430\u0432\u0446\u044f. spec.policyItem: \u0440\u044f\u0434\u043e\u043a, \u044f\u043a\u0438\u0439 \u043c\u0456\u0441\u0442\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438 \u043c\u043e\u0434\u0435\u043b\u0456 Casbin."}),"\n",(0,l.jsx)(n.li,{children:"\u041f\u0456\u0441\u043b\u044f \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u0432\u043b\u0430\u0441\u043d\u0438\u0445 \u0444\u0430\u0439\u043b\u0456\u0432 CasbinModel \u0442\u0430 CasbinPolicy \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0443 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0434\u043b\u044f \u0457\u0445 \u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u043d\u043d\u044f:"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u042f\u043a \u0442\u0456\u043b\u044c\u043a\u0438 \u043f\u0430\u0440\u0430 CasbinModel \u0442\u0430 CasbinPolicy \u0431\u0443\u0434\u0435 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0430, K8s-gatekeeper \u0437\u043c\u043e\u0436\u0435 \u0457\u0457 \u0432\u0438\u044f\u0432\u0438\u0442\u0438 \u043f\u0440\u043e\u0442\u044f\u0433\u043e\u043c 5 \u0441\u0435\u043a\u0443\u043d\u0434."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f <filename>\n"})}),"\n",(0,l.jsx)(n.p,{children:"3.1.2 \u0421\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f/\u041e\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f \u043c\u043e\u0434\u0435\u043b\u0456 \u0442\u0430 \u043f\u043e\u043b\u0456\u0442\u0438\u043a\u0438 Casbin \u0447\u0435\u0440\u0435\u0437 go-\u043a\u043b\u0456\u0454\u043d\u0442, \u044f\u043a\u0438\u0439 \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e"}),"\n",(0,l.jsx)(n.h4,{id:"\u043c\u0438-\u0440\u043e\u0437\u0443\u043c\u0456\u0454\u043c\u043e-\u0449\u043e-\u043c\u043e\u0436\u0443\u0442\u044c-\u0431\u0443\u0442\u0438-\u0441\u0438\u0442\u0443\u0430\u0446\u0456\u0457-\u043a\u043e\u043b\u0438-\u043d\u0435-\u0437\u0440\u0443\u0447\u043d\u043e-\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438-\u043e\u0431\u043e\u043b\u043e\u043d\u043a\u0443-\u0434\u043b\u044f-\u0432\u0438\u043a\u043e\u043d\u0430\u043d\u043d\u044f-\u043a\u043e\u043c\u0430\u043d\u0434-\u0431\u0435\u0437\u043f\u043e\u0441\u0435\u0440\u0435\u0434\u043d\u044c\u043e-\u043d\u0430-\u0432\u0443\u0437\u043b\u0456-\u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430-k8s-\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434-\u043a\u043e\u043b\u0438-\u0432\u0438-\u0431\u0443\u0434\u0443\u0454\u0442\u0435-\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0443-\u0445\u043c\u0430\u0440\u043d\u0443-\u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0443-\u0434\u043b\u044f-\u0432\u0430\u0448\u043e\u0457-\u043a\u043e\u0440\u043f\u043e\u0440\u0430\u0446\u0456\u0457",children:"\u041c\u0438 \u0440\u043e\u0437\u0443\u043c\u0456\u0454\u043c\u043e, \u0449\u043e \u043c\u043e\u0436\u0443\u0442\u044c \u0431\u0443\u0442\u0438 \u0441\u0438\u0442\u0443\u0430\u0446\u0456\u0457, \u043a\u043e\u043b\u0438 \u043d\u0435 \u0437\u0440\u0443\u0447\u043d\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u043e\u0431\u043e\u043b\u043e\u043d\u043a\u0443 \u0434\u043b\u044f \u0432\u0438\u043a\u043e\u043d\u0430\u043d\u043d\u044f \u043a\u043e\u043c\u0430\u043d\u0434 \u0431\u0435\u0437\u043f\u043e\u0441\u0435\u0440\u0435\u0434\u043d\u044c\u043e \u043d\u0430 \u0432\u0443\u0437\u043b\u0456 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430 K8s, \u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u043a\u043e\u043b\u0438 \u0432\u0438 \u0431\u0443\u0434\u0443\u0454\u0442\u0435 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0443 \u0445\u043c\u0430\u0440\u043d\u0443 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0443 \u0434\u043b\u044f \u0432\u0430\u0448\u043e\u0457 \u043a\u043e\u0440\u043f\u043e\u0440\u0430\u0446\u0456\u0457."}),"\n",(0,l.jsxs)(n.p,{children:["\u0422\u043e\u043c\u0443 \u043c\u0438 \u0440\u043e\u0437\u0440\u043e\u0431\u0438\u043b\u0438 go-\u043a\u043b\u0456\u0454\u043d\u0442 \u0434\u043b\u044f \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u0442\u0430 \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u043a\u0438 CasbinModel \u0442\u0430 CasbinPolicy. \u0411\u0456\u0431\u043b\u0456\u043e\u0442\u0435\u043a\u0430 go-\u043a\u043b\u0456\u0454\u043d\u0442\u0430 \u0440\u043e\u0437\u0442\u0430\u0448\u043e\u0432\u0430\u043d\u0430 \u0432 ",(0,l.jsx)(n.code,{children:"pkg/client"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["\u0423 ",(0,l.jsx)(n.code,{children:"client.go"})," \u043c\u0438 \u043d\u0430\u0434\u0430\u0454\u043c\u043e \u0444\u0443\u043d\u043a\u0446\u0456\u044e \u0434\u043b\u044f \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u043a\u043b\u0456\u0454\u043d\u0442\u0430."]}),"\n",(0,l.jsxs)(n.p,{children:["In ",(0,l.jsx)(n.code,{children:"client.go"}),", we provide a function to create a client."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:"func NewK8sGateKeeperClient(externalClient bool) (*K8sGateKeeperClient, error) \n"})}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"externalClient"})," parameter determines whether K8s-gatekeeper is running inside the K8s cluster or not."]}),"\n",(0,l.jsxs)(n.p,{children:["In ",(0,l.jsx)(n.code,{children:"model.go"}),", we provide various functions to create, delete, and modify CasbinModel. You can find out how to use these interfaces in ",(0,l.jsx)(n.code,{children:"model_test.go"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["In ",(0,l.jsx)(n.code,{children:"policy.go"}),", we provide various functions to create, delete, and modify CasbiPolicy. You can find out how to use these interfaces in ",(0,l.jsx)(n.code,{children:"policy_test.go"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"312-try-whether-k8s-gatekeeper-works",children:"3.1.2 Try Whether K8s-gatekeeper Works"}),"\n",(0,l.jsxs)(n.p,{children:["Suppose you have already created the exact model and policy in ",(0,l.jsx)(n.code,{children:"example/allowed_repo"}),". Now, try the following command:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f example/allowed_repo/testcase/reject_1.yaml\n"})}),"\n",(0,l.jsxs)(n.p,{children:["You should find that K8s will reject this request and mention that the webhook was the reason why this request is rejected. However, when you try to apply ",(0,l.jsx)(n.code,{children:"example/allowed_repo/testcase/approve_2.yaml"}),", it will be accepted."]}),"\n",(0,l.jsx)(n.h2,{id:"4-how-to-write-model-and-policy-with-k8s-gatekeeper",children:"4. How to Write Model and Policy with K8s-gatekeeper"}),"\n",(0,l.jsxs)(n.p,{children:["First of all, make sure you are familiar with the basic grammar of Casbin Models and Policies. If you are not, please read the ",(0,l.jsx)(n.a,{href:"/docs/get-started",children:"Get Started"})," section first. In this chapter, we assume that you already understand what Casbin Models and Policies are."]}),"\n",(0,l.jsx)(n.h3,{id:"41-request-definition-of-model",children:"4.1 Request Definition of Model"}),"\n",(0,l.jsx)(n.p,{children:"When K8s-gatekeeper is authorizing a request, the input is always an object: the Go object of the Admission Request. This means that the enforcer will always be used like this:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:"ok, err := enforcer.Enforce(admission)\n"})}),"\n",(0,l.jsxs)(n.p,{children:["where ",(0,l.jsx)(n.code,{children:"admission"})," is an ",(0,l.jsx)(n.code,{children:"AdmissionReview"})," object defined by K8s's official go api ",(0,l.jsx)(n.code,{children:'"k8s.io/api/admission/v1"'}),". You can find the definition of this struct in this repository: ",(0,l.jsx)(n.a,{href:"https://github.com/kubernetes/api/blob/master/admission/v1/types.go",children:"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"}),". For more information, you can also refer to ",(0,l.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response",children:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["Therefore, for any model used by K8s-gatekeeper, the definition of the ",(0,l.jsx)(n.code,{children:"request_definition"})," should always be like this:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"    [request_definition]\n    r =  obj\n"})}),"\n",(0,l.jsxs)(n.p,{children:["The name 'obj' is not mandatory, as long as the name is consistent with the name used in the ",(0,l.jsx)(n.code,{children:"[matchers]"})," part."]}),"\n",(0,l.jsx)(n.h3,{id:"42-matchers-of-model",children:"4.2 Matchers of Model"}),"\n",(0,l.jsx)(n.p,{children:"You are supposed to use the ABAC feature of Casbin to write your rules. However, the expression evaluator integrated in Casbin does not support indexing in maps or arrays(slices), nor the expansion of arrays. Therefore, K8s-gatekeeper provides various 'Casbin functions' as extensions to implement these features. If you still find that your demand cannot be fulfilled by these extensions, feel free to start an issue, or create a pull request."}),"\n",(0,l.jsxs)(n.p,{children:["If you are not familiar with Casbin functions, you can refer to ",(0,l.jsx)(n.a,{href:"/docs/function",children:"Function"})," for more information."]}),"\n",(0,l.jsx)(n.p,{children:"Here are the extension functions:"}),"\n",(0,l.jsx)(n.h3,{id:"421-extension-functions",children:"4.2.1 Extension functions"}),"\n",(0,l.jsx)(n.h4,{id:"4211-access",children:"4.2.1.1 access"}),"\n",(0,l.jsxs)(n.p,{children:["Access is used to solve the problem that Casbin does not support indexing in maps or arrays. The example ",(0,l.jsx)(n.code,{children:"example/allowed_repo/model.yaml"})," demonstrates the usage of this function:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:'[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n'})}),"\n",(0,l.jsxs)(n.p,{children:["In this matcher, ",(0,l.jsx)(n.code,{children:'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image")'})," is equivalent to ",(0,l.jsx)(n.code,{children:"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Image"}),", where ",(0,l.jsx)(n.code,{children:"r.obj.Request.Object.Object.Spec.Template.Spec.Containers"})," is a slice."]}),"\n",(0,l.jsxs)(n.p,{children:["Access can also call simple functions that have no parameters and return a single value. The example ",(0,l.jsx)(n.code,{children:"example/container_resource_limit/model.yaml"})," demonstrates this:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:'[matchers]\n  m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")) >= parseFloat(p.cpu) && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","memory","Value")) >= parseFloat(p.memory)\n'})}),"\n",(0,l.jsxs)(n.p,{children:["In this matcher, ",(0,l.jsx)(n.code,{children:'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")'})," is equivalent to ",(0,l.jsx)(n.code,{children:'r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits["cpu"].Value()'}),", where ",(0,l.jsx)(n.code,{children:"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits"})," is a map, and ",(0,l.jsx)(n.code,{children:"Value()"})," is a simple function that has no parameters and returns a single value."]}),"\n",(0,l.jsx)(n.h4,{id:"4212-accesswithwildcard",children:"4.2.1.2 accessWithWildcard"}),"\n",(0,l.jsxs)(n.p,{children:['Sometimes, you may have a demand like this: all elements in an array must have a prefix "aaa". However, Casbin does not support ',(0,l.jsx)(n.code,{children:"for"})," loops. With ",(0,l.jsx)(n.code,{children:"accessWithWildcard"}),' and the "map/slice expansion" feature, you can easily implement such a demand.']}),"\n",(0,l.jsxs)(n.p,{children:["For example, suppose ",(0,l.jsx)(n.code,{children:"a.b.c"})," is an array ",(0,l.jsx)(n.code,{children:"[aaa,bbb,ccc,ddd,eee]"}),", then the result of ",(0,l.jsx)(n.code,{children:'accessWithWildcard(a,"b","c","*")'})," will be a slice ",(0,l.jsx)(n.code,{children:"[aaa,bbb,ccc,ddd,eee]"}),". By using the wildcard ",(0,l.jsx)(n.code,{children:"*"}),", the slice is expanded."]}),"\n",(0,l.jsxs)(n.p,{children:["Similarly, the wildcard can be used more than once. For example, the result of ",(0,l.jsx)(n.code,{children:'accessWithWildcard(a,"b","c","*","*")'})," will be ",(0,l.jsx)(n.code,{children:"[a.b.c[0][0], a.b.c[0][1], ..., a.b.c[1][0], a.b.c[1][1], ...]"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"4213-functions-supporting-variable-length-arguments",children:"4.2.1.3 Functions Supporting Variable-length Arguments"}),"\n",(0,l.jsx)(n.p,{children:"In the expression evaluator of Casbin, when a parameter is an array, it will be automatically expanded as a variable-length argument. \u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 \u0446\u044e \u0444\u0443\u043d\u043a\u0446\u0456\u044e \u0434\u043b\u044f \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u043a\u0438 \u0440\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u043d\u044f \u043c\u0430\u0441\u0438\u0432\u0443/\u0437\u0440\u0456\u0437\u0443/\u043c\u0430\u043f\u0438, \u043c\u0438 \u0442\u0430\u043a\u043e\u0436 \u0456\u043d\u0442\u0435\u0433\u0440\u0443\u0432\u0430\u043b\u0438 \u043a\u0456\u043b\u044c\u043a\u0430 \u0444\u0443\u043d\u043a\u0446\u0456\u0439, \u044f\u043a\u0456 \u043f\u0440\u0438\u0439\u043c\u0430\u044e\u0442\u044c \u043c\u0430\u0441\u0438\u0432/\u0437\u0440\u0456\u0437 \u044f\u043a \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"contain(): \u043f\u0440\u0438\u0439\u043c\u0430\u0454 \u043a\u0456\u043b\u044c\u043a\u0430 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0456\u0432 \u0456 \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454, \u0447\u0438 \u0431\u0443\u0434\u044c-\u044f\u043a\u0438\u0439 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 (\u043a\u0440\u0456\u043c \u043e\u0441\u0442\u0430\u043d\u043d\u044c\u043e\u0433\u043e) \u0434\u043e\u0440\u0456\u0432\u043d\u044e\u0454 \u043e\u0441\u0442\u0430\u043d\u043d\u044c\u043e\u043c\u0443 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0443."}),"\n",(0,l.jsx)(n.li,{children:"split(a,b,c...,sep,index): \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442, \u044f\u043a\u0438\u0439 \u043c\u0456\u0441\u0442\u0438\u0442\u044c [splits(a,sep)[index], splits(b,sep)[index], splits(a,sep)[index], ...]."}),"\n",(0,l.jsx)(n.li,{children:"len(): \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454 \u0434\u043e\u0432\u0436\u0438\u043d\u0443 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0443 \u0437\u043c\u0456\u043d\u043d\u043e\u0457 \u0434\u043e\u0432\u0436\u0438\u043d\u0438."}),"\n",(0,l.jsx)(n.li,{children:"matchRegex(a,b,c...,regex): \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454, \u0447\u0438 \u0432\u0441\u0456 \u0434\u0430\u043d\u0456 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0438 (a, b, c, ...) \u0432\u0456\u0434\u043f\u043e\u0432\u0456\u0434\u0430\u044e\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u043e\u043c\u0443 regex. \u0432\u0456\u0434\u043f\u043e\u0432\u0456\u0434\u0430\u044e\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u043e\u043c\u0443 regex."}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u041e\u0441\u044c \u043f\u0440\u0438\u043a\u043b\u0430\u0434 \u0443 ",(0,l.jsx)(n.code,{children:"example/disallowed_tag/model.yaml"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:'    [matchers]\n    m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n    contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u041f\u0440\u0438\u043f\u0443\u0441\u043a\u0430\u044e\u0447\u0438, \u0449\u043e ",(0,l.jsx)(n.code,{children:'accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image")'})," \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454 ",(0,l.jsx)(n.code,{children:"['a:b', 'c:d', 'e:f', 'g:h']"}),", \u043e\u0441\u043a\u0456\u043b\u044c\u043a\u0438 splits \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u0443\u0454 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0438 \u0437\u043c\u0456\u043d\u043d\u043e\u0457 \u0434\u043e\u0432\u0436\u0438\u043d\u0438 \u0442\u0430 \u0432\u0438\u043a\u043e\u043d\u0443\u0454 \u043e\u043f\u0435\u0440\u0430\u0446\u0456\u044e \u0440\u043e\u0437\u0431\u0438\u0442\u0442\u044f \u0434\u043b\u044f \u043a\u043e\u0436\u043d\u043e\u0433\u043e \u0435\u043b\u0435\u043c\u0435\u043d\u0442\u0430, \u0435\u043b\u0435\u043c\u0435\u043d\u0442 \u0437 \u0456\u043d\u0434\u0435\u043a\u0441\u043e\u043c 1 \u0431\u0443\u0434\u0435 \u0432\u0438\u0431\u0440\u0430\u043d\u0438\u0439 \u0442\u0430 \u043f\u043e\u0432\u0435\u0440\u043d\u0435\u043d\u0438\u0439. \u0422\u043e\u043c\u0443, ",(0,l.jsx)(n.code,{children:'split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1)'})," \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454 ",(0,l.jsx)(n.code,{children:"['b','d','f','h']"}),". \u0406 ",(0,l.jsx)(n.code,{children:'contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)'})," \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454, \u0447\u0438 ",(0,l.jsx)(n.code,{children:"p.obj"})," \u043c\u0456\u0441\u0442\u0438\u0442\u044c\u0441\u044f \u0432 ",(0,l.jsx)(n.code,{children:"['b','d','f','h']"}),"."]}),"\n",(0,l.jsx)(n.h4,{id:"4212-\u0444\u0443\u043d\u043a\u0446\u0456\u0457-\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0456\u0457-\u0442\u0438\u043f\u0456\u0432",children:"4.2.1.2 \u0424\u0443\u043d\u043a\u0446\u0456\u0457 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0456\u0457 \u0442\u0438\u043f\u0456\u0432"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"ParseFloat(): \u041f\u0435\u0440\u0435\u0442\u0432\u043e\u0440\u044e\u0454 \u0446\u0456\u043b\u0435 \u0447\u0438\u0441\u043b\u043e \u0432 \u0447\u0438\u0441\u043b\u043e \u0437 \u043f\u043b\u0430\u0432\u0430\u044e\u0447\u043e\u044e \u043a\u043e\u043c\u043e\u044e (\u0446\u0435 \u043d\u0435\u043e\u0431\u0445\u0456\u0434\u043d\u043e, \u043e\u0441\u043a\u0456\u043b\u044c\u043a\u0438 \u0431\u0443\u0434\u044c-\u044f\u043a\u0435 \u0447\u0438\u0441\u043b\u043e, \u0449\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u044c\u0441\u044f \u0443 \u043f\u043e\u0440\u0456\u0432\u043d\u044f\u043d\u043d\u0456, \u043c\u0430\u0454 \u0431\u0443\u0442\u0438 \u043f\u0435\u0440\u0435\u0442\u0432\u043e\u0440\u0435\u043d\u0435 \u0443 \u0447\u0438\u0441\u043b\u043e \u0437 \u043f\u043b\u0430\u0432\u0430\u044e\u0447\u043e\u044e \u043a\u043e\u043c\u043e\u044e)."}),"\n",(0,l.jsxs)(n.li,{children:["ToString(): \u041f\u0435\u0440\u0435\u0442\u0432\u043e\u0440\u044e\u0454 \u043e\u0431'\u0454\u043a\u0442 \u0443 \u0440\u044f\u0434\u043e\u043a. \u0426\u0435\u0439 \u043e\u0431'\u0454\u043a\u0442 \u043c\u0430\u0454 \u043c\u0430\u0442\u0438 \u0431\u0430\u0437\u043e\u0432\u0438\u0439 \u0442\u0438\u043f \u0440\u044f\u0434\u043a\u0430 (\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u043e\u0431'\u0454\u043a\u0442 \u0442\u0438\u043f\u0443 ",(0,l.jsx)(n.code,{children:"XXX"}),", \u043a\u043e\u043b\u0438 \u0454 \u0432\u0438\u0441\u043b\u043e\u0432\u043b\u044e\u0432\u0430\u043d\u043d\u044f ",(0,l.jsx)(n.code,{children:"type XXX string"}),")."]}),"\n",(0,l.jsx)(n.li,{children:"IsNil(): \u041f\u043e\u0432\u0435\u0440\u0442\u0430\u0454, \u0447\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u0454 nil."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"5-\u0440\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456-\u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f",children:"5. \u0420\u043e\u0437\u0448\u0438\u0440\u0435\u043d\u0456 \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f"}),"\n",(0,l.jsx)(n.h3,{id:"51-\u043f\u0440\u043e-\u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438",children:"5.1 \u041f\u0440\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438"}),"\n",(0,l.jsx)(n.p,{children:"\u0423 Kubernetes (k8s) \u043e\u0431\u043e\u0432'\u044f\u0437\u043a\u043e\u0432\u043e, \u0449\u043e\u0431 webhook \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0432 HTTPS. \u0406\u0441\u043d\u0443\u0454 \u0434\u0432\u0430 \u043f\u0456\u0434\u0445\u043e\u0434\u0438 \u0434\u043b\u044f \u0434\u043e\u0441\u044f\u0433\u043d\u0435\u043d\u043d\u044f \u0446\u044c\u043e\u0433\u043e:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0441\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u0438\u0445 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0456\u0432 (\u043f\u0440\u0438\u043a\u043b\u0430\u0434\u0438 \u0443 \u0446\u044c\u043e\u043c\u0443 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0456\u0457 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0442\u044c \u0446\u0435\u0439 \u043c\u0435\u0442\u043e\u0434)"}),"\n",(0,l.jsx)(n.li,{children:"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0437\u0432\u0438\u0447\u0430\u0439\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"511-\u0441\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u0456-\u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438",children:"5.1.1 \u0421\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u0456 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438"}),"\n",(0,l.jsx)(n.p,{children:"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u0441\u0430\u043c\u043e\u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430 \u043e\u0437\u043d\u0430\u0447\u0430\u0454, \u0449\u043e \u0426\u0435\u043d\u0442\u0440 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0446\u0456\u0457 (CA), \u044f\u043a\u0438\u0439 \u0432\u0438\u0434\u0430\u0454 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442, \u043d\u0435 \u0454 \u043e\u0434\u043d\u0438\u043c \u0437 \u0432\u0456\u0434\u043e\u043c\u0438\u0445 CA. \u0422\u043e\u043c\u0443, \u0432\u0438 \u043f\u043e\u0432\u0438\u043d\u043d\u0456 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u0438\u0442\u0438 k8s \u043f\u0440\u043e \u0446\u0435\u0439 CA."}),"\n",(0,l.jsxs)(n.p,{children:["\u041d\u0430\u0440\u0430\u0437\u0456, \u043f\u0440\u0438\u043a\u043b\u0430\u0434 \u0443 \u0446\u044c\u043e\u043c\u0443 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0456\u0457 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454 \u0441\u0430\u043c\u043e\u0441\u0442\u0456\u0439\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0438\u0439 CA, \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0438\u0439 \u043a\u043b\u044e\u0447 \u0442\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442 \u044f\u043a\u043e\u0433\u043e \u0437\u0431\u0435\u0440\u0456\u0433\u0430\u044e\u0442\u044c\u0441\u044f \u0443 ",(0,l.jsx)(n.code,{children:"config/certificate/ca.crt"})," \u0442\u0430 ",(0,l.jsx)(n.code,{children:"config/certificate/ca.key"})," \u0432\u0456\u0434\u043f\u043e\u0432\u0456\u0434\u043d\u043e. \u0421\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442 \u0434\u043b\u044f webhook \u0454 ",(0,l.jsx)(n.code,{children:"config/certificate/server.crt"}),', \u044f\u043a\u0438\u0439 \u0432\u0438\u043f\u0443\u0449\u0435\u043d\u0438\u0439 \u0441\u0430\u043c\u043e\u0441\u0442\u0456\u0439\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0438\u043c CA. \u0414\u043e\u043c\u0435\u043d\u0438 \u0446\u044c\u043e\u0433\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430 - "webhook.domain.local" (\u0434\u043b\u044f \u0437\u043e\u0432\u043d\u0456\u0448\u043d\u044c\u043e\u0433\u043e webhook) \u0442\u0430 "casbin-webhook-svc.default.svc" (\u0434\u043b\u044f \u0432\u043d\u0443\u0442\u0440\u0456\u0448\u043d\u044c\u043e\u0433\u043e webhook).']}),"\n",(0,l.jsxs)(n.p,{children:["\u0406\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0456\u044f \u043f\u0440\u043e CA \u043f\u0435\u0440\u0435\u0434\u0430\u0454\u0442\u044c\u0441\u044f \u0434\u043e k8s \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439\u043d\u0456 \u0444\u0430\u0439\u043b\u0438 webhook. \u041e\u0431\u0438\u0434\u0432\u0430 ",(0,l.jsx)(n.code,{children:"config/webhook_external.yaml"})," \u0442\u0430 ",(0,l.jsx)(n.code,{children:"config/webhook_internal.yaml"}),' \u043c\u0430\u044e\u0442\u044c \u043f\u043e\u043b\u0435 \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e "CABundle", \u044f\u043a\u0435 \u043c\u0456\u0441\u0442\u0438\u0442\u044c base64 \u0437\u0430\u043a\u043e\u0434\u043e\u0432\u0430\u043d\u0438\u0439 \u0440\u044f\u0434\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430 CA.']}),"\n",(0,l.jsx)(n.p,{children:"\u0423 \u0432\u0438\u043f\u0430\u0434\u043a\u0443, \u044f\u043a\u0449\u043e \u0432\u0430\u043c \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0437\u043c\u0456\u043d\u0438\u0442\u0438 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442/\u0434\u043e\u043c\u0435\u043d (\u043d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434, \u044f\u043a\u0449\u043e \u0432\u0438 \u0445\u043e\u0447\u0435\u0442\u0435 \u043f\u043e\u043c\u0456\u0441\u0442\u0438\u0442\u0438 \u0446\u0435\u0439 webhook \u0432 \u0456\u043d\u0448\u0438\u0439 \u043f\u0440\u043e\u0441\u0442\u0456\u0440 \u0456\u043c\u0435\u043d k8s, \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 \u0432\u043d\u0443\u0442\u0440\u0456\u0448\u043d\u0456\u0439 webhook, \u0430\u0431\u043e \u044f\u043a\u0449\u043e \u0432\u0438 \u0445\u043e\u0447\u0435\u0442\u0435 \u0437\u043c\u0456\u043d\u0438\u0442\u0438 \u0434\u043e\u043c\u0435\u043d, \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 \u0437\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0439 webhook), \u0441\u043b\u0456\u0434 \u0434\u043e\u0442\u0440\u0438\u043c\u0443\u0432\u0430\u0442\u0438\u0441\u044f \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0438\u0445 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u0421\u0442\u0432\u043e\u0440\u0456\u0442\u044c \u043d\u043e\u0432\u0438\u0439 CA:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u0421\u0442\u0432\u043e\u0440\u0456\u0442\u044c \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0438\u0439 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0444\u0435\u0439\u043a\u043e\u0432\u043e\u0433\u043e CA:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"openssl genrsa -des3 -out ca.key 2048\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u0412\u0438\u0434\u0430\u043b\u0456\u0442\u044c \u0437\u0430\u0445\u0438\u0441\u0442 \u043f\u0430\u0440\u043e\u043b\u0435\u043c \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"openssl rsa -in ca.key -out ca.key\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u0421\u0442\u0432\u043e\u0440\u0456\u0442\u044c \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0438\u0439 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 webhook:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"openssl genrsa -des3 -out server.key 2048\nopenssl rsa -in server.key -out server.key\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0439\u0442\u0435 \u0441\u0430\u043c\u043e\u0441\u0442\u0456\u0439\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0438\u0439 CA \u0434\u043b\u044f \u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430 \u0434\u043b\u044f webhook:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u0421\u043a\u043e\u043f\u0456\u044e\u0439\u0442\u0435 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439\u043d\u0438\u0439 \u0444\u0430\u0439\u043b openssl \u0432\u0430\u0448\u043e\u0457 \u0441\u0438\u0441\u0442\u0435\u043c\u0438 \u0434\u043b\u044f \u0442\u0438\u043c\u0447\u0430\u0441\u043e\u0432\u043e\u0433\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f. \u0412\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u0434\u0456\u0437\u043d\u0430\u0442\u0438\u0441\u044f \u043c\u0456\u0441\u0446\u0435\u0437\u043d\u0430\u0445\u043e\u0434\u0436\u0435\u043d\u043d\u044f \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439\u043d\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0443, \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0432\u0448\u0438 ",(0,l.jsx)(n.code,{children:"openssl version -a"}),", \u0437\u0430\u0437\u0432\u0438\u0447\u0430\u0439 \u043d\u0430\u0437\u0438\u0432\u0430\u0454\u0442\u044c\u0441\u044f ",(0,l.jsx)(n.code,{children:"openssl.cnf"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u0423 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439\u043d\u043e\u043c\u0443 \u0444\u0430\u0439\u043b\u0456:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u0417\u043d\u0430\u0439\u0434\u0456\u0442\u044c \u043f\u0430\u0440\u0430\u0433\u0440\u0430\u0444 ",(0,l.jsx)(n.code,{children:"[req]"})," \u0442\u0430 \u0434\u043e\u0434\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0438\u0439 \u0440\u044f\u0434\u043e\u043a: ",(0,l.jsx)(n.code,{children:"req_extensions = v3_req"})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u0417\u043d\u0430\u0439\u0434\u0456\u0442\u044c \u043f\u0430\u0440\u0430\u0433\u0440\u0430\u0444 ",(0,l.jsx)(n.code,{children:"[v3_req]"})," \u0442\u0430 \u0434\u043e\u0434\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0438\u0439 \u0440\u044f\u0434\u043e\u043a: ",(0,l.jsx)(n.code,{children:"subjectAltName = @alt_names"})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u0414\u043e\u0434\u0430\u0439\u0442\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0456 \u0440\u044f\u0434\u043a\u0438 \u0434\u043e \u0444\u0430\u0439\u043b\u0443:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[alt_names]\nDNS.2=<The domain you want>\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u041f\u0440\u0438\u043c\u0456\u0442\u043a\u0430: \u0417\u0430\u043c\u0456\u043d\u0456\u0442\u044c 'casbin-webhook-svc.default.svc' \u043d\u0430 \u0441\u043f\u0440\u0430\u0432\u0436\u043d\u0454 \u0456\u043c'\u044f \u0441\u0435\u0440\u0432\u0456\u0441\u0443 \u0432\u0430\u0448\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0456\u0441\u0443, \u044f\u043a\u0449\u043e \u0432\u0438 \u0432\u0438\u0440\u0456\u0448\u0438\u0442\u0435 \u0437\u043c\u0456\u043d\u0438\u0442\u0438 \u0456\u043c'\u044f \u0441\u0435\u0440\u0432\u0456\u0441\u0443."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0439\u0442\u0435 \u0437\u043c\u0456\u043d\u0435\u043d\u0438\u0439 \u043a\u043e\u043d\u0444\u0456\u0433\u0443\u0440\u0430\u0446\u0456\u0439\u043d\u0438\u0439 \u0444\u0430\u0439\u043b \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0456\u0457 \u0444\u0430\u0439\u043b\u0443 \u0437\u0430\u043f\u0438\u0442\u0443 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"openssl req -new -nodes -keyout server.key -out server.csr -config openssl.cnf\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0439\u0442\u0435 \u0441\u0430\u043c\u043e\u0441\u0442\u0456\u0439\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0438\u0439 CA \u0434\u043b\u044f \u0432\u0456\u0434\u043f\u043e\u0432\u0456\u0434\u0456 \u043d\u0430 \u0437\u0430\u043f\u0438\u0442 \u0442\u0430 \u043f\u0456\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"openssl x509 -req -days 3650 -in server.csr -out server.crt -CA ca.crt -CAkey ca.key -CAcreateserial -extensions v3_req -extensions SAN -extfile openssl.cnf\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u0417\u0430\u043c\u0456\u043d\u0456\u0442\u044c \u043f\u043e\u043b\u0435 'CABundle': \u041e\u0431\u0438\u0434\u0432\u0430 ",(0,l.jsx)(n.code,{children:"config/webhook_external.yaml"})," \u0442\u0430 ",(0,l.jsx)(n.code,{children:"config/webhook_internal.yaml"}),' \u043c\u0430\u044e\u0442\u044c \u043f\u043e\u043b\u0435 \u043f\u0456\u0434 \u043d\u0430\u0437\u0432\u043e\u044e "CABundle", \u044f\u043a\u0435 \u043c\u0456\u0441\u0442\u0438\u0442\u044c base64 \u0437\u0430\u043a\u043e\u0434\u043e\u0432\u0430\u043d\u0438\u0439 \u0440\u044f\u0434\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0430 CA.']}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u041e\u043d\u043e\u0432\u0456\u0442\u044c \u0446\u0435 \u043f\u043e\u043b\u0435 \u043d\u043e\u0432\u0438\u043c \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u043e\u043c."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u044f\u043a\u0449\u043e-\u0432\u0438-\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435-helm-\u043f\u043e\u0434\u0456\u0431\u043d\u0456-\u0437\u043c\u0456\u043d\u0438-\u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e-\u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u0442\u0438-\u0434\u043e-helm-charts",children:"\u042f\u043a\u0449\u043e \u0432\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435 helm, \u043f\u043e\u0434\u0456\u0431\u043d\u0456 \u0437\u043c\u0456\u043d\u0438 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u0437\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u0442\u0438 \u0434\u043e helm charts."}),"\n",(0,l.jsx)(n.p,{children:"5.1.2 \u041b\u0435\u0433\u0430\u043b\u044c\u043d\u0456 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438 \u042f\u043a\u0449\u043e \u0432\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u0435 \u043b\u0435\u0433\u0430\u043b\u044c\u043d\u0456 \u0441\u0435\u0440\u0442\u0438\u0444\u0456\u043a\u0430\u0442\u0438, \u0432\u0430\u043c \u043d\u0435 \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u043e \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442\u0438 \u0432\u0441\u0456 \u0446\u0456 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u0438."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);