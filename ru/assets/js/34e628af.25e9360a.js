"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[616],{4005(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"k8s","title":"Authorization of Kubernetes","description":"\u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u043e\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u043d\u043e\u0435 \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 Kubernetes (k8s) RBAC \u0438 ABAC \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 Casbin","source":"@site/i18n/ru/docusaurus-plugin-content-docs/current/K8sAuthz.mdx","sourceDirName":".","slug":"/k8s","permalink":"/ru/docs/k8s","draft":false,"unlisted":false,"editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sAuthz.mdx","tags":[],"version":"current","frontMatter":{"id":"k8s","title":"Authorization of Kubernetes","description":"\u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u043e\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u043d\u043e\u0435 \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 Kubernetes (k8s) RBAC \u0438 ABAC \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 Casbin","keywords":["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],"authors":["hsluoyz"]},"sidebar":"docs","previous":{"title":"Performance Optimization","permalink":"/ru/docs/performance"},"next":{"title":"Admission Webhook for K8s","permalink":"/ru/docs/k8s-gatekeeper"}}');var r=n(4848),i=n(8453);const o={id:"k8s",title:"Authorization of Kubernetes",description:"\u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u043e\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u043d\u043e\u0435 \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 Kubernetes (k8s) RBAC \u0438 ABAC \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 Casbin",keywords:["Kubernetes authorization","Kubernetes RBAC","Kubernetes ABAC","K8s-authz"],authors:["hsluoyz"]},a=void 0,c={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435",id:"\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435",level:2}];function u(e){const s={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz",children:"K8s-authz"})," is a Kubernetes authorization middleware built on Casbin that implements RBAC (Role-Based Access Control) and ABAC (Attribute-Based Access Control) policy enforcement. This middleware integrates with the Kubernetes validation admission webhook to evaluate Casbin-defined policies against each request to Kubernetes resources. Custom admission controllers register with Kubernetes using ",(0,r.jsx)(s.code,{children:"ValidatingAdmissionWebhook"})," to validate request objects forwarded by the API server and return allow or deny responses."]}),"\n",(0,r.jsxs)(s.p,{children:["The validation webhook proxies requests for all Kubernetes resource types and subresources, performing policy verification for each. Users can perform operations on resources only when authorized by the Casbin enforcer. The ",(0,r.jsx)(s.a,{href:"/docs/get-started#new-a-casbin-enforcer",children:"enforcer"})," evaluates user roles as defined in the policies. Deploy this middleware directly to your Kubernetes cluster."]}),"\n",(0,r.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(s.p,{children:"Before you begin, ensure you have:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\u0420\u0430\u0431\u043e\u0442\u0430\u044e\u0449\u0438\u0439 \u043a\u043b\u0430\u0441\u0442\u0435\u0440 Kubernetes. Set up a local cluster using Docker or establish a complete Kubernetes environment on your server. For local setup on Windows, see ",(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/",children:"this guide"}),". For Linux server setup, see ",(0,r.jsx)(s.a,{href:"https://www.digitalocean.com/community/tutorials/how-to-create-a-kubernetes-cluster-using-kubeadm-on-ubuntu-18-04",children:"this tutorial"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Kubectl CLI. Installation instructions: ",(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/",children:"Windows"})," | ",(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/",children:"Linux"})]}),"\n",(0,r.jsx)(s.li,{children:"OpenSSL"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435",children:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435"}),"\n",(0,r.jsx)(s.p,{children:"Follow these steps to configure K8s-authz:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"\u0421\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0439\u0442\u0435 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u044b \u0438 \u043a\u043b\u044e\u0447\u0438 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e OpenSSL. Run:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"./gen_cert.sh\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Build the Docker image from the ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/Dockerfile",children:"Dockerfile"})," manually. Update the version number in both the command and the deployment ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/718f58c46e3dbf79063b5b1c18348c2fee5de9e9/manifests/deployment.yaml#L18",children:"file"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker build -t casbin/k8s_authz:0.1 .\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Define Casbin policies in ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/config/model.conf",children:"model.conf"})," and ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/config/policy.csv",children:"policy.csv"})," files. For policy configuration details, see the ",(0,r.jsx)(s.a,{href:"/docs/how-it-works",children:"documentation"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["(Optional) Modify ports in ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/main.go",children:"main.go"})," and the validation webhook configuration ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/master/manifests/deployment.yaml",children:"file"})," according to your requirements."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Deploy the validation controller and webhook to the Kubernetes cluster:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f deployment.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["For production environments, create a Kubernetes ",(0,r.jsx)(s.code,{children:"secret"})," to secure certificates:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl create secret generic casbin -n default \\\n  --from-file=key.pem=certs/casbin-key.pem \\\n  --from-file=cert.pem=certs/casbin-crt.pem\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Update the certificate directory paths in ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/main.go#L26",children:"main.go"})," and the ",(0,r.jsx)(s.a,{href:"https://github.com/casbin/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/manifests/deployment.yaml#L22",children:"manifests"})," to reference the created ",(0,r.jsx)(s.code,{children:"secret"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"The server should now be operational, validating requests to Kubernetes resources and enforcing policies."})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453(e,s,n){n.d(s,{R:()=>o,x:()=>a});var t=n(6540);const r={},i=t.createContext(r);function o(e){const s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);