"use strict";(globalThis.webpackChunkcasbin_website_v2=globalThis.webpackChunkcasbin_website_v2||[]).push([[9597],{6663(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>g,frontMatter:()=>s,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"log-error","title":"Log & Error Handling","description":"\u041b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043e\u0448\u0438\u0431\u043e\u043a \u0432 Casbin","source":"@site/i18n/ru/docusaurus-plugin-content-docs/current/LogError.mdx","sourceDirName":".","slug":"/log-error","permalink":"/ru/docs/log-error","draft":false,"unlisted":false,"editUrl":"https://github.com/casbin/casbin-website-v2/edit/master/docs/LogError.mdx","tags":[],"version":"current","frontMatter":{"id":"log-error","title":"Log & Error Handling","description":"\u041b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043e\u0448\u0438\u0431\u043e\u043a \u0432 Casbin","keywords":["log","error","error handling"],"authors":["hsluoyz"]},"sidebar":"docs","previous":{"title":"Command-line Tools","permalink":"/ru/docs/command-line-tools"},"next":{"title":"Frontend Usage","permalink":"/ru/docs/frontend"}}');var t=r(4848),i=r(8453);const s={id:"log-error",title:"Log & Error Handling",description:"\u041b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043e\u0448\u0438\u0431\u043e\u043a \u0432 Casbin",keywords:["log","error","error handling"],authors:["hsluoyz"]},l=void 0,a={},d=[{value:"\u041b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435",id:"\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435",level:2},{value:"Configure Separate Loggers for Different Enforcers",id:"configure-separate-loggers-for-different-enforcers",level:3},{value:"Supported Loggers",id:"supported-loggers",level:4},{value:"Implementing Custom Loggers",id:"implementing-custom-loggers",level:4},{value:"Error Handling",id:"error-handling",level:2},{value:"Enabling and Disabling Enforcement",id:"enabling-and-disabling-enforcement",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components},{TabItem:r,Tabs:o}=n;return r||h("TabItem",!0),o||h("Tabs",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435",children:"\u041b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435"}),"\n",(0,t.jsxs)(n.p,{children:["By default, Casbin uses the built-in ",(0,t.jsx)(n.code,{children:"log"})," package to print messages to the console:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-log",children:"2017/07/15 19:43:56 [Request: alice, data1, read ---\x3e true]\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Logging is disabled by default. Enable it using ",(0,t.jsx)(n.code,{children:"Enforcer.EnableLog()"})," or the last parameter of ",(0,t.jsx)(n.code,{children:"NewEnforcer()"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"For Golang: Casbin supports logging models, enforcement requests, roles, and policies. You can implement custom loggers for Casbin."})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["For Python: PyCasbin uses Python's standard logging mechanism. PyCasbin calls ",(0,t.jsx)(n.code,{children:"logging.getLogger()"})," to configure its logger. No special configuration is needed beyond initializing logging in your application. If you don't initialize logging, PyCasbin will produce no log output. When enabling logs in PyCasbin, you can specify configuration through the ",(0,t.jsx)(n.code,{children:"logging_config"})," parameter. Without explicit configuration, PyCasbin uses the ",(0,t.jsx)(n.a,{href:"https://github.com/casbin/pycasbin/blob/c33cabfa0ac65cd09cf812a65e71794d64cb5132/casbin/util/log.py#L6C1-L6C1",children:"default log configuration"}),". Django users should consult the ",(0,t.jsx)(n.a,{href:"https://docs.djangoproject.com/en/4.2/topics/logging/",children:"Django logging documentation"}),". Other Python users should refer to the ",(0,t.jsx)(n.a,{href:"https://docs.python.org/3/library/logging.config.html",children:"Python logging documentation"}),"."]})}),"\n",(0,t.jsx)(n.h3,{id:"configure-separate-loggers-for-different-enforcers",children:"Configure Separate Loggers for Different Enforcers"}),"\n",(0,t.jsx)(n.p,{children:"Each enforcer can have its own logger, and loggers can be changed at runtime."}),"\n",(0,t.jsxs)(n.p,{children:["You can specify a logger using the last parameter of ",(0,t.jsx)(n.code,{children:"NewEnforcer()"}),". When using this method, the logger's enabled field takes precedence over the enforcer's enabled parameter."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"// Set a default logger as enforcer e1's logger.\n// This operation can also be seen as changing the logger of e1 at runtime.\ne1.SetLogger(&Log.DefaultLogger{})\n\n// Set another logger as enforcer e2's logger.\ne2.SetLogger(&YouOwnLogger)\n\n// Set your logger when initializing enforcer e3.\ne3, _ := casbin.NewEnforcer(\"examples/rbac_model.conf\", a, logger)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"supported-loggers",children:"Supported Loggers"}),"\n",(0,t.jsx)(n.p,{children:"Casbin provides several logger implementations:"}),"\n",(0,t.jsxs)(o,{groupId:"langs",children:[(0,t.jsx)(r,{value:"Go",label:"Go",default:!0,children:(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Logger"}),(0,t.jsx)(n.th,{children:"Author"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://github.com/casbin/casbin/blob/master/log/default_logger.go",children:"Default logger (built-in)"})}),(0,t.jsx)(n.td,{children:"Casbin"}),(0,t.jsx)(n.td,{children:"The default logger using Go's standard log package."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://github.com/casbin/zap-logger",children:"Zap logger"})}),(0,t.jsx)(n.td,{children:"Casbin"}),(0,t.jsxs)(n.td,{children:["Uses ",(0,t.jsx)(n.a,{href:"https://github.com/uber-go/zap",children:"zap"})," for JSON-encoded logs with additional customization options via zap-logger."]})]})]})]})}),(0,t.jsx)(r,{value:"PHP",label:"PHP",children:(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Logger"}),(0,t.jsx)(n.th,{children:"Author"}),(0,t.jsx)(n.th,{children:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://github.com/php-casbin/psr3-bridge",children:"psr3-bridge logger"})}),(0,t.jsx)(n.td,{children:"Casbin"}),(0,t.jsxs)(n.td,{children:["Provides a ",(0,t.jsx)(n.a,{href:"https://www.php-fig.org/psr/psr-3/",children:"PSR-3"})," compliant bridge."]})]})})]})})]}),"\n",(0,t.jsx)(n.h4,{id:"implementing-custom-loggers",children:"Implementing Custom Loggers"}),"\n",(0,t.jsxs)(n.p,{children:["Custom loggers must implement the ",(0,t.jsx)(n.a,{href:"https://github.com/casbin/casbin/blob/master/log/logger.go#L20",children:"Logger"})," interface."]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Method"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"EnableLog()"}),(0,t.jsx)(n.td,{children:"mandatory"}),(0,t.jsx)(n.td,{children:"Controls whether messages are printed."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"IsEnabled()"}),(0,t.jsx)(n.td,{children:"mandatory"}),(0,t.jsx)(n.td,{children:"Returns the current logger's enabled status."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"LogModel()"}),(0,t.jsx)(n.td,{children:"mandatory"}),(0,t.jsx)(n.td,{children:"Logs model-related information."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"LogEnforce()"}),(0,t.jsx)(n.td,{children:"mandatory"}),(0,t.jsx)(n.td,{children:"Logs enforcement-related information."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"LogRole()"}),(0,t.jsx)(n.td,{children:"mandatory"}),(0,t.jsx)(n.td,{children:"Logs role-related information."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"LogPolicy()"}),(0,t.jsx)(n.td,{children:"mandatory"}),(0,t.jsx)(n.td,{children:"Logs policy-related information."})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["Pass your custom logger to ",(0,t.jsx)(n.code,{children:"Enforcer.SetLogger()"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Here's a Go example of implementing a custom logger:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'import (\n    "fmt"\n    "log"\n    "strings"\n)\n\n// DefaultLogger is the implementation for a Logger using golang log.\ntype DefaultLogger struct {\n    enabled bool\n}\n\nfunc (l *DefaultLogger) EnableLog(enable bool) {\n    l.enabled = enable\n}\n\nfunc (l *DefaultLogger) IsEnabled() bool {\n    return l.enabled\n}\n\nfunc (l *DefaultLogger) LogModel(model [][]string) {\n    if !l.enabled {\n        return\n    }\n    var str strings.Builder\n    str.WriteString("Model: ")\n    for _, v := range model {\n        str.WriteString(fmt.Sprintf("%v\\n", v))\n    }\n\n    log.Println(str.String())\n}\n\nfunc (l *DefaultLogger) LogEnforce(matcher string, request []interface{}, result bool, explains [][]string) {\n    if !l.enabled {\n        return\n    }\n\n    var reqStr strings.Builder\n    reqStr.WriteString("Request: ")\n    for i, rval := range request {\n        if i != len(request)-1 {\n            reqStr.WriteString(fmt.Sprintf("%v, ", rval))\n        } else {\n            reqStr.WriteString(fmt.Sprintf("%v", rval))\n        }\n    }\n    reqStr.WriteString(fmt.Sprintf(" ---\x3e %t\\n", result))\n\n    reqStr.WriteString("Hit Policy: ")\n    for i, pval := range explains {\n        if i != len(explains)-1 {\n            reqStr.WriteString(fmt.Sprintf("%v, ", pval))\n        } else {\n            reqStr.WriteString(fmt.Sprintf("%v \\n", pval))\n        }\n    }\n\n    log.Println(reqStr.String())\n}\n\nfunc (l *DefaultLogger) LogPolicy(policy map[string][][]string) {\n    if !l.enabled {\n        return\n    }\n\n    var str strings.Builder\n    str.WriteString("Policy: ")\n    for k, v := range policy {\n        str.WriteString(fmt.Sprintf("%s : %v\\n", k, v))\n    }\n\n    log.Println(str.String())\n}\n\nfunc (l *DefaultLogger) LogRole(roles []string) {\n    if !l.enabled {\n        return\n    }\n\n    log.Println("Roles: ", roles)\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.p,{children:"Errors or panics can occur in Casbin for several reasons:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Invalid syntax in the model file (.conf)"}),"\n",(0,t.jsx)(n.li,{children:"Invalid syntax in the policy file (.csv)"}),"\n",(0,t.jsx)(n.li,{children:"Custom errors from storage adapters (e.g., MySQL connection failures)"}),"\n",(0,t.jsx)(n.li,{children:"Casbin bugs"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Five primary functions may produce errors or panics:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Function"}),(0,t.jsx)(n.th,{children:"Behavior on Error"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://godoc.org/github.com/casbin/casbin#NewEnforcer",children:"NewEnforcer()"})}),(0,t.jsx)(n.td,{children:"Returns an error"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://godoc.org/github.com/casbin/casbin#Enforcer.LoadModel",children:"LoadModel()"})}),(0,t.jsx)(n.td,{children:"Returns an error"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://godoc.org/github.com/casbin/casbin#Enforcer.LoadPolicy",children:"LoadPolicy()"})}),(0,t.jsx)(n.td,{children:"Returns an error"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://godoc.org/github.com/casbin/casbin#Enforcer.SavePolicy",children:"SavePolicy()"})}),(0,t.jsx)(n.td,{children:"Returns an error"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://godoc.org/github.com/casbin/casbin#Enforcer.Enforce",children:"Enforce()"})}),(0,t.jsx)(n.td,{children:"Returns an error"})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"NewEnforcer()"})," calls both ",(0,t.jsx)(n.code,{children:"LoadModel()"})," and ",(0,t.jsx)(n.code,{children:"LoadPolicy()"})," internally, so you don't need to call them separately when using ",(0,t.jsx)(n.code,{children:"NewEnforcer()"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"enabling-and-disabling-enforcement",children:"Enabling and Disabling Enforcement"}),"\n",(0,t.jsxs)(n.p,{children:["You can disable the enforcer using ",(0,t.jsx)(n.code,{children:"Enforcer.EnableEnforce()"}),". When disabled, ",(0,t.jsx)(n.code,{children:"Enforcer.Enforce()"})," always returns ",(0,t.jsx)(n.code,{children:"true"}),". Other operations like policy management remain unaffected. Example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'e := casbin.NewEnforcer("examples/basic_model.conf", "examples/basic_policy.csv")\n\n// Will return false.\n// By default, the enforcer is enabled.\ne.Enforce("non-authorized-user", "data1", "read")\n\n// Disable the enforcer at runtime.\ne.EnableEnforce(false)\n\n// Will return true for any request.\ne.Enforce("non-authorized-user", "data1", "read")\n\n// Enable the enforcer again.\ne.EnableEnforce(true)\n\n// Will return false.\ne.Enforce("non-authorized-user", "data1", "read")\n'})})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}function h(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453(e,n,r){r.d(n,{R:()=>s,x:()=>l});var o=r(6540);const t={},i=o.createContext(t);function s(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);