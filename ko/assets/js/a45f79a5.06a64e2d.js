"use strict";(self.webpackChunkcasbin_website_v2=self.webpackChunkcasbin_website_v2||[]).push([[7277],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>u});var n=a(7294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var s=n.createContext({}),o=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},c=function(e){var t=o(e.components);return n.createElement(s.Provider,{value:t},e.children)},k={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,i=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),m=o(a),u=l,d=m["".concat(s,".").concat(u)]||m[u]||k[u]||i;return a?n.createElement(d,r(r({ref:t},c),{},{components:a})):n.createElement(d,r({ref:t},c))}));function u(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=a.length,r=new Array(i);r[0]=m;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:l,r[1]=p;for(var o=2;o<i;o++)r[o]=a[o];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},3453:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>k,frontMatter:()=>i,metadata:()=>p,toc:()=>o});var n=a(7462),l=(a(7294),a(3905));const i={id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Casbin\uc744 \uae30\ubc18\uc73c\ub85c \ud55c Kubernetes (K8s) RBAC \ubc0f ABAC \uc778\uc99d \ubbf8\ub4e4\uc6e8\uc5b4",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},r=void 0,p={unversionedId:"k8s-gatekeeper",id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Casbin\uc744 \uae30\ubc18\uc73c\ub85c \ud55c Kubernetes (K8s) RBAC \ubc0f ABAC \uc778\uc99d \ubbf8\ub4e4\uc6e8\uc5b4",source:"@site/i18n/ko/docusaurus-plugin-content-docs/current/K8sGateKeeper.mdx",sourceDirName:".",slug:"/k8s-gatekeeper",permalink:"/ko/docs/k8s-gatekeeper",draft:!1,editUrl:"https://github.com/casbin/casbin-website-v2/edit/master/docs/K8sGateKeeper.mdx",tags:[],version:"current",frontMatter:{id:"k8s-gatekeeper",title:"Admission Webhook for K8s",description:"Casbin\uc744 \uae30\ubc18\uc73c\ub85c \ud55c Kubernetes (K8s) RBAC \ubc0f ABAC \uc778\uc99d \ubbf8\ub4e4\uc6e8\uc5b4",keywords:["k8s-gatekeeper","Kubernetes","K8s"],authors:["ComradeProgrammer"]},sidebar:"docs",previous:{title:"Authorization of Kubernetes",permalink:"/ko/docs/k8s"},next:{title:"Authorization of Service Mesh through Envoy",permalink:"/ko/docs/envoy"}},s={},o=[{value:"1. Casbin K8s-Gatekeeper\uc5d0 \ub300\ud55c \uac1c\uc694 \ubc0f \ubb38\uc11c",id:"1-casbin-k8s-gatekeeper\uc5d0-\ub300\ud55c-\uac1c\uc694-\ubc0f-\ubb38\uc11c",level:2},{value:"0.1 \uac04\ub2e8\ud55c \uc608\uc2dc",id:"01-\uac04\ub2e8\ud55c-\uc608\uc2dc",level:3},{value:"1.1 Casbin K8s-Gatekeeper\ub294 \uc5b4\ub5bb\uac8c \uc791\ub3d9\ud569\ub2c8\uae4c?",id:"11-casbin-k8s-gatekeeper\ub294-\uc5b4\ub5bb\uac8c-\uc791\ub3d9\ud569\ub2c8\uae4c",level:3},{value:"1.2 \uc791\ub3d9 \ubc29\uc2dd\uc744 \uc124\uba85\ud558\ub294 \uc608\uc2dc",id:"12-\uc791\ub3d9-\ubc29\uc2dd\uc744-\uc124\uba85\ud558\ub294-\uc608\uc2dc",level:3},{value:"2 K8s-gatekeeper \uc124\uce58",id:"2-k8s-gatekeeper-\uc124\uce58",level:2},{value:"2.1 \ub0b4\ubd80 \uc6f9\ud6c5",id:"21-\ub0b4\ubd80-\uc6f9\ud6c5",level:3},{value:"2.1.1 \ub2e8\uacc4 1: \uc774\ubbf8\uc9c0 \ube4c\ub4dc",id:"211-\ub2e8\uacc4-1-\uc774\ubbf8\uc9c0-\ube4c\ub4dc",level:4},{value:"2.1.2 \ub2e8\uacc4 2: K8s-gatekeeper\ub97c \uc704\ud55c \uc11c\ube44\uc2a4\uc640 \ubc30\ud3ec \uc124\uc815",id:"212-\ub2e8\uacc4-2-k8s-gatekeeper\ub97c-\uc704\ud55c-\uc11c\ube44\uc2a4\uc640-\ubc30\ud3ec-\uc124\uc815",level:4},{value:"2.1.3 \ub2e8\uacc4 3: K8s-gatekeeper\ub97c \uc704\ud55c CRD \ub9ac\uc18c\uc2a4 \uc124\uce58",id:"213-\ub2e8\uacc4-3-k8s-gatekeeper\ub97c-\uc704\ud55c-crd-\ub9ac\uc18c\uc2a4-\uc124\uce58",level:4},{value:"2.2 \uc678\ubd80 \uc6f9\ud6c5",id:"22-\uc678\ubd80-\uc6f9\ud6c5",level:3},{value:"2.3 Helm\uc744 \ud1b5\ud55c K8s-gatekeeper \uc124\uce58",id:"23-helm\uc744-\ud1b5\ud55c-k8s-gatekeeper-\uc124\uce58",level:3},{value:"2.3.1 \ub2e8\uacc4 1: \uc774\ubbf8\uc9c0 \ube4c\ub4dc",id:"231-\ub2e8\uacc4-1-\uc774\ubbf8\uc9c0-\ube4c\ub4dc",level:4},{value:"2.3.2 Helm \uc124\uce58",id:"232-helm-\uc124\uce58",level:4},{value:"3. K8s-gatekeeper \uc2dc\ub3c4\ud558\uae30",id:"3-k8s-gatekeeper-\uc2dc\ub3c4\ud558\uae30",level:2},{value:"3.1 Casbin \ubaa8\ub378 \ubc0f \uc815\ucc45 \uc0dd\uc131",id:"31-casbin-\ubaa8\ub378-\ubc0f-\uc815\ucc45-\uc0dd\uc131",level:3},{value:"3.1.1 kubectl\uc744 \ud1b5\ud55c Casbin \ubaa8\ub378 \ubc0f \uc815\ucc45 \uc0dd\uc131/\uc5c5\ub370\uc774\ud2b8",id:"311-kubectl\uc744-\ud1b5\ud55c-casbin-\ubaa8\ub378-\ubc0f-\uc815\ucc45-\uc0dd\uc131\uc5c5\ub370\uc774\ud2b8",level:4},{value:"3.1.2 \uc6b0\ub9ac\uac00 \uc81c\uacf5\ud558\ub294 go-client\ub97c \ud1b5\ud574 Casbin \ubaa8\ub378\uacfc \uc815\ucc45 \uc0dd\uc131/\uc5c5\ub370\uc774\ud2b8",id:"312-\uc6b0\ub9ac\uac00-\uc81c\uacf5\ud558\ub294-go-client\ub97c-\ud1b5\ud574-casbin-\ubaa8\ub378\uacfc-\uc815\ucc45-\uc0dd\uc131\uc5c5\ub370\uc774\ud2b8",level:4},{value:"3.1.2 K8s-gatekeeper \uc791\ub3d9 \uc5ec\ubd80 \ud655\uc778",id:"312-k8s-gatekeeper-\uc791\ub3d9-\uc5ec\ubd80-\ud655\uc778",level:3},{value:"4. K8s-gatekeeper\ub85c \ubaa8\ub378\uacfc \uc815\ucc45 \uc791\uc131 \ubc29\ubc95",id:"4-k8s-gatekeeper\ub85c-\ubaa8\ub378\uacfc-\uc815\ucc45-\uc791\uc131-\ubc29\ubc95",level:2},{value:"4.1 \ubaa8\ub378\uc758 \uc694\uccad \uc815\uc758",id:"41-\ubaa8\ub378\uc758-\uc694\uccad-\uc815\uc758",level:3},{value:"4.2 \ubaa8\ub378\uc758 Matchers",id:"42-\ubaa8\ub378\uc758-matchers",level:3},{value:"4.2.1 \ud655\uc7a5 \ud568\uc218",id:"421-\ud655\uc7a5-\ud568\uc218",level:3},{value:"4.2.1.1 \uc811\uadfc",id:"4211-\uc811\uadfc",level:4},{value:"4.2.1.2 accessWithWildcard",id:"4212-accesswithwildcard",level:4},{value:"4.2.1.3 \uac00\ubcc0 \uae38\uc774 \uc778\uc218\ub97c \uc9c0\uc6d0\ud558\ub294 \ud568\uc218",id:"4213-\uac00\ubcc0-\uae38\uc774-\uc778\uc218\ub97c-\uc9c0\uc6d0\ud558\ub294-\ud568\uc218",level:3},{value:"4.2.1.2 \ud0c0\uc785 \ubcc0\ud658 \ud568\uc218\ub4e4",id:"4212-\ud0c0\uc785-\ubcc0\ud658-\ud568\uc218\ub4e4",level:4},{value:"5. \uace0\uae09 \uc124\uc815",id:"5-\uace0\uae09-\uc124\uc815",level:2},{value:"5.1 \uc778\uc99d\uc11c\uc5d0 \ub300\ud558\uc5ec",id:"51-\uc778\uc99d\uc11c\uc5d0-\ub300\ud558\uc5ec",level:3},{value:"5.1.1 \uc790\uccb4 \uc11c\uba85 \uc778\uc99d\uc11c",id:"511-\uc790\uccb4-\uc11c\uba85-\uc778\uc99d\uc11c",level:4},{value:"5.1.2 \ubc95\uc801 \uc778\uc99d\uc11c",id:"512-\ubc95\uc801-\uc778\uc99d\uc11c",level:4}],c={toc:o};function k(e){let{components:t,...a}=e;return(0,l.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"1-casbin-k8s-gatekeeper\uc5d0-\ub300\ud55c-\uac1c\uc694-\ubc0f-\ubb38\uc11c"},"1. Casbin K8s-Gatekeeper\uc5d0 \ub300\ud55c \uac1c\uc694 \ubc0f \ubb38\uc11c"),(0,l.kt)("p",null,"Casbin K8s-GateKeeper\ub294 Casbin\uc744 \uc561\uc138\uc2a4 \uc81c\uc5b4 \ub3c4\uad6c\ub85c \ud1b5\ud569\ud558\ub294 Kubernetes \uc785\uc7a5 \uc6f9\ud6c5\uc785\ub2c8\ub2e4. Casbin K8s-GateKeeper\ub97c \uc0ac\uc6a9\ud558\uba74, \uc5b4\ub5a4 \ucf54\ub4dc\ub3c4 \uc791\uc131\ud558\uc9c0 \uc54a\uace0, Casbin \ubaa8\ub378\uacfc \uc815\ucc45\uc758 \uc120\uc5b8\uc801\uc778 \uc124\uc815 \uba87 \uc904\ub9cc\uc73c\ub85c K8s \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud55c \ubaa8\ub4e0 \uc791\uc5c5\uc744 \uc778\uc99d\ud558\uac70\ub098 \ucc28\ub2e8\ud558\ub294 \uc720\uc5f0\ud55c \uaddc\uce59\uc744 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 Casbin ACL (Access Control List) \uc5b8\uc5b4\uc758 \uc77c\ubd80\uc785\ub2c8\ub2e4."),(0,l.kt)("p",null,"Casbin K8s-GateKeeper\ub294 Casbin \ucee4\ubba4\ub2c8\ud2f0\uc5d0 \uc758\ud574 \uac1c\ubc1c\ub418\uace0 \uc720\uc9c0 \uad00\ub9ac\ub429\ub2c8\ub2e4. \uc774 \ud504\ub85c\uc81d\ud2b8\uc758 \uc800\uc7a5\uc18c\ub294 \ub2e4\uc74c \uc704\uce58\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/casbin/k8s-gatekeeper"},"https://github.com/casbin/k8s-gatekeeper")),(0,l.kt)("h3",{id:"01-\uac04\ub2e8\ud55c-\uc608\uc2dc"},"0.1 \uac04\ub2e8\ud55c \uc608\uc2dc"),(0,l.kt)("p",null,'\uc608\ub97c \ub4e4\uc5b4, \uc5b4\ub5a4 \ucf54\ub4dc\ub3c4 \uc791\uc131\ud560 \ud544\uc694 \uc5c6\uc774 \ub2e4\uc74c\uacfc \uac19\uc740 \uc124\uc815 \uc904\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc774 \uae30\ub2a5\uc744 \ub2ec\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4: "\ud2b9\uc815 \ud0dc\uadf8\uac00 \uc788\ub294 \uc774\ubbf8\uc9c0\uac00 \uc5b4\ub5a4 \ubc30\ud3ec\uc5d0\uc11c\ub3c4 \uc0ac\uc6a9\ub418\ub294 \uac83\uc744 \uae08\uc9c0\ud569\ub2c8\ub2e4":'),(0,l.kt)("p",null,"Model:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\ncontain(split(accessWithWildcard(${OBJECT}.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,l.kt)("p",null,"And Policy:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csv"},'p, "1.14.1",deny\n')),(0,l.kt)("p",null,"\uc774\ub4e4\uc740 \uc77c\ubc18\uc801\uc778 Casbin ACL \uc5b8\uc5b4\uc5d0 \uc788\uc2b5\ub2c8\ub2e4. \uc774\uc5d0 \ub300\ud55c \uc7a5\uc744 \uc774\ubbf8 \uc77d\uc5c8\ub2e4\uba74 \uc774\ud574\ud558\uae30 \ub9e4\uc6b0 \uc26c\uc6b8 \uac83\uc785\ub2c8\ub2e4."),(0,l.kt)("p",null,"Casbin K8s-Gatekeeper\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 \uc7a5\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\uc0ac\uc6a9\ud558\uae30 \uc27d\uc2b5\ub2c8\ub2e4. \ub9ce\uc740 \ucf54\ub4dc\ub97c \uc791\uc131\ud558\ub294 \uac83\ubcf4\ub2e4 \uba87 \uc904\uc758 ACL\uc744 \uc791\uc131\ud558\ub294 \uac83\uc774 \ud6e8\uc52c \ub0ab\uc2b5\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"\uc124\uc815\uc758 \ud56b \uc5c5\ub370\uc774\ud2b8\ub97c \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \uc124\uc815\uc744 \uc218\uc815\ud558\uae30 \uc704\ud574 \uc804\uccb4 \ud50c\ub7ec\uadf8\uc778\uc744 \uc885\ub8cc\ud560 \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"\uc720\uc5f0\ud569\ub2c8\ub2e4. ",(0,l.kt)("inlineCode",{parentName:"li"},"kubectl gatekeeper"),"\ub85c \ud0d0\uc0c9\ud560 \uc218 \uc788\ub294 \uc5b4\ub5a4 K8s \ub9ac\uc18c\uc2a4\uc5d0\ub3c4 \uc784\uc758\uc758 \uaddc\uce59\uc744 \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"K8s \uc785\uc7a5 \uc6f9\ud6c5\uc758 \uad6c\ud604\uc744 \ub2e8\uc21c\ud654\ud569\ub2c8\ub2e4. \uc774\ub294 \ub9e4\uc6b0 \ubcf5\uc7a1\ud569\ub2c8\ub2e4. K8s \uc785\uc7a5 \uc6f9\ud6c5\uc774 \ubb34\uc5c7\uc778\uc9c0 \ub610\ub294 \uc5b4\ub5bb\uac8c \ucf54\ub4dc\ub97c \uc791\uc131\ud558\ub294\uc9c0 \uc54c \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \uc81c\uc57d\uc744 \ub450\uace0 \uc2f6\uc740 \ub9ac\uc18c\uc2a4\ub97c \uc54c\uace0 Casbin ACL\uc744 \uc791\uc131\ud558\ub294 \uac83\uc774 \uc804\ubd80\uc785\ub2c8\ub2e4. \ubaa8\ub450\uac00 K8s\uac00 \ubcf5\uc7a1\ud558\ub2e4\ub294 \uac83\uc744 \uc54c\uace0 \uc788\uc9c0\ub9cc, Casbin K8s-Gatekeeper\ub97c \uc0ac\uc6a9\ud558\uba74 \uc2dc\uac04\uc744 \uc808\uc57d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"Casbin \ucee4\ubba4\ub2c8\ud2f0\uc5d0\uc11c \uc720\uc9c0 \uad00\ub9ac\ub429\ub2c8\ub2e4. \uc774 \ud50c\ub7ec\uadf8\uc778\uc5d0 \ub300\ud574 \ud63c\ub780\uc2a4\ub7ec\uc6b4 \uac83\uc774 \uc788\uac70\ub098 \uc774\uac83\uc744 \uc2dc\ub3c4\ud558\uba74\uc11c \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74 \uc5b8\uc81c\ub4e0\uc9c0 \uc800\ud76c\uc5d0\uac8c \uc5f0\ub77d\ud558\uc2ed\uc2dc\uc624.")),(0,l.kt)("h3",{id:"11-casbin-k8s-gatekeeper\ub294-\uc5b4\ub5bb\uac8c-\uc791\ub3d9\ud569\ub2c8\uae4c"},"1.1 Casbin K8s-Gatekeeper\ub294 \uc5b4\ub5bb\uac8c \uc791\ub3d9\ud569\ub2c8\uae4c?"),(0,l.kt)("p",null,"K8s-Gatekeeper\ub294 \uad00\ub9ac\uc790\uac00 \uc6d0\ud558\uc9c0 \uc54a\ub294 K8s\uc5d0\uc11c\uc758 \ubaa8\ub4e0 \uc791\uc5c5\uc744 \ubc29\uc9c0\ud558\uae30 \uc704\ud574 ",(0,l.kt)("a",{parentName:"p",href:"/docs/overview"},"Casbin"),"\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc784\uc758\uc758 \uc0ac\uc6a9\uc790 \uc815\uc758 \uc561\uc138\uc2a4 \uc81c\uc5b4 \uaddc\uce59\uc744 \uc801\uc6a9\ud558\ub294 K8s\uc758 \uc785\uc7a5 \uc6f9\ud6c5\uc785\ub2c8\ub2e4."),(0,l.kt)("p",null,"Casbin\uc740 \uac15\ub825\ud558\uace0 \ud6a8\uc728\uc801\uc778 \uc624\ud508 \uc18c\uc2a4 \uc561\uc138\uc2a4 \uc81c\uc5b4 \ub77c\uc774\ube0c\ub7ec\ub9ac\uc785\ub2c8\ub2e4. \ub2e4\uc591\ud55c \uc561\uc138\uc2a4 \uc81c\uc5b4 \ubaa8\ub378\uc5d0 \uae30\ubc18\ud55c \uc778\uc99d\uc744 \uac15\uc81c\ud558\ub294 \uc9c0\uc6d0\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. Casbin\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ",(0,l.kt)("a",{parentName:"p",href:"/docs/overview"},"\uac1c\uc694"),"\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624."),(0,l.kt)("p",null,"K8s\uc758 \uc785\uc7a5 \uc6f9\ud6c5\uc740 '\uc785\uc7a5 \uc694\uccad'\uc744 \ubc1b\uc544\uc11c \ubb34\uc5b8\uac00\ub97c \ud558\ub294 HTTP \ucf5c\ubc31\uc785\ub2c8\ub2e4. \ud2b9\ud788, K8s-Gatekeeper\ub294 'ValidatingAdmissionWebhook'\uc774\ub77c\ub294 \ud2b9\ubcc4\ud55c \uc720\ud615\uc758 \uc785\ud559 \uc6f9\ud6c5\uc785\ub2c8\ub2e4. \uc774 \uc6f9\ud6c5\uc740 \uc774 \uc785\ud559 \uc694\uccad\uc744 \uc218\ub77d\ud560\uc9c0 \uac70\ubd80\ud560\uc9c0 \uacb0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc785\ud559 \uc694\uccad\uc5d0 \ub300\ud574 \ub9d0\ud558\uc790\uba74, \uc774\ub4e4\uc740 K8s\uc758 \uc9c0\uc815\ub41c \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud55c \uc791\uc5c5\uc744 \uc124\uba85\ud558\ub294 HTTP \uc694\uccad\uc785\ub2c8\ub2e4(\uc608: \ubc30\ud3ec \uc0dd\uc131/\uc0ad\uc81c). \uc785\ud559 \uc6f9\ud6c5\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ",(0,l.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks"},"K8s \uacf5\uc2dd \ubb38\uc11c"),"\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624."),(0,l.kt)("h3",{id:"12-\uc791\ub3d9-\ubc29\uc2dd\uc744-\uc124\uba85\ud558\ub294-\uc608\uc2dc"},"1.2 \uc791\ub3d9 \ubc29\uc2dd\uc744 \uc124\uba85\ud558\ub294 \uc608\uc2dc"),(0,l.kt)("p",null,"\uc608\ub97c \ub4e4\uc5b4, \ub204\uad70\uac00 nginx\ub97c \uc2e4\ud589\ud558\ub294 \ud30c\ub4dc\ub97c \ud3ec\ud568\ud558\ub294 \ubc30\ud3ec\ub97c \uc0dd\uc131\ud558\ub824\uace0 \ud560 \ub54c(kubectl \ub610\ub294 K8s \ud074\ub77c\uc774\uc5b8\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec), K8s\ub294 \uc785\ud559 \uc694\uccad\uc744 \uc0dd\uc131\ud558\uba70, \uc774\ub294 (YAML \ud615\uc2dd\uc73c\ub85c \ubc88\uc5ed\ub41c\ub2e4\uba74) \ub2e4\uc74c\uacfc \uac19\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.14.1\n        ports:\n        - containerPort: 80\n")),(0,l.kt)("p",null,"\uc774 \uc694\uccad\uc740 \uadf8\ub9bc\uc5d0 \ud45c\uc2dc\ub41c \ubaa8\ub4e0 \ubbf8\ub4e4\uc6e8\uc5b4\uc758 \uacfc\uc815\uc744 \uac70\uce58\uac8c \ub420 \uac83\uc774\uba70, \uc774\uc5d0\ub294 \uc6b0\ub9ac\uc758 K8s-Gatekeeper\uac00 \ud3ec\ud568\ub429\ub2c8\ub2e4. K8s-Gatekeeper\ub294 \uc0ac\uc6a9\uc790\uac00 \uc0dd\uc131\ud558\uace0 \uc720\uc9c0\ud558\ub294 K8s\uc758 etcd\uc5d0 \uc800\uc7a5\ub41c \ubaa8\ub4e0 Casbin enforcer\ub97c \uac10\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4(",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," \ub610\ub294 \uc6b0\ub9ac\uac00 \uc81c\uacf5\ud558\ub294 Go \ud074\ub77c\uc774\uc5b8\ud2b8\ub97c \ud1b5\ud574). \uac01 enforcer\ub294 Casbin \ubaa8\ub378\uacfc Casbin \uc815\ucc45\uc744 \ud3ec\ud568\ud569\ub2c8\ub2e4. \uc785\ud559 \uc694\uccad\uc740 \uac01 enforcer\uc5d0 \uc758\ud574 \ud558\ub098\uc529 \ucc98\ub9ac\ub418\uba70, \ubaa8\ub4e0 enforcer\ub97c \ud1b5\uacfc\ud574\uc57c\ub9cc \uc774 K8s-Gatekeeper\uc5d0 \uc758\ud574 \uc694\uccad\uc774 \uc218\ub77d\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"(Casbin enforcer, \ubaa8\ub378, \ub610\ub294 \uc815\ucc45\uc774 \ubb34\uc5c7\uc778\uc9c0 \uc774\ud574\ud558\uc9c0 \ubabb\ud55c\ub2e4\uba74, \uc774 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624: ",(0,l.kt)("a",{parentName:"p",href:"/docs/get-started"},"\uc2dc\uc791\ud558\uae30"),")."),(0,l.kt)("p",null,"\uc608\ub97c \ub4e4\uc5b4, \uc5b4\ub5a4 \uc774\uc720\ub85c \uad00\ub9ac\uc790\ub294 'nginx:1.14.1' \uc774\ubbf8\uc9c0\uc758 \ucd9c\ud604\uc744 \uae08\uc9c0\ud558\uba74\uc11c 'nginx:1.3.1'\uc744 \ud5c8\uc6a9\ud558\ub824\uace0 \ud569\ub2c8\ub2e4. \ub2e4\uc74c \uaddc\uce59\uacfc \uc815\ucc45\uc744 \ud3ec\ud568\ud558\ub294 enforcer\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4(\uc6b0\ub9ac\ub294 \ub2e4\uc74c \uc7a5\uc5d0\uc11c enforcer\ub97c \uc0dd\uc131\ud558\ub294 \ubc29\ubc95, \uc774\ub4e4 \ubaa8\ub378\uacfc \uc815\ucc45\uc774 \ubb34\uc5c7\uc778\uc9c0, \uadf8\ub9ac\uace0 \uc5b4\ub5bb\uac8c \uc791\uc131\ud558\ub294\uc9c0 \uc124\uba85\ud560 \uac83\uc785\ub2c8\ub2e4)."),(0,l.kt)("p",null,"Model:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[request_definition]\nr =  obj\n\n[policy_definition]\np =  obj,eft\n\n[policy_effect]\ne = !some(where (p.eft == deny))\n\n[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n\n')),(0,l.kt)("p",null,"Policy:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csv"},'p, "nginx:1.13.1",allow\np, "nginx:1.14.1",deny\n')),(0,l.kt)("p",null,"\uc704\uc758 \ubaa8\ub378\uacfc \uc815\ucc45\uc744 \ud3ec\ud568\ud558\ub294 enforcer\ub97c \uc0dd\uc131\ud568\uc73c\ub85c\uc368, \uc774\uc804\uc758 \uc785\ud559 \uc694\uccad\uc740 \uc774 enforcer\uc5d0 \uc758\ud574 \uac70\ubd80\ub418\uba70, \uc774\ub294 K8s\uac00 \uc774 \ubc30\ud3ec\ub97c \uc0dd\uc131\ud558\uc9c0 \uc54a\uc744 \uac83\uc784\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4."),(0,l.kt)("h2",{id:"2-k8s-gatekeeper-\uc124\uce58"},"2 K8s-gatekeeper \uc124\uce58"),(0,l.kt)("p",null,"K8s-gatekeeper\ub97c \uc124\uce58\ud558\ub294 \ub370\ub294 \uc138 \uac00\uc9c0 \ubc29\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4: \uc678\ubd80 \uc6f9\ud6c5, \ub0b4\ubd80 \uc6f9\ud6c5, \uadf8\ub9ac\uace0 Helm."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"\ucc38\uace0: \uc774\ub7ec\ud55c \ubc29\ubc95\ub4e4\uc740 \uc0ac\uc6a9\uc790\uac00 K8s-gatekeeper\ub97c \uc2dc\ud5d8\ud574 \ubcf4\uae30 \uc704\ud55c \uac83\uc774\uba70, \uc548\uc804\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc0dd\uc0b0 \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub824\uba74, \uc124\uce58 \uc804\uc5d0 \ubc18\ub4dc\uc2dc ",(0,l.kt)("a",{parentName:"p",href:"#5-advanced-settings"},"5\uc7a5. \uace0\uae09 \uc124\uc815"),"\uc744 \uc77d\uace0 \ud544\uc694\ud55c \uc218\uc815\uc744 \ud558\uc2ed\uc2dc\uc624.")),(0,l.kt)("h3",{id:"21-\ub0b4\ubd80-\uc6f9\ud6c5"},"2.1 \ub0b4\ubd80 \uc6f9\ud6c5"),(0,l.kt)("h4",{id:"211-\ub2e8\uacc4-1-\uc774\ubbf8\uc9c0-\ube4c\ub4dc"},"2.1.1 \ub2e8\uacc4 1: \uc774\ubbf8\uc9c0 \ube4c\ub4dc"),(0,l.kt)("p",null,"\ub0b4\ubd80 \uc6f9\ud6c5 \ubc29\ubc95\uc758 \uacbd\uc6b0, \uc6f9\ud6c5 \uc790\uccb4\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub0b4\uc758 \uc11c\ube44\uc2a4\ub85c \uad6c\ud604\ub429\ub2c8\ub2e4. \ud544\uc694\ud55c \uc11c\ube44\uc2a4\uc640 \ubc30\ud3ec\ub97c \uc0dd\uc131\ud558\ub824\uba74, K8s-gatekeeper\uc758 \uc774\ubbf8\uc9c0\ub97c \ube4c\ub4dc\ud574\uc57c \ud569\ub2c8\ub2e4. \ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud558\uc5ec \uc790\uc2e0\uc758 \uc774\ubbf8\uc9c0\ub97c \ube4c\ub4dc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"docker build --target webhook -t k8s-gatekeeper .\n")),(0,l.kt)("p",null,"\uc774 \uba85\ub839\uc740 'k8s-gatekeeper:latest'\ub77c\ub294 \ub85c\uceec \uc774\ubbf8\uc9c0\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"\ucc38\uace0: minikube\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0, 'docker build'\ub97c \uc2e4\ud589\ud558\uae30 \uc804\uc5d0 ",(0,l.kt)("inlineCode",{parentName:"p"},"eval $(minikube -p minikube docker-env)"),"\ub97c \uc2e4\ud589\ud558\uc2ed\uc2dc\uc624.")),(0,l.kt)("h4",{id:"212-\ub2e8\uacc4-2-k8s-gatekeeper\ub97c-\uc704\ud55c-\uc11c\ube44\uc2a4\uc640-\ubc30\ud3ec-\uc124\uc815"},"2.1.2 \ub2e8\uacc4 2: K8s-gatekeeper\ub97c \uc704\ud55c \uc11c\ube44\uc2a4\uc640 \ubc30\ud3ec \uc124\uc815"),(0,l.kt)("p",null,"\ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud558\uc2ed\uc2dc\uc624:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/rbac.yaml\nkubectl apply -f config/webhook_deployment.yaml \nkubectl apply -f config/webhook_internal.yaml \n")),(0,l.kt)("p",null,"\uc774\ub807\uac8c \ud558\uba74 K8s-gatekeeper\uac00 \uc2e4\ud589\uc744 \uc2dc\uc791\ud558\uba70, ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl get pods"),"\ub97c \uc2e4\ud589\ud558\uc5ec \uc774\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("h4",{id:"213-\ub2e8\uacc4-3-k8s-gatekeeper\ub97c-\uc704\ud55c-crd-\ub9ac\uc18c\uc2a4-\uc124\uce58"},"2.1.3 \ub2e8\uacc4 3: K8s-gatekeeper\ub97c \uc704\ud55c CRD \ub9ac\uc18c\uc2a4 \uc124\uce58"),(0,l.kt)("p",null,"\ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud558\uc2ed\uc2dc\uc624:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\n")),(0,l.kt)("h3",{id:"22-\uc678\ubd80-\uc6f9\ud6c5"},"2.2 \uc678\ubd80 \uc6f9\ud6c5"),(0,l.kt)("p",null,"\uc678\ubd80 \uc6f9\ud6c5 \ubc29\ubc95\uc5d0 \ub300\ud574, K8s-gatekeeper\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc678\ubd80\uc5d0\uc11c \uc2e4\ud589\ub418\uba70, \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uc77c\ubc18 \uc6f9\uc0ac\uc774\ud2b8\uc5d0 \uc811\uadfc\ud558\ub294 \uac83\ucc98\ub7fc K8s-gatekeeper\uc5d0 \uc811\uadfc\ud560 \uac83\uc785\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 admission \uc6f9\ud6c5\uc774 \ubc18\ub4dc\uc2dc HTTPS\uc5ec\uc57c \ud55c\ub2e4\ub294 \ud544\uc218 \uc694\uad6c\uc0ac\ud56d\uc744 \uac00\uc9c0\uace0 \uc788\uc2b5\ub2c8\ub2e4. K8s-gatekeeper\ub97c \uc2dc\ud5d8\ud574 \ubcf4\uae30 \uc704\ud55c \ubaa9\uc801\uc73c\ub85c, \uc6b0\ub9ac\ub294 \uc77c\ub828\uc758 \uc778\uc99d\uc11c\uc640 \uac1c\uc778 \ud0a4\ub97c \uc81c\uacf5\ud558\uc600\uc2b5\ub2c8\ub2e4(\ube44\ub85d \uc774\uac83\uc774 \uc548\uc804\ud558\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4). \uc790\uc2e0\uc758 \uc778\uc99d\uc11c\ub97c \uc0ac\uc6a9\ud558\ub824\uba74, \uc778\uc99d\uc11c\uc640 \uac1c\uc778 \ud0a4\ub97c \uc870\uc815\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \uc9c0\uce68\uc744 \uc704\ud574 ",(0,l.kt)("a",{parentName:"p",href:"#5-advanced-settings"},"5\uc7a5\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624. \uace0\uae09 \uc124\uc815"),"."),(0,l.kt)("p",null,"\uc6b0\ub9ac\uac00 \uc81c\uacf5\ud558\ub294 \uc778\uc99d\uc11c\ub294 'webhook.domain.local'\uc5d0 \ub300\ud574 \ubc1c\uae09\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uadf8\ub798\uc11c, \ud638\uc2a4\ud2b8\ub97c \uc218\uc815\ud558\uc2ed\uc2dc\uc624(\uc608: /etc/hosts) \uadf8\ub9ac\uace0 'webhook.domain.local'\uc744 K8s-gatekeeper\uac00 \uc2e4\ud589 \uc911\uc778 IP \uc8fc\uc18c\ub85c \uc9c0\uc815\ud558\uc2ed\uc2dc\uc624."),(0,l.kt)("p",null,"\uadf8\ub7f0 \ub2e4\uc74c \ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud558\uc2ed\uc2dc\uc624:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"go mod tidy\ngo mod vendor\ngo run cmd/webhook/main.go\nkubectl apply -f config/auth.casbin.org_casbinmodels.yaml \nkubectl apply -f config/auth.casbin.org_casbinpolicies.yaml\nkubectl apply -f config/webhook_external.yaml \n")),(0,l.kt)("h3",{id:"23-helm\uc744-\ud1b5\ud55c-k8s-gatekeeper-\uc124\uce58"},"2.3 Helm\uc744 \ud1b5\ud55c K8s-gatekeeper \uc124\uce58"),(0,l.kt)("h4",{id:"231-\ub2e8\uacc4-1-\uc774\ubbf8\uc9c0-\ube4c\ub4dc"},"2.3.1 \ub2e8\uacc4 1: \uc774\ubbf8\uc9c0 \ube4c\ub4dc"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"#211-step-1-build-the-image"},"2.1.1\uc7a5"),"\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624."),(0,l.kt)("h4",{id:"232-helm-\uc124\uce58"},"2.3.2 Helm \uc124\uce58"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"helm install k8sgatekeeper ./k8sgatekeeper")," \uba85\ub839\uc744 \uc2e4\ud589\ud558\uc2ed\uc2dc\uc624."),(0,l.kt)("h2",{id:"3-k8s-gatekeeper-\uc2dc\ub3c4\ud558\uae30"},"3. K8s-gatekeeper \uc2dc\ub3c4\ud558\uae30"),(0,l.kt)("h3",{id:"31-casbin-\ubaa8\ub378-\ubc0f-\uc815\ucc45-\uc0dd\uc131"},"3.1 Casbin \ubaa8\ub378 \ubc0f \uc815\ucc45 \uc0dd\uc131"),(0,l.kt)("p",null,"\ubaa8\ub378\uacfc \uc815\ucc45\uc744 \uc0dd\uc131\ud558\ub294 \ub450 \uac00\uc9c0 \ubc29\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4: kubectl\uc744 \ud1b5\ud574 \ub610\ub294 \uc6b0\ub9ac\uac00 \uc81c\uacf5\ud558\ub294 go-client\ub97c \ud1b5\ud574."),(0,l.kt)("h4",{id:"311-kubectl\uc744-\ud1b5\ud55c-casbin-\ubaa8\ub378-\ubc0f-\uc815\ucc45-\uc0dd\uc131\uc5c5\ub370\uc774\ud2b8"},"3.1.1 kubectl\uc744 \ud1b5\ud55c Casbin \ubaa8\ub378 \ubc0f \uc815\ucc45 \uc0dd\uc131/\uc5c5\ub370\uc774\ud2b8"),(0,l.kt)("p",null,"K8s-gatekeeper\uc5d0\uc11c, Casbin \ubaa8\ub378\uc740 'CasbinModel'\uc774\ub77c\ub294 CRD \ub9ac\uc18c\uc2a4\uc5d0 \uc800\uc7a5\ub429\ub2c8\ub2e4. \uadf8 \uc815\uc758\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinmodels.yaml"),"\uc5d0 \uc704\uce58\ud574 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml"),"\uc5d0 \uc608\uc2dc\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c \ud544\ub4dc\uc5d0 \uc8fc\uc758\ud558\uc2ed\uc2dc\uc624:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"metadata.name: \ubaa8\ub378\uc758 \uc774\ub984\uc785\ub2c8\ub2e4. \uc774 \uc774\ub984\uc740 \ubc18\ub4dc\uc2dc \uc774 \ubaa8\ub378\uacfc \uad00\ub828\ub41c CasbinPolicy \uac1d\uccb4\uc758 \uc774\ub984\uacfc \ub3d9\uc77c\ud574\uc57c \ud558\ubbc0\ub85c, K8s-gatekeeper\uac00 \uadf8\ub4e4\uc744 \uc9dd\uc9c0\uc5b4 enforcer\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},'spec.enable: \uc774 \ud544\ub4dc\uac00 "false"\ub85c \uc124\uc815\ub418\uba74, \uc774 \ubaa8\ub378(\uadf8\ub9ac\uace0 \uc774 \ubaa8\ub378\uacfc \uad00\ub828\ub41c CasbinPolicy \uac1d\uccb4)\uc740 \ubb34\uc2dc\ub420 \uac83\uc785\ub2c8\ub2e4.'),(0,l.kt)("li",{parentName:"ul"},"spec.modelText: Casbin \ubaa8\ub378\uc758 \ubaa8\ub378 \ud14d\uc2a4\ud2b8\ub97c \ud3ec\ud568\ud558\ub294 \ubb38\uc790\uc5f4\uc785\ub2c8\ub2e4.")),(0,l.kt)("p",null,"Casbin \uc815\ucc45\uc740 'CasbinPolicy'\ub77c\ub294 \ub2e4\ub978 CRD \ub9ac\uc18c\uc2a4\uc5d0 \uc800\uc7a5\ub418\uba70, \uadf8 \uc815\uc758\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/auth.casbin.org_casbinpolicies.yaml"),"\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/policy.yaml"),"\uc5d0 \uc608\uc2dc\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c \ud544\ub4dc\uc5d0 \uc8fc\uc758\ud558\uc2ed\uc2dc\uc624:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"metadata.name: \uc815\ucc45\uc758 \uc774\ub984\uc785\ub2c8\ub2e4. \uc774 \uc774\ub984\uc740 \uc774 \uc815\ucc45\uacfc \uad00\ub828\ub41c CasbinModel \uac1d\uccb4\uc758 \uc774\ub984\uacfc \ub3d9\uc77c\ud574\uc57c \ud558\ubbc0\ub85c, K8s-gatekeeper\uac00 \uadf8\ub4e4\uc744 \uc9dd\uc9c0\uc5b4 enforcer\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"spec.policyItem: Casbin \ubaa8\ub378\uc758 \uc815\ucc45 \ud14d\uc2a4\ud2b8\ub97c \ud3ec\ud568\ud558\ub294 \ubb38\uc790\uc5f4\uc785\ub2c8\ub2e4.")),(0,l.kt)("p",null,"\uc790\uc2e0\uc758 CasbinModel\uacfc CasbinPolicy \ud30c\uc77c\uc744 \uc0dd\uc131\ud55c \ud6c4, \ub2e4\uc74c \uba85\ub839\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc801\uc6a9\ud558\uc2ed\uc2dc\uc624:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f <filename>\n")),(0,l.kt)("p",null,"CasbinModel\uacfc CasbinPolicy\uc758 \uc30d\uc774 \uc0dd\uc131\ub418\uba74, K8s-gatekeeper\ub294 5\ucd08 \uc774\ub0b4\uc5d0 \uc774\ub97c \uac10\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("h4",{id:"312-\uc6b0\ub9ac\uac00-\uc81c\uacf5\ud558\ub294-go-client\ub97c-\ud1b5\ud574-casbin-\ubaa8\ub378\uacfc-\uc815\ucc45-\uc0dd\uc131\uc5c5\ub370\uc774\ud2b8"},"3.1.2 \uc6b0\ub9ac\uac00 \uc81c\uacf5\ud558\ub294 go-client\ub97c \ud1b5\ud574 Casbin \ubaa8\ub378\uacfc \uc815\ucc45 \uc0dd\uc131/\uc5c5\ub370\uc774\ud2b8"),(0,l.kt)("p",null,"K8s \ud074\ub7ec\uc2a4\ud130\uc758 \ub178\ub4dc\uc5d0\uc11c \uc9c1\uc811 \uba85\ub839\uc744 \uc2e4\ud589\ud558\ub294 \ub370 \uc258\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \ud3b8\ub9ac\ud558\uc9c0 \uc54a\uc740 \uc0c1\ud669\uc774 \uc788\uc744 \uc218 \uc788\uc74c\uc744 \uc774\ud574\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, \ud68c\uc0ac\uc758 \uc790\ub3d9 \ud074\ub77c\uc6b0\ub4dc \ud50c\ub7ab\ud3fc\uc744 \uad6c\ucd95\ud560 \ub54c\uc785\ub2c8\ub2e4. \ub530\ub77c\uc11c, \uc6b0\ub9ac\ub294 CasbinModel\uacfc CasbinPolicy\ub97c \uc0dd\uc131\ud558\uace0 \uc720\uc9c0\ud558\uae30 \uc704\ud55c go-client\ub97c \uac1c\ubc1c\ud588\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"go-client \ub77c\uc774\ube0c\ub7ec\ub9ac\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"pkg/client"),"\uc5d0 \uc704\uce58\ud574 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"client.go"),"\uc5d0\uc11c\ub294 \ud074\ub77c\uc774\uc5b8\ud2b8\ub97c \uc0dd\uc131\ud558\ub294 \ud568\uc218\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"func NewK8sGateKeeperClient(externalClient bool) (*K8sGateKeeperClient, error) \n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"externalClient")," \ub9e4\uac1c\ubcc0\uc218\ub294 K8s-gatekeeper\uac00 K8s \ud074\ub7ec\uc2a4\ud130 \ub0b4\ubd80\uc5d0\uc11c \uc2e4\ud589\ub418\uace0 \uc788\ub294\uc9c0 \uc5ec\ubd80\ub97c \uacb0\uc815\ud569\ub2c8\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"model.go"),"\uc5d0\uc11c\ub294 CasbinModel\uc744 \uc0dd\uc131, \uc0ad\uc81c, \uc218\uc815\ud558\ub294 \ub2e4\uc591\ud55c \ud568\uc218\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. ",(0,l.kt)("inlineCode",{parentName:"p"},"model_test.go"),"\uc5d0\uc11c \uc774\ub7ec\ud55c \uc778\ud130\ud398\uc774\uc2a4\ub97c \uc5b4\ub5bb\uac8c \uc0ac\uc6a9\ud558\ub294\uc9c0 \uc54c\uc544\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"policy.go"),"\uc5d0\uc11c\ub294 CasbiPolicy\ub97c \uc0dd\uc131, \uc0ad\uc81c, \uc218\uc815\ud558\ub294 \ub2e4\uc591\ud55c \ud568\uc218\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. ",(0,l.kt)("inlineCode",{parentName:"p"},"policy_test.go"),"\uc5d0\uc11c \uc774\ub7ec\ud55c \uc778\ud130\ud398\uc774\uc2a4\ub97c \uc5b4\ub5bb\uac8c \uc0ac\uc6a9\ud558\ub294\uc9c0 \uc54c\uc544\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("h3",{id:"312-k8s-gatekeeper-\uc791\ub3d9-\uc5ec\ubd80-\ud655\uc778"},"3.1.2 K8s-gatekeeper \uc791\ub3d9 \uc5ec\ubd80 \ud655\uc778"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo"),"\uc5d0\uc11c \uc815\ud655\ud55c \ubaa8\ub378\uacfc \uc815\ucc45\uc744 \uc774\ubbf8 \uc0dd\uc131\ud588\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. \uc774\uc81c, \ub2e4\uc74c \uba85\ub839\uc744 \uc2dc\ub3c4\ud574 \ubcf4\uc138\uc694:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f example/allowed_repo/testcase/reject_1.yaml\n")),(0,l.kt)("p",null,"K8s\uac00 \uc774 \uc694\uccad\uc744 \uac70\ubd80\ud558\uace0, \uc6f9\ud6c5\uc774 \uc774 \uc694\uccad\uc774 \uac70\ubd80\ub41c \uc774\uc720\ub77c\uace0 \uc5b8\uae09\ud558\ub294 \uac83\uc744 \ubc1c\uacac\ud574\uc57c \ud569\ub2c8\ub2e4. \uadf8\ub7ec\ub098, ",(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/testcase/approve_2.yaml"),"\uc744 \uc801\uc6a9\ud558\ub824\uace0 \ud558\uba74, \uc774\ub294 \uc218\ub77d\ub420 \uac83\uc785\ub2c8\ub2e4."),(0,l.kt)("h2",{id:"4-k8s-gatekeeper\ub85c-\ubaa8\ub378\uacfc-\uc815\ucc45-\uc791\uc131-\ubc29\ubc95"},"4. K8s-gatekeeper\ub85c \ubaa8\ub378\uacfc \uc815\ucc45 \uc791\uc131 \ubc29\ubc95"),(0,l.kt)("p",null,"\uba3c\uc800, Casbin \ubaa8\ub378\uacfc \uc815\ucc45\uc758 \uae30\ubcf8 \ubb38\ubc95\uc5d0 \uc775\uc219\ud574\uc57c \ud569\ub2c8\ub2e4. \uadf8\ub807\uc9c0 \uc54a\ub2e4\uba74, \uba3c\uc800 ",(0,l.kt)("a",{parentName:"p",href:"/docs/get-started"},"\uc2dc\uc791\ud558\uae30")," \uc139\uc158\uc744 \uc77d\uc5b4\ubcf4\uc2ed\uc2dc\uc624. \uc774 \uc7a5\uc5d0\uc11c\ub294 \uc774\ubbf8 Casbin \ubaa8\ub378\uacfc \uc815\ucc45\uc774 \ubb34\uc5c7\uc778\uc9c0 \uc774\ud574\ud558\uace0 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4."),(0,l.kt)("h3",{id:"41-\ubaa8\ub378\uc758-\uc694\uccad-\uc815\uc758"},"4.1 \ubaa8\ub378\uc758 \uc694\uccad \uc815\uc758"),(0,l.kt)("p",null,"K8s-gatekeeper\uac00 \uc694\uccad\uc744 \uc778\uc99d\ud560 \ub54c, \uc785\ub825\uc740 \ud56d\uc0c1 \uac1d\uccb4\uc785\ub2c8\ub2e4: Admission Request\uc758 Go \uac1d\uccb4\uc785\ub2c8\ub2e4. \uc774\ub294 enforcer\uac00 \ud56d\uc0c1 \ub2e4\uc74c\uacfc \uac19\uc774 \uc0ac\uc6a9\ub420 \uac83\uc784\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"ok, err := enforcer.Enforce(admission)\n")),(0,l.kt)("p",null,"\uc5ec\uae30\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"admission"),"\uc740 K8s\uc758 \uacf5\uc2dd go api\uc778 ",(0,l.kt)("inlineCode",{parentName:"p"},'"k8s.io/api/admission/v1"'),"\uc5d0 \uc758\ud574 \uc815\uc758\ub41c ",(0,l.kt)("inlineCode",{parentName:"p"},"AdmissionReview")," \uac1d\uccb4\uc785\ub2c8\ub2e4. \uc774 \uad6c\uc870\uccb4\uc758 \uc815\uc758\ub294 \uc774 \uc800\uc7a5\uc18c\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"},"https://github.com/kubernetes/api/blob/master/admission/v1/types.go"),". \uc790\uc138\ud55c \uc815\ubcf4\ub294 ",(0,l.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"},"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-request-and-response"),"\ub97c \ucc38\uc870\ud558\uc2e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ub530\ub77c\uc11c, K8s-gatekeeper\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \ubaa8\ub4e0 \ubaa8\ub378\uc5d0 \ub300\ud574 ",(0,l.kt)("inlineCode",{parentName:"p"},"request_definition"),"\uc758 \uc815\uc758\ub294 \ud56d\uc0c1 \uc774\ub807\uac8c \ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},"    [request_definition]\n    r =  obj\n")),(0,l.kt)("p",null,"'obj'\ub77c\ub294 \uc774\ub984\uc740 \ud544\uc218\uac00 \uc544\ub2c8\uba70, \uc774\ub984\uc774 ",(0,l.kt)("inlineCode",{parentName:"p"},"[matchers]")," \ubd80\ubd84\uc5d0\uc11c \uc0ac\uc6a9\ub41c \uc774\ub984\uacfc \uc77c\uce58\ud558\uae30\ub9cc \ud558\uba74 \ub429\ub2c8\ub2e4."),(0,l.kt)("h3",{id:"42-\ubaa8\ub378\uc758-matchers"},"4.2 \ubaa8\ub378\uc758 Matchers"),(0,l.kt)("p",null,"\uaddc\uce59\uc744 \uc791\uc131\ud560 \ub54c Casbin\uc758 ABAC \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \uadf8\ub7ec\ub098, Casbin\uc5d0 \ud1b5\ud569\ub41c \ud45c\ud604\uc2dd \ud3c9\uac00\uae30\ub294 \ub9f5\uc774\ub098 \ubc30\uc5f4(\uc2ac\ub77c\uc774\uc2a4)\uc5d0\uc11c\uc758 \uc778\ub371\uc2f1\uc744 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc73c\uba70, \ubc30\uc5f4\uc758 \ud655\uc7a5\ub3c4 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c, K8s-gatekeeper\ub294 \uc774\ub7ec\ud55c \uae30\ub2a5\uc744 \uad6c\ud604\ud558\uae30 \uc704\ud574 \ub2e4\uc591\ud55c 'Casbin \ud568\uc218'\ub97c \ud655\uc7a5\uc73c\ub85c \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ud655\uc7a5\uc73c\ub85c\ub3c4 \uc694\uad6c\uc0ac\ud56d\uc744 \ucda9\uc871\uc2dc\ud0a4\uc9c0 \ubabb\ud55c\ub2e4\uba74, \uc790\uc720\ub86d\uac8c \uc774\uc288\ub97c \uc2dc\uc791\ud558\uac70\ub098 \ud480 \ub9ac\ud018\uc2a4\ud2b8\ub97c \uc0dd\uc131\ud558\uc2ed\uc2dc\uc624."),(0,l.kt)("p",null,"Casbin \ud568\uc218\uc5d0 \uc775\uc219\ud558\uc9c0 \uc54a\ub2e4\uba74, \uc790\uc138\ud55c \uc815\ubcf4\ub97c \uc5bb\uae30 \uc704\ud574 ",(0,l.kt)("a",{parentName:"p",href:"/docs/function"},"Function"),"\uc744 \ucc38\uc870\ud558\uc2e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ub2e4\uc74c\uc740 \ud655\uc7a5 \ud568\uc218\uc785\ub2c8\ub2e4:"),(0,l.kt)("h3",{id:"421-\ud655\uc7a5-\ud568\uc218"},"4.2.1 \ud655\uc7a5 \ud568\uc218"),(0,l.kt)("h4",{id:"4211-\uc811\uadfc"},"4.2.1.1 \uc811\uadfc"),(0,l.kt)("p",null,"Access\ub294 Casbin\uc774 \ub9f5\uc774\ub098 \ubc30\uc5f4\uc5d0\uc11c\uc758 \uc778\ub371\uc2f1\uc744 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \uc774 \ud568\uc218\uc758 \uc0ac\uc6a9\ubc95\uc740 ",(0,l.kt)("inlineCode",{parentName:"p"},"example/allowed_repo/model.yaml")," \uc608\uc81c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\nm = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\naccess(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image") == p.obj\n')),(0,l.kt)("p",null,"\uc774 matcher\uc5d0\uc11c, ",(0,l.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Image")'),"\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Image"),"\uc640 \ub3d9\uc77c\ud558\uba70, \uc5ec\uae30\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers"),"\ub294 \uc2ac\ub77c\uc774\uc2a4\uc785\ub2c8\ub2e4."),(0,l.kt)("p",null,"Access\ub294 \ub9e4\uac1c\ubcc0\uc218\uac00 \uc5c6\uace0 \ub2e8\uc77c \uac12\uc744 \ubc18\ud658\ud558\ub294 \uac04\ub2e8\ud55c \ud568\uc218\ub97c \ud638\ucd9c\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"example/container_resource_limit/model.yaml")," \uc608\uc81c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'[matchers]\n  m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")) >= parseFloat(p.cpu) && \\\n  parseFloat(access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","memory","Value")) >= parseFloat(p.memory)\n')),(0,l.kt)("p",null,"\uc774 matcher\uc5d0\uc11c, ",(0,l.kt)("inlineCode",{parentName:"p"},'access(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , 0, "Resources","Limits","cpu","Value")'),"\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},'r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits["cpu"].Value()'),"\uc640 \ub3d9\uc77c\ud558\uba70, \uc5ec\uae30\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"r.obj.Request.Object.Object.Spec.Template.Spec.Containers[0].Resources.Limits"),"\ub294 \ub9f5\uc774\uace0, ",(0,l.kt)("inlineCode",{parentName:"p"},"Value()"),"\ub294 \ub9e4\uac1c\ubcc0\uc218\uac00 \uc5c6\uace0 \ub2e8\uc77c \uac12\uc744 \ubc18\ud658\ud558\ub294 \uac04\ub2e8\ud55c \ud568\uc218\uc785\ub2c8\ub2e4."),(0,l.kt)("h4",{id:"4212-accesswithwildcard"},"4.2.1.2 accessWithWildcard"),(0,l.kt)("p",null,'\ub54c\ub54c\ub85c, \ubc30\uc5f4\uc758 \ubaa8\ub4e0 \uc694\uc18c\uac00 "aaa" \uc811\ub450\uc0ac\ub97c \uac00\uc838\uc57c \ud558\ub294 \uc694\uad6c\uc0ac\ud56d\uc774 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7ec\ub098, Casbin\uc740 ',(0,l.kt)("inlineCode",{parentName:"p"},"for")," \ub8e8\ud504\ub97c \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. ",(0,l.kt)("inlineCode",{parentName:"p"},"accessWithWildcard"),'\uc640 "map/slice expansion" \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uba74 \uc774\ub7ec\ud55c \uc694\uad6c\uc0ac\ud56d\uc744 \uc27d\uac8c \uad6c\ud604\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.'),(0,l.kt)("p",null,"\uc608\ub97c \ub4e4\uc5b4, ",(0,l.kt)("inlineCode",{parentName:"p"},"a.b.c"),"\uac00 \ubc30\uc5f4 ",(0,l.kt)("inlineCode",{parentName:"p"},"[aaa,bbb,ccc,ddd,eee]"),"\ub77c\uba74, ",(0,l.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a,"b","c","*")'),"\uc758 \uacb0\uacfc\ub294 \uc2ac\ub77c\uc774\uc2a4 ",(0,l.kt)("inlineCode",{parentName:"p"},"[aaa,bbb,ccc,ddd,eee]"),"\uac00 \ub429\ub2c8\ub2e4. \uc640\uc77c\ub4dc\uce74\ub4dc ",(0,l.kt)("inlineCode",{parentName:"p"},"*"),"\ub97c \uc0ac\uc6a9\ud558\uba74 \uc2ac\ub77c\uc774\uc2a4\uac00 \ud655\uc7a5\ub429\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ub9c8\ucc2c\uac00\uc9c0\ub85c, \uc640\uc77c\ub4dc\uce74\ub4dc\ub294 \ud55c \ubc88 \uc774\uc0c1 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, ",(0,l.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(a,"b","c","*","*")'),"\uc758 \uacb0\uacfc\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"[a.b.c[0][0], a.b.c[0][1], ..., a.b.c[1][0], a.b.c[1][1], ...]"),"\uac00 \ub429\ub2c8\ub2e4."),(0,l.kt)("h3",{id:"4213-\uac00\ubcc0-\uae38\uc774-\uc778\uc218\ub97c-\uc9c0\uc6d0\ud558\ub294-\ud568\uc218"},"4.2.1.3 \uac00\ubcc0 \uae38\uc774 \uc778\uc218\ub97c \uc9c0\uc6d0\ud558\ub294 \ud568\uc218"),(0,l.kt)("p",null,"Casbin\uc758 \ud45c\ud604\uc2dd \ud3c9\uac00\uae30\uc5d0\uc11c \ub9e4\uac1c\ubcc0\uc218\uac00 \ubc30\uc5f4\uc778 \uacbd\uc6b0, \uc774\ub294 \uc790\ub3d9\uc73c\ub85c \uac00\ubcc0 \uae38\uc774 \uc778\uc218\ub85c \ud655\uc7a5\ub429\ub2c8\ub2e4. \uc774 \uae30\ub2a5\uc744 \ud65c\uc6a9\ud558\uc5ec \ubc30\uc5f4/\uc2ac\ub77c\uc774\uc2a4/\ub9f5 \ud655\uc7a5\uc744 \uc9c0\uc6d0\ud558\uba70, \ubc30\uc5f4/\uc2ac\ub77c\uc774\uc2a4\ub97c \ub9e4\uac1c\ubcc0\uc218\ub85c \ubc1b\ub294 \uc5ec\ub7ec \ud568\uc218\ub97c \ud1b5\ud569\ud588\uc2b5\ub2c8\ub2e4:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"contain(): \uc5ec\ub7ec \ub9e4\uac1c\ubcc0\uc218\ub97c \ubc1b\uc544 \ub9c8\uc9c0\ub9c9 \ub9e4\uac1c\ubcc0\uc218\ub97c \uc81c\uc678\ud55c \uc5b4\ub5a4 \ub9e4\uac1c\ubcc0\uc218\ub4e0 \ub9c8\uc9c0\ub9c9 \ub9e4\uac1c\ubcc0\uc218\uc640 \uac19\uc740\uc9c0 \uc5ec\ubd80\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"split(a,b,c...,sep,index): ",(0,l.kt)("inlineCode",{parentName:"li"},"[splits(a,sep)[index], splits(b,sep)[index], splits(a,sep)[index], ...]"),"\ub97c \ud3ec\ud568\ud558\ub294 \uc2ac\ub77c\uc774\uc2a4\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"len(): \uac00\ubcc0 \uae38\uc774 \uc778\uc218\uc758 \uae38\uc774\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"matchRegex(a,b,c...,regex): \uc8fc\uc5b4\uc9c4 \ubaa8\ub4e0 \ub9e4\uac1c\ubcc0\uc218 (",(0,l.kt)("inlineCode",{parentName:"li"},"a"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"b"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"c"),", ...)\uac00 \uc8fc\uc5b4\uc9c4 regex\uc640 \uc77c\uce58\ud558\ub294\uc9c0 \uc5ec\ubd80\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4.")),(0,l.kt)("p",null,"\ub2e4\uc74c\uc740 ",(0,l.kt)("inlineCode",{parentName:"p"},"example/disallowed_tag/model.yaml"),"\uc5d0\uc11c\uc758 \uc608\uc2dc\uc785\ub2c8\ub2e4:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini"},'    [matchers]\n    m = r.obj.Request.Namespace == "default" && r.obj.Request.Resource.Resource =="deployments" && \\\n    contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},'accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image")'),"\uac00 ",(0,l.kt)("inlineCode",{parentName:"p"},'["a:b", "c:d", "e:f", "g:h"]'),"\ub97c \ubc18\ud658\ud55c\ub2e4\uace0 \uac00\uc815\ud558\uba74, splits\ub294 \uac00\ubcc0 \uae38\uc774 \uc778\uc218\ub97c \uc9c0\uc6d0\ud558\uace0 \uac01 \uc694\uc18c\uc5d0 \ub300\ud574 splits \uc5f0\uc0b0\uc744 \uc218\ud589\ud558\ubbc0\ub85c, \uc778\ub371\uc2a4 1\uc758 \uc694\uc18c\uac00 \uc120\ud0dd\ub418\uc5b4 \ubc18\ud658\ub429\ub2c8\ub2e4. \ub530\ub77c\uc11c, ",(0,l.kt)("inlineCode",{parentName:"p"},'split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1)'),"\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},'["b","d","f","h"]'),"\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4. \uadf8\ub9ac\uace0 ",(0,l.kt)("inlineCode",{parentName:"p"},'contain(split(accessWithWildcard(r.obj.Request.Object.Object.Spec.Template.Spec.Containers , "*", "Image"),":",1) , p.obj)'),"\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"p.obj"),"\uac00 ",(0,l.kt)("inlineCode",{parentName:"p"},'["b","d","f","h"]'),"\uc5d0 \ud3ec\ud568\ub418\uc5b4 \uc788\ub294\uc9c0 \uc5ec\ubd80\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."),(0,l.kt)("h4",{id:"4212-\ud0c0\uc785-\ubcc0\ud658-\ud568\uc218\ub4e4"},"4.2.1.2 \ud0c0\uc785 \ubcc0\ud658 \ud568\uc218\ub4e4"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"ParseFloat(): \uc815\uc218\ub97c \ubd80\ub3d9\uc18c\uc218\uc810\uc73c\ub85c \ubcc0\ud658\ud569\ub2c8\ub2e4 (\ube44\uad50\uc5d0 \uc0ac\uc6a9\ub418\ub294 \ubaa8\ub4e0 \uc22b\uc790\ub294 \ubd80\ub3d9\uc18c\uc218\uc810\uc73c\ub85c \ubcc0\ud658\ub418\uc5b4\uc57c \ud558\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4)."),(0,l.kt)("li",{parentName:"ul"},"ToString(): \uac1d\uccb4\ub97c \ubb38\uc790\uc5f4\ub85c \ubcc0\ud658\ud569\ub2c8\ub2e4. \uc774 \uac1d\uccb4\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ubb38\uc790\uc5f4 \ud0c0\uc785\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4 (\uc608\ub97c \ub4e4\uc5b4, ",(0,l.kt)("inlineCode",{parentName:"li"},"type XXX string"),"\uc774\ub77c\ub294 \ubb38\uc7a5\uc774 \uc788\uc744 \ub54c ",(0,l.kt)("inlineCode",{parentName:"li"},"XXX")," \ud0c0\uc785\uc758 \uac1d\uccb4)."),(0,l.kt)("li",{parentName:"ul"},"IsNil(): \ub9e4\uac1c\ubcc0\uc218\uac00 nil\uc778\uc9c0 \uc5ec\ubd80\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4.")),(0,l.kt)("h2",{id:"5-\uace0\uae09-\uc124\uc815"},"5. \uace0\uae09 \uc124\uc815"),(0,l.kt)("h3",{id:"51-\uc778\uc99d\uc11c\uc5d0-\ub300\ud558\uc5ec"},"5.1 \uc778\uc99d\uc11c\uc5d0 \ub300\ud558\uc5ec"),(0,l.kt)("p",null,"\ucfe0\ubc84\ub124\ud2f0\uc2a4(k8s)\uc5d0\uc11c\ub294 \uc6f9\ud6c5\uc774 HTTPS\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \ud544\uc218\uc785\ub2c8\ub2e4. \uc774\ub97c \ub2ec\uc131\ud558\uae30 \uc704\ud55c \ub450 \uac00\uc9c0 \uc811\uadfc\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\uc790\uccb4 \uc11c\uba85 \uc778\uc99d\uc11c \uc0ac\uc6a9 (\uc774 \uc800\uc7a5\uc18c\uc758 \uc608\uc81c\uc5d0\uc11c\ub294 \uc774 \ubc29\ubc95\uc744 \uc0ac\uc6a9)"),(0,l.kt)("li",{parentName:"ul"},"\uc77c\ubc18 \uc778\uc99d\uc11c \uc0ac\uc6a9")),(0,l.kt)("h4",{id:"511-\uc790\uccb4-\uc11c\uba85-\uc778\uc99d\uc11c"},"5.1.1 \uc790\uccb4 \uc11c\uba85 \uc778\uc99d\uc11c"),(0,l.kt)("p",null,"\uc790\uccb4 \uc11c\uba85 \uc778\uc99d\uc11c\ub97c \uc0ac\uc6a9\ud55c\ub2e4\ub294 \uac83\uc740 \uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud558\ub294 \uc778\uc99d \uae30\uad00(CA)\uc774 \uc798 \uc54c\ub824\uc9c4 CA \uc911 \ud558\ub098\uac00 \uc544\ub2c8\ub77c\ub294 \uac83\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c, k8s\uc5d0 \uc774 CA\ub97c \uc54c\ub824\uc57c \ud569\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ud604\uc7ac, \uc774 \uc800\uc7a5\uc18c\uc758 \uc608\uc81c\uc5d0\uc11c\ub294 \uc790\uccb4 \uc81c\uc791 CA\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\uc73c\uba70, \uadf8 \uac1c\uc778 \ud0a4\uc640 \uc778\uc99d\uc11c\ub294 \uac01\uac01 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.crt"),"\uc640 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/certificate/ca.key"),"\uc5d0 \uc800\uc7a5\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc6f9\ud6c5\uc758 \uc778\uc99d\uc11c\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"config/certificate/server.crt"),'\ub85c, \uc774\ub294 \uc790\uccb4 \uc81c\uc791 CA\uc5d0 \uc758\ud574 \ubc1c\uae09\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc774 \uc778\uc99d\uc11c\uc758 \ub3c4\uba54\uc778\uc740 "webhook.domain.local" (\uc678\ubd80 \uc6f9\ud6c5\uc6a9)\uacfc "casbin-webhook-svc.default.svc" (\ub0b4\ubd80 \uc6f9\ud6c5\uc6a9)\uc785\ub2c8\ub2e4.'),(0,l.kt)("p",null,"CA\uc5d0 \ub300\ud55c \uc815\ubcf4\ub294 \uc6f9\ud6c5 \uc124\uc815 \ud30c\uc77c\uc744 \ud1b5\ud574 k8s\uc5d0 \uc804\ub2ec\ub429\ub2c8\ub2e4. ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml"),"\uacfc ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),' \ubaa8\ub450 "CABundle"\uc774\ub77c\ub294 \ud544\ub4dc\ub97c \uac00\uc9c0\uace0 \uc788\uc73c\uba70, \uc774\ub294 CA\uc758 \uc778\uc99d\uc11c\uc758 base64 \uc778\ucf54\ub529 \ubb38\uc790\uc5f4\uc744 \ud3ec\ud568\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4.'),(0,l.kt)("p",null,"\uc778\uc99d\uc11c/\ub3c4\uba54\uc778\uc744 \ubcc0\uacbd\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 (\uc608\ub97c \ub4e4\uc5b4, \ub0b4\ubd80 \uc6f9\ud6c5\uc744 \uc0ac\uc6a9\ud558\uba74\uc11c \uc774 \uc6f9\ud6c5\uc744 k8s\uc758 \ub2e4\ub978 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub85c \uc62e\uae30\uace0 \uc2f6\uac70\ub098, \uc678\ubd80 \uc6f9\ud6c5\uc744 \uc0ac\uc6a9\ud558\uba74\uc11c \ub3c4\uba54\uc778\uc744 \ubcc0\uacbd\ud558\uace0 \uc2f6\uc740 \uacbd\uc6b0) \ub2e4\uc74c \uc808\ucc28\ub97c \ub530\ub77c\uc57c \ud569\ub2c8\ub2e4:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\uc0c8\ub85c\uc6b4 CA \uc0dd\uc131:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uac00\uc9dc CA\uc758 \uac1c\uc778 \ud0a4\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out ca.key 2048\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uac1c\uc778 \ud0a4\uc758 \ube44\ubc00\ubc88\ud638 \ubcf4\ud638\ub97c \uc81c\uac70\ud569\ub2c8\ub2e4:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl rsa -in ca.key -out ca.key\n"))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\uc6f9\ud6c5 \uc11c\ubc84\uc758 \uac1c\uc778 \ud0a4\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl genrsa -des3 -out server.key 2048\nopenssl rsa -in server.key -out server.key\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\uc790\uccb4 \uc0dd\uc131\ub41c CA\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc6f9\ud6c5\uc758 \uc778\uc99d\uc11c\uc5d0 \uc11c\uba85\ud569\ub2c8\ub2e4:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uc784\uc2dc \uc0ac\uc6a9\uc744 \uc704\ud574 \uc2dc\uc2a4\ud15c\uc758 openssl \uc124\uc815 \ud30c\uc77c\uc744 \ubcf5\uc0ac\ud569\ub2c8\ub2e4. ",(0,l.kt)("inlineCode",{parentName:"p"},"openssl version -a"),"\ub97c \uc2e4\ud589\ud558\uc5ec \uc124\uc815 \ud30c\uc77c\uc758 \uc704\uce58\ub97c \ucc3e\uc744 \uc218 \uc788\uc73c\uba70, \uc77c\ubc18\uc801\uc73c\ub85c ",(0,l.kt)("inlineCode",{parentName:"p"},"openssl.cnf"),"\ub77c\uace0 \ubd88\ub9bd\ub2c8\ub2e4.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uc124\uc815 \ud30c\uc77c\uc5d0\uc11c:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"[req]")," \ub2e8\ub77d\uc744 \ucc3e\uc544 \ub2e4\uc74c \uc904\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4: ",(0,l.kt)("inlineCode",{parentName:"p"},"req_extensions = v3_req"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"[v3_req]")," \ub2e8\ub77d\uc744 \ucc3e\uc544 \ub2e4\uc74c \uc904\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4: ",(0,l.kt)("inlineCode",{parentName:"p"},"subjectAltName = @alt_names"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\ud30c\uc77c\uc5d0 \ub2e4\uc74c \uc904\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-ini"},"[alt_names]\nDNS.2=<The domain you want>\n")),(0,l.kt)("p",{parentName:"li"},"\ucc38\uace0: \uc11c\ube44\uc2a4 \uc774\ub984\uc744 \uc218\uc815\ud558\uae30\ub85c \uacb0\uc815\ud55c \uacbd\uc6b0 \uc2e4\uc81c \uc11c\ube44\uc2a4\uc758 \uc11c\ube44\uc2a4 \uc774\ub984\uc73c\ub85c 'casbin-webhook-svc.default.svc'\ub97c \uad50\uccb4\ud569\ub2c8\ub2e4.")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uc218\uc815\ub41c \uc124\uc815 \ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc778\uc99d\uc11c \uc694\uccad \ud30c\uc77c\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl req -new -nodes -keyout server.key -out server.csr -config openssl.cnf\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uc790\uccb4 \uc81c\uc791 CA\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc694\uccad\uc5d0 \uc751\ub2f5\ud558\uace0 \uc778\uc99d\uc11c\uc5d0 \uc11c\uba85\ud569\ub2c8\ub2e4:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl x509 -req -days 3650 -in server.csr -out server.crt -CA ca.crt -CAkey ca.key -CAcreateserial -extensions v3_req -extensions SAN -extfile openssl.cnf\n"))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"'CABundle' \ud544\ub4dc\ub97c \uad50\uccb4\ud569\ub2c8\ub2e4: ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," \ubc0f ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),"\uc5d0\ub294 CA\uc758 \uc778\uc99d\uc11c\uc758 base64 \uc778\ucf54\ub529 \ubb38\uc790\uc5f4\uc774 \ud3ec\ud568\ub41c 'CABundle'\uc774\ub77c\ub294 \ud544\ub4dc\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ud544\ub4dc\ub97c \uc0c8 \uc778\uc99d\uc11c\ub85c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"helm\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0, helm \ucc28\ud2b8\uc5d0\ub3c4 \ube44\uc2b7\ud55c \ubcc0\uacbd\uc774 \uc801\uc6a9\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4."))),(0,l.kt)("h4",{id:"512-\ubc95\uc801-\uc778\uc99d\uc11c"},"5.1.2 \ubc95\uc801 \uc778\uc99d\uc11c"),(0,l.kt)("p",null,"\ubc95\uc801 \uc778\uc99d\uc11c\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0, \uc774 \ubaa8\ub4e0 \uc808\ucc28\ub97c \uac70\uce60 \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_external.yaml")," \ubc0f ",(0,l.kt)("inlineCode",{parentName:"p"},"config/webhook_internal.yaml"),"\uc5d0\uc11c 'CABundle' \ud544\ub4dc\ub97c \uc81c\uac70\ud558\uace0, \uc774 \ud30c\uc77c\ub4e4\uc758 \ub3c4\uba54\uc778\uc744 \uc18c\uc720\ud55c \ub3c4\uba54\uc778\uc73c\ub85c \ubcc0\uacbd\ud569\ub2c8\ub2e4."))}k.isMDXComponent=!0}}]);